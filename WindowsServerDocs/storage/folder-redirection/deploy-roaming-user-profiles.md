---
Title: 移動ユーザー プロファイルを展開します。
TOCTitle: Deploying Roaming User Profiles
ms.prod: windows-server-threshold
ms.technology: storage
ms.topic: article
author: JasonGerend
manager: brianlic
ms.date: 07/09/2018
ms.author: jgerend
ms.openlocfilehash: c662b8c44e3603ec972e06f3fb0ddbd55e1af904
ms.sourcegitcommit: 0b5fd4dc4148b92480db04e4dc22e139dcff8582
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/24/2019
ms.locfileid: "66192721"
---
# <a name="deploying-roaming-user-profiles"></a>移動ユーザー プロファイルを展開します。

>適用対象:Windows 10、Windows 8.1、Windows 8、Windows 7、Windows Server 2019、Windows Server 2016、Windows Server (半期チャネル)、Windows Server 2012 R2、Windows Server 2012、Windows Server 2008 R2

このトピックでは、Windows Server を使用してデプロイする方法を説明します。[移動ユーザー プロファイル](folder-redirection-rup-overview.md)Windows クライアント コンピューターにします。 移動ユーザー プロファイルのユーザーが、同じオペレーティング システムと複数のコンピューターでアプリケーションの設定を受け取れるように、ユーザー プロファイルをファイル共有にリダイレクトします。

このトピックに対する最近の変更の一覧は、次を参照してください。、[変更履歴](#change-history)このトピックの「します。

>[!IMPORTANT]
>セキュリティの変更により[MS16 072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016)、更新された[手順 4。必要に応じて移動ユーザー プロファイルの GPO を作成](#step-4-optionally-create-a-gpo-for-roaming-user-profiles)このトピックの「その Windows をできるように正しく移動ユーザー プロファイル ポリシーを適用 (影響受ける Pc でローカル ポリシーを元に戻されません)。

> [!IMPORTANT]
>  開始するユーザーのカスタマイズは、次の構成の OS、インプレース アップグレード後に失われます。
> - ユーザーのローミング プロファイルを構成します。
> - 許可されている変更を開始する
>
> その結果、[スタート] メニューは、OS インプレース アップグレード後に、新しい OS のバージョンの既定値にリセットされます。 回避策は、次を参照してください[付録 c:。作業は、アップグレード後に [スタート] メニューのレイアウトをリセットする約](#appendix-c-working-around-reset-start-menu-layouts-after-upgrades)します。

## <a name="prerequisites"></a>前提条件

### <a name="hardware-requirements"></a>ハードウェア要件

移動ユーザー プロファイル、x64 ベースまたは x86 ベースのコンピューターが必要です。Windows RT. によってサポートされていません

### <a name="software-requirements"></a>ソフトウェア要件

移動ユーザー プロファイルには次のソフトウェア要件があります。

- 既存のローカル ユーザー プロファイルのある環境に、フォルダー リダイレクトと共に移動ユーザー プロファイルを展開する場合、移動ユーザー プロファイルの前にフォルダー リダイレクトを展開して、移動プロファイルのサイズを最小にします。 既存のユーザー フォルダーが正しくリダイレクトされたら、移動ユーザー プロファイルを展開できます。
- 移動ユーザー プロファイルを管理するには、Domain Administrators セキュリティ グループ、Enterprise Administrators セキュリティ グループ、または Group Policy Creator Owners セキュリティ グループのメンバーとしてサインインする必要があります。
- クライアント コンピューターには、Windows 10、Windows 8.1、Windows 8、Windows 7、Windows Vista、Windows Server 2012 R2、Windows Server 2012、Windows Server 2008 R2、または Windows Server 2008 を実行する必要があります。
- クライアント コンピューターは、管理している Active Directory ドメイン サービス (AD DS) に参加している必要があります。
- グループ ポリシー管理および Active Directory 管理センターがインストールされたコンピューターが使用できる必要があります。
- 移動ユーザー プロファイルをホストするためにファイル サーバーが使用できる必要があります。

    - ファイル共有で DFS 名前空間を使用している場合、ユーザーのさまざまなサーバーへの編集の競合を防ぐため、DFS フォルダー (リンク) のターゲットは 1 つである必要があります。
    - ファイル共有で DFS レプリケーションを使用して、コンテンツを別のサーバーにレプリケートする場合、ユーザーのさまざまなサーバーへの編集の競合を防ぐため、ユーザーはソース サーバーにのみアクセスできる必要があります。
    - ファイル共有がクラスター化されている場合は、パフォーマンスの問題を回避するため、ファイル共有での継続的可用性を無効にします。
- プライマリ コンピューターのサポートを使用して、移動ユーザー プロファイルには、追加のクライアント コンピューターと Active Directory スキーマの要件があります。 詳細については、次を参照してください。[フォルダー リダイレクトと移動ユーザー プロファイル用のプライマリ コンピューターの展開](deploy-primary-computers.md)します。
- ユーザーの [スタート] メニューが Windows 10、Windows Server 2019、または Windows Server 2016 に移動されない 1 つ以上の PC、リモート デスクトップ セッション ホスト、または仮想デスクトップ インフラストラクチャ (VDI) サーバーを使用している場合のレイアウト。 この問題を回避するには、このトピックの説明に従って、スタート画面のレイアウトを指定できます。 行うことができます、または正しくリモート デスクトップ セッション ホスト サーバーまたは VDI サーバーと共に使用する場合の開始 メニューの設定をローミング ユーザー プロファイルのディスクを使用します。 詳細については、次を参照してください。 [Windows Server 2012 でのユーザー プロファイル ディスクのユーザー データの管理を容易に](https://blogs.technet.microsoft.com/enterprisemobility/2012/11/13/easier-user-data-management-with-user-profile-disks-in-windows-server-2012/)します。

### <a name="considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows"></a>複数の Windows のバージョンで移動ユーザー プロファイルを使用する場合の考慮事項

複数の Windows のバージョン間で移動ユーザー プロファイルを使用する場合、次の対策を講じることをお勧めします。

- オペレーティング システムのバージョンごとに、個別のプロファイル バージョンを維持するように Windows を構成します。 これにより、プロファイルの破損など望ましくない予測不能な問題を回避します。
- フォルダー リダイレクトを使用して、ドキュメントやピクチャなどのユーザー ファイルをユーザー プロファイルとは別に保存します。 これにより、ユーザーがオペレーティング システムのバージョンの違いに関係なく、同じファイルを使用できます。 さらに、プロファイルが小さく維持され、サインインが速くなります。
- 移動ユーザー プロファイルに十分な記憶域を割り当てます。 2 つのオペレーティング システムのバージョンをサポートする場合、オペレーティング システム バージョンごとに個別のプロファイルを維持するため、プロファイルの数 (したがって消費される合計の領域) が倍になります。
- Windows Vista および Windows Server 2008 と Windows 7/Windows Server 2008 R2 を実行しているコンピューター間で移動ユーザー プロファイルを使用しないでください。 これらのオペレーティング システムのバージョン間のローミングはそれらのプロファイル バージョンの非互換性が原因でサポートされていません。
- ユーザーに、一方のオペレーティング システム バージョンで行った変更は他方のオペレーティング システム バージョンに移動されないことを通知してください。
- 別のプロファイル バージョンを使用する Windows のバージョンを環境内を移動する場合 (たとえば、Windows 10 バージョン 1607 を Windows 10 の利用から-を参照してください[付録 b:プロファイル バージョン参照情報](#appendix-b-profile-version-reference-information)一覧については)、ユーザーは、空の新しいローミング ユーザー プロファイルを受信します。 一般的なフォルダーをリダイレクトするフォルダーのリダイレクトを使用して新しいプロファイルの取得の影響を最小限に抑えることができます。 移行する移動ユーザー プロファイルの 1 つのプロファイルのバージョンから別のサポートされているメソッドはありません。

## <a name="step-1-enable-the-use-of-separate-profile-versions"></a>手順 1:個別のプロファイル バージョンの使用を有効にする

Windows 8.1、Windows 8、Windows Server 2012 R2、または Windows Server 2012 を実行しているコンピューターを移動ユーザー プロファイルを展開する場合は、展開する前に、Windows 環境にいくつかの変更を加えるをお勧めします。 これらの変更により、将来のオペレーティング システムのアップグレードがスムーズに進み、移動ユーザー プロファイルによって、複数の Windows のバージョンを同時に実行できるようになります。

これらの変更を行うには、次の手順に従います。

1. 移動、固定、スーパー固定、またはドメインの既定のプロファイルを使用するすべてのコンピューターに、適切なソフトウェア更新をダウンロードしてインストールします。

    - Windows 8.1、または Windows Server 2012 R2: 記事で説明されているソフトウェア更新プログラムをインストール[2887595](http://support.microsoft.com/kb/2887595)で、マイクロソフト サポート技術情報 (リリースされた) 場合。
    - Windows 8 または Windows Server 2012: Microsoft サポート技術情報の記事 [2887239](http://support.microsoft.com/kb/2887239) で説明されているソフトウェア更新プログラムをインストールします。
2. Windows 8.1、Windows 8、Windows Server 2012 R2、または移動ユーザー プロファイルを使用する Windows Server 2012 を実行するすべてのコンピューターでレジストリ エディターを使用して、または、次のレジストリを作成するグループ ポリシーがキー DWORD の値とするように設定`1`します。 グループ ポリシーを使用してレジストリ キーを作成する方法については、「 [[レジストリ] 項目を構成する](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753092(v=ws.11)>)」を参照してください。

    ```PowerShell
    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ProfSvc\Parameters\UseProfilePathExtensionVersion
    ```

    >[!WARNING]
    >レジストリを正しく編集しないと、システムが正常に動作しなくなる場合があります。 レジストリを変更する前に、コンピューター上の重要なデータのバックアップを作成する必要があります。
3. コンピューターを再起動します。

## <a name="step-2-create-a-roaming-user-profiles-security-group"></a>手順 2:移動ユーザー プロファイルのセキュリティ グループを作成する

環境に移動ユーザー プロファイルをまだ設定していない場合、最初の手順は、移動ユーザー プロファイル ポリシー設定を適用するすべてのユーザーやコンピューターを含むセキュリティ グループを作成することです。

- 汎用移動ユーザー プロファイル展開の管理者は一般にユーザーのセキュリティ グループを作成します。
- リモート デスクトップ サービスまたは仮想デスクトップ展開の管理者は一般にユーザーと共有コンピューターのセキュリティ グループを使用します。

移動ユーザー プロファイルのセキュリティ グループを作成する方法を次に示します。

1. Active Directory 管理センターでコンピューターにサーバー マネージャーを開きますがインストールされます。
2. **ツール**メニューの  **Active Directory 管理センター**します。 Active Directory 管理センターが表示されます。
3. 適切なドメインまたは OU を選択] を右クリックして**新規**、し、[**グループ**します。
4. **[グループの作成]** ウィンドウの **[グループ]** で、次の設定を指定します。

    - **[グループ名]** に、セキュリティ グループの名前を入力します。たとえば、**Roaming User Profiles Users and Computers** のようになります。
    - **グループのスコープ**を選択します**セキュリティ**、し、 **Global**します。
5. **メンバー**セクションで、**追加**します。 [ユーザー、連絡先、コンピューター、サービス アカウントまたはグループの選択] ダイアログ ボックスが表示されます。
6. セキュリティ グループにコンピューター アカウントを含める場合は、**オブジェクトの種類**を選択します、**コンピューター**チェック ボックスをオンにし、選択**OK**します。
7. ユーザー、グループ、または移動ユーザー プロファイルを配置コンピューターの名前を入力 **ok** 、し、 **OK**もう一度です。

## <a name="step-3-create-a-file-share-for-roaming-user-profiles"></a>手順 3:移動ユーザー プロファイルのファイル共有を作成する

(リダイレクトされたフォルダーが移動プロファイル フォルダーの誤ったキャッシュを回避するための共有から独立した)、ユーザー プロファイルで、次の手順を使用して、Windows を実行するサーバーでファイル共有を作成するローミングの個別のファイル共有を既に持っていない場合サーバー。

>[!NOTE]
>一部の機能が異なるか、使用している Windows Server のバージョンに応じて利用できない可能性があります。

Windows Server でファイル共有を作成する方法を次に示します。

1. サーバー マネージャーのナビゲーション ウィンドウで次のように選択します。 **File and Storage Services**、し、**共有**共有のページを表示します。
2. 共有] タイルで、次のように選択します。**タスク**、し、[**新しい共有**します。 新しい共有ウィザードが表示されます。
3. **プロファイルの選択**] ページで [ **SMB 共有-簡易**します。 ファイル サーバー リソース マネージャーがインストールされているありフォルダー管理プロパティを使用している場合、代わりに選択して**SMB 共有 - 高度な**します。
4. **[共有の場所]** ページで、共有を作成するサーバーとボリュームを選択します。
5. **[共有名]** ページで、**[共有名]** ボックスに共有の名前 ( **User Profiles$** など) を入力します。

    >[!TIP]
    >共有を作成するときに、配置することで、共有を非表示に、```$```共有名の後にします。 これにより、共有が通常のブラウザーから非表示になります。
6. **[他の設定]** ページで、**[継続的可用性を有効にする]** チェック ボックスをオフにし (ある場合)、必要に応じて **[アクセスベースの列挙を有効にする]** および **[データ アクセスの暗号化]** チェック ボックスをオンにします。
7. **権限**] ページで、[**アクセス許可をカスタマイズしています**. [セキュリティの詳細設定] ダイアログ ボックスが表示されます。
8. 選択**継承を無効にする**、し、**変換には、このオブジェクトを明示的なアクセス許可にアクセス許可が継承されて**します。
9. アクセス許可の説明に従って設定[移動ユーザー プロファイルをホストしているファイルの必要なアクセス許可の共有](#required-permissions-for-the-file-share-hosting-roaming-user-profiles)され、次のスクリーン ショットでは、一覧にないグループおよびアカウントのアクセス許可を削除し、追加の表示を特別な手順 1. で作成した Roaming User Profiles Users and Computers グループにアクセスを許可します。
    
    ![表 1 で説明されている権限を示すセキュリティ設定 ウィンドウの詳細](media\advanced-security-user-profiles.jpg)
    
    **図 1** 移動ユーザー プロファイル共有のアクセス許可の設定
10. **[SMB 共有 - 高度]** プロファイルを選択した場合、**[管理プロパティ]** ページで、**[ユーザー ファイル]** フォルダーの使用法値を選択します。
11. **[SMB 共有 - 高度]** プロファイルを選択した場合、**[クォータ]** ページで、オプションで共有のユーザーに適用するクォータを選択します。
12. **確認**] ページで、[**作成します。**

### <a name="required-permissions-for-the-file-share-hosting-roaming-user-profiles"></a>必要なアクセス許可、ファイル共有ホスティング移動ユーザー プロファイル

|       |       |       |
|   -   |   -   |   -   |
| ユーザー アカウント | アクセス権 | 対象 |
|   System    |  フル コントロール     |  このフォルダー、サブフォルダー、およびファイル     |
|  管理者     |  フル コントロール     |  このフォルダーのみ     |
|  作成者/所有者     |  フル コントロール     |  サブフォルダーとファイルのみ     |
| データを共有に置く必要があるユーザーのセキュリティ グループ (Roaming User Profiles Users and Computers)      |  フォルダーの一覧/データの読み取り *(アクセス許可の詳細)* <br />フォルダーの作成/データの追加 *(アクセス許可の詳細)* |  このフォルダーのみ     |
| その他のグループおよびアカウント   |  なし (削除)     |       |

## <a name="step-4-optionally-create-a-gpo-for-roaming-user-profiles"></a>手順 4:オプションで移動ユーザー プロファイルの GPO を作成する

移動ユーザー プロファイル設定用の GPO をまだ作成していない場合、次の手順に従って、移動ユーザー プロファイルに使用する空の GPO を作成します。 この GPO は、移動ユーザー プロファイル設定 (別途説明するプライマリ コンピューターのサポートなど) を構成することができ、さらに、一般に仮想デスクトップ環境内やリモート デスクトップ サービスによって展開する場合に行うように、コンピューターで移動ユーザー プロファイルを有効にするためにも使用できます。

移動ユーザー プロファイルの GPO を作成する方法を次に示します。

1. グループ ポリシー管理がインストールされたコンピューターでサーバー マネージャーを開きます。
2. **ツール**メニューの  **Group Policy Management**します。 グループ ポリシー管理が表示されます。
3. ドメインまたは OU の移動ユーザー プロファイルをセットアップしを選択するを右クリックして**このドメインに GPO を作成し、リンクする**します。
4. **新しい GPO** ] ダイアログ ボックスで、GPO の名前を入力します (たとえば、 **Roaming User Profile Settings**)、し、[ **[ok]** 。
5. 新しく作成した GPO を右クリックし、**[リンクの有効化]** チェックボックスをオフにします。 これにより、GPO の構成が完了するまで、それが適用されるのを防ぎます。
6. GPO を選択します。 **セキュリティ フィルター処理**のセクション、**スコープ** タブで  **Authenticated Users**、し、**削除**GPO を回避するにはすべてのユーザーに適用されないようにします。
7. **セキュリティ フィルター処理**セクションで、**追加**します。
8. **ユーザーの選択、コンピューター、またはグループ**ダイアログ ボックスで、手順 1. で作成したグループの名前、セキュリティの種類 (たとえば、 **Roaming User Profiles Users とコンピューター**)、し、 **ok** .
9. 選択、**委任** タブで **追加**、型**Authenticated Users**を選択します **ok** 、し、 **ok** もう一度既定値をそのまま使用するには、読み取りのアクセス許可。
    
    この手順でセキュリティの変更のために必要[MS16 072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016)します。

>[!IMPORTANT]
>セキュリティの変更により[MS16 072A](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016)、今すぐする必要があります提供か Authenticated Users グループの委任の読み取りアクセス許可、GPO に - それ以外の場合、ユーザーに、GPO を適用しないを取得またはが既に適用されている場合、GPO が削除された、ユーザー プロファイルをローカル PC にリダイレクトします。 詳細については、次を参照してください。[を展開するグループ ポリシーのセキュリティ更新プログラム MS16-072](https://blogs.technet.microsoft.com/askds/2016/06/22/deploying-group-policy-security-update-ms16-072-kb3163622/)します。

## <a name="step-5-optionally-set-up-roaming-user-profiles-on-user-accounts"></a>手順 5:オプションでユーザー アカウントに移動ユーザー プロファイルを設定する

移動ユーザー プロファイルをユーザー アカウントに展開する場合、次の手順を使用して、Active Directory ドメイン サービスでユーザー アカウントに移動ユーザー プロファイルを指定します。 したリモート デスクトップ サービスまたは仮想デスクトップ展開では、代わりに使用してで説明する手順の通常行われるように、コンピューターに移動ユーザー プロファイルを展開する場合[手順 6。コンピューターで、移動ユーザー プロファイルを必要に応じてセットアップ](#step-6-optionally-set-up-roaming-user-profiles-on-computers)します。

>[!NOTE]
>移動ユーザー プロファイルを Active Directory を使用してユーザー アカウントに設定し、さらにグループ ポリシーを使用してコンピューターに設定した場合、コンピューターベースのポリシー設定が優先されます。

ユーザー アカウントに移動ユーザー プロファイルを設定する方法を次に示します。

1. Active Directory 管理者センターで、適切なドメインの **[Users]** コンテナー (または OU) に移動します。
2. 移動ユーザー プロファイルを割り当てる、ユーザーを右クリックし、選択するすべてのユーザー選択**プロパティ**します。
3. **プロファイル**セクションで、**プロファイル パス:** チェック ボックスをオンし続けて、ユーザーのローミング ユーザー プロファイルを保存する場所をファイル共有にパスを入力`%username%`(自動的に置き換え、ユーザーがサインイン ユーザー名の最初の時間)。 次に、例を示します。
    
    `\\fs1.corp.contoso.com\User Profiles$\%username%`
    
    固定移動ユーザー プロファイルを指定するには、以前作成した、たとえば、NTuser.man ファイルへのパスを指定`fs1.corp.contoso.comUser Profiles$default`します。 詳細については、次を参照してください。[固定ユーザー プロファイルを作成する](https://docs.microsoft.com/windows/client-management/mandatory-user-profile)します。
4. **[OK]** を選択します。

>[!NOTE]
>既定で、移動ユーザー プロファイルを使用する場合、すべての Windows® ランタイムベース (Windows ストア) アプリの展開が許可されます。 ただし、特殊なプロファイルを使用する場合、アプリは既定で展開されません。 特殊なプロファイルは、ユーザーがサインアウトした後に変更が破棄されるユーザー プロファイルです。
><br><br>特殊なプロファイルのアプリの展開の制限を削除するには、**特殊なプロファイルでの展開操作を許可する**ポリシー設定 (コンピューターの構成\ポリシー\管理用テンプレート\Windows コンポーネント\アプリ パッケージの展開にある) をオンにします。 ただし、このシナリオで展開されたアプリでは、コンピューターに一部のデータが保存されたままになり、単一のコンピューターに数百のユーザーがいる場合に、蓄積される可能性があります。 アプリをクリーンアップする検索または使用するツールを開発、 [CleanupPackageForUserAsync](https://msdn.microsoft.com/library/windows/apps/windows.management.deployment.packagemanager.cleanuppackageforuserasync.aspx)不要になったコンピューターのプロファイルを持っているユーザーに対してアプリ パッケージをクリーンアップする API。
><br><br>Windows ストア アプリの追加の背景情報については、「 [Windows ストアへのクライアント アクセスの管理](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh832040(v=ws.11)>)」を参照してください。

## <a name="step-6-optionally-set-up-roaming-user-profiles-on-computers"></a>手順 6:オプションでコンピューターに移動ユーザー プロファイルを設定する

一般に、リモート デスクトップ サービスや仮想デスクトップの展開で行われるように、移動ユーザー プロファイルをコンピューターに展開する場合は、次の手順に従います。 ユーザー アカウントに移動ユーザー プロファイルを展開する場合で説明する手順を使用して代わりに[手順 5。ユーザー アカウントに、移動ユーザー プロファイルを必要に応じて設定](#step-5-optionally-set-up-roaming-user-profiles-on-user-accounts)します。

グループ ポリシーを使用して、Windows 8.1、Windows 8、Windows 7、Windows Vista、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows Server 2008 R2、または Windows Server 2008 を実行しているコンピューターに移動ユーザー プロファイルを適用することができます。

>[!NOTE]
>移動ユーザー プロファイルをグループ ポリシーを使用してコンピューターに設定し、さらに Active Directory を使用してユーザー アカウントに設定した場合、コンピューターベースのポリシー設定が優先されます。

コンピューターで、移動ユーザー プロファイルを設定する方法を次に示します。

1. グループ ポリシー管理がインストールされたコンピューターでサーバー マネージャーを開きます。
2. **ツール**メニューの  **Group Policy Management**します。 グループ ポリシーの管理が表示されます。
3. グループ ポリシー管理で、手順 3 で作成した GPO を右クリックし (たとえば、 **Roaming User Profiles Settings**)、し、**編集**。
4. グループ ポリシー管理エディター] ウィンドウで、**[コンピューターの構成]**、次に **[ポリシー]**、次に **[管理用テンプレート]**、次に **[システム]**、次に **[ユーザー プロファイル]** に移動します。
5. 右クリック**このコンピューターにログオンするすべてのユーザーの移動プロファイル パスを設定**選び**編集**します。
    > [!TIP]
    > ユーザーのホーム フォルダーは、構成されている場合、Windows PowerShell などの一部のプログラムによって使用される既定のフォルダーです。 AD DS のユーザー アカウントのプロパティーの **[ホーム フォルダー]** セクションを使用して、ユーザー単位で、代替のローカルまたはネットワークの場所を構成できます。 Windows 8.1、Windows 8、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、または仮想デスクトップ環境で Windows Server 2012 を実行するコンピューターのすべてのユーザー ホーム フォルダーの場所を構成するには、有効にする、**ユーザー ホーム フォルダーを設定**ポリシーの設定し、マップの (またはローカル フォルダーを指定) にファイル共有とドライブ文字を指定します。 環境変数や省略記号を使用しないでください。 ユーザーのサインオン時に指定されたパスの最後にユーザーのエイリアスが追加されます。
6. **プロパティ**ダイアログ ボックスで、**有効**
7. **このコンピューターにログオンしているユーザーは、この移動プロファイル パスを使用する必要があります**ボックスに、後に、ユーザーのローミング ユーザー プロファイルを保存するファイル共有へのパスを入力`%username%`(これは自動的に置き換えられますユーザー名の最初の時間と、ユーザーがサインイン)。 例:

    `\\fs1.corp.contoso.com\User Profiles$\%username%`

    事前構成済みのプロファイルをユーザーことはできません (変更は、ユーザーがサインアウトするときにリセットされます) 永続的に変更、作成しておいた、たとえば NTuser.man ファイルへのパスを指定するには、固定移動ユーザー プロファイルを指定する`\\fs1.corp.contoso.com\User Profiles$\default`します。 詳細については、「 [Creating a Mandatory User Profile (固定ユーザー プロファイルの作成)](https://docs.microsoft.com/windows/client-management/mandatory-user-profile)」を参照してください。
8. **[OK]** を選択します。

## <a name="step-7-optionally-specify-a-start-layout-for-windows-10-pcs"></a>手順 7:Windows 10 Pc のスタート画面のレイアウトを必要に応じて指定します。

グループ ポリシーを使用して、ユーザーは、すべての Pc で同じのスタート画面のレイアウトを表示できるように、特定のスタート メニューのレイアウトを適用することができます。 ユーザーは、複数の pc にサインインを使用して、Pc 間で一貫性のある開始レイアウトがあるように、各自の Pc のすべてに、GPO が適用されることを確認します。

スタート画面のレイアウトを指定するには、次の操作を行います。

1. Windows 10 バージョン 1607 (とも呼ばれる、Anniversary Update)、Windows 10 Pc を更新またはそれ以降、2017 年 3 月 14 日の累積的な更新プログラムをインストール ([KB4013429](https://support.microsoft.com/kb/4013429)) またはそれ以降。
2. 完全または部分的なスタート メニューのレイアウト XML ファイルを作成します。 これを行うを参照してください。[カスタマイズとエクスポートのスタート画面のレイアウト](https://docs.microsoft.com/windows/configuration/customize-and-export-start-layout)します。
    * 指定した場合、*完全*スタート画面のレイアウト、ユーザーが [スタート] メニューの任意の部分をカスタマイズすることはできません。 指定した場合、*部分*スタート画面のレイアウト、ユーザーがカスタマイズできるすべてのタイルを指定するロックのグループが。 ただし、スタートの部分のレイアウトでは、[スタート] メニューに対するユーザーのカスタマイズは他の Pc に移動されません。
3. グループ ポリシーを使用すると、移動ユーザー プロファイル用に作成した GPO をカスタマイズしたスタートのレイアウトを適用できます。 これを行うを参照してください。[ドメインでカスタマイズされたスタート レイアウトを適用するグループ ポリシーを使って](https://docs.microsoft.com/windows/configuration/customize-windows-10-start-screens-by-using-group-policy#bkmk-domaingpodeployment)します。
4. グループ ポリシーを使用して、Windows 10 Pc で次のレジストリ値を設定します。 これを行うを参照してください。[レジストリ項目を構成する](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753092(v=ws.11)>)します。

| **操作** | **Update** |
|------------|------------|
|［ハイブ］|**HKEY_LOCAL_MACHINE**|
|キーのパス|**Software\Microsoft\Windows\CurrentVersion\Explorer**|
|値の名前|**SpecialRoamingOverrideAllowed**|
|[値の型]|**REG_DWORD**|
|[値] に|**1** (または**0**を無効にする)|
|基本|**10 進数**|

5. (省略可能)高速ユーザーをサインインさせる初回ログオンの最適化を有効にします。 これを行うを参照してください。[サインインの時間を短縮するポリシーを適用する](https://docs.microsoft.com/windows/client-management/mandatory-user-profile#apply-policies-to-improve-sign-in-time)します。
6. (省略可能)クライアント Pc の展開に使用する Windows 10 の基本イメージから不要なアプリを削除することによって、サインイン時間をさらに軽減します。 Windows Server 2019 および Windows Server 2016 がないすべての事前プロビジョニング済みのアプリのためサーバー イメージに、この手順をスキップすることができます。
    - アプリを削除するには、使用、[削除 AppxProvisionedPackage](https://docs.microsoft.com/powershell/module/dism/remove-appxprovisionedpackage?view=win10-ps)で、次のアプリケーションをアンインストールする Windows PowerShell コマンドレット。 Pc が既にデプロイされている場合を使用してこれらのアプリの削除のスクリプトを作成することができます、[削除 AppxPackage](https://docs.microsoft.com/powershell/module/appx/remove-appxpackage?view=win10-ps)します。
    
      - Microsoft.windowscommunicationsapps\_8wekyb3d8bbwe
      - Microsoft.BingWeather\_8wekyb3d8bbwe
      - Microsoft.DesktopAppInstaller\_8wekyb3d8bbwe
      - Microsoft.Getstarted\_8wekyb3d8bbwe
      - Microsoft.Windows.Photos\_8wekyb3d8bbwe
      - Microsoft.WindowsCamera\_8wekyb3d8bbwe
      - Microsoft.WindowsFeedbackHub\_8wekyb3d8bbwe
      - Microsoft.WindowsStore\_8wekyb3d8bbwe
      - Microsoft.XboxApp\_8wekyb3d8bbwe
      - Microsoft.XboxIdentityProvider\_8wekyb3d8bbwe
      - Microsoft.ZuneMusic\_8wekyb3d8bbwe

>[!NOTE]
>これらのアプリをアンインストールするサインイン時間が減少しますが、デプロイでは、これらのいずれかが必要な場合にインストールしておくことができます。

## <a name="step-8-enable-the-roaming-user-profiles-gpo"></a>手順 8:移動ユーザー プロファイル GPO を有効にする

グループ ポリシーを使用して、コンピューターに移動ユーザー プロファイルを設定しているか、グループ ポリシーを使用して、他の移動ユーザー プロファイルをカスタマイズした場合、次の手順は、GPO を有効にし、影響のあるユーザーへの適用を許可することです。

>[!TIP]
>プライマリ コンピューターのサポートを実装する場合は、今、GPO を有効にする前に。 これにより、プライマリ コンピューターのサポートが有効にされる前に、ユーザー データがプライマリでないコンピューターにコピーされることを防ぎます。 特定のポリシー設定で、次を参照してください。[フォルダー リダイレクトと移動ユーザー プロファイル用のプライマリ コンピューターの展開](deploy-primary-computers.md)します。

移動ユーザー プロファイル GPO を有効にする方法を次に示します。

1. グループ ポリシーの管理を開きます。
2. 作成した GPO を右クリックし、**リンクになっている**します。 メニュー項目の横にチェックボックスが表示されます。

## <a name="step-9-test-roaming-user-profiles"></a>手順 9:移動ユーザー プロファイルをテストする

移動ユーザー プロファイルをテストするには、移動ユーザー プロファイル用に構成されたユーザー アカウントでコンピューターにサインインするか、移動ユーザー プロファイル用に構成されたコンピューターにサインインします。 次に、プロファイルがリダイレクトされることを確認します。

移動ユーザー プロファイルをテストする方法を次に示します。

1. 移動ユーザー プロファイルを有効にしているユーザー アカウントでプライマリ コンピューターにサインインします (プライマリ コンピューターのサポートを有効にしている場合)。 特定のコンピューターで移動ユーザー プロファイルを有効にしている場合、これらのいずれかのコンピューターにサインインします。
2. ユーザーが以前にコンピューターにサインインしている場合、管理者特権でコマンド プロンプトを開き、次のコマンドを入力して、クライアント コンピューターに最新のグループ ポリシー設定が適用されるようにします。
    
    ```PowerShell
    GpUpdate /Force
    ```
3. ユーザー プロファイルのローミングで確認するのには、開く**コントロール パネル**を選択します**システムとセキュリティ**、**システム**を選択します**システムの詳細設定**を選択します**設定** セクションで、ユーザー プロファイルと探して**ローミング**で、**型**列。

## <a name="appendix-a-checklist-for-deploying-roaming-user-profiles"></a>付録 A:移動ユーザー プロファイルの展開のチェックリスト

|状況|アクション|
|:---:|---|
|☐<br>☐<br>☐<br>☐<br>☐|1. ドメインを準備する<br>-コンピューターをドメインに参加します。<br>-個別のプロファイル バージョンの使用を有効にします。<br>-ユーザー アカウントを作成します。<br>-(省略可能) フォルダー リダイレクトを展開|
|☐<br><br><br>|2. 移動ユーザー プロファイルのセキュリティ グループを作成する<br>グループ名:<br>メンバー:|
|☐<br><br>|3.移動ユーザー プロファイルのファイル共有を作成する<br>ファイルの共有名:|
|☐<br><br>|4。移動ユーザー プロファイルの GPO を作成する<br>GPO 名:|
|☐|5。移動ユーザー プロファイル ポリシー設定を構成する|
|☐<br>☐<br>☐|6。移動ユーザー プロファイルを有効にします。<br>-ユーザー アカウントで AD DS に有効になっているでしょうか。<br>-コンピューター アカウントでグループ ポリシーで有効にしますか。<br>|
|☐|7.(省略可能)Windows 10 Pc の必須のスタート画面のレイアウトを指定します。|
|☐<br>☐<br><br>☐<br><br>☐|8.(省略可能)プライマリ コンピューターのサポートを有効にします。<br>-ユーザーのプライマリ コンピューターを指定します。<br>-ユーザーとプライマリ コンピューターのマッピングの場所:<br>-フォルダー リダイレクトの (省略可能) を有効にするプライマリ コンピューターのサポート<br>-コンピューターのユーザー ベースか。<br>-(省略可能) を有効にする移動ユーザー プロファイルのプライマリ コンピューターのサポート|
|☐|9.移動ユーザー プロファイル GPO を有効にする|
|☐|10.移動ユーザー プロファイルをテストする|

## <a name="appendix-b-profile-version-reference-information"></a>付録 B:プロファイル バージョン参照情報

各プロファイルには、プロファイルを使用する Windows のバージョンに対応するプロファイル バージョンがあります。 たとえば、Windows 10、バージョン 1703 およびバージョン 1607 の両方を使用します。V6 プロファイル バージョンです。 Microsoft では、新しいプロファイルのバージョンは Windows のすべてのバージョンが新しいプロファイルのバージョンを含むなぜの互換性を維持するために必要な場合にのみ作成します。

次の表に、各種 Windows バージョンでの移動ユーザー プロファイルの場所を一覧表示します。

|オペレーティング システムのバージョン|移動ユーザー プロファイルの場所|
|---|---|
|Windows XP と Windows Server 2003|```\\<servername>\<fileshare>\<username>```|
|Windows Vista および Windows Server 2008|```\\<servername>\<fileshare>\<username>.V2```|
|Windows 7 および Windows Server 2008 R2|```\\<servername>\<fileshare>\<username>.V2```|
|Windows 8 と Windows Server 2012|```\\<servername>\<fileshare>\<username>.V3``` (ソフトウェアの更新およびレジストリ キーの適用後)<br>```\\<servername>\<fileshare>\<username>.V2``` (ソフトウェアの前に更新およびレジストリ キーの適用)|
|Windows 8.1 および Windows Server 2012 R2|```\\<servername>\<fileshare>\<username>.V4``` (ソフトウェアの更新およびレジストリ キーの適用後)<br>```\\<servername>\<fileshare>\<username>.V2``` (ソフトウェアの前に更新およびレジストリ キーの適用)|
|Windows 10|```\\<servername>\<fileshare>\<username>.V5```|
|Windows 10、バージョン 1703 およびバージョン 1607|```\\<servername>\<fileshare>\<username>.V6```|

## <a name="appendix-c-working-around-reset-start-menu-layouts-after-upgrades"></a>付録 C作業は、アップグレード後に [スタート] メニューのレイアウトをリセットする約

スタート メニューのレイアウトが、インプレース アップグレード後にリセットを回避する方法を次に示します。

 - 1 人のユーザーがこれまで、デバイスを使用して、IT 管理者は、SCCM など管理対象の OS 展開戦略を使用してのみが、次を実行します。
    
    1. Export-startlayout で、アップグレード前に、のスタート メニューのレイアウトをエクスポートします。 
    2. OOBE 後が、ユーザーがサインインする前に Import-startlayout をスタート メニューのレイアウトをインポートします。  
 
    > [!NOTE] 
    > 既定のユーザー プロファイルを変更、StartLayout をインポートします。 インポートが発生した後に作成されたすべてのユーザー プロファイルは、インポートの開始レイアウトで表示されます。
 
 - IT 管理者は、グループ ポリシーの開始のレイアウトを管理することできます。 使用してグループ ポリシーでは、ユーザーに標準化された開始のレイアウトを適用する集中管理ソリューションを提供します。 グループ ポリシーを使用して管理を開始するモードを 2 つのモードがあります。 完全なロックダウンを適用し部分ロックダウンします。 ロックダウンの完全なシナリオでは、ユーザーがスタートのレイアウトを変更できなくなります。 部分的なロックダウン シナリオでは、開始の特定の領域を変更するができます。 詳細については、次を参照してください。[カスタマイズとエクスポートのスタート画面のレイアウト](https://docs.microsoft.com/windows/configuration/customize-and-export-start-layout)します。
        
    > [!NOTE]
    > 部分的なロックダウン シナリオでユーザーが行った変更はアップグレード中にも失われます。

 -  開始レイアウトのリセットが発生し、エンドユーザーは開始を再構成することができます。 通知の電子メールや他の通知は、OS のアップグレードに影響を最小化された後にリセットするのには、その開始レイアウトを期待するエンドユーザーに送信できます。 

# <a name="change-history"></a>変更履歴

次の表に、このトピックの最も重要な変更をいくつかまとめています。

|日付|説明 |Reason|
|--- |---         |---   |
|2019 年 5 月 1 日、|2019 のアップデートを追加|
|2018 年 4 月 10 日より、|ときに開始するユーザーのカスタマイズは失われます、OS、インプレース アップグレード後の説明を追加|引き出しが既知の問題です。|
|2018 年 3 月 13 日 |Windows Server 2016 の更新 | 以前のバージョンのライブラリ外に移動し、Windows Server の現在のバージョンが更新されました。|
|2017 年 4 月 13 日|Windows 10 バージョン 1703 のプロファイル情報を追加し、オペレーティング システムをアップグレードする場合は、ローミング プロファイルのバージョンの作業を明記しました — を参照してください[移動ユーザー プロファイルを複数のバージョンの Windows を使用する際の考慮事項](#considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows)します。|カスタマー フィードバック。|
|2017 年 3 月 14 日|Windows 10 Pc での必須のスタート画面のレイアウトを指定する省略可能な手順を追加した[付録 a:移動ユーザー プロファイルの展開のチェックリスト](#appendix-a-checklist-for-deploying-roaming-user-profiles)します。|機能の最新の Windows 更新プログラムで変更します。|
|2017 年 1 月 23 日|追加するステップを[手順 4。必要に応じて移動ユーザー プロファイルの GPO を作成](#step-4-optionally-create-a-gpo-for-roaming-user-profiles)現在 Authenticated Users に読み取りアクセス許可を委任するグループ ポリシーのセキュリティ更新プログラムのために必要です。|セキュリティは、グループ ポリシーの処理に変更します。|
|2016 年 12 月 29 日|内のリンクを追加[手順 8。ローミング ユーザー プロファイル GPO を有効にする](#step-8-enable-the-roaming-user-profiles-gpo)プライマリ コンピューターのグループ ポリシーを設定する方法に関する情報を取得しやすくします。 手順 5. と 6. 番号のある問題をいくつかの参照も修正しました。|カスタマー フィードバック。|
|2016 年 12 月 5 日|追加情報が問題のローミングの開始] メニューの [設定の説明です。|カスタマー フィードバック。|
|2016 年 7 月 6 日|Windows 10 プロファイル バージョン サフィックスを追加[付録 b:プロファイル バージョン参照情報](#appendix-b-profile-version-reference-information)します。 Windows XP および Windows Server 2003 をサポートされるオペレーティング システムの一覧からも削除されます。|Windows、および削除の詳細についてはサポートされなくなった Windows のバージョンの新しいバージョンを更新します。|
|2015 年 7 月 7 日|クラスター化されたファイル サーバーを使用するときに継続的可用性を無効にする要件と手順を追加しました。|継続的可用性が無効になっていると、クラスター化されたファイル共有は小さい書き込み (移動ユーザー プロファイルでは一般的) でのパフォーマンスが向上します。|
|2014 年 3 月 19 日|プロファイル バージョン サフィックス (します。V2、します。V3、します。V4) で[付録 b:プロファイル バージョン参照情報](#appendix-b-profile-version-reference-information)します。|Windows は大文字と小文字を区別しない、NFS ファイル共有を使用する場合は、正しい (大文字) 大文字と小文字のプロファイルのサフィックスがある必要があります。|
|2013 年 10 月 9 日|Windows Server 2012 R2 および Windows 8.1 では、いくつかの点を明確化され、追加の変更、[移動ユーザー プロファイルを複数のバージョンの Windows を使用する際の考慮事項](#considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows)と[付録 b:プロファイル バージョン参照情報](#appendix-b-profile-version-reference-information)セクション。|新しいバージョンの更新プログラムカスタマー フィードバック。|

## <a name="more-information"></a>詳細情報

- [フォルダー リダイレクト、オフライン ファイル、および移動ユーザー プロファイルを展開します。](deploy-folder-redirection.md)
- [フォルダー リダイレクトと移動ユーザー プロファイル用のプライマリ コンピューターを展開します。](deploy-primary-computers.md)
- [ユーザー状態管理の実装](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc784645(v=ws.10)>)
- [レプリケートされたユーザーのプロファイル データに関する Microsoft のサポートに関する声明](https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/)
- [DISM を使用したアプリのサイドロード](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>)
- [パッケージ化、展開、および Windows ランタイム ベース アプリのクエリのトラブルシューティング](https://msdn.microsoft.com/library/windows/desktop/hh973484.aspx)