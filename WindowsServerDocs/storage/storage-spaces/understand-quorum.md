---
title: 理解クラスターとプール クォーラム
description: 複雑さを経由する具体的な例では、クラスターとプール クォーラムを理解すること。
keywords: 記憶域スペース ダイレクト、クォーラム、監視、S2D、クラスター クォーラム、プール クォーラム、クラスター、プール
ms.prod: windows-server-threshold
ms.author: adagashe
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: adagashe
ms.date: 01/18/2019
ms.localizationpriority: medium
ms.openlocfilehash: 24890b191db8bc6934132857e830d4f77c394b02
ms.sourcegitcommit: 28dc7c7f1e44fee7ab2112228af329a9ce0e02ba
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/22/2019
ms.locfileid: "9024140"
---
# 理解クラスターとプール クォーラム

>適用対象: Windows Server 2019、Windows Server 2016

[Windows Server フェールオーバー クラスタ リング](../../failover-clustering/failover-clustering-overview.md)のワークロードの高可用性を提供します。 これらのリソースはリソースをホストしているノードが; 場合は、高可用性と見なされますただし、クラスター通常必要がありますが実行されている複数の半分のノードが*クォーラム*を持つと呼ばれます。

クォーラムを防ぐために設計された*ブレイン*シナリオをネットワーク上のパーティションがあるし、ノードのサブセットが相互に通信できない場合に発生します。 これにより、ワークロードを所有して多くの問題につながることが、同じディスクに書き込むしようとするノードの両方のサブセットが発生することができます。 ただし、これらのグループを実行しているため、これらのグループの 1 つのみがオンライン状態が維持を続行するノードの 1 つだけを強制するクォーラムのフェールオーバー クラスタ リングの概念でこれができません。

クォーラムは、クラスターが残っているオンライン中に許容できる障害の数を決定します。 クォーラムについては、複数のサーバーが同時にリソース グループをホストし、同時に、同じディスクに書き込むしようとしないでくださいできるように、クラスター ノードのサブセットの間の通信に問題がある場合のシナリオを処理しています。 ことでこのクォーラムの概念、クラスターにクラスター サービスが特定のリソース グループの 1 つだけの場合は true 所有者があることを確認するノードのサブセットのいずれかで停止が強制されます。 停止されているノードは、ノードのあるメイン グループと通信できるもう一度後が自動的にクラスターに参加し、クラスター サービスを開始します。

Windows Server 2016 では、独自のクォーラム メカニズムがあるシステムの 2 つのコンポーネントがあります。

- <strong>クラスター クォーラム</strong>: クラスター レベルでこの処理は、(つまりノードが失われるしてクラスターを維持する)
- <strong>プール クォーラム</strong>: 記憶域スペース ダイレクトを有効にする、プール レベルでこの処理は (つまりノードとドライブが失われる人でき、プールを維持)。 記憶域プールにあるクォーラムのさまざまな理由は、クラスター化されたと非クラスター化の両方のシナリオで使用する設計されました。

## クラスター クォーラムの概要

次の表では、クラスター クォーラム結果のシナリオごとの概要を示します。

| サーバー ノード | 1 つのサーバー ノードの障害の後に残ることができます。 | 1 台のサーバー ノードに障害し、別の後に残ることができます。 | 2 つの同時サーバー ノード障害を回避することができます。 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 50/50                               | いいえ                                                | いいえ                                                 |
| 2 + 監視  | はい                                 | いいえ                                                | いいえ                                                 |
| 3            | はい                                 | 50/50                                             | いいえ                                                 |
| 3 + 監視  | はい                                 | はい                                               | いいえ                                                 |
| 4            | はい                                 | はい                                               | 50/50                                              |
| 4 + 監視  | はい                                 | はい                                               | はい                                                |
| 5 以上  | はい                                 | はい                                               | はい                                                |

### クラスター クォーラムの推奨事項

- 監視は、2 つのノードがあれば、<strong>必須</strong>します。
- 監視は、次の 3 つか 4 つのノードがあれば、<strong>を強くお勧め</strong>します。
- インターネットにアクセスした場合、 <strong>[クラウド監視](../../failover-clustering/deploy-cloud-witness.md)</strong>
- 他のコンピューターやファイル共有と IT 環境の場合は、使うファイル共有監視

## クラスター クォーラムのしくみ

ノードが失敗した場合、またはノードの一部は、別のサブセットのコンタクトを失ったときは、可能なノードは、オンラインのままにクラスターの*大部分*を構成することを確認する必要があります。 確認することはできませんと、それらがオフラインにされます。

*大部分*の概念は、クラスター内のノードの合計数が奇数 (たとえば、5 つのノードのクラスター内の次の 3 つのノード) の場合とのみ機能クリーンにします。 そのため、ノード (たとえば、4 つのノード クラスター) の偶数でクラスターの何かどうか。

2 つの方法が奇数*票の合計数*クラスターを作成できます。

1. 最初に、追加の投票と*監視*を追加することによって*を*1 つに移動できます。 これには、ユーザーのセットアップが必要です。
2.  または、ゼロ (必要に応じて自動的に行われます) 1 つの復旧を開始ノードの票*を*1 つ移動できます。

可能なノードには、*大部分*が正常にことを確認するたびにれなかっただけに存在する*ほとんど*の定義が更新されます。 これにより、クラスター ノードが 1 つ別、が失われるなどができます。 このエラーが続くと呼ばれる後に*投票の合計数*の適合させるの概念<strong>*動的クォーラム*</strong>します。  

### 動的な監視

動的な監視は、*票の合計数*が奇数であるかどうかを確認する監視の投票を切り替えます。 票の数が奇数がある場合、監視に投票はありません。 偶数票の場合は、投票には、監視します。 動的な監視は、クラスターになる監視エラーがあるため、リスクを大幅に削減します。 クラスターは、クラスター内で利用できる返信のノードの番号に基づいた監視投票を使用するかどうかを決定します。

動的なクォーラムは、以下に説明した方法で動的な監視と連携します。

### 動的なクォーラムの動作

- ある場合、<strong>でも</strong>数のノードと監視、 *1 つのノードがゼロの投票を取得*します。 たとえば、4 つのノードの唯一の 3 つは、*票の合計数*は、3、および投票を 2 つの残存オブジェクトには、大部分と見なされますように投票を取得します。
- ある場合、<strong>奇数</strong>ノードと監視、*投票を入手することのすべて*の数。
- ある場合、<strong>でも</strong>数のノードと *、監視投票*を、監視は、合計が奇数ようにします。
- ある場合、<strong>奇数</strong>ノードと *、監視しない投票*監視の数。

動的なクォーラムを票の大部分が失われないようにするには、動的と、1 つのノード (前回男性順位と呼ばれます) を実行するクラスター ノードに投票を割り当てることができます。 例として、4 つのノードのクラスターを見てみましょう。 そのクォーラム 3 票を必要と想定しています。 

この例では、クラスターが停止している 2 つのノードが失われた場合。

![図 4 つのクラスター ノード示す、投票をそれぞれの取得](media/understand-quorum/dynamic-quorum-base.png)

ただし、動的クォーラムによりこれが発生します。 クォーラムに必要な*票の合計数*では、利用できるノード数に基づいては決まりますできるようになりました。 そのため、動的のクォーラムを 3 つのノードを紛失した場合でも、クラスターはのままです。

![失敗した時刻、および各エラー後に調整する必要の投票の数に 1 つのノードの 4 つのクラスター ノードを示す図。](media/understand-quorum/dynamic-quorum-step-through.png)

上記のシナリオは、記憶域スペース ダイレクトの有効になっていることがない一般的なクラスターに適用されます。 ただし、記憶域スペース ダイレクトを有効にでも、クラスター ノードの 2 つの障害できますのみサポートします。 これは、[プール クォーラム] セクション](#poolQuorum)ではよりについて説明します。

### 例

#### 監視することがなく 2 つのノード。 
1 つのノードの票がゼロの総数*大部分*投票を決定ように<strong>1 投票</strong>します。 投票以外のノードが予期せずダウンした場合は、1/1 には、を除きと関連するクラスターします。 返信のノードが予期せずダウンした場合を除き、0/1 があり、クラスターがダウンします。 返信のノードの電源が正常に場合、は、投票が他のノードに転送され、関連するクラスターします。 *<strong>監視を構成することが重要であるためにです。</strong>*

![クォーラム監視することがなく 2 つのノードの場合とで説明しています](media/understand-quorum/2-node-no-witness.png)

- 1 つのサーバーの障害の後に残ることができます: <strong>50% の確率</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>いいえ</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>いいえ</strong>します。 

#### 2 つのノードを監視します。 
両方のノード投票、さらに、監視投票のための合計外の*大部分*が決定される<strong>3 票</strong>します。 いずれかのノードがダウンした場合は、を除きが 2/3 と関連するクラスターします。

![クォーラム監視で 2 つのノードの場合とで説明しています](media/understand-quorum/2-node-witness.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>いいえ</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>いいえ</strong>します。 

#### 監視することがなく 3 つのノード。
合計外の*大部分*が決定されますので、すべてのノードが投票<strong>3 票</strong>します。 任意のノードがダウンした場合は、れなかったは 2/3 と関連するクラスターします。 クラスターを監視することがなく 2 つのノードになります: シナリオ 1 内にいる時点で、します。

![クォーラム監視することがなく、3 つのノードの場合とで説明しています](media/understand-quorum/3-node-no-witness.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます: <strong>50% の確率</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>いいえ</strong>します。 

#### 3 つのノードを監視します。
すべてのノードが投票、監視が投票最初にしないようにします。 *大部分*が合計外決定<strong>3 票</strong>します。 1 つの障害発生後、監視は – シナリオ 2 には、2 つのノードがクラスターには、します。 そのため、ここで 2 つのノードと監視投票します。

![クォーラム監視で 3 つのノードの場合とで説明しています](media/understand-quorum/3-node-witness.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>はい</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>いいえ</strong>します。 

#### 監視することがなく、4 つのノード
1 つのノードの票を 0 にための合計外の*大部分*が決定される<strong>3 票</strong>します。 1 つの障害発生後、クラスターが 3 つのノードになり、シナリオ 3 でいます。

![クォーラム監視することがなく、4 つのノードの場合とで説明しています](media/understand-quorum/4-node-no-witness.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>はい</strong>します。
- 2 つのサーバーの障害を一度に回避できます: <strong>50% の確率</strong>します。 

#### 4 つのノードを監視します。
すべてのノードの票と監視投票、ための合計外の*大部分*が決定される<strong>5 投票</strong>します。 1 つの障害発生後は、シナリオ 4 でできました。 2 つ同時障害の発生後、シナリオ 2 を省略することにします。

![クォーラム監視で 4 つのノードの場合とで説明しています](media/understand-quorum/4-node-witness.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>はい</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>はい</strong>します。 

#### 5 つのノード以降。
すべてのノードが投票、またはすべてが 1 つの投票、どのにより奇数の合計。 記憶域スペース ダイレクト処理できない複数の 2 つのノード ダウンいずれにしても、ため、この時点で、監視がない必要なまたはに便利です。

![クォーラム説明した 5 つのノードと以外の場合](media/understand-quorum/5-nodes.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>はい</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>はい</strong>します。 

クォーラムのしくみを理解したら、次のクォーラム証人の種類を見てみましょう。

### クォーラム監視の種類

フェールオーバー クラスタ リングには、3 種類のクォーラム証人サポートしています。

- <strong>[クラウド監視](../../failover-clustering\deploy-cloud-witness.md)</strong> -クラスターのすべてのノードからアクセス可能な Azure での記憶域の Blob。 Witness.log ファイルで、クラスタ リングの情報を保持が、クラスター データベースのコピーを保存しません。
- <strong>ファイル共有監視</strong>: Windows Server を実行しているファイル サーバーで構成されている A SMB ファイル共有します。 Witness.log ファイルで、クラスタ リングの情報を保持が、クラスター データベースのコピーを保存しません。
- <strong>ディスクの監視</strong>-クラスターの利用可能な記憶域グループ内にある小さなクラスター ディスクします。 このディスクは、高可用性のノード間でフェールオーバーことができます。 クラスター データベースのコピーが含まれています。  <strong>*記憶域スペース ダイレクト サポートされていないディスク監視*</strong>します。

## <a id="poolQuorum"></a>プール クォーラムの概要

前述のクラスター クォーラムは、クラスター レベルで動作します。 次に、プール レベル (つまり、ノードが失われる可能性がドライブし、を維持プールを持つ) で動作するプール クォーラムに見ていきましょう。 記憶域プールにあるクォーラムのさまざまな理由は、クラスター化されたと非クラスター化の両方のシナリオで使用する設計されました。

次の表では、シナリオごとのプール クォーラム結果の概要を示します。

| サーバー ノード | 1 つのサーバー ノードの障害の後に残ることができます。 | 1 台のサーバー ノードに障害し、別の後に残ることができます。 | 2 つの同時サーバー ノード障害を回避することができます。 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | いいえ                                  | いいえ                                                | いいえ                                                 |
| 2 + 監視  | はい                                 | いいえ                                                | いいえ                                                 |
| 3            | はい                                 | いいえ                                                | いいえ                                                 |
| 3 + 監視  | はい                                 | いいえ                                                | いいえ                                                 |
| 4            | はい                                 | いいえ                                                | いいえ                                                 |
| 4 + 監視  | はい                                 | はい                                               | はい                                                |
| 5 以上  | はい                                 | はい                                               | はい                                                |

## プール クォーラムのしくみ

ドライブが失敗した場合、またはドライブの一部は、別のサブセットのコンタクトを失ったときは、残りのドライブは、オンラインのままに、プールの*大部分*を構成することを確認する必要があります。 確認することはできませんと、それらがオフラインにされます。 プールはオフラインまたはオンライン状態を維持クォーラムのための十分なディスクがあるかどうかに基づいているエンティティ (50% + 1)。 プールのリソースの所有者 (アクティブなクラスター ノード) は、+1 できます。

ただし、プール クォーラム動作が異なりますクラスター クォーラムから次の方法で。

- プールを使って 1 つのノード、クラスター内 tie 区切りとして監視としてもドライブ (プール リソースの所有者であるこのノード) の半分の後に残る
- プールには、動的なクォーラムはありません。
- プールが投票を削除する独自のバージョンを実装していません。

### 例

#### 4 つのノード、左右対称のレイアウトとします。 
16 台のドライブの各票を 1 つあり、2 つのノードも 1 つの投票 (プール リソースの所有者のため)。 *大部分*が合計外決定<strong>16 投票</strong>します。 3 と 4 ノード ダウンした場合、残りのサブセットは、8 ドライブと 9/16 投票は、プールのリソースの所有者を持ちます。 そのため、プールが生き残ます。

![プール クォーラム 1](media/understand-quorum/pool-1.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>はい</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>はい</strong>します。 

#### 4 つのノードと、左右対称のレイアウトとドライブ エラー。 
16 台のドライブの各票を 1 つあり、2 ノードも 1 つの投票 (プール リソースの所有者のため)。 *大部分*が合計外決定<strong>16 投票</strong>します。 最初に、ドライブ 7 がダウンします。 3 と 4 ノード ダウンした場合、残りのサブセットで 7 ドライブと 8/16 投票は、プールのリソースの所有者は、します。 そのため、プールでは、大部分がないしがダウンします。

![プール クォーラム 2](media/understand-quorum/pool-2.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>いいえ</strong>します。
- 2 つのサーバーの障害を一度に回避できます:<strong>いいえ</strong>します。 

#### 非対称レイアウトで 4 つのノード。 
24 台のドライブの各票を 1 つあり、2 つのノードも 1 つの投票 (プール リソースの所有者のため)。 *大部分*が合計外決定<strong>24 投票</strong>します。 3 と 4 ノード ダウンした場合、残りのサブセットで 8 ドライブと 9 月 24 日の投票は、プールのリソースの所有者は、します。 そのため、プールでは、大部分がないしがダウンします。

![プール クォーラム 3](media/understand-quorum/pool-3.png)

- 1 つのサーバーの障害の後に残ることができます:<strong>はい</strong>します。
- 1 台のサーバーの失敗し、別の後に残ることができます:<strong>依存</strong>(できませんの後に残る場合は、3、4 つの両方のノードは、下に移動しますが、他のすべてのシナリオの後に残ることができます。
- 2 つのサーバーの障害を一度に回避できます:<strong>依存</strong>(できませんの後に残る場合は、3、4 つの両方のノードは、下に移動しますが、他のすべてのシナリオの後に残ることができます。

### プール クォーラムの推奨事項

- クラスター内の各ノードが左右対称であることを確認します (各ノードには、同じ数のドライブ)
- 3 方向ミラーリングやデュアル パリティを使用していることができるようにするノードの障害を許容できる仮想ディスクをオンラインを保持するは、有効にします。 詳細については、[ボリュームのガイダンス] ページ](plan-volumes.md)を参照してください。
- 複数の 2 つのノードがダウン、または 2 つのノードと別のノード上のディスクが下にある場合は、ボリュームのデータの 3 つすべてのコピーへのアクセスがない可能性があるためオフラインにして利用不可であります。 サーバーを戻すまたはボリューム内のすべてのデータのほとんどの回復性を確認するには、迅速にディスクを交換することをお勧めします。

## 詳細

- [クォーラムを構成および管理する](../../failover-clustering/manage-cluster-quorum.md)
- [クラウド監視を展開します。](../../failover-clustering/deploy-cloud-witness.md)
