---
title: クラスター セット
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 01/30/2019
description: この記事は、クラスターのセットのシナリオを説明します
ms.localizationpriority: medium
ms.openlocfilehash: 349b69835ae68c626e886cad30f4d5a89d358372
ms.sourcegitcommit: a3958dba4c2318eaf2e89c7532e36c78b1a76644
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/05/2019
ms.locfileid: "66719706"
---
# <a name="cluster-sets"></a>クラスター セット

> 適用対象:Windows Server 2019

クラスターのセットは、桁違いによって 1 つのソフトウェア定義されているデータ センター (SDDC) クラウドでのクラスター ノードの数を増加する Windows Server 2019 リリースで新しいクラウド スケール アウト テクノロジです。 クラスターのセットが複数のフェールオーバー クラスターの疎結合のグループ化: コンピューティング、ストレージまたはハイパーコンバージドします。 クラスター設定テクノロジを使用する仮想マシンの流動性クラスター セットおよび統合記憶域の名前空間内でメンバーのクラスター間で全体に仮想マシンの流動性をサポートするためです。

既存のフェールオーバー クラスター管理を維持は、クラスターのメンバーで発生しているときにクラスター セットのインスタンスはさらに、集計のライフ サイクル管理に関する主な使用事例を提供します。 この Windows Server 2019 シナリオ評価ガイドでは、PowerShell を使用してクラスター セットのテクノロジを評価するための手順と必要な背景情報を提供します。

## <a name="technology-introduction"></a>テクノロジの概要

クラスター セットのテクノロジは、ソフトウェア定義されているデータ センター (SDDC) クラウド スケールで動作して特定の顧客の要求を満たすために開発されました。 セットでは、次のように付加価値をまとめることができます。  

- 1 つのクラスター ソフトウェアの障害の境界を維持しながらも 1 つの大規模なファブリックに複数の小さいクラスターを組み合わせることで高可用性バーチャル マシンを実行するためのサポートされている SDDC クラウド スケールを大幅に向上させる
- 流動的な移行を使用して、テナント仮想マシンの可用性に影響を与えることがなく、フェールオーバー クラスターのライフ サイクルのオンボードをなど、インベントリから削除がクラスター全体を管理するこの大きなファブリック全体で仮想マシン
- 簡単に、ハイパー コンバージドの両方でコンピューティングとストレージの比率を変更します。
- メリット[Azure のような障害ドメインと可用性セット](htttps://docs.microsoft.com/azure/virtual-machines/windows/manage-availability)初期の仮想マシンの配置と後続の仮想マシンの移行でのクラスター間で
- 混在さまざまな世代の CPU ハードウェア、同じクラスターには、効率を最大化の同種の個別障害ドメインを保持する中でも、ファブリックを設定します。  同じハードウェアの推奨事項は各個々 のクラスターとクラスター全体のセット内でまだ存在することに注意してください。

高レベルのビューからこれは、どのようなクラスターのセットのようにできます。

![クラスター ソリューション ビューを設定します。](media/Cluster-sets-Overview/Cluster-sets-solution-View.png)

上のイメージ内の要素のそれぞれの簡単な概要を次に示します。

**管理クラスター**

クラスターのセットで管理クラスターとは、クラスター全体のセットと、統合ストレージ (クラスター設定 Namespace) 名前空間参照スケール アウト ファイル サーバー (SOFS) の高可用性の管理プレーンをホストするフェールオーバー クラスターです。 管理クラスターは、仮想マシンのワークロードを実行するメンバーのクラスターから論理的に切り離されます。 これにより、管理プレーンをすべてローカライズされたクラスター全体の障害に回復力のある設定クラスター メンバーのクラスターの電源の停電などです。   

**クラスターのメンバー**

クラスターのセットのメンバー クラスターは、通常、仮想マシンと記憶域スペース ダイレクトのワークロードを実行している従来のハイパー コンバージド クラスターです。 複数のクラスターのメンバーより大きな SDDC クラウド ファブリックを形成する 1 つのクラスター セットのデプロイに参加します。 クラスターのメンバーが異なる 2 つの重要な側面の管理クラスター: クラスターのメンバーは、障害ドメインに参加し、可用性セットの構造とメンバー クラスターもサイズをホストの仮想マシンと記憶域スペース ダイレクトのワークロード。 このため、管理クラスターでクラスター セット内のクラスターの境界を越えて移動クラスター セットの仮想マシンがホストされないする必要があります。

**クラスターの名前空間参照 SOFS を設定します。**

(クラスター設定 Namespace) SOFS クラスター セットの名前空間参照は、スケール アウト ファイル サーバーのクラスター設定 Namespace SOFS で SMB 共有の各参照の共有 –-型 'SimpleReferral' Windows Server 2019 で新しく導入されたのです。 この参照は、サーバー メッセージ ブロック (SMB) クライアント メンバー クラスター SOFS でホストされる SMB 共有ターゲットへのアクセスを許可します。 クラスターは、I/O パスの SOFS は、軽量の参照メカニズムであり、参加しない名前空間参照を設定します。 クライアント ノードの各 SMB の参照は永続的キャッシュされ、クラスターのセットの名前空間を動的に更新に自動的にこれらの参照、必要に応じて。

**クラスターのマスター設定**

クラスターのセットにメンバーのクラスター間の通信は、疎結合し、「クラスター設定マスター」(CS Master) と呼ばれる新しいクラスター リソースによって調整されます。 その他のクラスター リソースと同様には、CS マスターは、高可用性と個々 のメンバーのクラスターの障害や管理のクラスター ノードの障害に対する回復力です。 新しいクラスターの設定の WMI プロバイダーを使用したは、CS マスターは、クラスターの設定のすべての管理の容易性対話の管理エンドポイントを提供します。

**クラスター ワーカーを設定します。**

クラスターの設定の展開では、CS マスターは、メンバー"クラスター設定 Worker"(CS ワーカー) と呼ばれるクラスターで新しいクラスター リソースと対話します。 CS ワーカーは、クラスターで、CS マスターからの要求では、ローカル クラスターの対話を調整する唯一の連絡係として機能します。 このような相互作用の例には、仮想マシンの配置とクラスターのローカル リソースのインベントリが含まれます。 クラスターのセットでのクラスターの各メンバーの CS Worker インスタンスが 1 つしかないです。 

**障害ドメイン**

障害ドメインは、ソフトウェアのグループ化し、エラーが発生したときに、管理者を決定するハードウェアの成果物がまとめて失敗します。  管理者は、障害ドメインとして 1 つまたは複数のクラスターをまとめて指定できます、中に、各ノードは、可用性セット内の障害ドメインに参加でした。 クラスター設定デザイン リーフで障害ドメインの境界の決定の意思決定は、データ センター トポロジに関する考慮事項: などの PDU に精通した管理者にネットワーク – クラスターのメンバーが共有します。 

**可用性セット**

可用性セットには、可用性セットにそれらを整理し、ワークロードをその可用性セットにデプロイして、障害ドメイン間でクラスター化されたワークロードの必要な冗長性を構成する管理者が役立ちます。 たとえば、その可用性セット内の 1 つの障害ドメインがダウンしたときに、アプリケーションは、少なくともが維持するため、各レベルの可用性セットに少なくとも 2 つの仮想マシンを構成することをお勧め 2 層アプリケーションを展開する場合同じ可用性セットの異なる障害ドメインでホストされている各レベルで 1 つの仮想マシン。

## <a name="why-use-cluster-sets"></a>クラスターのセットを使用する理由

クラスターのセットは、回復性を損なうことがなく、スケールの利点を提供します。  

クラスターのセットは、複数のクラスターをクラスタ リングまとめてを各クラスターの回復性の独立したまま、大規模なファブリックを作成できます。  たとえば、いくつかの 4 ノード HCI がある仮想マシンを実行しているクラスター。  各クラスターでは、自身のために必要な回復性を提供します。  記憶域またはメモリに収まるように起動する場合、スケール アップは、次の手順です。  スケール アップではいくつかのオプションと考慮事項です。

1. 現在のクラスターに記憶域を追加します。  記憶域スペース ダイレクトでこの可能性がありますに注意が必要です、正確な同じモデルまたはファームウェア ドライブができない場合があります。  再構築の時間を考慮する必要も、考慮する必要があります。
2. メモリを追加します。  場合、マシンが処理できるメモリの限界はでしょうか。  どのような場合にすべての使用可能なメモリ スロットがいっぱいか。
3. 現在のクラスターにドライブを使用した追加のコンピューティング ノードを追加します。  これは、記憶が蘇ってきましたオプション 1 と見なされるを必要とします。
4. まったく新しいクラスターを購入します。

これは、クラスターのセットがスケールの利点を提供します。  クラスターにクラスターを追加した場合を記憶域または別のクラスターに、追加購入可能なメモリの利用はできます。  回復性の観点から、記憶域スペース ダイレクトにノードを追加する予定はありません提供クォーラムの投票を追加します。  前述の[ここ](drive-symmetry-considerations.md)記憶域スペース ダイレクト クラスター障害にも、2 つのノードがダウンする前にします。  HCI 4 ノード クラスターがあれば、3 つのノードがダウン クラスター全体になります。  場合は、8 ノード クラスターがある場合は、3 つのノードがダウン クラスター全体になります。  セット内の 4 ノード HCI の 2 つのクラスターを含むクラスター セット、HCI の 1 つの 2 つのノードがダウンし他 HCI の 1 つのノードがダウン、両方のクラスターを稼働状態を維持します。  方が 1 つ大きい 16 ノードの記憶域スペース ダイレクト クラスターを作成または 4 つの 4 ノード クラスターに分割してクラスターのセットを使用しますか。  複数のコンピューティング ノードがダウンしている (が予期せずまたはメンテナンスのため) で、4 つの 4 ノード クラスターのクラスター セットにより、同じ尺度が優れた回復性を持つと実稼働のままです。

## <a name="considerations-for-deploying-cluster-sets"></a>クラスターのセットをデプロイするための考慮事項

クラスターのセットが何かを使用する必要があるかどうかを考慮する場合は、これらの質問を考慮してください。

- 現在 HCI コンピューティングおよび記憶域スケール制限を克服する必要がありますか。
- ないコンピューティングおよび記憶域をすべて同じ同じでしょうか。
- クラスター間で仮想マシンをライブ移行ですか。
- しますか? Azure のようなコンピューターの可用性セットと障害ドメイン間での複数のクラスター
- 新しい仮想マシンを配置する必要があるかを判断する、すべてのクラスターを確認する時間がかかるしなければですか。

あなたの答えがはいの場合は、し、クラスター セット必要があります。

全体的なデータ センターの戦略をより大きな SDDC が変わる可能性がありますを考慮するその他のいくつかの項目があります。  SQL Server は、良い例です。  クラスター間で SQL Server 仮想マシンの移動は、他のノードで実行する SQL のライセンスを必要でしょうか。  

## <a name="scale-out-file-server-and-cluster-sets"></a>スケール アウト ファイル サーバーとクラスターのセット

Windows Server の 2019 はインフラストラクチャのスケール アウト ファイル サーバー (SOFS) と呼ばれる新しいスケール アウト ファイル サーバーの役割があります。 

次の考慮事項は、インフラストラクチャの SOFS ロールに適用されます。

1.  フェールオーバー クラスターでのみ最大で 1 つのインフラストラクチャの SOFS クラスターの役割があります。 インフラストラクチャの SOFS ロールを指定して作成、" **-インフラストラクチャ**"スイッチ パラメーターを**追加 ClusterScaleOutFileServerRole**コマンドレット。  例:

        Add-ClusterScaleoutFileServerRole -Name "my_infra_sofs_name" -Infrastructure

2.  各 CSV ボリュームのフェイル オーバーに自動的に作成は、CSV ボリューム名に基づいて自動生成される名前の SMB 共有の作成をトリガーします。 管理者が直接作成または SOFS ロールを持ち、CSV ボリュームの作成/変更操作で他よりも下に SMB 共有を変更できません。

3.  ハイパーコンバージド構成では、インフラストラクチャ SOFS は SMB クライアント (HYPER-V ホスト)、保証された継続的可用性 (CA) と共に、インフラストラクチャの SOFS の SMB サーバーと通信できます。 このハイパー コンバージドの SMB ループバック CA は、仮想マシンを所有している仮想マシン id が、クライアントとサーバー間で転送されます、仮想ディスク (VHDx) ファイルへのアクセスを使用して実現されます。 この identity 転送では、前に標準のハイパー コンバージド クラスター構成と同じように ACL 設定 VHDx ファイルを許可します。

クラスターのセットが作成されると、クラスターのセットの名前空間は、各メンバーのクラスターでインフラストラクチャ SOFS とさらに、管理クラスターでインフラストラクチャの SOFS に依存します。

時にメンバー クラスター管理者が既に存在する場合に、そのクラスターでインフラストラクチャ SOFS の名前を指定し、クラスター セットに追加されます。 インフラストラクチャ SOFS が存在しない場合は、この操作によって、新しいメンバーのクラスターで新しいインフラストラクチャの SOFS ロールが作成されます。 メンバーのクラスターで、インフラストラクチャの SOFS ロールが既に存在する場合の追加操作暗黙的に名前を変更指定した名前に、必要に応じて。 任意の既存の単一の SMB サーバーまたはクラスターのセットによって使用のままにするクラスター メンバーでインフラストラクチャ以外の SOFS ロール。 

クラスター セットの作成時に、管理者は、管理クラスター上の名前空間のルートとして既存の AD コンピューター オブジェクトを使用するオプションを持ちます。 クラスター セットの作成操作では、管理クラスターでインフラストラクチャの SOFS クラスターの役割を作成またはクラスターのメンバーだけ前述したように既存のインフラストラクチャの SOFS ロールの名前を変更します。 管理クラスターでインフラストラクチャの SOFS クラスターの名前空間参照 (クラスター設定 Namespace) SOFS の設定が使用されます。 単に、クラスターに SMB 共有の各設定の SOFS は Windows Server 2019 で新しく導入された型 'SimpleReferral' - の紹介共有 –-名前空間であることを意味します。  この参照は、メンバー クラスター SOFS でホストされている SMB クライアントが SMB 共有のターゲットにアクセスできます。 クラスターは、I/O パスの SOFS は、軽量の参照メカニズムであり、参加しない名前空間参照を設定します。 SMB の参照をクライアント ノードの各永年キャッシュされ、クラスター セットの名前空間に動的に自動的にこれらの参照必要に応じて更新

## <a name="creating-a-cluster-set"></a>クラスターのセットを作成します。

### <a name="prerequisites"></a>前提条件

設定、クラスターを作成するには、以下の前提条件をお勧めします。

1. Windows Server 2019 を実行している管理クライアントを構成します。
2. この管理サーバーのフェールオーバー クラスター ツールをインストールします。
3. クラスターのメンバー (2 つ以上のクラスターに少なくとも 2 つのクラスター共有ボリュームを各クラスターで) の作成します。
4. メンバーのクラスターにまたがる管理クラスター (物理またはゲスト) を作成します。  このアプローチでは、管理プレーンは引き続き可能なメンバーのクラスターの失敗にかかわらず使用できるクラスターのセットをによりします。

### <a name="steps"></a>手順

1. 前提条件で定義されている 3 つのクラスターから設定を新しいクラスターを作成します。  グラフの下には、クラスターを作成する例を示しています。  この例では設定、クラスターの名前になります**CSMASTER**します。

   | クラスタ名               | 後で使用されるインフラストラクチャ SOFS 名 | 
   |----------------------------|-------------------------------------------|
   | セット クラスター                | SOFS CLUSTERSET                           |
   | CLUSTER1                   | SOFS CLUSTER1                             |
   | CLUSTER2                   | SOFS CLUSTER2                             |

2. すべてのクラスターが作成されるとは、一連のマスター クラスターを作成するのに次のコマンドを使用します。

        New-ClusterSet -Name CSMASTER -NamespaceRoot SOFS-CLUSTERSET -CimSession SET-CLUSTER

3. クラスター サーバーのクラスター セットを追加して、使用される次のとおりです。

        Add-ClusterSetMember -ClusterName CLUSTER1 -CimSession CSMASTER -InfraSOFSName SOFS-CLUSTER1
        Add-ClusterSetMember -ClusterName CLUSTER2 -CimSession CSMASTER -InfraSOFSName SOFS-CLUSTER2

   > [!NOTE]
   > 静的 IP アドレス スキームを使用している場合する必要があります *- StaticAddress x.x.x.x*上、**新規 ClusterSet**コマンド。

4. クラスターのクラスターのメンバーからセットを作成すると、ノード セットとそのプロパティを一覧表示できます。  すべてのメンバーを列挙するには、クラスターのセットでクラスターします。

        Get-ClusterSetMember -CimSession CSMASTER

5. すべてのメンバーを列挙するには、設定、管理クラスターのノードを含むクラスターでクラスターします。

        Get-ClusterSet -CimSession CSMASTER | Get-Cluster | Get-ClusterNode

6. メンバーのクラスターからのすべてのノードを一覧表示。

        Get-ClusterSetNode -CimSession CSMASTER

7. すべてを一覧表示するには、クラスター間でリソース グループを設定します。

        Get-ClusterSet -CimSession CSMASTER | Get-Cluster | Get-ClusterGroup 

8. クラスターを検証には、クラスター メンバーごとのインフラストラクチャ SOFS 上 (Volume1 またはインフラストラクチャのファイル サーバーと両方とパスの名前にする ScopeName が付いて、CSV フォルダーとして識別される) 1 つの SMB 共有を作成、作成プロセスを設定します。CSV ボリューム:

        Get-SmbShare -CimSession CSMASTER

8. クラスターのセットには、レビュー用に収集できるデバッグ ログがあります。  クラスターの設定し、すべてのメンバーと、管理クラスターのクラスターのデバッグ ログを収集することができます。

        Get-ClusterSetLog -ClusterSetCimSession CSMASTER -IncludeClusterLog -IncludeManagementClusterLog -DestinationFolderPath <path>

9. Kerberos を構成する[の制約付き委任](https://blogs.technet.microsoft.com/virtualization/2017/02/01/live-migration-via-constrained-delegation-with-kerberos-in-windows-server-2016/)すべてのクラスター間でメンバーを設定します。

10. クラスターの設定の各ノードで Kerberos をクラスター間で仮想マシンのライブ マイグレーション認証の種類を構成します。

        foreach($h in $hosts){ Set-VMHost -VirtualMachineMigrationAuthenticationType Kerberos -ComputerName $h }

11. 管理クラスターをクラスター セットの各ノードでローカルの administrators グループに追加します。

        foreach($h in $hosts){ Invoke-Command -ComputerName $h -ScriptBlock {Net localgroup administrators /add <management_cluster_name>$} }

## <a name="creating-new-virtual-machines-and-adding-to-cluster-sets"></a>新しい仮想マシンを作成して、クラスターのセットに追加します。

設定、クラスターを作成した後には、次の手順では、新しい仮想マシンを作成します。  通常、仮想マシンを作成し、クラスターに追加するときは、ときに、クラスターで実行する最適な可能性があるを確認するためにいくつかのチェックを実行する必要があります。  これらのチェックが考えられます。

- メモリの量は、クラスター ノードで使用できるでしょうか。
- ディスク領域の量は、クラスター ノードで使用できるでしょうか。
- 仮想マシンは特定の記憶域の要件 (つまりする; 高速なドライブを実行しているクラスターに移動する SQL Server 仮想マシンまたはインフラストラクチャの仮想マシンが重要ではありませんし、それより遅いドライブ上で実行できます) が必要です。

この質問の回答は後に、する必要があるクラスターで仮想マシンを作成します。  クラスターのセットの利点の 1 つは、クラスター セットがこれらのチェックを行うし、最適のノードに仮想マシンを配置します。

以下のコマンドはどちらも最適なクラスターの識別し、仮想マシンを展開します。  少なくとも 4 ギガバイトのメモリが仮想マシンの使用可能であり、1 個の仮想プロセッサを利用する必要があることを指定する新しい仮想マシンを作成次の例では、します。

- 4 gb が仮想マシンの利用可能であることを確認します。
- 1 で使用される仮想プロセッサを設定します。
- 10% 以上を確認します仮想マシンの使用可能な CPU。

   ```PowerShell
   # Identify the optimal node to create a new virtual machine
   $memoryinMB=4096
   $vpcount = 1
   $targetnode = Get-ClusterSetOptimalNodeForVM -CimSession CSMASTER -VMMemory $memoryinMB -VMVirtualCoreCount $vpcount -VMCpuReservation 10
   $secure_string_pwd = convertto-securestring "<password>" -asplaintext -force
   $cred = new-object -typename System.Management.Automation.PSCredential ("<domain\account>",$secure_string_pwd)

   # Deploy the virtual machine on the optimal node
   Invoke-Command -ComputerName $targetnode.name -scriptblock { param([String]$storagepath); New-VM CSVM1 -MemoryStartupBytes 3072MB -path $storagepath -NewVHDPath CSVM.vhdx -NewVHDSizeBytes 4194304 } -ArgumentList @("\\SOFS-CLUSTER1\VOLUME1") -Credential $cred | Out-Null
   
   Start-VM CSVM1 -ComputerName $targetnode.name | Out-Null
   Get-VM CSVM1 -ComputerName $targetnode.name | fl State, ComputerName
   ```

完了したら、仮想マシンおよび配置された場所の情報が表示されます。  上記の例として表示するには。

        State         : Running
        ComputerName  : 1-S2D2

持たないための十分なメモリ、cpu、またはディスク領域を仮想マシンを追加する場合は、エラーを受け取ります。

      Get-ClusterSetOptimalNodeForVM : A cluster node is not available for this operation.  

仮想マシンが作成されたら、指定された特定のノードで、HYPER-V マネージャーで表示されます。  クラスターを仮想マシンを設定して、クラスターには、それを追加するには、コマンドが未満です。  

        Register-ClusterSetVM -CimSession CSMASTER -MemberName $targetnode.Member -VMName CSVM1

完了すると、出力になります。

         Id  VMName  State  MemberName  PSComputerName
         --  ------  -----  ----------  --------------
          1  CSVM1      On  CLUSTER1    CSMASTER

既存の仮想マシンを使用するクラスターを追加したら、仮想マシンはクラスターのセットすべての仮想マシンを一度に使用するコマンドは登録を登録することも必要です。

        Get-ClusterSetMember -name CLUSTER3 -CimSession CSMASTER | Register-ClusterSetVM -RegisterAll -CimSession CSMASTER

ただし、仮想マシンへのパスをクラスター セットの名前空間に追加する必要があるため、プロセスは完了しません。

たとえば、既存のクラスターが追加されが事前構成済みの仮想マシンの配置されてで、ローカル クラスター共有ボリューム (CSV) を VHDX へのパスはようになります"C:\ClusterStorage\Volume1\MYVM\Virtual ハード Disks\MYVM.vhdx します。  記憶域の移行は、CSV のパスは、クラスターを 1 つのメンバーをローカルに設計されているときに実行される必要があります。 したがって、されません、仮想マシンにアクセスできるライブしたらメンバー クラスター間で移行。 

この例では、CLUSTER3 は SOFS CLUSTER3 としてのインフラストラクチャのスケール アウト ファイル サーバーと追加 ClusterSetMember を使用して設定するクラスターに追加されました。  コマンドは、仮想マシンの構成と記憶域を移動するには。

        Move-VMStorage -DestinationStoragePath \\SOFS-CLUSTER3\Volume1 -Name MYVM

これが完了すると、警告が表示されます。

        WARNING: There were issues updating the virtual machine configuration that may prevent the virtual machine from running.  For more information view the report file below.
        WARNING: Report file location: C:\Windows\Cluster\Reports\Update-ClusterVirtualMachineConfiguration '' on date at time.htm.

警告は、「仮想マシン ロールのストレージ構成の変更が検出されない」この警告は無視できます。  実際の物理的な場所としての警告の原因は変更されません。構成パスのみです。 

Move-vmstorage の詳細についてを参照してくださいこの[リンク](https://docs.microsoft.com/powershell/module/hyper-v/move-vmstorage?view=win10-ps)します。 

別のクラスター セットのクラスター間で仮想マシンを移行するライブは、過去のようにない同じです。 非クラスターのセットでは、手順になります。

1. クラスターから仮想マシン ロールを削除します。
2. 別のクラスターのメンバー ノードに仮想マシンのライブ マイグレーションします。
3. 仮想マシンをクラスターに新しい仮想マシン ロールとして追加します。

クラスターのセットを次の手順は必要ありませんし、コマンドの 1 つだけが必要です。  最初に、コマンドを使用して移行できるすべてのネットワークを設定する必要があります。

    Set-VMHost -UseAnyNetworkMigration $true

たとえば、CLUSTER3 で CLUSTER1 から NODE2 CL3 にクラスター設定の仮想マシンを移動します。  1 つのコマンドは次のようになります。

        Move-ClusterSetVM -CimSession CSMASTER -VMName CSVM1 -Node NODE2-CL3

この仮想マシンの記憶域または構成ファイルは移動されないことに注意してください。  仮想マシンへのパスのままで、必要ない\\SOFS CLUSTER1\VOLUME1 します。  仮想マシンが登録されたら、クラスターのセットを持つインフラストラクチャ サーバーのファイル共有のパス、ドライブおよび仮想マシン、仮想マシンと同じコンピューター上にあるものが必要としません。

## <a name="creating-availability-sets-fault-domains"></a>障害ドメインを設定して可用性を作成します。

導入のように、Azure のような障害ドメインと可用性セットは、クラスターのセットで構成できます。  これは、最初の仮想マシンの配置とクラスター間で移行の際に便利です。  

次の例では、4 つのクラスターのクラスター セットに参加しています。  セット内で、クラスターとその他の 2 つのクラスターで作成された障害ドメインの 2 つの論理的な障害ドメインが作成されます。  これらの 2 つの障害ドメインは、可用性セットを構成します。 

次の例では、CLUSTER1 と CLUSTER2 と呼ばれる障害ドメインで**FD1** CLUSTER3 と CLUSTER4 がという名前のフォールト ドメインはあります**FD2**します。  可用性セットが呼び出される**CSMASTER-AS**し、2 つの障害ドメインで構成されます。

コマンドは、障害ドメインを作成するには。

        New-ClusterSetFaultDomain -Name FD1 -FdType Logical -CimSession CSMASTER -MemberCluster CLUSTER1,CLUSTER2 -Description "This is my first fault domain"

        New-ClusterSetFaultDomain -Name FD2 -FdType Logical -CimSession CSMASTER -MemberCluster CLUSTER3,CLUSTER4 -Description "This is my second fault domain"

正常に作成されていることを確認するには、その出力と Get ClusterSetFaultDomain を実行できます。

        PS C:\> Get-ClusterSetFaultDomain -CimSession CSMASTER -FdName FD1 | fl *

        PSShowComputerName    : True
        FaultDomainType       : Logical
        ClusterName           : {CLUSTER1, CLUSTER2}
        Description           : This is my first fault domain
        FDName                : FD1
        Id                    : 1
        PSComputerName        : CSMASTER

障害ドメインが作成されたら、可用性セットを作成する必要がありますに。

        New-ClusterSetAvailabilitySet -Name CSMASTER-AS -FdType Logical -CimSession CSMASTER -ParticipantName FD1,FD2

検証するのにが作成されたら、次を使用します。

        Get-ClusterSetAvailabilitySet -AvailabilitySetName CSMASTER-AS -CimSession CSMASTER

新しい仮想マシンを作成するときに最適なノードの決定の一部としての AvailabilitySet パラメーターを使用する必要がありますはし。  このため、このようなものにし、なります。

        # Identify the optimal node to create a new virtual machine
        $memoryinMB=4096
        $vpcount = 1
        $av = Get-ClusterSetAvailabilitySet -Name CSMASTER-AS -CimSession CSMASTER
        $targetnode = Get-ClusterSetOptimalNodeForVM -CimSession CSMASTER -VMMemory $memoryinMB -VMVirtualCoreCount $vpcount -VMCpuReservation 10 -AvailabilitySet $av
        $secure_string_pwd = convertto-securestring "<password>" -asplaintext -force
        $cred = new-object -typename System.Management.Automation.PSCredential ("<domain\account>",$secure_string_pwd)

クラスターからクラスターを削除するため、さまざまなライフ サイクルを設定します。 クラスターのクラスター セットから削除する必要がある場合もあります。 ベスト プラクティスとして、クラスターからすべてのクラスター セットの仮想マシンに移行する必要があります。 これを使用して、**移動 ClusterSetVM**と**Move-vmstorage**コマンド。

ただし、仮想マシンをも移動できませんが、クラスター セットは、一連の直感的な結果を管理者に提供するアクションを実行します。  セットから、クラスターが削除されると、すべて残りクラスター セットの仮想マシンが削除されているクラスターでホストされているはその記憶域へのアクセスがあると仮定すると、そのクラスターにバインドされている高可用性のバーチャル マシンを単になります。  クラスターのセットは、別にインベントリをそのをも自動的に更新されます。

- 不要になった今削除クラスターとことで実行されている仮想マシンの正常性を追跡
- クラスターのセットの名前空間と、今すぐ削除クラスターでホストされている共有に対するすべての参照から削除します

たとえば、クラスターのセットから CLUSTER1 クラスターを削除するコマンドは次のようになります。

        Remove-ClusterSetMember -ClusterName CLUSTER1 -CimSession CSMASTER

## <a name="frequently-asked-questions-faq"></a>よく寄せられる質問 (FAQ)

**質問:** 私のクラスター セットでしか使用できません、ハイパーコンバージド クラスターをのみを使用するでしょうか。 <br>
**回答:** No.  従来のクラスターで記憶域スペース ダイレクトが混在することができます。

**質問:** クラスター設定を使用して、System Center Virtual Machine Manager を管理できますか。 <br>
**回答:** System Center Virtual Machine Manager は現在クラスターのセットをサポートしていません <br><br> **質問:** Windows Server 2012 R2 または 2016 クラスターで共存できます同一のクラスター セットか。 <br>
**質問:** Windows Server 2012 R2 からワークロードを移行できるまたは 2016 クラスターだけでそれらのクラスターに参加、同じクラスターに設定しますか。 <br>
**回答:** クラスターのセットは、のでそのため、Windows Server の 2019 に導入される新しいテクノロジが、以前のリリースでは存在しません。 ダウンレベルの OS ベースのクラスターでは、クラスターのセットを結合できません。 ただし、クラスターのオペレーティング システムのローリング アップグレードのテクノロジでは、Windows Server 2019 にこれらのクラスターをアップグレードすることで目的の移行機能を提供する必要があります。

**質問:** クラスターのセットはことができます、私やコンピューティング (単独で) ストレージをスケールを許可しますか。 <br>
**回答:** はい、記憶域スペース ダイレクトまたは従来の HYPER-V クラスターを追加するだけです。 クラスターのセット、ハイパー コンバージド クラスターのセットであっても、コンピューティングとストレージ比の簡単な変更になります。

**質問:** クラスターのセットの管理ツールとは <br>
**回答:** PowerShell または WMI をこのリリースでします。

**質問:** プロセッサの世代の異なるクラスター間のライブ マイグレーションは  <br>
**回答:** クラスターのセットはいないプロセッサの違いを回避し、HYPER-V での現在のサポートされているよりも優先されます。  そのため、プロセッサ互換性モードは、クイック移行で使用する必要があります。  クラスター セットの推奨事項では、発生するクラスター間でライブ マイグレーションの各個々 のクラスターと全体のクラスター セット内の同じプロセッサ ハードウェアを使用します。

**質問:** できます私のクラスター セットを仮想マシンに自動的にフェールオーバー クラスター障害のでしょうか。  <br>
**回答:** このリリースで仮想マシンのクラスター設定できるのみ手動でライブで移行した; のクラスター間でフェールオーバーを自動的にすることはできません。 

**質問:** 記憶域がクラスターの障害に対する回復性確認する方法 <br>
**回答:** メンバーのクラスター間でのクラスター間で記憶域レプリカ (SR) ソリューションを使用して、クラスターの障害に記憶域の回復性を実現します。

**質問:** 記憶域レプリカ (SR) を使用してクラスターのメンバー間でレプリケートします。 レプリカのターゲット記憶域スペース ダイレクト クラスターに記憶域レプリカのフェールオーバーで UNC パスの変更セットの名前空間の格納をクラスターの操作を行いますか。 <br>
**回答:** このリリースでこのようなクラスター セットの名前空間参照変更は記憶域レプリカのフェールオーバーは発生しません。 このシナリオは、し、それを使用する方法に重要なかどうかは Microsoft に知らせてください。

**質問:** 災害復旧の障害ドメイン間で仮想マシンをフェールオーバーすることは (たとえば、全体の障害ドメインがダウン) ですか? <br>
**回答:** いいえ、そのクラスター間のフェールオーバーに注意してください内での論理的な障害ドメインはまだサポートされていません。 

**質問:** 私のクラスターは複数のサイト (または DNS ドメイン) に span のクラスターを設定できますか。 <br> 
**回答:** これは、テストされていないシナリオであり、すぐに運用のサポートの計画。 このシナリオは、し、それを使用する方法に重要なかどうかは Microsoft に知らせてください。

**質問:** クラスターは、IPv6 での作業を設定しますか。 <br>
**回答:** フェールオーバー クラスターと同様、IPv4 と IPv6 の両方は、クラスターのセットでサポートされます。

**質問:** クラスターの Active Directory フォレストの要件は何の設定します。 <br>
**回答:** メンバーのすべてのクラスターは、同じ AD フォレストである必要があります。

**質問:** クラスターまたはノードの数を 1 つのクラスターの一部設定できますか。 <br>
**回答:** Windows Server の 2019 でクラスターのセットにテストされ、最大 64 個の合計のクラスター ノードをサポートします。 ただし、クラスターはくらい大きく制限にアーキテクチャのスケールを設定し、ハードコーディングされた制限のあるものではありません。 規模が大きいと、それを使用する方法に重要なは Microsoft に知らせてください。

**質問:** クラスターのセット内のすべての記憶域スペース ダイレクト クラスターでは、1 つの記憶域プールを形成するでしょうか。 <br>
**回答:** No. 記憶域スペース ダイレクト テクノロジでは、単一のクラスターとクラスターのセットのメンバーのクラスター全体ではなく引き続き動作します。

**質問:** 名前空間の高可用性を設定、クラスターは? <br>
**回答:** はい、クラスターのセットの名前空間は、管理クラスターで実行されている継続的に使用可能な (CA) の紹介 SOFS 名前空間サーバー経由で提供されます。 ローカライズされたクラスター全体の障害に対する回復力のあるさせるメンバー クラスターから仮想マシンのための十分な数のことをお勧めします。 ただし、予期しない致命的なエラー-例: すべての仮想マシンで、管理クラスターを同時にダウン – に対応する、紹介情報はさらに永続的にキャッシュ、各クラスター ノードで再起動後にも。
 
**質問:** クラスターはクラスター セットの記憶域のパフォーマンスを低下名前空間ベースの記憶域へのアクセスを設定します。 <br>
**回答:** No. クラスターのセットの名前空間には、概念的にはのような分散ファイル システム名前空間 (DFSN) – クラスター セット内で、オーバーレイ参照名前空間が用意されています。 異なり DFSN、すべてのクラスター セットの名前空間参照をメタデータは自動的に設定され、管理者の介入なしにすべてのノードで自動的に更新されため、ストレージのアクセス パスでパフォーマンスのオーバーヘッドはほとんどありません。 

**質問:** クラスターのセットのメタデータをバックアップする方法は? <br>
**回答:** このガイドでは、フェールオーバー クラスターの場合と同じです。 システム状態バックアップ、クラスターの状態をバックアップします。  Windows Server バックアップでは、(多数の自己修復ロジックがあるため決して必要する必要があります) をノードのクラスター データベースのみの復元を行うことができますか、すべてのノードでクラスター全体のデータベースをロールバックする authoritative restore を実行します。 クラスターのセットの場合は、Microsoft は、必要な場合はメンバー クラスターとし、管理クラスターにまず authoritative restore を実行お勧めします。
