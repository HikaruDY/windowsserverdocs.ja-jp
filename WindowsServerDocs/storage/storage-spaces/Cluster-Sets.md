---
title: クラスター セット
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 01/30/2019
description: この記事でクラスター セットのシナリオについて説明します。
ms.localizationpriority: medium
ms.openlocfilehash: 2deeb6968f910e80bacb2354ad2e575060a7797a
ms.sourcegitcommit: 07aefbdbb0eedb42aaed3d195c2429310c761da0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "9041008"
---
# クラスター セット

> 17650 以降の Windows Server Insider Preview ビルドに適用されます。

クラスター セットは、この数桁が 1 つのソフトウェア定義型データ センター (SDDC) クラウドでのクラスター ノードの数が増加するプレビュー リリースで新しいクラウド スケール アウト テクノロジです。 クラスター セットは、複数のフェールオーバー クラスターの疎結合グループ: 記憶域を計算します。 または、ハイパーコンバージドします。 クラスター設定テクノロジを使用する仮想マシンの滑らかな動作クラスター セットと統合された記憶域名前空間内のメンバー クラスター全体に仮想マシンの滑らかな動作をサポートするためです。 

保持の既存のフェールオーバー クラスター管理エクスペリエンスのメンバーのクラスターに、クラスター セット インスタンスさらに集計ライフ サイクル管理に関する主な用途用意されています。 この Windows Server プレビュー シナリオの評価ガイドでは、PowerShell を使用してクラスター セットのテクノロジを評価するための詳しい手順と共にために必要な背景情報を提供します。 

## テクノロジの概要

クラスター セットのテクノロジをソフトウェア定義データ センター (SDDC) クラウド スケールでの動作の固有の顧客要求を満たすために開発されています。 このプレビュー リリースのクラスター セットの価値は、次のようまとめることができます。  

- 1 つのクラスターにソフトウェアの障害の境界を維持しながらも 1 つの大きなファブリックに複数の小さいクラスターを組み合わせることによって、高可用性の仮想マシンを実行するためのサポートされている SDDC クラウド スケールを大幅に向上させる
- テナントの仮想マシンの可用性、滑らかに移行する経由での影響を与えずに、フェールオーバー クラスターのライフ サイクルと、オンボードを含む廃止されますでクラスター全体を管理この大規模なファブリックの間での仮想マシン
- ハイパーコンバージド記憶域への計算に比を容易に変更します。
- 最初の仮想マシンの配置とそれ以降の仮想マシンの移行でクラスター間で[Azure のような障害ドメインと使用可能状況の設定](htttps://docs.microsoft.com/azure/virtual-machines/windows/manage-availability)のメリットします。
- 混在異なる世代の CPU ハードウェア同じクラスター内には、個々 の障害ドメインの効率を最大同種維持時であっても、ファブリックを設定します。  同じハードウェアの推奨事項はクラスター全体のセットと、それぞれ個別のクラスター内でまだ存在していることに注意してください。

高レベルのビューでは、これは、どのようなクラスター セットのようになります。

![クラスター ソリューション ビューを設定します。](media\Cluster-sets-Overview\Cluster-sets-solution-View.png)

上記の画像内の要素のそれぞれの簡単な概要を次に示します。

**クラスターの管理**

クラスター セットに管理クラスターは、フェールオーバー クラスター、クラスター全体のセットと統合された記憶域名前空間 (クラスター設定 Namespace) 紹介スケール アウト ファイル サーバー (SOFS) の高可用性管理平面をホストしています。 管理クラスターは、仮想マシンのワークロードを実行するメンバー クラスターから論理的に分離します。 これにより、クラスター管理平面にローカライズされたクラスター全体にわたるエラーをすべて、resilient 設定のメンバーのクラスターの電源が失われるなどです。   

**メンバーのクラスター**

クラスター セットにメンバー クラスターは、通常、仮想マシンの記憶域スペース ダイレクトのワークロードを実行している従来のハイパーコンバージド クラスターです。 複数メンバーのクラスターより大きな SDDC クラウド ファブリックを形成する 1 つのクラスター セットの展開に参加します。 メンバーのクラスターと異なる 2 つの主要な側面で管理クラスター: 障害ドメインに参加しているメンバーのクラスターと使用可能状況の設定を作成します。 メンバー クラスターがホストの仮想マシンと記憶域スペース ダイレクトのワークロードにサイズもします。 このため、クラスター セットでクラスターの境界を越えて移動クラスター セットの仮想マシンを管理クラスター上でホストされませんする必要があります。

**クラスター セットの名前空間の紹介 SOFS**

クラスター セットの名前空間紹介 (クラスター設定 Namespace) SOFS とは、スケール アウト ファイル サーバーのクラスター セット Namespace SOFS 上の各を SMB 共有 'SimpleReferral' はこのプレビュー リリースで新しく導入された型の – 紹介の共有です。  この参照は、サーバー メッセージ ブロック (SMB) クライアントに SOFS メンバー クラスターでホストされている SMB 共有ターゲットへのアクセスを許可します。 クラスターは、I/O パスで SOFS 軽量な紹介メカニズムし、ように、参加していない名前空間の参照を設定します。 SMB 紹介は無期限のクライアント ノードごとにキャッシュされ、クラスター セットの名前空間に動的に自動的にこれらの紹介案件必要に応じて更新します。

**クラスター マスターを設定します。**

クラスター セットでは、メンバー クラスター間の通信は、疎結合し、「クラスター設定マスター」(CS マスター) と呼ばれる新しいクラスター リソースを調整します。 その他のクラスター リソースと同様に CS マスター可用性が高く、個々 のメンバー クラスターの障害や管理クラスター ノードの障害を resilient します。 新しいクラスター設定 WMI プロバイダーを使用した CS マスターは、すべてのクラスター セット管理操作の管理のエンドポイントを提供します。

**クラスター セット ワーカー**

展開では、クラスターの設定、CS マスターは、「クラスター設定ワーカー」(CS ワーカー) と呼ばれるクラスターのメンバーに新しいクラスター リソースとやり取りします。 CS ワーカーは CS マスターによって要求されたローカル クラスター操作を編成するクラスター上でのみ担当者として機能します。 このような操作の例には、仮想マシンの配置とインベントリを作成するクラスター ローカル リソースが含まれます。 のみのメンバーの各インスタンスを CS ワーカー クラスターのクラスター セットに 1 つです。 

**障害ドメイン**

障害ドメインがソフトウェアのグループ化し、障害が発生した場合、管理者が決定ハードウェア アーティファクトが一緒失敗します。  管理者は、障害ドメインとして 1 つまたは複数のクラスターをまとめて指定でした、中に各ノードが使用可能状況のセットでフォールト ドメインに参加可能性があります。 クラスターで設定デザイン葉フォールト ドメインの境界の決定の意思決定精通データ センター トポロジに関する考慮事項: PDU などでは、管理者にネットワーク – メンバー クラスターを共有することです。 

**使用可能状況の設定**

な可用性の設定により、管理者は、使用可能状況のセットにそれらを整理して、その可用性セットにワークロードを展開して、障害ドメイン間でクラスター化されたワークロードの冗長性の目的を構成します。 たとえば、使用可能状況の各階層その可用性セット内の 1 つの障害ドメインがダウンした場合、アプリケーションは、少なくともを維持するための設定では、少なくとも 2 つの仮想マシンを構成することをお勧めします 2 層アプリケーションを展開する場合その同じ可用性のさまざまな障害ドメインでホストされている各階層の 1 つの仮想マシンを設定します。

## クラスター セットを使用する理由

クラスター セットは、回復性を損なうことがなく、スケールのメリットを提供します。  

クラスター セットは、複数のクラスターをクラスタ リングまとめて各クラスターの回復性のための独立したまま、大規模なファブリックを作成できます。  たとえば、いくつかの 4 ノード HCI がある仮想マシンを実行しているクラスターします。  各クラスターでは、それ自体に必要な回復性を提供します。  記憶域またはメモリにいっぱいに起動する場合は、次の手順はスケール アップします。  スケール アップでは、いくつかのオプションと考慮事項があります。

1. 現在のクラスターに複数の記憶域を追加します。  記憶域スペース ダイレクトでこれは、注意が必要とまったく同じモデル/ファームウェア ドライブができない場合があります。  再構築時間の考慮事項では、考慮する必要があります。
2. 多くのメモリを追加します。  場合、コンピューターが処理できるメモリ達ししているかどうか。  どのような場合は利用可能なメモリのスロットすべてが完全なかどうか。
3. 現在のクラスターにドライブを含む追加のコンピューティング ノードを追加します。  ここでは、戻るオプション 1 を考慮する必要はありません。
4. まったく新しいクラスターを購入します。

これは、クラスター セットはスケーリングのメリットを提供します。  クラスター セットにクラスターを追加した場合を記憶域または任意の追加購入することがなく別のクラスターで使用可能なメモリの利用を教えてくださいできます。  回復性の観点から、記憶域スペース ダイレクトに追加のノードを追加する予定はありませんクォーラムに対する追加の投票を提供します。  として説明したように[は、ここ](drive-symmetry-considerations.md)で、記憶域スペース ダイレクト クラスターは、下方向にする前に 2 ノードの損失を回避することができます。  4 ノード HCI クラスターがあれば、3 つのノード移動クラスター全体になります。  8 ノードのクラスターがあれば、3 つのノードにクラスター全体になります。  セットの 2 つの 4 ノード HCI クラスターを持つクラスター セット、2 ノード HCI の 1 つのと他の HCI で 1 のノードが移動を両方のクラスターを継続的にします。  好ましい 1 つの大きな 16 ノード記憶域スペース ダイレクト クラスターを作成または 4 つの 4 ノードのクラスターに分割してクラスター セットを使用するかどうか。  コンピューティングの複数のノードが移動できます (突然またはメンテナンスのため) である同じの規模が回復性の向上により、クラスター セットに 4 つの 4 ノード クラスターを持つ実稼働状態が維持されます。

## クラスター セットを展開するための考慮事項

クラスター セットは何かを使用する必要があるかどうかを検討するときは、これらの質問を検討してください。

- 現在 HCI コンピューティングおよびストレージ スケールの制限を超える必要がありますか。
- すべてのコンピューティングおよびストレージと同じは異なるかどうか。
- クラスター間の仮想マシンを移行するライブかどうか。
- たい Azure のようなコンピューターの可用性を設定し、障害ドメイン複数のクラスターですか。
- 新しい仮想マシンを配置する必要があるかを判断するためにすべてのクラスターを見てに時間がかかるする必要がありますか。

回答が [はい] である場合をクラスター セットが必要となります。

大きい SDDC が、全体的なデータ センターの戦略を変更可能性がありますを考慮するその他のいくつかの項目があります。  SQL Server では、適切な例を示します。  SQL Server の仮想マシン クラスター間で移動はライセンスの追加のノード上で実行するには必要かどうか。  

## スケール アウト ファイル サーバーおよびクラスター セット

Windows Server 2019 のでは、インフラストラクチャ スケール アウト ファイル サーバー (SOFS) と呼ばれる新しいスケール アウト ファイル サーバーの役割があります。 

インフラストラクチャ SOFS ロールには、次の考慮事項が適用されます。

1.  フェールオーバー クラスターに最大で 1 つのインフラストラクチャ SOFS クラスターの役割があります。 インフラストラクチャ SOFS ロールを指定することによって作成、"**-インフラストラクチャ**"パラメーターを**追加 ClusterScaleOutFileServerRole**コマンドレットに切り替えます。  例:

        Add-ClusterScaleoutFileServerRole -Name "my_infra_sofs_name" -Infrastructure

2.  フェールオーバーで自動的に作成した各 CSV ボリュームでは、CSV ボリューム名に基づいて、自動生成された名前を持つ、SMB 共有の作成がトリガーされます。 管理者は、直接作成または SOFS ロールを持ち、CSV ボリュームを作成/変更操作で以外の下の SMB 共有を変更できません。

3.  ハイパーコンバージド構成では、インフラストラクチャ、SOFS SMB クライアントに保証された継続的な可用性 (CA) インフラストラクチャ SOFS SMB サーバーへの通信に (HYPER-V ホスト) を許可します。 このハイパーコンバージド SMB ループバック CA は、仮想マシンを所有している仮想マシン id がクライアントとサーバー間で転送される、仮想ディスク (VHDx) ファイルへのアクセスによって実現されます。 この identity 転送では、前に、ハイパーコンバージド クラスターの標準的な構成の場合と同様の ACL これ VHDx ファイルを許可します。

クラスター セットが作成されると、クラスター セットの名前空間は、メンバー、各クラスターで、インフラストラクチャ SOFS し、さらに、インフラストラクチャ SOFS 管理クラスター内に依存します。

時にメンバー クラスター管理者が既に存在する場合に、そのクラスター上で、インフラストラクチャ SOFS の名前を指定するクラスター セットに追加されます。 インフラストラクチャ SOFS が存在しない場合、新しいメンバー クラスター上で新しいインフラストラクチャ SOFS ロールは、この操作によって作成されます。 メンバー クラスター上で、インフラストラクチャ SOFS ロールが既に存在する場合、追加の操作暗黙的に名前を変更する、指定した名前を必要に応じてします。 任意の既存のシングルトン SMB サーバー、またはメンバーのクラスターが残っているクラスター セットで利用されていないインフラストラクチャ以外の SOFS ロールします。 

クラスター セットが作成された時点では、管理者は管理クラスター上で名前空間のルートとして既存の AD コンピューター オブジェクトを使用するオプションを持ちます。 クラスター セットを作成する操作は、管理クラスターでインフラストラクチャ SOFS クラスターの役割を作成したり、クラスターのメンバーだけ前述したように、既存のインフラストラクチャ SOFS ロールの名前を変更します。 インフラストラクチャ SOFS 管理クラスター上では、クラスターの名前空間の参照 (クラスター設定 Namespace) SOFS の設定に使用されます。 クラスター上で各 SMB 共有設定 SOFS はこのプレビュー リリースで新しく導入された – 'SimpleReferral' の種類 - の紹介の共有の名前空間であることを意味します。  この参照は、メンバー クラスター SOFS でホストされている SMB クライアントが SMB 共有ターゲットにアクセスできます。 クラスターは、I/O パスで SOFS 軽量な紹介メカニズムし、ように、参加していない名前空間の参照を設定します。 SMB 紹介はクライアントのノードのそれぞれで永続的にキャッシュされ、クラスター セットの名前空間に動的に自動的にこれらの紹介案件必要に応じて更新

## クラスター セットを作成します。

### 前提条件

設定クラスターを作成するには、次の前提条件をお勧めします。

1. 最新の Windows Server Insider リリースを実行している管理クライアントを構成します。
2. フェールオーバー クラスターのツールは、この管理サーバーにインストールします。
3. クラスター メンバー (少なくとも 2 つのクラスターに少なくとも 2 つのクラスター共有ボリュームと各クラスターで) の作成します。
4. メンバーのクラスターをまたいでいる管理クラスター (物理またはゲスト) を作成します。  このアプローチでは、平面に管理し続けることが可能なメンバー クラスター失敗にかかわらずクラスター セットを確認します。

### 手順

1. 次の 3 つのクラスターから設定されるように、前提条件で定義されている新しいクラスターを作成します。  グラフの下のクラスターを作成する例を提供します。  この例では設定クラスターの名前を**CSMASTER**となります。

   | クラスター名               | 後で使用するインフラストラクチャ SOFS 名 | 
   |----------------------------|-------------------------------------------|
   | セット クラスター                | SOFS CLUSTERSET                           |
   | CLUSTER1                   | SOFS CLUSTER1                             |
   | CLUSTER2                   | SOFS CLUSTER2                             |

2. すべてのクラスターが作成されたら、セット マスター クラスターを作成するのに次のコマンドを使用します。

        New-ClusterSet -Name CSMASTER -NamespaceRoot SOFS-CLUSTERSET -CimSession SET-CLUSTER

3. クラスター セットにクラスター サーバーを追加する、以下を使うことはできます。

        Add-ClusterSetMember -ClusterName CLUSTER1 -CimSession CSMASTER -InfraSOFSName SOFS-CLUSTER1
        Add-ClusterSetMember -ClusterName CLUSTER2 -CimSession CSMASTER -InfraSOFSName SOFS-CLUSTER2

   > [!NOTE]
   > 静的 IP アドレス スキームを使用している場合は、**新規 ClusterSet**コマンドで *-StaticAddress x.x.x.x*を含める必要があります。

4. クラスターのクラスター メンバー外セットを作成した後は、ノードのセットとそのプロパティを一覧表示できます。  すべてのメンバーを列挙するには、クラスター セットにクラスターします。

        Get-ClusterSetMember -CimSession CSMASTER

5. すべてのメンバーを列挙するには、設定、管理のクラスター ノードを含むクラスターでクラスターします。

        Get-ClusterSet -CimSession CSMASTER | Get-Cluster | Get-ClusterNode

6. メンバー クラスターからのすべてのノードの一覧を表示します。

        Get-ClusterSetNode -CimSession CSMASTER

7. すべての一覧をクラスター全体にわたってリソース グループを設定します。

        Get-ClusterSet -CimSession CSMASTER | Get-Cluster | Get-ClusterGroup 

8. クラスターを確認するには、各クラスター メンバーのインフラストラクチャ SOFS で作成 (Volume1 またはインフラストラクチャ ファイル サーバーとの両方にパスの名前をされている ScopeName では、CSV フォルダーのラベルとして識別されます)、1 つの SMB 共有の作成プロセスを設定します。CSV ボリュームの場合:

        Get-SmbShare -CimSession CSMASTER

8. クラスター セットでは、レビューの収集できるデバッグ ログがあります。  クラスターの設定し、すべてのメンバーと管理のクラスターにクラスター デバッグ ログを収集することができます。

        Get-ClusterSetLog -ClusterSetCimSession CSMASTER -IncludeClusterLog -IncludeManagementClusterLog -DestinationFolderPath <path>

9. Kerberos で[制約付き委任](https://blogs.technet.microsoft.com/virtualization/2017/02/01/live-migration-via-constrained-delegation-with-kerberos-in-windows-server-2016/)をすべてのクラスター セット メンバー間を構成します。

10. クラスター セット内の各ノードでは、kerberos クロス クラスターの仮想マシンのライブ マイグレーション認証の種類を構成します。

        foreach($h in $hosts){ Set-VMHost -VirtualMachineMigrationAuthenticationType Kerberos -ComputerName $h }

11. 管理クラスターをクラスター セット内の各ノードのローカル administrators グループに追加します。

        foreach($h in $hosts){ Invoke-Command -ComputerName $h -ScriptBlock {Net localgroup administrators /add <management_cluster_name>$} }

## 新しい仮想マシンを作成し、クラスター セットに追加します。

設定クラスターの作成後、次の手順が、新しい仮想マシンを作成します。  通常、仮想マシンを作成して、クラスターに追加する時間になる場合、クラスター上で実行する最適な場合がありますを確認するためにいくつかのチェックを行う必要があります。  これらのチェックを含めることができます。

- メモリの量は、クラスター ノード上で使用できるかどうか。
- ディスク領域の量は、クラスター ノード上で使用できるかどうか。
- 仮想マシンに特定の記憶域の要件 (つまりか高速のドライブを実行しているクラスターに移動し、SQL Server の仮想マシンまたは、インフラストラクチャの仮想マシンが重要でないし、低速のドライブ上で実行できます) が必要です。

この質問の回答は後、にする必要があるクラスター上で仮想マシンを作成します。  クラスター セットの利点の 1 つは、クラスター セットをこれらのチェックを実行して、最適なノードで、仮想マシンを配置することです。

以下のコマンドは両方最適なクラスターを識別し、仮想マシンを展開します。  少なくとも 4 ギガバイトのメモリが仮想マシンの使用可能であり、1 の仮想プロセッサを利用する必要がありますを指定新しい仮想マシンを作成例では、以下。

- 4 gb が仮想マシンの利用可能であることを確認します。
- 1 で使用されている仮想プロセッサを設定します。
- 10% 以上を確認します仮想マシンの利用可能な CPU。

   ```PowerShell
   # Identify the optimal node to create a new virtual machine
   $memoryinMB=4096
   $vpcount = 1
   $targetnode = Get-ClusterSetOptimalNodeForVM -CimSession CSMASTER -VMMemory $memoryinMB -VMVirtualCoreCount $vpcount -VMCpuReservation 10
   $secure_string_pwd = convertto-securestring "<password>" -asplaintext -force
   $cred = new-object -typename System.Management.Automation.PSCredential ("<domain\account>",$secure_string_pwd)

   # Deploy the virtual machine on the optimal node
   Invoke-Command -ComputerName $targetnode.name -scriptblock { param([String]$storagepath); New-VM CSVM1 -MemoryStartupBytes 3072MB -path $storagepath -NewVHDPath CSVM.vhdx -NewVHDSizeBytes 4194304 } -ArgumentList @("\\SOFS-CLUSTER1\VOLUME1") -Credential $cred | Out-Null
   
   Start-VM CSVM1 -ComputerName $targetnode.name | Out-Null
   Get-VM CSVM1 -ComputerName $targetnode.name | fl State, ComputerName
   ```

これが完了したらが与えられます仮想マシンと配置された場所についてします。  上記の例として表示するには。

        State         : Running
        ComputerName  : 1-S2D2

いない十分なメモリ、cpu、またはディスク領域を仮想マシンを追加する場合は、エラーが表示されます。

      Get-ClusterSetOptimalNodeForVM : A cluster node is not available for this operation.  

仮想マシンが作成されたらが指定されている特定のノード上で HYPER-V マネージャーで表示されます。  クラスターは、仮想マシンを設定して、クラスター内には、それを追加するには、コマンドを下回っています。  

        Register-ClusterSetVM -CimSession CSMASTER -MemberName $targetnode.Member -VMName CSVM1

これが完了すると、出力になります。

         Id  VMName  State  MemberName  PSComputerName
         --  ------  -----  ----------  --------------
          1  CSVM1      On  CLUSTER1    CSMASTER

既存の仮想マシンを使用したクラスターを追加した場合、仮想マシンでは、クラスター セットが、仮想マシンを同時に使用するコマンドは、すべてを登録に登録する必要があります。

        Get-ClusterSetMember -name CLUSTER3 -CimSession CSMASTER | Register-ClusterSetVM -RegisterAll -CimSession CSMASTER

ただし、仮想マシンへのパスをクラスター セットの名前空間に追加する必要があるため、プロセスが完了しません。

たとえば、既存クラスターが追加され、それが事前構成済みの仮想マシン、reside で、ローカル クラスター共有ボリューム (CSV)、VHDX のパスが以下のように"C:\ClusterStorage\Volume1\MYVM\Virtual ハード Disks\MYVM.vhdx します。  ストレージの移行は、CSV パスは、デザイン、1 つのメンバーのクラスターにローカルで実行する必要があります。 したがっては仮想マシンにアクセスできるライブされたらメンバー クラスター間で移行です。 

この例では CLUSTER3 SOFS CLUSTER3 としてのインフラストラクチャのスケール アウト ファイル サーバーと追加 ClusterSetMember を使用して設定クラスターに追加されました。  コマンドは、仮想マシンの構成と記憶域を移動するには。

        Move-VMStorage -DestinationStoragePath \\SOFS-CLUSTER3\Volume1 -Name MYVM

これが完了すると、警告が表示されます。

        WARNING: There were issues updating the virtual machine configuration that may prevent the virtual machine from running.  For more information view the report file below.
        WARNING: Report file location: C:\Windows\Cluster\Reports\Update-ClusterVirtualMachineConfiguration '' on date at time.htm.

この警告は、「仮想マシンの役割の記憶域構成の変更が検出されない」として、この警告を無視できます。  実際の物理的な場所として警告の原因は変更されません。構成パスのみです。 

移動 VMStorage について詳しくは、この[リンク](https://docs.microsoft.com/powershell/module/hyper-v/move-vmstorage?view=win10-ps)を確認してください。 

ライブ別のクラスター セット クラスター間での仮想マシンの移行は、過去に示すよういない同じです。 非クラスター セットのシナリオでの手順になります。

1. 仮想マシンの役割をクラスターから削除します。
2. 別のクラスターのメンバー ノードに仮想マシンのライブ マイグレーションします。
3. 仮想マシンの新しいロールとしてクラスターに仮想マシンを追加します。

クラスター セットを使って次の手順は必要なく、1 つのコマンドが必要です。  たとえば、CLUSTER3 のクラスター セットの仮想マシンを CLUSTER1 から node 2 CL3 に移動します。  1 つのコマンドは次のようになります。

        Move-ClusterSetVM -CimSession CSMASTER -VMName CSVM1 -Node NODE2-CL3

この仮想マシンの記憶域または構成ファイルは移動されないことに注意してください。  仮想マシンへのパスに限り、\\SOFS-CLUSTER1\VOLUME1 として必要はありません。  仮想マシンが登録されているクラスター セットとインフラストラクチャのファイル サーバーの共有のパスには、ドライブと仮想マシン、仮想マシンと同じコンピューター上にあるものが必要としません。

## セットの障害ドメインの可用性の作成

導入のように、Azure のようなフォールト ドメインと使用可能状況のセットは、クラスター セットで構成できます。  最初の仮想マシンの配置し、クラスター間の移行に有効です。  

次の例では、クラスター セットに参加している 4 つのクラスターがあります。  セット内の 2 つのクラスターとその他の 2 つのクラスターで作成した障害ドメインの論理的な障害ドメインが作成されます。  これら 2 つの障害ドメイン Availabiilty セットを構成します。 

次の例で CLUSTER1 と CLUSTER2 が CLUSTER3 CLUSTER4 なります**FD2**と呼ばれる障害ドメインの中に**FD1**と呼ばれるフォールト ドメイン内になります。  使用可能状況のセットが呼び出される**CSMASTER-AS**し、2 つの障害ドメインで構成されます。

コマンドはフォールト ドメインを作成するには。

        New-ClusterSetFaultDomain -Name FD1 -FdType Logical -CimSession CSMASTER -MemberCluster CLUSTER1,CLUSTER2 -Description "This is my first fault domain"

        New-ClusterSetFaultDomain -Name FD2 -FdType Logical -CimSession CSMASTER -MemberCluster CLUSTER3,CLUSTER4 -Description "This is my second fault domain"

正常に作成されたことを確認するには、するには、表示されるその出力で Get ClusterSetFaultDomain を実行することができます。

        PS C:\> Get-ClusterSetFaultDomain -CimSession CSMASTER -FdName FD1 | fl *

        PSShowComputerName    : True
        FaultDomainType       : Logical
        ClusterName           : {CLUSTER1, CLUSTER2}
        Description           : This is my first fault domain
        FDName                : FD1
        Id                    : 1
        PSComputerName        : CSMASTER

障害ドメインが作成されて、可用性は、作成する必要がありますを設定します。

        New-ClusterSetAvailabilitySet -Name CSMASTER-AS -FdType Logical -CimSession CSMASTER -ParticipantName FD1,FD2

検証するのにが作成されたら、その後で使用します。

        Get-ClusterSetAvailabilitySet -AvailabilitySetName CSMASTER-AS -CimSession CSMASTER

新しい仮想マシンを作成するときは必要がある最適なノードを判別する際に - AvailabilitySet パラメーターを使用します。  次のように、なります。

        # Identify the optimal node to create a new virtual machine
        $memoryinMB=4096
        $vpcount = 1
        $av = Get-ClusterSetAvailabilitySet -Name CSMASTER-AS -CimSession CSMASTER
        $targetnode = Get-ClusterSetOptimalNodeForVM -CimSession CSMASTER -VMMemory $memoryinMB -VMVirtualCoreCount $vpcount -VMCpuReservation 10 -AvailabilitySet $av
        $secure_string_pwd = convertto-securestring "<password>" -asplaintext -force
        $cred = new-object -typename System.Management.Automation.PSCredential ("<domain\account>",$secure_string_pwd)

クラスターをクラスターから削除するさまざまなライフ サイクルを設定します。 クラスターのクラスター セットから削除する必要がある場合もあります。 ベスト プラクティスとして、すべてのクラスター セットの仮想マシンはクラスターから移動する必要があります。 これは、**移動 ClusterSetVM**と**移動 VMStorage**コマンドを使用して実現できます。

ただし、仮想マシンをも移動できませんが、クラスター セットは一連の管理者に直感的な結果を提供するアクションを実行します。  セットから、クラスターが削除されると、すべて残りクラスター セットの仮想マシンが削除されているクラスターでホストされているは、記憶域へのアクセスがあると想定すると、そのクラスターにバインドされている仮想マシンの高可用性を単になります。  クラスター セットには、インベントリも自動的に更新されます。

- ここで削除されたクラスターとことで実行されている仮想マシンの正常性を追跡できなく
- クラスター セットの名前空間と、ここで削除されたクラスターでホストされている共有へのすべての参照から削除します

たとえば、クラスター セットから CLUSTER1 クラスターを削除するには、コマンドは次のようになります。

        Remove-ClusterSetMember -ClusterName CLUSTER1 -CimSession CSMASTER

## よく寄せられる質問 (FAQ)

**質問:** マイ クラスター セットにハイパーコンバージド クラスターを使用するだけに限定されて I いるかどうか。 <br>
**応答:** 違います。  従来のクラスターと記憶域スペース ダイレクトを組み合わせることができます。

**質問:**[クラスター経由で System Center の仮想マシン Manager 設定を管理できますか。 <br>
**応答:** System Center の仮想マシンのマネージャーは現在クラスター セットをサポートしていません <br><br> **質問:** できる Windows Server 2012 R2 または 2016 クラスター内に共存させる同じクラスター セットかどうか。 <br>
**質問:** Windows Server 2012 R2 オフ ワークロードを移行できます。 または 2016 クラスターそれらのクラスターがあるだけで同じクラスター セットを参加させるかどうか。 <br>
**応答:** クラスターを設定する新しいテクノロジは、Windows Server Preview で導入されたビルドようが存在しない以前のリリースでします。 クラスター セットがダウンレベル OS ベースのクラスターに参加できません。 ただし、クラスター オペレーティング システムのローリング アップグレードのテクノロジには、Windows Server 2019 をこれらのクラスターをアップグレードすることを求めている移行機能を提供する必要があります。

**質問:** クラスター セットも許可できます記憶域を拡大縮小または (単独で) を計算するかどうか。 <br>
**応答:** はい、追加するだけで、記憶域スペース ダイレクトまたは従来の HYPER-V クラスターします。 クラスター セット、ハイパーコンバージド クラスター セットであっても計算の記憶域比の簡単な変更です。

**質問:** クラスター セットの管理ツールとは <br>
**応答:** PowerShell または WMI このリリースでします。

**質問:** 異なる世代のプロセッサを搭載したクロス クラスターのライブ マイグレーションのとし  <br>
**応答:** クラスター セットはプロセッサの相違点を回避されず、HYPER-V の現在のサポートを優先します。  したがって、プロセッサ互換性モードは、クイックの移行で使用する必要があります。  発生するクラスター間でライブ マイグレーションにそれぞれ個別のクラスターと全体のクラスター セット内のプロセッサと同じハードウェアを使用するがクラスター セットが推奨されます。

**質問:** できます my クラスター セットを仮想マシンに自動的にフェールオーバー クラスター エラーの発生時におけるかどうか。  <br>
**応答:** このリリースでクラスター セットの仮想マシンのみである可能性手動でライブ マイグレーション クラスターただし、フェールオーバーを自動的にすることはできません。 

**質問:** 行うようにして、記憶域がクラスターの障害かどうか。 <br>
**応答:** メンバーのクラスター間でクロス クラスターの記憶域レプリカ (SR) ソリューションを使用して、クラスターの障害に記憶域の回復性を実現します。

**質問:** 記憶域レプリカ (SR) メンバー クラスター間のレプリケーションを使用します。 レプリカ ターゲット記憶域スペース ダイレクト クラスターに SR フェールオーバーの UNC パスの変更を記憶域セットの名前空間をクラスター操作を行うかどうか。 <br>
**応答:** このリリースで SR フェールオーバーでこのようなクラスター セット名前空間の参照の変更は発生しません。 このシナリオが重要にし、それを使用する方法を知る Microsoft ご連絡ください。

**質問:** フォールト ドメイン災害復旧で仮想マシンをフェールオーバーすることもできますが (たとえば、全体の障害ドメインがダウン) かどうか。 <br>
**応答:** いいえ、その間クラスター フェールオーバーをメモ内での論理的なフォールト ドメインはまだサポートされていません。 

**質問:** クラスターは複数のサイト (または DNS ドメイン) でスパン クラスターを設定できますか。 <br> 
**応答:** これは、テストされていないシナリオであり、すぐに実稼働のサポートが計画されています。 このシナリオが重要にし、それを使用する方法を知る Microsoft ご連絡ください。

**質問:** クラスターは、ipv6 の作業を設定します。 <br>
**応答:** フェールオーバー クラスターの場合と同様、クラスター セットを使って、IPv4 と IPv6 の両方がサポートします。

**質問:** クラスターの Active Directory フォレストの要件を設定します。 <br>
**応答:** すべてのメンバー クラスターは、同じ AD フォレスト内にあります。

**質問:** クラスターまたはノードの数、1 つのクラスターの一部設定できるかどうか。 <br>
**応答:** プレビューでは、クラスター セットにテストされ、最大 64 合計クラスター ノードをサポートします。 ただし、クラスターより大きい制限をアーキテクチャ スケールを設定し、制限のハードコードされたものではありません。 Microsoft がいるかどうかより大きなスケールと、それを使用する方法に重要なご連絡ください。

**質問:** クラスター セット内のすべての記憶域スペース ダイレクト クラスターは、1 つの記憶域プールが形成されるかどうか。 <br>
**応答:** 違います。 記憶域スペース ダイレクトのテクノロジは、クラスター セットにメンバー クラスター間ではなく、1 つのクラスター内で引き続き動作します。

**質問:** 名前空間の可用性を設定、クラスターかどうか。 <br>
**応答:** はい、クラスター セットの名前空間は、管理クラスター上で実行されている継続的に利用可能な (CA) 紹介 SOFS 名前空間サーバーを介して提供されます。 マイクロソフトでは、ローカライズされたクラスター全体の障害を resilient するメンバー クラスターから仮想マシンのための十分な数のことをお勧めします。 ただし、予期しない致命的なエラー-例: すべての仮想マシンで下方向に同時に管理クラスター – のアカウントを紹介情報は、さらに永続的にキャッシュ、各クラスター ノードで再起動を行っても。
 
**質問:** クラスターは、クラスター セットの記憶域のパフォーマンス低下名前空間ベースの記憶域へのアクセスを設定します。 <br>
**応答:** 違います。 クラスター セットの名前空間には、概念的にはのように分散ファイル システムの名前空間 (DFSN) – クラスター セット内オーバーレイ紹介の名前空間が用意されています。 異なり DFSN、すべてのクラスター セットの名前空間の紹介メタデータは自動的に設定し、すべてのノードの管理者操作なしで自動更新が、パフォーマンスのオーバーヘッドが記憶域へのアクセス パス内でほとんどないためです。 

**質問:** クラスター セットのメタデータをバックアップする方法は? <br>
**応答:** このガイドでは、フェールオーバー クラスターのと同じです。 システム状態バックアップ、クラスターの状態をバックアップします。  Windows Server バックアップ、を通じて (これは、多数の自己修復のロジックがあるため決して必要する必要があります) ノードのクラスター データベースだけの復元を行うことができますにすべてのノード間でクラスター全体のデータベースをロールバックする権限の復元を行うこともできます。 クラスター セットの場合は、マイクロソフトは、必要な場合、メンバー クラスターし管理クラスター上でまず権限のある復元の操作をお勧めします。 
