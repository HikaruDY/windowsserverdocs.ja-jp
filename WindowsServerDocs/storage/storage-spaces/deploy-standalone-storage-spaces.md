---
title: スタンドアロン サーバーに記憶域スペースを展開する
description: Windows Server 2012 ベースのスタンドアロン サーバーに記憶域スペースを展開する方法について説明します。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-spaces
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: 40265e767ac9aca05386c0893def259aca3a5633
ms.sourcegitcommit: e73fbe1046a8bd2bf4f24ccffc11465ad8dfab1d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/07/2019
ms.locfileid: "8992535"
---
# スタンドアロン サーバーに記憶域スペースを展開する

>適用対象: Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、スタンドアロン サーバーに記憶域スペースを展開する方法について説明します。 クラスター化された記憶域スペースを作成する方法について詳しくは、 [Windows Server 2012 R2 上の記憶域スペース クラスターの展開](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>)を参照してください。

ストレージ領域を作成するには、まず 1 つ以上の記憶域プールを作成する必要があります。 記憶域プールは、物理ディスクのコレクションです。 記憶域プールは、記憶域の集計、柔軟な容量の拡張、および管理を委任できます。

記憶域プールから 1 つまたは複数の仮想ディスクを作成できます。 これらの仮想ディスクは*記憶域スペース*とも呼ばれます。 記憶域スペースはフォーマットのボリュームを作成することが通常のディスク、Windows オペレーティング システムが表示されます。 ファイル サービスおよび記憶域サービスのユーザー インターフェイスを使って仮想ディスクを作成するときは、回復性の種類を構成することができます (単純なミラーまたはパリティ)、プロビジョニングの種類 (シンまたは固定)、およびサイズ。 Windows PowerShell、を通じて列、インターリーブ値、および使用するプール内のどの物理ディスクの数などの他のパラメーターを設定できます。 これらの追加パラメーターについて詳しくは、[新規 VirtualDisk](https://docs.microsoft.com/powershell/module/storage/new-virtualdisk?view=win10-ps)を参照してください。 と[列とは記憶域スペースの決定数を使用するかどうか。](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx%23what_are_columns_and_how_does_storage_spaces_decide_how_many_to_use)で記憶域スペースよく寄せられる質問 (FAQ)。

>[!NOTE]
>記憶域スペースを使って、Windows オペレーティング システムをホストすることはできません。

仮想ディスクからは、1 つまたは複数のボリュームを作成できます。 ボリュームを作成するときは、サイズ、ドライブ文字またはフォルダー、ファイル システム (NTFS ファイル システムまたは Resilient File System (ReFS))、アロケーション ユニット サイズ、および、省略可能なボリューム ラベルを構成できます。

次の図は、記憶域スペースのワークフローを示しています。

![記憶域スペースのワークフロー](media/deploy-standalone-storage-spaces/storage-spaces-workflow.png)

**図 1: 記憶域スペースのワークフロー**

>[!NOTE]
>このトピックでは、上記の手順の一部を自動化するために使用できるサンプル Windows PowerShell コマンドレットを使用します。 詳細については、 [PowerShell](https://docs.microsoft.com/powershell/scripting/powershell-scripting?view=powershell-6)を参照してください。

## 前提条件

記憶域スペースを使用して、スタンドアロンの Windows Server 2012−based サーバーで、するには、使用する物理ディスクが次の前提条件を満たしていることを確認します。

> [!IMPORTANT]
> フェールオーバー クラスターで記憶域スペースを展開する方法を説明する場合は、 [Windows Server 2012 R2 上の記憶域スペース クラスターの展開](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>)を参照してください。 フェールオーバー クラスターの展開では、サポートされているディスクのバスの種類、サポートされている回復性の種類、およびディスクの必要な最小数など、さまざまな前提条件があります。

|エリア|要件|説明|
|---|---|---|
|ディスクのバスの種類|シリアル接続 SCSI (SAS)<br>シリアル Advanced テクノロジの添付ファイル (SATA)<br>-iSCSI とファイバー チャネルのコント ローラー。 |USB ドライブを使用することもできます。 ただし、サーバー環境で USB ドライブを使用するのに最適ではありません。<br>記憶域スペースは、それらの上に作成した仮想ディスクが回復性のない (任意の列数に応じた単純) である限り、iSCSI、ファイバー チャネル (FC) コント ローラーでサポートされます。<br>|
|ディスクの構成|-物理ディスクは 4 GB 以上である必要があります。<br>空白とフォーマットされていないディスクがあります。 ボリュームを作成することはありません。||
|HBA に関する考慮事項|-RAID 機能をサポートしていないシンプルなホスト バス アダプター (Hba) を推奨します。<br>-RAID 機能をすべて無効になっていると Hba を RAID 以外のモードである必要があります RAID に対応した場合<br>-アダプターは、物理ディスク、キャッシュ データを抽象化または接続されている任意のデバイスを隠したりする必要がありますできません。 これには、接続されているだけでは、-多数のディスク (JBOD) デバイスによって提供されるエンクロージャ サービスが含まれます。 |記憶域スペースと互換性がのみ Hba RAID のすべての機能を完全に無効ことができます。|
|JBOD 格納装置|-JBOD 格納装置は省略可能です。<br>推奨記憶域スペースを使用する認定格納装置の Windows Server Catalog に記載されています。<br>-JBOD 格納装置を使用している場合、エンクロージャが完全に機能するために記憶域スペースをサポートしている、ストレージ ベンダーと確認します。<br>-JBOD 格納装置がエンクロージャおよびスロットの識別をサポートしているかどうかを確認するのには、次の Windows PowerShell コマンドレットを実行します。<br><br>`Get-PhysicalDisk \| ? {$_.BusType –eq "SAS"} \| fc`<br><br>**EnclosureNumber**と**スロットにある**フィールドに値が含まれている場合、エンクロージャはこれらの機能をサポートします。||

物理ディスクとスタンドアロン サーバーの展開の目的の回復性の種類の数を計画するには、次のガイドラインを使用します。

|回復性の種類|ディスクの要件|用途|
|---|---|---|
|**シンプル**<br><br>-物理ディスク間でデータをストライプします。<br>-ディスクの容量を最大化し、スループットの向上<br>(ディスクの障害からは保護されません)-回復性<br><br><br><br><br><br><br>|1 つ以上の物理ディスクが必要です。|ホスト欠かすデータを使わないでください。 単純なスペースは、ディスク障害に対しては保護されません。<br><br>使用して、コストを削減一時的または簡単に再作成されたデータをホストします。<br><br>回復性が必須ではありませんか、アプリケーションで提供されていない、高パフォーマンス ワークロードに適しています。|
|**Mirror (ミラー)**<br><br>-一連の物理ディスク全体でデータの 2 つまたは 3 つのコピーを格納します。<br>-、信頼性を向上しますが、容量を軽減します。 重複除外は、すべての書き込みで発生します。 ミラー スペースには、複数の物理ドライブのデータもストライプ化されます。<br>-データ スループットとパリティよりも低いアクセスの待機時間<br>使用はダーティ追跡 (恐竜回収チーム) をプール内のディスクへの変更を追跡する地域です。 システムが予期しないシャット ダウンから再開すると、スペースがオンラインになり、設定、恐竜回収チームにより、ディスク プール内で相互に一貫しました。|1 つのディスク障害から保護するために、少なくとも 2 つの物理ディスクが必要です。<br><br>2 つの同時ディスク障害から保護するために、少なくとも 5 つの物理ディスクが必要です。|ほとんどの展開に使用します。 たとえば、ミラー スペースは、汎用的なファイル共有や仮想ハード_ディスク (VHD) ライブラリに適しています。|
|**パリティ**<br><br>の物理ディスク間でストライプ データとパリティの情報<br>-シンプルなスペースと比較しても、容量はいくらか減る場合信頼性が向上します。<br>-ジャーナルを通じて回復性が向上します。 これにより、予期しないシャット ダウンが発生した場合は、データの破損を防止できます。|1 つのディスク障害から保護するために、少なくとも 3 つの物理ディスクが必要です。|アーカイブ、バックアップなどの高度連番のワークロードに使用します。|

## 手順 1: 記憶域プールを作成します。

1 つ以上の記憶域プールに最初のグループ使用可能な物理ディスクする必要があります。

1. サーバー マネージャーのナビゲーション ウィンドウで、**ファイル サービスおよび記憶域のサービス**を選択します。

2. ナビゲーション ウィンドウで、**記憶域プール**ページを選択します。
    
    既定では、使用可能なディスクが*基底*プールというプールに含まれています。 [**記憶域プール**基底プールが記載されていない場合は、記憶域が記憶域スペースの要件を満たしていないことを示します。 ディスクが前提条件のセクションに記載されている要件を満たしていることを確認します。
    
    >[!TIP]
    >**基底**の記憶域プールを選択すると、**物理ディスク**で使用可能な物理ディスクの一覧が表示されます。

3. **記憶域プール**、下には、**タスク**の一覧を選択し、**新しい記憶域プール**を選択します。 新しい記憶域プール ウィザードが開きます。

4. **開始する前に**] ページで、 **[次へ]** を選択します。

5. **記憶域プールの名前を指定してサブシステム**] ページで、名前と必要に応じて、記憶域プールの説明を入力を使用する物理ディスクが利用可能なグループを選択し、 **[次へ]** を選択します。

6. **記憶域プールの物理ディスクの選択**] ページで、次に、し、**次に**操作を行います。
    
    1. 記憶域プールに含める各物理ディスクの横にあるチェック ボックスを選択します。
    
    2. いずれかを指定する、または**割り当て**、下のホット予備として複数のディスクがドロップダウン矢印を選択して、**ホット予備**し、選択します。

7. **確認の選択**] ページで、設定が正しいし、[**作成**ことを確認します。

8. **結果の表示**] ページで、すべてのタスクが完了するとし、[**閉じる**] を選択することを確認します。
    
    >[!NOTE]
    >必要に応じて、次の手順に直接を引き続き**このウィザードを終了するときに、仮想ディスクの作成**] チェック ボックスを選択できます。

9. [**記憶域プール**には、新しい記憶域プールに表示されていることを確認します。

### 記憶域プールを作成するための Windows PowerShell のと同じコマンド

次の Windows PowerShell コマンドレットまたはコマンドレットは、前の手順と同じ機能を実行します。 表示される場合でもが複数の行は、ここにわたるワード ラップ制約を書式設定のために、単一行では、各コマンドレットを入力します。

次の例は、基底プールに物理ディスクが利用可能なを示します。

```PowerShell
Get-StoragePool -IsPrimordial $true | Get-PhysicalDisk | Where-Object CanPool -eq $True
```

次の例では、利用可能なすべてのディスクを使用する*StoragePool1*という名前の新しい記憶域プールを作成します。

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk –CanPool $True)
```

次の例では、 *StoragePool1*、使用可能なディスクの 4 つを使用する、新しい記憶域プールを作成します。

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk PhysicalDisk1, PhysicalDisk2, PhysicalDisk3, PhysicalDisk4)
```

次の例のコマンドレットのシーケンスは、記憶域プール*StoragePool1*にホット予備として利用可能な物理ディスク*PhysicalDisk5*を追加する方法を示します。

```PowerShell
$PDToAdd = Get-PhysicalDisk –FriendlyName PhysicalDisk5
Add-PhysicalDisk –StoragePoolFriendlyName StoragePool1 –PhysicalDisks $PDToAdd –Usage HotSpare
```

## 手順 2: 仮想ディスクを作成します。

次に、記憶域プールから 1 つまたは複数の仮想ディスクを作成する必要があります。 仮想ディスクを作成するときは、物理ディスク全体のデータのレイアウト方法を選択できます。 これは、信頼性とパフォーマンスの両方に影響します。 仮想または固定のプロビジョニングされたディスクを作成するかどうかを選択することもできます。

1. 仮想ディスクの新しいウィザードが開き、サーバー マネージャーで、**記憶域プール**ページでない場合 [**記憶域プール**、確認、目的の記憶域プールが選択されていることを確認します。

2. [**仮想ディスク**、**タスク**の一覧を選択し、**新しい仮想ディスク**を選択します。 仮想ディスクの新しいウィザードが開きます。

3. **開始する前に**] ページで、 **[次へ]** を選択します。

4. **記憶域プールの選択**] ページで、目的の記憶域プールを選択し、 **[次へ]** を選択します。

5. **仮想ディスクの名前を指定してください**] ページで、名前とオプションの説明を入力し、 **[次へ]** を選択します。

6. **記憶域のレイアウトを選択**] ページで、目的のレイアウトを選択し、 **[次へ]** を選択します。
    
    >[!NOTE]
    >十分な物理ディスクがないレイアウトを選択する場合は、 **[次へ]** を選択すると、エラー メッセージが表示されます。 レイアウトを使うと、ディスクの要件について詳しくは、参照[の前提条件](#prerequisites))。

7. 記憶域のレイアウトとして**ミラー**を選択したプールに 5 つまたは複数のディスクがある場合は、**回復性の設定の構成**] ページが表示されます。 次のオプションのいずれかを選択します。
    
      - **双方向ミラー**
      - **3 方向ミラー**

8. **プロビジョニングの種類を指定してください**] ページで、次のオプションのいずれかを選択し、 **[次へ]** を選択します。
    
      - **シン**
        
        シン プロビジョニングを使って、必要な場合に領域が割り当てられます。 これは、利用可能な記憶域の使用量を最適化します。 ただし、過剰な記憶域を割り当てることができますが、する必要がありますを注意深く監視するディスク領域の量が利用可能です。
    
      - **固定**
        
        固定のプロビジョニングでは、記憶域の容量は仮想ディスクの作成時に、すぐに割り当てます。 そのため、仮想ディスクのサイズと同じですが、記憶域プールからプロビジョニングの使用領域を固定します。
    
    >[!TIP]
    >記憶域スペース、同じ記憶域プールに両方の仮想および固定-プロビジョニングされた仮想ディスクを作成できます。 たとえば、データベースと関連するログ ファイルをホストするのに固定プロビジョニングの仮想ディスクをホストするのに仮想プロビジョニングされた仮想ディスクを使用することができます。

9. **仮想ディスクのサイズを指定してください**] ページで、次の操作を行います。
    
    前の手順でシン プロビジョニングを選択した場合、**仮想ディスクのサイズ**] ボックスに、仮想ディスクのサイズを入力し、ユニット (**MB**、 **GB**、または**TB**) を選択して、**次**を選択します。
    
    前の手順で固定プロビジョニングを選択した場合は、次のいずれかを選択します。
    
      - **サイズを指定します。**
        
        サイズを指定するには、**仮想ディスクのサイズ**] ボックスに値を入力し、単位 (**MB**、 **GB**、または**TB**) を選択します。
        
        単純な以外の記憶域のレイアウトを使用する場合、仮想ディスクは、指定したサイズよりも多くの空き領域を使用します。 ボリュームのサイズが記憶域プールの空き領域を超えている潜在的なエラーを回避するには、**可能であれば、指定されたサイズまで最大の仮想ディスクの作成**] チェック ボックスを選択できます。
    
      - **最大サイズ**
        
        記憶域プールの最大容量を使用する仮想ディスクを作成するには、このオプションを選択します。

10. **確認の選択**] ページで、設定が正しいし、[**作成**ことを確認します。

11. **結果の表示**] ページで、すべてのタスクが完了するとし、[**閉じる**] を選択することを確認します。
    
    >[!TIP]
    >既定では、**このウィザードを終了するときに、ボリュームの作成**] チェック ボックスを選択します。 次の手順に直接移動します。

### 仮想ディスクを作成するための Windows PowerShell のと同じコマンド

次の Windows PowerShell コマンドレットまたはコマンドレットは、前の手順と同じ機能を実行します。 表示される場合でもが複数の行は、ここにわたるワード ラップ制約を書式設定のために、単一行では、各コマンドレットを入力します。

次の例では、50 GB の仮想ディスクが*StoragePool1*という名前の記憶域プールに*VirtualDisk1*という名前を作成します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB)
```

次の例では、 *StoragePool1*という名前の記憶域プールに*VirtualDisk1*という名前のミラー化された仮想ディスクを作成します。 ディスクでは、記憶域プールの最大記憶域容量を使用します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –ResiliencySettingName Mirror –UseMaximumSize
```

次の例では、50 GB の仮想ディスクが記憶域プール*StoragePool1*という名前で*VirtualDisk1*という名前を作成します。 ディスクでは、シン プロビジョニング型を使用します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB) –ProvisioningType Thin
```

次の例では、 *StoragePool1*という名前の記憶域プールに*VirtualDisk1*という名前の仮想ディスクを作成します。 仮想ディスクは 3 方向ミラーリングを使用して、20 GB の固定サイズです。

>[!NOTE]
>操作するには、このコマンドレットの記憶域プールに少なくとも 5 つの物理ディスクが必要です。 (これは含まれませんが、ホット予備として割り当てられたすべてのディスク。)

```PowerShell
New-VirtualDisk -StoragePoolFriendlyName StoragePool1 -FriendlyName VirtualDisk1 -ResiliencySettingName Mirror -NumberOfDataCopies 3 -Size 20GB -ProvisioningType Fixed
```

## 手順 3: ボリュームを作成します。

次に、仮想ディスクからボリュームを作成する必要があります。 省略可能なドライブ文字またはフォルダーを割り当てるし、ファイル システムでボリュームをフォーマットすることができます。

1. 新しいボリューム ウィザードが開き、サーバー マネージャーで、[**仮想ディスク**、**記憶域プール**ページでない場合は、目的の仮想ディスクを右クリックし、し、**新しいボリューム**を選択します。
    
    新しいボリューム ウィザードが開きます。

2. **開始する前に**] ページで、 **[次へ]** を選択します。

3. **サーバーとディスクの選択**] ページで、次に、し、**次に**操作を実行します。
    
    1. **サーバー**の領域では、ボリュームをプロビジョニングするサーバーを選択します。
    
    2. **ディスク**領域では、ボリュームを作成する仮想ディスクを選択します。

4. **ボリュームのサイズを指定してください**] ページで、ボリュームのサイズを入力します (**MB**、 **GB**、または**TB**) 単位で指定し、 **[次へ]** を選択します。

5. **ドライブ文字またはフォルダーに割り当てる**] ページで、目的のオプションを構成し、 **[次へ]** を選択します。

6. **ファイル システムの設定の選択**] ページで、次に、し、**次に**操作を実行します。
    
    1. **ファイル システム**の一覧では、 **NTFS**または**ReFS**のいずれかを選択します。
    
    2. **アロケーション ユニット サイズ**の一覧では、設定の**既定**のままにするか、アロケーション ユニット サイズを設定します。
        
        >[!NOTE]
        >アロケーション ユニット サイズについて詳しくは、[既定の NTFS、FAT、exFAT のクラスター サイズ](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat)を参照してください。

    
    3. 必要に応じて、**ボリューム ラベル**] ボックスで、たとえば**HR データ**ボリューム ラベル名を入力します。

7. **確認の選択**] ページで、設定が正しいし、[**作成**ことを確認します。

8. **結果の表示**] ページで、すべてのタスクが完了するとし、[**閉じる**] を選択することを確認します。

9. ボリュームが作成されたこと、サーバー マネージャーで、ことを確認するには、**ボリューム**のページを選択します。 作成されたサーバーの下では、ボリュームは記載されています。 エクスプ ローラーで、ボリュームがあるかを確認することもできます。

### ボリュームを作成するための Windows PowerShell のと同じコマンド

次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 単一行のコマンドを入力します。

次の例*VirtualDisk1*の仮想ディスクのディスクを初期化、割り当てられているドライブのパーティションを作成し、既定の NTFS ファイル システムでボリュームします。

```PowerShell
Get-VirtualDisk –FriendlyName VirtualDisk1 | Get-Disk | Initialize-Disk –Passthru | New-Partition –AssignDriveLetter –UseMaximumSize | Format-Volume
```

## 追加情報

- [記憶域スペース](overview.md)
- [Windows PowerShell での記憶域コマンドレット](https://docs.microsoft.com/powershell/module/storage/index?view=win10-ps)
- [クラスター化された記憶域スペースを展開します。](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11))
- [記憶域スペースのよく寄せられる質問 (FAQ)](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx)
