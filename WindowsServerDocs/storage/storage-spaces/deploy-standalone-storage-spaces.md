---
title: スタンドアロン サーバーに記憶域スペースを展開する
description: スタンドアロンの Windows Server 2012 ベースのサーバーに記憶域スペースを展開する方法について説明します。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-spaces
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: f9b5d2b0d5acfcbde52131c29704e38d835d048e
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/31/2019
ms.locfileid: "66447551"
---
# <a name="deploy-storage-spaces-on-a-stand-alone-server"></a>スタンドアロン サーバーに記憶域スペースを展開する

>適用対象:Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、スタンドアロン サーバーに記憶域スペースを展開する方法について説明します。 クラスター化された記憶域スペースを作成する方法については、次を参照してください。 [Windows Server 2012 R2 上の記憶域スペース クラスター デプロイ](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>)します。

記憶域スペースを作成するには、まず 1 つまたは複数の記憶域プールを作成する必要があります。 記憶域プールは、物理ディスクのコレクションです。 記憶域プールでは、記憶域の集約、柔軟な容量拡張、および代理管理が可能です。

1 つの記憶域プールから 1 つまたは複数の仮想ディスクを作成できます。 このような仮想ディスクは*記憶域スペース*とも呼ばれます。 Windows オペレーティング システムからは、記憶域スペースはフォーマットされたボリュームを作成できる通常のディスクと見なされます。 ファイル サービスおよび記憶域サービスのユーザー インターフェイスを使用して仮想ディスクを作成する場合、回復性の種類 (シンプル、ミラー、またはパリティ)、プロビジョニングの種類 (仮想または固定)、およびサイズを構成できます。 Windows PowerShell を使用すると、列数、インタリーブ値、プール内の使用する物理ディスクなど、追加のパラメーターを設定できます。 これらの追加パラメーターについては、次を参照してください。 [New-virtualdisk](https://docs.microsoft.com/powershell/module/storage/new-virtualdisk?view=win10-ps)と[列の概要と記憶域スペースの決定を使用するいくつか?](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx%23what_are_columns_and_how_does_storage_spaces_decide_how_many_to_use)で記憶域スペースに関してよく寄せられる質問 (FAQ)。

>[!NOTE]
>Windows オペレーティング システムをホストするのに記憶域スペースを使用することはできません。

1 つの仮想ディスクから 1 つまたは複数のボリュームを作成できます。 ボリュームを作成する場合は、サイズ、ドライブ文字またはフォルダー、ファイル システム (NTFS ファイル システムまたは Resilient File System (ReFS))、アロケーション ユニット サイズ、およびオプションのボリューム ラベルを構成できます。

次の図は、記憶域スペースのワークフローを示します。

![記憶域スペースのワークフロー](media/deploy-standalone-storage-spaces/storage-spaces-workflow.png)

**図 1: 記憶域スペースのワークフロー**

>[!NOTE]
>このトピックでは、サンプル Windows PowerShell コマンドレットを紹介します。ここで説明する手順の一部はこのコマンドレットで自動化できます。 詳細については、次を参照してください。 [PowerShell](https://docs.microsoft.com/powershell/scripting/powershell-scripting?view=powershell-6)します。

## <a name="prerequisites"></a>前提条件

スタンドアロン Windows Server 2012−based サーバー上の記憶域スペースを使用するには、使用する物理ディスクが次の前提条件を満たしているを確認します。

> [!IMPORTANT]
> 参照してください、フェールオーバー クラスターで記憶域スペースを展開する方法について説明したい場合[Windows Server 2012 R2 上の記憶域スペース クラスター デプロイ](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>)します。 フェールオーバー クラスターの展開では、サポートされているディスク バスの種類、サポートされている回復性の種類、および必要な最小のディスク数など、さまざまな前提条件があります。

|エリア|要件|メモ|
|---|---|---|
|ディスク バスの種類|シリアル接続 SCSI (SAS)<br>-Serial Advanced Technology Attachment (SATA)<br>-iSCSI とファイバー チャネル コント ローラー。 |USB ドライブを使用することもできます。 ただし、サーバー環境で USB ドライブを使用するのに最適ではありません。<br>記憶域スペースは、それらの上に作成される仮想ディスクが、回復力のある (列の数に単純) 限り、iSCSI とファイバー チャネル (FC) コント ローラーでサポートされます。<br>|
|ディスク構成|-物理ディスクが 4 GB 以上にする必要があります。<br>空でフォーマットされていない、ディスクがある必要があります。 ボリュームは作成しないでください。||
|HBA に関する考慮事項|-RAID 機能をサポートしていません単純なホスト バス アダプター (Hba) がお勧めします<br>-無効になっているすべての RAID 機能を備えた Hba を非 RAID モードである必要があります場合 RAID 対応<br>-アダプターの物理ディスクのキャッシュのデータを抽象化または接続されているデバイスがわかりにくくなる必要がありますできません。 これには、接続されている JBOD (just-a-bunch-of-disks) デバイスが提供するエンクロージャー サービスも含まれます。 |記憶域スペースは、すべての RAID 機能を完全に無効にした場合にのみ、HBA と互換性があります。|
|JBOD エンクロージャ|-JBOD エンクロー ジャーはオプションです。<br>推奨に記憶域スペースを使用して、認定、Windows Server カタログに記載されているエンクロージャ<br>-JBOD エンクロージャを使用している場合、エンクロージャが完全に機能するために記憶域スペースをサポートする、記憶域ベンダーに確認します。<br>、JBOD エンクロージャがエンクロージャとスロットの識別をサポートしているかどうかを判断するには次の Windows PowerShell コマンドレットを実行します。<br><br>`Get-PhysicalDisk \| ? {$_.BusType –eq "SAS"} \| fc`<br><br>場合、 **EnclosureNumber**と**SlotNumber**フィールド値が含まれる、エンクロージャがこれらの機能をサポートしています。||

物理ディスク数とスタンドアロン サーバーの展開で望ましい回復性の種類について計画する場合は、次のガイドラインに従ってください。

|回復性の種類|ディスクの要件|用途|
|---|---|---|
|**シンプル**<br><br>-物理ディスク間でデータをストライプ化します。<br>-ディスク容量を最大化して、スループットが向上<br>、回復性が (ディスクの障害からは保護しません) なし<br><br><br><br><br><br><br>|少なくとも 1 つの物理ディスクが必要です。|置き換えることができないデータのホストには使用しないでください。 シンプル スペースは、ディスク障害から保護されません。<br><br>一時的なデータや簡単に作成し直すことができるデータを低コストでホストする場合に使用します。<br><br>回復性が必要でないか、アプリケーションによって既に提供されている高パフォーマンス ワークロードに適しています。|
|**ミラー**<br><br>-物理ディスクのセット間でデータの 2 つまたは 3 つのコピーを保存します。<br>-、信頼性を向上しますが、容量を削減します。 書き込みごとに重複が発生します。 また、ミラー スペースは、複数の物理ドライブ全体にデータをストライプ化します。<br>さらに高いデータのスループットとパリティより低いアクセスの待機時間<br>使用はダーティ DRT (region tracking)、プール内のディスクに対する変更を追跡します。 予期しないシャットダウンからシステムが再開され、スペースがオンラインに戻るとと、DRT によって、プール内のディスクの一貫性が相互に保たれます。|1 つのディスク障害が発生した場合に保護するには、少なくとも 2 つの物理ディスクが必要です。<br><br>2 つのディスクの障害が同時に発生した場合に保護するには、少なくとも 5 つの物理ディスクが必要です。|ほとんどの展開に使用できます。 たとえば、ミラー スペースは、汎用的なファイル共有や仮想ハード ディスク (VHD) ライブラリに適しています。|
|**パリティ**<br><br>-物理ディスク間でデータとパリティ情報をストライプ化します。<br>-シンプルなスペースと比較されますが、容量をある程度少なくなりますと信頼性が向上します。<br>-ジャーナリングによって回復性が向上します。 予期しないシャットダウンが発生した場合、ジャーナリングによってデータの破損を回避できます。|1 つのディスク障害が発生した場合に保護するには、少なくとも 3 つの物理ディスクが必要です。|アーカイブやバックアップなど、連続性が高いワークロードに使用します。|

## <a name="step-1-create-a-storage-pool"></a>手順 1:記憶域プールを作成する

まず使用可能な物理ディスクを 1 つまたは複数の記憶域プールにグループ化する必要があります。

1. サーバー マネージャーのナビゲーション ウィンドウで次のように選択します。 **File and Storage Services**します。

2. ナビゲーション ウィンドウで、選択、**記憶域プール**ページ。
    
    既定では、使用可能なディスクは *primordial* プールというプールに含まれています。 primordial プールが **[記憶域プール]** に表示されていない場合、記憶域が記憶域スペースの要件を満たしていないことを示します。 前提条件セクションで説明されている要件をディスクが満たしていることを確認してください。
    
    >[!TIP]
    >**[Primordial]** 記憶域プールを選択すると、使用可能な物理ディスクは **[物理ディスク]** に表示されます。

3. **記憶域プール**を選択、**タスク**、一覧表示し、**新しい記憶域プール**します。 新しい記憶域プール ウィザードが開きます。

4. **開始する前に**] ページで、[**次**します。

5. **サブシステムと記憶域プールの名前を指定**] ページで、記憶域プールのオプションの説明と名前を入力を使用し、[する使用可能な物理ディスクのグループを選択**次**します。

6. **物理ディスクを記憶域プールの選択** ページで、以下を実行して、選択**次**:
    
    1. 記憶域プールに含める各物理ディスクの横にあるチェック ボックスをオンにします。
    
    2. ホット スペアとして 1 つまたは複数のディスクを指定する場合**割り当て**のドロップダウン矢印を選択し、選択、**ホット スペア**します。

7. **オプションの確認** ページで、設定が正しいことを確認し、選択、**作成**です。

8. **結果を表示** ページで、すべてのタスクが完了した、選択であることを確認**閉じる**します。
    
    >[!NOTE]
    >必要に応じて、次の手順にそのまま進むには、 **[このウィザードを閉じるときに仮想ディスクを作成します]** チェック ボックスをオンにします。

9. **[記憶域プール]** に新しい記憶域プールが表示されることを確認します。

### <a name="windows-powershell-equivalent-commands-for-creating-storage-pools"></a>Windows PowerShell の記憶域プールを作成するための同等のコマンド

以下の Windows PowerShell コマンドレットは、前述の手順と同じ機能を実行します。 ここでは書式上の制約のために、折り返されて複数の行にわたって表示される場合もありますが、各コマンドレットは 1 行に入力します。

次の例は、primordial プールで使用可能な物理ディスクを示しています。

```PowerShell
Get-StoragePool -IsPrimordial $true | Get-PhysicalDisk | Where-Object CanPool -eq $True
```

次の例では、という名前の新しい記憶域プールを作成する*StoragePool1*使用可能なすべてのディスクを使用します。

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk –CanPool $True)
```

次の例では、新しい記憶域プール、 *StoragePool1*、使用可能なディスクの 4 つを使用します。

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk PhysicalDisk1, PhysicalDisk2, PhysicalDisk3, PhysicalDisk4)
```

次の一連のコマンドレット例は、ホット スペアとして使用可能な物理ディスク *PhysicalDisk5* を記憶域プール *StoragePool1* に追加する方法を示しています。

```PowerShell
$PDToAdd = Get-PhysicalDisk –FriendlyName PhysicalDisk5
Add-PhysicalDisk –StoragePoolFriendlyName StoragePool1 –PhysicalDisks $PDToAdd –Usage HotSpare
```

## <a name="step-2-create-a-virtual-disk"></a>手順 2:仮想ディスクを作成する

次に、この記憶域プールから 1 つまたは複数の仮想ディスクを作成する必要があります。 仮想ディスクを作成するときに、物理ディスクにデータを配置する方法を選択できます。 この選択は、信頼性とパフォーマンスの両方に影響があります。 また、仮想プロビジョニング ディスクと固定プロビジョニング ディスクのどちらを作成するかを選択できます。

1. 仮想ディスク ウィザードの新規作成がまだ開いていない場合は、サーバー マネージャーの **[記憶域プール]** ページの **[記憶域プール]** で、目的の記憶域プールが選択されていることを確認します。

2. **仮想ディスク**を選択、**タスク**、一覧表示し、**新しい仮想ディスク**します。 新しい仮想ディスク ウィザードが開きます。

3. **開始する前に**] ページで、[**次**します。

4. **記憶域プールを選択します。** ページで、目的の記憶域プールを選択し、選択**次**。

5. **仮想ディスク名を指定**ページで名前とオプションの説明を入力し、選択**次**します。

6. **記憶域のレイアウトを選択します。** ページで、目的のレイアウトを選択し、選択**次**。
    
    >[!NOTE]
    >選択するとエラー メッセージが表示するための十分な物理ディスクがないレイアウトを選択する場合は**次**します。 使用し、必要なディスク レイアウトの詳細については、次を参照してください。[の前提条件](#prerequisites))。

7. 選択した場合**ミラー** 、プールに 5 つ以上のディスクがある記憶域のレイアウトとすると、**回復性の設定を構成する**ページが表示されます。 次のいずれかのオプションを選びます。
    
      - **双方向ミラー**
      - **3 方向ミラー**

8. **プロビジョニングの種類を指定**ページで、次のオプションのいずれかを選択し、選択**次**します。
    
   - **仮想**
        
     仮想プロビジョニングの場合、必要に応じてスペースが割り当てられます。 使用可能な記憶域の使用状況が最適化されます。 ただし、記憶域を過度に割り当てることができるため、使用可能なディスク容量を注意して監視する必要があります。
    
   - **固定**
        
     固定プロビジョニングの場合、記憶域容量は、仮想ディスクを作成すると即時に割り当てられます。 そのため、固定プロビジョニングでは、仮想ディスク サイズと同じ記憶域プールのスペースを使用します。
    
     >[!TIP]
     >記憶域スペースでは、仮想プロビジョニングと固定プロビジョニングの仮想ディスクの両方を同じ記憶域プールに作成できます。 たとえば、仮想プロビジョニング仮想ディスクを使用してデータベースをホストし、固定プロビジョニング仮想ディスクを使用して関連するログ ファイルをホストすることができます。

9. **[仮想ディスクのサイズの指定]** ページで、次の手順を実行します。
    
    前の手順で仮想プロビジョニングを選択したかどうか、**仮想ディスクのサイズ**ボックスを仮想ディスクのサイズを入力し、単位を選択します (**MB**、 **GB**、または**TB**) を選択し、**次**します。
    
    前の手順で固定プロビジョニングを選択した場合は、次のいずれかを選択します。
    
      - **サイズの指定**
        
        サイズを指定する値を入力します。、**仮想ディスクのサイズ**の単位を選択し、(**MB**、 **GB**、または**TB**)。
        
        シンプル以外の記憶域のレイアウトを使用する場合、仮想ディスクは指定したサイズよりも多くの空き領域を使用します。 ボリュームのサイズが記憶域プールの空き領域を超えるエラーが発生する可能性を回避するには、 **[指定したサイズ以下で可能な限り最大の仮想ディスクを作成する]** チェック ボックスをオンにします。
    
      - **最大サイズ**
        
        記憶域プールの最大容量を使用する仮想ディスクを作成するには、このオプションを選択します。

10. **オプションの確認** ページで、設定が正しいことを確認し、選択、**作成**です。

11. **結果を表示** ページで、すべてのタスクが完了した、選択であることを確認**閉じる**します。
    
    >[!TIP]
    >既定で、 **[このウィザードを閉じるときにボリュームを作成します]** チェック ボックスはオンです。 [閉じる] をクリックして次の手順に進みます。

### <a name="windows-powershell-equivalent-commands-for-creating-virtual-disks"></a>仮想ディスクを作成するための同等のコマンドを Windows PowerShell

以下の Windows PowerShell コマンドレットは、前述の手順と同じ機能を実行します。 ここでは書式上の制約のために、折り返されて複数の行にわたって表示される場合もありますが、各コマンドレットは 1 行に入力します。

次の例では、という名前の 50 GB の仮想ディスクを作成する*VirtualDisk1*という名前の記憶域プールで*StoragePool1*します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB)
```

次の例では、という名前のミラー化された仮想ディスクを作成する*VirtualDisk1*という名前の記憶域プールで*StoragePool1*します。 ディスクは記憶域プールの最大ストレージ容量を使用します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –ResiliencySettingName Mirror –UseMaximumSize
```

次の例では、という名前の 50 GB の仮想ディスクを作成する*VirtualDisk1*という記憶域プールに*StoragePool1*します。 このディスクは、仮想プロビジョニングの種類を使用します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB) –ProvisioningType Thin
```

次の例では、という名前の仮想ディスクを作成する*VirtualDisk1*という名前の記憶域プールで*StoragePool1*します。 この仮想ディスクは 3 方向のミラーリングを使用し、20 GB の固定サイズです。

>[!NOTE]
>このコマンドレットを実行するには、記憶域プールに少なくとも 5 つの物理ディスクが必要です (ホット スペアとして割り当てられているディスクは含まれません)。

```PowerShell
New-VirtualDisk -StoragePoolFriendlyName StoragePool1 -FriendlyName VirtualDisk1 -ResiliencySettingName Mirror -NumberOfDataCopies 3 -Size 20GB -ProvisioningType Fixed
```

## <a name="step-3-create-a-volume"></a>手順 3:ボリュームを作成する

次に、仮想ディスクからボリュームを作成する必要があります。 省略可能なドライブ文字またはフォルダー、割り当ててから、ファイル システムでボリュームをフォーマットできます。

1. 新しいボリューム ウィザードがまだ開いていない場合、**記憶域プール**ページの サーバー マネージャーで、**仮想ディスク**目的の仮想ディスクを右クリックし、**新しいボリューム**.
    
    ボリュームの新規作成ウィザードが開きます。

2. **開始する前に**] ページで、[**次**します。

3. **サーバーとディスクの選択** ページで、以下を実行して、選択**次**します。
    
    1. **Server**領域で、ボリュームをプロビジョニングするサーバーを選択します。
    
    2. **ディスク**領域で、ボリュームを作成する仮想ディスクを選択します。

4. **ボリュームのサイズを指定**] ページで、単位を指定ボリュームのサイズを入力してください (**MB**、 **GB**、または**TB**)、し、[ **次**します。

5. **ドライブ文字またはフォルダーに割り当てる**ページで、目的のオプションを構成し、**次**します。

6. **ファイル システムの設定を選択します。**  ページで、以下を実行して、選択**次**。
    
    1. **ファイル システム**一覧で、いずれかを選択**NTFS**または**ReFS**します。
    
    2. **[アロケーション ユニット サイズ]** リストで、 **[既定]** の設定のままにするか、アロケーション ユニット サイズを設定します。
        
        >[!NOTE]
        >アロケーション ユニット サイズの詳細については、次を参照してください。 [NTFS、FAT、および exFAT のデフォルトのクラスター サイズ](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat)します。

    
    3. 必要に応じて、 **[ボリューム ラベル]** ボックスにボリューム ラベル名を入力します (たとえば、「**HR Data**」)。

7. **オプションの確認** ページで、設定が正しいことを確認し、選択、**作成**です。

8. **結果を表示** ページで、すべてのタスクが完了した、選択であることを確認**閉じる**します。

9. ボリュームが作成されたこと、サーバー マネージャーで、確認するには、選択、**ボリューム**ページ。 作成したサーバーの下にボリュームが表示されます。 また、エクスプローラーでボリュームを確認することもできます。

### <a name="windows-powershell-equivalent-commands-for-creating-volumes"></a>ボリュームを作成するための同等のコマンドを Windows PowerShell

次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 コマンドは 1 行で入力してください。

次の例は、仮想ディスク *VirtualDisk1* のディスクを初期化し、ドライブ文字を割り当てたパーティションを作成し、既定の NTFS ファイル システムを使用してボリュームをフォーマットします。

```PowerShell
Get-VirtualDisk –FriendlyName VirtualDisk1 | Get-Disk | Initialize-Disk –Passthru | New-Partition –AssignDriveLetter –UseMaximumSize | Format-Volume
```

## <a name="additional-information"></a>追加情報

- [記憶域スペース](overview.md)
- [Windows PowerShell の記憶域コマンドレット](https://docs.microsoft.com/powershell/module/storage/index?view=win10-ps)
- [クラスター化された記憶域スペースを展開します。](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11))
- [Storage Spaces Frequently Asked Questions (FAQ)](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx)
