---
title: ハイパーコンバージド インフラストラクチャの障害回復シナリオ
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: この記事で Microsoft HCI (記憶域スペース ダイレクト) の障害復旧用現在利用可能なシナリオについて説明します。
ms.localizationpriority: medium
ms.openlocfilehash: 32bbf02ca78d5c6a2147162768c984d0e0b27e36
ms.sourcegitcommit: dfd25348ea3587e09ea8c2224237a3e8078422ae
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/16/2018
ms.locfileid: "4678611"
---
# 記憶域スペース ダイレクトの障害回復

> 適用対象: Windows Server 2019、Windows Server 2016

このトピックでは、障害復旧用に構成する方法、ハイパーコンバージド インフラストラクチャ (HCI) のシナリオを提供します。

多くの企業は、ハイパーコンバージド ソリューションを実行しているしに残るなどに戻って実稼働迅速に障害が発生した場合は、障害の計画します。 障害復旧用 HCI を構成するいくつかの方法し、このドキュメントでは今日で提供するオプションを説明します。

障害が発生した場合は、使用可能状況を復元のディスカッションの中心回復時刻の目標 (RTO) と呼ばれるものです。 これは、期間の対象のビジネスに許容結果を回避するためにサービスを復元する必要があります。 場合によっては、このプロセスにほぼ即時に復元運用環境で自動的に発生します。 状況によっては、管理者による手動による介入がサービスを復元する発生する必要があります。

ハイパーコンバージド障害回復のオプションは今日は。

1. 複数のクラスターの記憶域レプリカの使用
2. クラスター間での HYPER-V レプリカ
3. バックアップと復元

## 複数のクラスターの記憶域レプリカの使用

[記憶域レプリカ](../storage-replica/storage-replica-overview.md)では、ボリュームのレプリケーションにより、同期および非同期レプリケーションをサポートしています。 同期または非同期レプリケーションを使うかを選択するときは、回復ポイントの目標 (RPO) を検討してください。 回復ポイントの目標は、主要な損失と見なされる前に発生するデータの損失です。 同期レプリケーションを使う場合、順番に書き込まれます両端を同時に。 使う場合に非同期、書き込みは非常に高速にレプリケートされますが、失われた可能性があります。 最適に機能するかを確認すると、アプリケーションまたはファイルの使用方法を検討する必要があります。

記憶域レプリカはファイルのレベルとブロック レベルのコピー メカニズムです。つまり、必要はありませんレプリケートするデータの種類。 これにより、ハイパーコンバージド インフラストラクチャの人気のあるオプション。 記憶域レプリカもさまざまな種類のので HCI の 1 つで、すべて 1 つの種類の記憶域のレプリケーション パートナー間でドライブを利用でき、他の別の種類の記憶域が適切に機能します。 

記憶域レプリカの重要な機能の 1 つは、オンプレミスと Azure で実行できます。 オンプレミス、Azure に Azure をオンプレミスまたはもオンプレミス Azure (またはその逆) を設定することができます。

このシナリオでは、2 つの個別の独立したクラスターがあります。 HCI 間の記憶域レプリカを構成するには、[クラスター間の記憶域のレプリケーション](../storage-replica/cluster-to-cluster-storage-replication.md)の手順に従うことができます。

![記憶域のレプリケーションの図](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure1.png)

次の考慮事項は、記憶域レプリカを展開するときに適用されます。 

1.  レプリケーションを構成すると、フェールオーバー クラスタ リングの外部行われます。 
2.  レプリケーションの方法の選択は、ネットワーク待機時間と RPO 要件に依存してされます。 同期は、整合性を防ぐためにデータが失われる障害が発生した時点で待機時間が短いネットワーク上のデータをレプリケートします。 非同期レプリケート待機時間の長いが各サイトにネットワーク経由でデータがない同一のコピー障害発生時にします。 
3.  災害が発生した場合は、フェールオーバー クラスター間は、自動ではなく、記憶域レプリカの PowerShell コマンドレットを手動で調整する必要があります。 上の図に ClusterA はプライマリ、ClusterB はセカンダリです。 ClusterA がダウンした場合、リソースの起動前に、プライマリ ClusterB を手動で設定する必要があります。 ClusterA がもう一度上げると、セカンダリようにする必要があります。 すべてのデータを同期されている、変更を加えるし、ロールを最初に設定した方法をスワップします。
4.  記憶域レプリカは、データをレプリケートするのみがため、新しい仮想マシンまたはスケール アウト ファイル サーバー (SOFS) このデータを利用することは必要レプリカ パートナーにフェールオーバー クラスター マネージャーの内部を作成します。

仮想マシンまたはクラスターで実行されている、SOFS がある場合、記憶域レプリカを使用できます。 手動または自動 PowerShell スクリプトを使用して、レプリカ HCI でリソースをオンラインの移行にすることができます。

## Hyper-V レプリカ

[HYPER-V レプリカ](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica)では、ハイパーコンバージド インフラストラクチャを障害復旧用の仮想マシン レベルのレプリケーションを提供します。 HYPER-V レプリカが実行できる機能は、仮想マシンを実行し、セカンダリ サイトまたは Azure (レプリカ) をレプリケートします。 セカンダリのサイトから HYPER-V レプリカに複製仮想マシン サード (拡張レプリカ) できます。

![HYPER-V のレプリケーションの図](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure2.png)

HYPER-V レプリカ、レプリケーションは行われますの HYPER-V によってします。 最初のレプリケーション用の仮想マシンを有効にする場合は、対応するレプリカ クラスターに送信する最初のコピーする方法の 3 つの選択肢があります。

1.  ネットワーク経由での最初のコピーを送信します。
2.  外部メディアに最初のコピーを送信できるように、手動で、サーバー上にコピーできます。
3.  既にレプリカ ホストで作成された既存の仮想マシンを使用します。

この初期レプリケーションを行う場合、その他のオプションです。

1.  レプリケーションをすぐに開始します。
2.  初期レプリケーションが行われる時期の時刻をスケジュールします。 

他の考慮事項が必要になります。

- どのような VHD/VHDX のレプリケーションにします。 それらのすべてまたは 1 つだけをレプリケートすることができます。
- 保存する回復ポイントの数。 どの時点で復元するに関するいくつかのオプションを用意する場合は、しする数を指定します。 1 つの復元ポイントのみする場合も選択することができます。
- どのくらいの頻度にボリューム シャドウ コピー サービス (VSS) が段階的なシャドウ コピーをレプリケートします。
- どのくらいの頻度の変更を取得する (30 秒、5 分、15 分) をレプリケートします。

HCI 参加と HYPER-V レプリカで、各クラスターで作成された[HYPER-V レプリカ ブローカー](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/)リソースが必要です。 このリソースには、いくつかの処理が行われます。

1.  により、単一の名前空間の HYPER-V レプリカに接続するためには、各クラスター。
2.  レプリカ (または拡張レプリカ) に存在するが、最初のコピーを受け取った場合、クラスター内でノードが決まります。
3.  には、仮想マシンが別のノードに移動した場合に属しているレプリカ (または拡張レプリカ) のノードを追跡します。 レプリケーションが行わことは適切なノードに情報を送信できるように、この情報を追跡する必要があります。

## バックアップと復元

非常に多くの作業を話しはありませんと同様に重要では 1 つの従来の障害回復オプションは、クラスター全体またはクラスター内のノードのエラーです。 このシナリオでは、いずれかのオプションは、Windows NT バックアップを使用します。 

ハイパーコンバージド インフラストラクチャのバックアップを定期的な推奨事項では常にします。 クラスター サービスを実行すると、システム状態バックアップを実行する場合は中、クラスター レジストリ データベースは、バックアップの一部になります。 クラスターまたはデータベースを復元するには、2 つの異なる方法 (非信頼と権限のある) があります。

### 権限のないです。

権限のない復元では、Windows NT バックアップを使用して実現でき、クラスター ノードだけを完全に復元に相当します。 のみクラスター ノード (およびクラスター レジストリ データベース) を復元する必要がある場合は、現在クラスター情報をすべて適切な権限を使用して復元とします。 Windows NT バックアップ インターフェイスまたはコマンド ライン WBADMIN を通じて、権限のない復元を実行できます。EXE します。

ノードを復元した後、クラスターに参加させることができます。 何が起こることです。 は既存の実行中のクラスターには、現在ですべての情報を更新します。

### 権限のあります。

クラスターの構成の復元には、クラスターの構成時にその一方で、かかります。 クラスター情報自体が失われ、復元が必要なとき、この種類の復元を実現のみする必要があります。 たとえば、1000 以上の共有が含まれているファイル サーバーが誤って削除された、戻る必要です。 クラスターの復元を完了するには、コマンドラインからバックアップを実行する必要があります。

クラスター ノードの権限の復元が開始されると、クラスター ビューでその他のすべてのノード上でクラスター サービスが停止し、クラスター構成が固定されています。 これは、その復元が実行されたノードのクラスター サービスが、新しいクラスター構成のコピーを使用して、クラスターが形成されるために、最初に開始する重要な理由です。

権限の復元を実行するには、次の手順を実行できます。

1.  WBADMIN を実行します。インストールし、システムの状態が、コンポーネントの 1 つあることを確認するバックアップの最新バージョンを取得する管理者のコマンド プロンプトから EXE 戻すことができます。

    ```powershell
    Wbadmin get versions
    ```

2.  かどうかがあるバージョン バックアップにクラスター レジストリ情報がコンポーネントとしてを決定します。 このコマンドは、バージョンおよび手順 3 で使用するアプリケーション/コンポーネントから必要があります、いくつかの項目がします。 バージョンについては、たとえば、バックアップでは、午前 2時 04分、2018 年 1 月 3 日が行ったし、これは、復元する必要がありますか。

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  回復する必要があるクラスター レジストリ バージョンのみ復元を開始します。 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

復元が行われると、このノードがクラスター サービスを最初に起動して、クラスターを形成する 1 つあります。 他のすべてのノードし開始して、クラスターに参加する必要があります。

## 要約 

これをすべてを合計、ハイパーコンバージド障害回復を慎重に計画する必要があります。 お客様のニーズに最適なことを十分にテストする必要がありますいくつかのシナリオがあります。 点に注意して 1 つの項目は、慣れて場合フェールオーバー クラスターで過去に、ストレッチ クラスターされている、年間にわたって非常に一般的なオプションです。 ハイパーコンバージド ソリューションの設計変更のビットがあったし、回復性に基づいています。 ハイパーコンバージド クラスター内の 2 つのノードを紛失した場合は、クラスター全体が開始されます。 このされている場合、ハイパーコンバージドの環境でストレッチのシナリオがサポートされていません。


