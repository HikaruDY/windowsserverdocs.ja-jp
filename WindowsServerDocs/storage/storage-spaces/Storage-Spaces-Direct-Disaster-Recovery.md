---
title: ハイパー コンバージド インフラストラクチャのディザスター リカバリーのシナリオ
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: この記事は、現時点 (記憶域スペース ダイレクト) の Microsoft HCI のディザスター リカバリーのシナリオを説明します
ms.localizationpriority: medium
ms.openlocfilehash: c844c56c3a1717658bcdb970e78d45b5cdda861c
ms.sourcegitcommit: 48bb3e5c179dc520fa879b16c9afe09e07c87629
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/31/2019
ms.locfileid: "66453124"
---
# <a name="disaster-recovery-with-storage-spaces-direct"></a>記憶域スペース ダイレクトでのディザスター リカバリー

> 適用対象:Windows Server 2019、Windows Server 2016

このトピックでは、ディザスター リカバリーのためにどのハイパー コンバージド インフラストラクチャ (HCI) シナリオを構成できます。

多数の企業は、ハイパーコンバージド ソリューションを実行しているし、災害の計画中か、戻るを運用環境に迅速に障害が発生した場合に機能を提供します。 ディザスター リカバリー HCI を構成するいくつかの方法し、このドキュメントが現在に利用できるオプションについて説明します。

ときに障害が発生した場合は、可用性を復元するディスカッションを中心に展開復旧時間目標 (RTO) として知られています。 これは、ビジネスに許容できない影響を回避するためにサービスを復元する必要がありますを対象となる時間です。 場合によってでこのプロセスはできるほぼすぐに復元された運用環境で自動的に発生します。 それ以外の場合、サービスを復元する管理者による手動の介入があります。

ハイパー コンバージドと障害復旧のオプションは、今日は。

1. 複数のクラスターの記憶域レプリカを利用します。
2. クラスター間で HYPER-V レプリカ
3. バックアップと復元

## <a name="multiple-clusters-utilizing-storage-replica"></a>複数のクラスターの記憶域レプリカを利用します。

[記憶域レプリカ](../storage-replica/storage-replica-overview.md)ボリュームのレプリケーションを有効にして、同期および非同期のレプリケーションをサポートしています。 同期または非同期のレプリケーションを使用するかを選択するときは、回復ポイント目標 (RPO) を検討してください。 回復ポイントの目標は、主要な損失と見なされる前に発生してもよい考えられるデータ損失の量です。 同期レプリケーションを使用する場合、順番に両方の end に書き込むことと同時がされます。 使用する場合非同期、書き込みは非常に高速にレプリケートされますが、失われる可能性があります。 最適にする動作を確認するアプリケーションまたはファイルの使用状況を考慮する必要があります。

記憶域レプリカはファイルのレベルとブロック レベルのコピー メカニズムです。つまり、関係ありませんレプリケートされているデータの種類。 これにより、ハイパー コンバージド インフラストラクチャの人気の高いオプション。 記憶域レプリカもので HCI の 1 つで、すべて 1 つの型の記憶域のレプリケーション パートナー間でドライブの別の種類を利用できるし、他の別の型ストレージはまったく問題ありません。 

記憶域レプリカの 1 つの重要な機能は、Azure とオンプレミスで実行できることです。 オンプレミス、Azure から Azure にオンプレミスまたはでも、オンプレミスを Azure に (またはその逆) を設定することができます。

このシナリオでは、2 つの個別の独立クラスターを使用します。 HCI の間の記憶域レプリカを構成するための手順を利用できる[クラスター-クラスター記憶域レプリケーション](../storage-replica/cluster-to-cluster-storage-replication.md)します。

![ストレージ レプリケーションのダイアグラム](media/storage-spaces-direct-disaster-recovery/Disaster-Recovery-Figure1.png)

記憶域レプリカをデプロイするときに、次の考慮事項が適用されます。 

1.  レプリケーションの構成はフェールオーバー クラスタ リングの外部で行われます。 
2.  レプリケーションの方法の選択は、ネットワーク待機時間と RPO の要件に依存してになります。 同期は、エラー発生時にデータの損失を生じないようにするためのクラッシュ整合性と待機時間の短いネットワーク上のデータをレプリケートします。 非同期レプリケートしますが、待機時間が増加、各サイトでネットワーク経由でデータがない同一のコピーをエラー発生時にします。 
3.  災害の場合、クラスター間でのフェールオーバーは自動であり、記憶域レプリカの PowerShell コマンドレットを手動で調整する必要があります。 上記の図で ClusterA はプライマリ、ClusterB はセカンダリです。 ClusterA がダウンした場合は、リソースの起動前にプライマリとして ClusterB を手動で設定する必要があります。 ClusterA がバックアップすると、セカンダリようにする必要があります。 すべてのデータが同期されているとは、変更、ロールを最初に設定した方法をスワップします。
4.  記憶域レプリカはデータをレプリケートするだけであるために、新しいバーチャル マシンまたはスケール アウト ファイル サーバー (SOFS) このデータを利用するは、フェールオーバー クラスター マネージャー内のレプリカ パートナー上でも作成する必要がありますは。

仮想マシンまたは SOFS クラスターで実行した場合、記憶域レプリカを使用できます。 レプリカ HCI のリソースをオンラインを取り込むと、手動または PowerShell スクリプトを使用して自動を指定できます。

## <a name="hyper-v-replica"></a>Hyper-V レプリカ

[HYPER-V レプリカ](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica)ハイパー コンバージド インフラストラクチャでのディザスター リカバリーのための仮想マシン レベルのレプリケーションを提供します。 HYPER-V レプリカで実行できますが、仮想マシンを (レプリカ) を Azure またはセカンダリ サイトにレプリケートします。 セカンダリ サイトから、HYPER-V レプリカにレプリケートできます仮想マシン 3 つ目の (拡張レプリカ)。

![HYPER-V レプリケーションのダイアグラム](media/storage-spaces-direct-disaster-recovery/Disaster-Recovery-Figure2.png)

HYPER-V レプリカに、レプリケーションは隠メ諶 HYPER-V。 最初に仮想マシンのレプリケーションを有効にすると、対応するレプリカ クラスターに送信される初期コピーする方法の 3 つの選択肢があります。

1.  初期コピーをネットワーク経由で送信します。
2.  外部メディアに初期コピーを送信できるように、手動でサーバーにコピーできます。
3.  レプリカのホストに既に作成されて既存の仮想マシンの使用します。

この初期レプリケーションを行う場合、その他のオプションです。

1.  レプリケーションをすぐに開始します。
2.  初期レプリケーションが行われる時期に時間をスケジュールします。 

必要になるその他の考慮事項は次のとおりです。

- どのような VHD または VHDX のレプリケートします。 それらのすべてまたは 1 つだけをレプリケートすることができます。
- 保存する回復ポイントの数。 いくつかのオプションについて、どの時点で復元する場合は、したいとする数を指定します。 1 つの復元ポイントが欲しい場合も選択ができます。
- どのくらいの頻度が必要なボリューム シャドウ コピー サービス (VSS) が増分のシャドウ コピーを複製します。
- どのくらいの頻度の変更の取得 (30 秒、5 分、15 分) をレプリケートします。

あります HCI は、HYPER-V レプリカの参加、ときに、 [、HYPER-V レプリカ ブローカー](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/)各クラスターで作成されたリソース。 このリソースはいくつかの処理を行います。

1.  使用する単一の名前空間に接続するため、HYPER-V レプリカのクラスターごとにできます。
2.  レプリカ (または拡張レプリカ) に存在する最初のコピーを受け取ると、そのクラスター内でノードが決まります。
3.  仮想マシンが別のノードに移動する場合に備えて、属しているレプリカ (または拡張レプリカ) のノードがの追跡。 レプリケーションの実行時情報を適切なノードに送信できるように、これを追跡するために必要です。

## <a name="backup-and-restore"></a>バックアップと復元

1 つの従来のディザスター リカバリー オプションについてあまり説明はありませんが、同様に重要ですが、クラスター全体またはクラスター内のノードの障害。 このシナリオのいずれかのオプションは、Windows NT バックアップを使用します。 

ハイパー コンバージド インフラストラクチャの定期的なバックアップを作成するという推奨設定では常にします。 クラスター サービスを実行すると、システム状態バックアップを行う場合は、中に、クラスター レジストリ データベースがそのバックアップの一部になります。 クラスターまたはデータベースを復元するには、2 つの異なる方法 (非信頼と権限のある) があります。

### <a name="non-authoritative"></a>権限のないです。

非 Authoritative restore は、Windows NT バックアップを使用して実現でき、クラスター ノードだけの完全な復元と同じです。 クラスター ノード (およびクラスター レジストリ データベース) を復元するだけの場合と、すべて現在クラスター情報適切な権限のないを使用して復元は。 Windows NT バックアップ インターフェイスまたは WBADMIN コマンド ラインでは、権限のない復元を実行できます。実行可能ファイルです。

ノードを復元した後は、クラスターに参加させます。 既存の実行中のクラスターにアクセスし、すべての情報は、現在の更新が発生します。

### <a name="authoritative"></a>権限を持つ

クラスターの構成の Authoritative restore をでは、クラスターの構成にその一方で、かかります。 クラスター情報自体を失われ、復元が必要なときに、この種類の復元を実現だけする必要があります。 たとえば、1000 以上の共有が含まれているファイル サーバーが誤って削除されたと戻る必要です。 クラスターの Authoritative restore を完了するには、コマンドラインからのバックアップを実行することが必要です。

クラスター ノードで権限のある復元が開始されると、クラスター ビューで他のすべてのノードで、クラスター サービスを停止し、クラスター構成が固定されています。 これは、復元が実行されたノードのクラスター サービスが、クラスター構成の新しいコピーを使用して、クラスターを形成するために、最初に開始する重要な理由です。

で、authoritative restore を実行するには、次の手順を実行できます。

1.  WBADMIN を実行します。インストールし、システム状態コンポーネントの 1 つあることを確認したいバックアップの最新バージョンを取得する管理コマンド プロンプトから実行可能ファイルを復元できます。

    ```powershell
    Wbadmin get versions
    ```

2.  かどうかがあるバージョンのバックアップは、クラスター レジストリ情報がコンポーネントとしてを決定します。 このコマンドは、バージョンおよび手順 3. で使用するためのアプリケーション/コンポーネントから必要があります、いくつかの項目があります。 バージョンについては、たとえば、バックアップで 2018 年 1 月 3 日午前 2時 04分を行ったし、これは、復元する必要がありますか。

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  必要なクラスター レジストリ バージョンのみを回復する権限のある復元を開始します。 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

復元が行われると、一度このノードはまずクラスター サービスを開始し、クラスターを形成する 1 つである必要があります。 他のすべてのノード、開始して、クラスターに参加する必要があります。

## <a name="summary"></a>概要 

これをすべて合計、ハイパー コンバージドのディザスター リカバリーを慎重に計画する必要があります。 いくつかのシナリオのニーズに最適なことができますを徹底的にテストする必要があります。 注意する 1 つの項目は、過去のフェールオーバー クラスターと経験が場合、ストレッチ クラスターされている、長年にわたって非常に人気の高いオプションです。 少し、ハイパーコンバージド ソリューションの設計の変更があったし、回復性に基づきます。 ハイパー コンバージド クラスター内の 2 つのノードを紛失した場合、クラスター全体をダウンします。 このされている場合は、ハイパー コンバージドの両方の環境での stretch のシナリオがサポートされていません。


