---
title: よく寄せられる質問 (FAQ) の記憶域の移行サービス
description: 別の 1 つのサーバーから移行する場合、どのようなファイルが転送から除外するなどの記憶域の移行サービスについてよく寄せられる質問。
author: nedpyle
ms.author: nedpyle
manager: siroy
ms.date: 06/04/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: 8f0f16f14ccf9099af8ff8bb8b27209c75c87cfc
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/20/2019
ms.locfileid: "67284465"
---
# <a name="storage-migration-service-frequently-asked-questions-faq"></a>よく寄せられる質問 (FAQ) の記憶域の移行サービス

このトピックを使用してに関するよく寄せられる質問 (Faq) への回答を含む[記憶域の移行サービス](overview.md)サーバーを移行します。

## <a name="excluded-files"></a> どのようなファイルとフォルダーは、転送から除外されますか。

記憶域の移行サービスには、Windows オペレーションに干渉する可能性がわかっているファイルやフォルダーを転送しません。 具体的には、ここでは、どのようなしません転送 PreExistingData フォルダーに、先に移動します。

- Windows では、プログラム ファイル、Program Files (x86)、Program Data, ユーザー
- $Recycle.bin、recycler、Recycled、システム ボリューム情報、$UpgDrv$、$SysReset、$Windows ~ $Windows。 bt によって ~ %.ls、Windows.old、ブート、回復、Documents and Settings。
- pagefile.sys, hiberfil.sys, swapfile.sys, winpepge.sys, config.sys, bootsect.bak, bootmgr, bootnxt
- ファイルやフォルダーと競合する移行元サーバーで、変換先のフォルダーを除外します。 <br>たとえば、N:\Windows フォルダーがソースであるし、C:\ にマップされます。ボリューム、先に転送されませんの取得-含まれるものに関係なく — ため先に C:\Windows システム フォルダーに影響すること。

## <a name="domain-migration"></a> ドメインの移行がサポートされますか。

記憶域の移行サービスは、Active Directory ドメイン間の移行を許可されません。 常にサーバー間の移行は、移行先サーバーに同じドメインに参加します。 Active Directory フォレスト内の別のドメインからの移行の資格情報を使用できます。 記憶域の移行サービスは、ワークグループ間の移行はサポートします。  

## <a name="cluster-support"></a> クラスターは、ソースまたは変換先としてサポートされますか。

現時点で記憶域の移行サービスは Windows Server 2019 のクラスター間で移行します。 記憶域の移行サービスの今後のリリースのクラスター サポートを追加する予定です。

## <a name="local-principals"></a> ローカル グループとローカル ユーザーを移行しますか。

現在は記憶域の移行サービスを移行するは、ローカルのユーザーまたは Windows Server 2019 内のローカル グループ。 ローカル ユーザーとローカル グループの移行は、記憶域の移行サービスの今後のリリースでサポートを追加する予定です。

## <a name="domain-controller"></a> ドメイン コント ローラーへの移行がサポートされますか。

記憶域の移行サービスでは、Windows Server 2019 のドメイン コント ローラーが移行現在しません。 この問題を回避するを Active Directory ドメインでは、複数のドメイン コント ローラーがある限り、降格する前に、ドメイン コント ローラー カット オーバーの完了後、変換先を昇格し、移行します。 記憶域の移行サービスの今後のリリースでドメイン コント ローラーの移行のサポートを追加する予定です。

## <a name="share-attributes"></a> 記憶域の移行サービスでは、どのような属性を移行しますか。

記憶域の移行サービスは、すべてのフラグ、設定、およびセキュリティの SMB 共有を移行します。 記憶域の移行サービスに移行するフラグの一覧は次のとおりです。

    - 共有状態
    - 可用性の種類
    - 共有の種類
    - フォルダーの列挙モード*とも呼ばれるアクセス ベースの列挙 (ABE)*
    - キャッシュ モード
    - リースのモード
    - Smb インスタンス
    - CA のタイムアウト
    - 同時ユーザー数の制限
    - 継続的に使用できます。
    - 説明           
    - データを暗号化します。
    - Identity のリモート処理
    - インフラストラクチャ
    - 名前
    - パス
    - スコープ
    - スコープ名
    - セキュリティ記述子
    - シャドウ コピー
    - 特別です
    - 一時

## <a name="move-db"></a> 記憶域の移行サービス データベースを移動することができますか。

記憶域の移行サービスでは、既定で非表示の c:\programdata\microsoft\storagemigrationservice フォルダーにインストールされている拡張可能なストレージ エンジン (ESE) データベースを使用します。 ジョブが追加され、転送が完了し、移行後に大幅なドライブの領域を消費する、このデータベースは拡張が数百万のファイルの場合、ジョブを削除しないでください。 データベースを移動する場合は、次の手順に従います。

1. Orchestrator コンピューターの「記憶域の移行サービス」サービスを停止します。
2. 所有権を取得、`%programdata%/Microsoft/StorageMigrationService`フォルダー
3. 完全に制御を共有するユーザー アカウントとすべてのファイルとサブフォルダーを追加します。
4. Orchestrator コンピューターのフォルダーを別のドライブに移動します。
5. 次のレジストリの REG_SZ 値を設定します。

    HKEY_Local_Machine\Software\Microsoft\SMS DatabasePath =*別のボリュームに新しいデータベース フォルダーのパスを*します。 
6. システムがすべてのファイルとフォルダーのサブフォルダーへのフル コントロールを持っていることを確認します。
7. 自分のアカウントのアクセス許可を削除します。
8. 「記憶域の移行サービス」サービスを開始します。

## <a name="non-windows"></a> Windows Server 以外のソースから移行できますか。

Windows Server 2019 に付属して記憶域の移行サービスのバージョンでは、Windows Server 2003 以降のオペレーティング システムからの移行をサポートします。 現在、Linux、Samba、NetApp、EMC、またはその他の SAN および NAS ストレージ デバイスから移行できません。 記憶域の移行サービス, Linux Samba サポート開始の将来のバージョンでこれを可能にする予定です。

## <a name="previous-versions"></a> 以前のバージョンのファイルを移行できますか。

Windows Server 2019 の付属ストレージ移行サービスのバージョンでは、移行する以前のバージョンで作成されたボリュームのシャドウ コピー サービス) のファイルをサポートしていません。 現在のバージョンのみが移行されます。 

## <a name="ntfs-refs"></a> REFS を NTFS から移行できますか。

Windows Server 2019 の付属ストレージ移行サービスのバージョンでは、NTFS から REFS ファイル システムへの移行をサポートしていません。 NTFS から NTFS および ReFS を REFS に移行することができます。 これは、機能、メタデータ、および NTFS から ReFS が重複していない他の側面では、多くの違いのための仕様です。 ReFS では、アプリケーションのワークロード ファイル システム、一般的なファイル システムではありません。 詳細については、次を参照してください[Resilient File System (ReFS) の概要。](../refs/refs-overview.md)

## <a name="consolidate-servers"></a> 1 つのサーバーに複数のサーバーを統合できますか。

Windows Server 2019 の付属ストレージ移行サービスのバージョンでは、1 つのサーバーに複数のサーバーの統合をサポートしていません。 -同じ共有名があります。 次の 3 つの別のソース サーバーの統合の例を移行すると、ローカル ファイル パス - これらのパスと、重複または競合の発生を防ぐための共有を仮想化を 1 つの新しいサーバーに 3 つすべてに回答しました前のサーバー名と IP アドレス。 記憶域の移行サービスの今後のバージョンでこの機能を追加する可能性があります。  

## <a name="optimize"></a> インベントリと転送のパフォーマンスを最適化します。

記憶域の移行サービスには、マルチ スレッドの読み書きを高速の両方を指定できるだけでなく、完全なデータ忠実性は多くのファイル コピー ツールで不足しているに沿って表示できるように設計された記憶域の移行サービスのプロキシ サービスと呼ばれるコピー エンジンが含まれています。 既定の構成は、多くのお客様に最適なされますは、インベントリおよび転送中に SMS のパフォーマンスを向上させる方法があります。

- **対象のオペレーティング システムの Windows Server 2019 を使用します。** Windows Server 2019 には、記憶域の移行サービスのプロキシ サービスが含まれています。 この機能をインストール先の Windows Server 2019 に移行すると、すべての転送は、ソースとターゲットの間の直接視野として動作します。 このサービスは転送中に、orchestrator で実行セットアップ先のコンピューターは大幅に遅くなりますが、Windows Server 2012 R2 または Windows Server 2016 では、転送、ダブルホップ場合。 Windows Server 2012 R2 または Windows Server 2016 の変換先で実行されている複数のジョブがある場合は、オーケストレーターがボトルネックになります。 

- **既定の転送のスレッドを変更します。** 記憶域の移行サービスのプロキシ サービスは、特定のジョブで同時に 8 つのファイルをコピーします。 SMS のプロキシを実行しているすべてのノードでは、10 進数で次のレジストリ REG_DWORD 値の名前を調整することによって、同時コピーのスレッドの数を増やすことができます。

    HKEY_Local_Machine\Software\Microsoft\SMSProxy FileTransferThreadCount

   有効範囲は、Windows Server 2019 では、1 ~ 128 です。 変更した後は、移行に参加しているすべてのコンピューター上の記憶域の移行サービスのプロキシ サービスを再起動する必要があります。 この設定は注意が必要追加のコア、記憶域のパフォーマンス、およびネットワーク帯域幅、高く設定することが必要があります。 設定が高すぎると、既定の設定と比較してパフォーマンスが低下する可能性があります。 SMS の以降のバージョンでは、ヒューリスティックによって、CPU、メモリ、ネットワーク、および記憶域に基づいてスレッドの設定を変更する機能は予定です。

- **コアとメモリを追加します。**  ソース、orchestrator、および変換先のコンピューターは、少なくとも 2 つのプロセッサ コアまたは 2 つの Vcpu があるし、FileTransferThreadCount (上記) と組み合わせたときに特にのインベントリと転送のパフォーマンスの詳細は助けが大幅にことを強くお勧めします。 通常の Office 形式よりも大きいファイルを転送するときに (ギガバイト以上) 転送のパフォーマンスは、既定の 2 GB の最小値よりも多くのメモリを得られます。

- **複数のジョブを作成します。** インベントリ、転送、シリアル方式で各サーバーに接続が複数のソースのサーバーでジョブを作成するときに、カット オーバーします。 つまり、各サーバーが別のサーバーを開始する前に、フェーズを完了する必要があります。 多くのサーバーを並列で実行するには、だけでサーバーを 1 つだけ格納している各ジョブで複数のジョブを作成します。 SMS では、つまり、1 つのオーケストレーターには、多くの Windows Server 2019 セットアップ先のコンピューターを並列化、ジョブの実行を同時に 100 をサポートしています。 複数の並列ジョブを実行している場合、セットアップ先のコンピューターが Windows Server 2016 または Windows Server 2012 R2 は、変換先で実行されている、SMS プロキシ サービスでは、ことがなく、orchestrator する必要がありますすべてを実行と転送自体はお勧めしませんし、なる可能性があります、ボトルネックです。 1 つのジョブ内で同時に実行するサーバーの機能は、以降のバージョンの SMS で追加する予定の機能です。

- **RDMA ネットワークでは、SMB 3 を使用します。** Windows Server 2012 またはそれ以降のソース コンピュータ、SMB 3.x をサポート SMB ダイレクト モードおよび RDMA のネットワークから転送しています。 場合、 RDMA の転送のほとんどの CPU コストからマザーボードの Cpu に移動オンボード NIC プロセッサでは、待ち時間とサーバーの CPU 使用率を減らすことです。 さらに、RDMA ネットワーク ROCE と iWARP に通常より一般的な TCP/イーサネット、25、50、インターフェイスごとに 100 Gb 速度なども大幅に高帯域幅があります。 通常、SMB ダイレクトを使用してストレージ自体までネットワークから転送速度の制限に移動します。   

- **3 の SMB マルチ チャネルを使用します。** 場合は、Windows Server 2012 またはそれ以降のソース コンピュータから転送ファイルのコピーのパフォーマンスを大幅に向上できます SMB 3.x のサポート マルチ チャネル コピー。 ソースおよび宛先の両方がある限り、この機能は自動的に動作します。

   - 複数のネットワーク アダプター
   - Receive Side Scaling (RSS) をサポートする 1 つまたは複数のネットワーク アダプター
   - NIC チーミングを使用して構成されている複数のネットワーク アダプターのいずれか
   - RDMA をサポートしているネットワーク アダプター 1 つ以上

- **ドライバーを更新します。** 必要に応じて、ソース、宛先、および orchestrator を最新のベンダー ストレージとエンクロージャのファームウェアとドライバー、最新のベンダー HBA ドライバー、最新のベンダー BIOS および UEFI ファームウェア、最新のベンダー ネットワーク ドライバー、および最新のマザーボード チップセット ドライバーをインストールします。サーバー。 必要に応じてノードを再起動します。 共有記憶域およびネットワーク ハードウェアの構成については、ハードウェア ベンダーのドキュメントを参照してください。

- **高パフォーマンスの処理を有効にします。** サーバーの BIOS および UEFI の設定が、C 状態の無効化、QPI 速度の設定、NUMA の有効化、最大メモリ動作周波数の設定など、高パフォーマンスを有効にする設定であることを確認します。 Windows Server での電源管理が高パフォーマンスに設定されていることを確認します。 必要に応じて再起動します。 忘れずにこれらを適切な状態に移行の完了後に戻ります。 

- **ハードウェアのチューニング**レビュー、[パフォーマンス チューニング ガイドラインの Windows Server 2016](https://docs.microsoft.com/windows-server/administration/performance-tuning/) orchestrator と Windows Server 2019 を実行している移行先コンピューターと Windows Server 2016 をチューニングします。 [ネットワーク サブシステムのパフォーマンス チューニング](https://docs.microsoft.com/windows-server/networking/technologies/network-subsystem/net-sub-performance-tuning-nics)セクションに特に重要な情報が含まれています。

- **高速ストレージを使用します。** ソース コンピューターの記憶域の速度をアップグレードする困難な場合がありますが、先のストレージが少なくとも転送で不要なボトルネックがないことを確認するには、ソースが読み取りの IO パフォーマンスでは、書き込みの IO パフォーマンスで高速ことを確認する必要があります。 送信先が VM の場合は、実行されるように、少なくとも移行のためには、ハイパーバイザー ホストの最速のストレージ層などフラッシュ層またはミラー化されたすべてフラッシュでもハイブリッド スペースを使用して記憶域スペース ダイレクト HCI クラスターでします。 SMS の移行が完了したら、VM できますライブ低下のレベルまたはホストに移行します。

- **ウイルス対策を更新します。** 常に、ソースと変換先が最小限のパフォーマンスのオーバーヘッドを確実にウイルス対策ソフトウェアの最新のパッチ バージョンを実行していることを確認します。 テストとして、することができます*一時的に*インベントリする場合や移行元と移行先サーバー上のフォルダーのスキャンを除外します。 転送のパフォーマンスが向上し場合に、手順やウイルス対策ソフトウェアの更新バージョンまたは期待されるパフォーマンスの低下の詳細については、ウイルス対策ソフトウェア ベンダーに問い合わせてください。

## <a name="give-feedback"></a> バグの報告、フィードバックを提供またはサポートを受けるには、オプションとは

記憶域の移行サービスのフィードバック。

- クリックする「の機能」をお勧めします「と"Windows Server"のカテゴリとサブカテゴリの「記憶域の移行」を指定する Windows 10 でフィードバック ハブ ツールを使用して
- 使用して、 [Windows Server UserVoice](https://windowsserver.uservoice.com)サイト
- 電子メール smsfeed@microsoft.com

バグ報告します。

- 「レポートの問題」をクリックし、"Windows Server"のカテゴリとサブカテゴリの「記憶域の移行」を指定する、Windows 10 でフィードバック ハブ ツールを使用してください。
- 使用してサポート ケースを開く[マイクロソフトのサポート](https://support.microsoft.com)

サポートを受けるには。

 - 質問を投稿、 [Windows Server Tech コミュニティ](https://techcommunity.microsoft.com/t5/Windows-Server/ct-p/Windows-Server)
 - 投稿、 [Windows Server 2019 Technet フォーラム](https://social.technet.microsoft.com/Forums/en-US/home?forum=ws2019&filter=alltypes&sort=lastpostdesc) 
 - 使用してサポート ケースを開く[マイクロソフトのサポート](https://support.microsoft.com)


## <a name="see-also"></a>関連項目

- [記憶域の移行サービスの概要](overview.md)
