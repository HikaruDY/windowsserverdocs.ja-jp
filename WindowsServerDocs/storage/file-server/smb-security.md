---
title: 一般法セキュリティの強化
description: Windows Server 2012 R2、Windows Server 2012 では、Windows Server 2016 で一般法暗号化機能について説明します。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: 831ca8266c3ec18ffb83227dcb2d39b3f953ad1a
ms.sourcegitcommit: 375e94dc70c76e7aa5679c32f0f4dbc26cf7dd83
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/10/2018
ms.locfileid: "2233528"
---
# <a name="smb-security-enhancements"></a>一般法セキュリティの強化

>対象: Windows Server 2012 R2、Windows Server 2012、Windows Server 2016

このトピックでは、Windows Server 2012 R2、Windows Server 2012、および Windows Server 2016 の一般法セキュリティの強化について説明します。

## <a name="smb-encryption"></a>一般法暗号化

一般法暗号化一般法データの - エンドツー エンド暗号化を提供し、信頼されているネットワーク傍受個からデータを保護します。 一般法暗号化を展開するには最低限の残存作業時間] では、特殊なハードウェアまたはソフトウェアの小規模の他のコストがあります。 インターネット プロトコル セキュリティ) または WAN アクセラレータの要件はありません。 共有あたりごとに、またはファイル全体 server、一般法暗号化を構成し、さまざまなデータが信頼されているネットワークを通過するシナリオを有効にすることができます。

>[!NOTE]
>一般法暗号化では、残りの部分を BitLocker ドライブ暗号化で処理が通常のセキュリティは説明しません。

どのような状況で仲介攻撃から保護する機密データが必要なは、一般法暗号化を検討してください。 可能なシナリオは次のとおりです。

- インフォメーション ワーカーの機密性の高いデータを移動するには、一般法プロトコルを使用します。 一般法暗号化では、ファイル サーバーとワイド エリア ネットワーク (WAN) 接続マイクロソフト以外のプロバイダーで維持されるなど、スキャン ネットワークに関係なく、クライアントの間のエンドツー エンドのプライバシーと整合性保証を提供します。
- 一般法 3.0 は、ファイル サーバーは、SQL Server または HYPER-V など、サーバー アプリケーションの継続的に使用できるストレージを使用できます。 一般法暗号化を有効にすると、覗き見攻撃からその情報を保護するには、営業案件を提供します。 一般法暗号化がより多くの記憶域ネットワーク (San) に必要なソリューションの専用のハードウェアを使用して簡単です。

>[!IMPORTANT]
>運用暗号化されていないと比較して任意のエンドツー エンド暗号化保護コストの注目すべきパフォーマンスがあることに注意してください。

## <a name="enable-smb-encryption"></a>一般法暗号化を有効にします。

ファイル サーバー全体または特定のファイル共有に対してのみ一般法暗号化を有効にすることができます。 一般法暗号化を有効にするのにには、次の手順のいずれかを使用します。

### <a name="enable-smb-encryption-with-windows-powershell"></a>Windows PowerShell で一般法暗号化を有効にします。

1. 一般法暗号化の個々 のファイルの共有を有効にするには、サーバー上で次のスクリプトを入力します。
    
    ```PowerShell
    Set-SmbShare –Name <sharename> -EncryptData $true
    ```
2. ファイル サーバー全体の一般法暗号化を有効にするには、サーバー上で次のスクリプトを入力します。
    
    ```PowerShell
    Set-SmbServerConfiguration –EncryptData $true
    ```
3. 新しい一般法ファイルの共有を有効になっている一般法暗号化を作成するのには、次のスクリプトを入力します。
    
    ```PowerShell
    New-SmbShare –Name <sharename> -Path <pathname> –EncryptData $true
    ```

### <a name="enable-smb-encryption-with-server-manager"></a>一般法暗号化サーバー マネージャーで有効にします。

1. サーバー マネージャーで、**ファイルと記憶域サービス**を開きます。
2. 共有の管理] ページを開くには、**共有**を選択します。
3. 一般法暗号化を有効にするための共有を右クリックし、[**プロパティ**] を選びます。
4. [共有の [**設定**] ページには、**暗号化データへのアクセス**を選択します。 この共有へのアクセスをリモートのファイルを暗号化します。

### <a name="considerations-for-deploying-smb-encryption"></a>一般法暗号化を展開するための考慮事項

既定では、ファイル共有またはサーバーの一般法暗号化が有効にすると一般法 3.0 クライアントのみが指定されたファイル共有へのアクセス許可されます。 これは、データを保護する共有へのアクセスをクライアントがすべての管理者の意図を適用します。 ただし、状況によっては、管理者になる (たとえば、期間を切り替え混在クライアント オペレーティング システムのバージョンが使用されている場合) 一般法 3.0 をサポートしているクライアントの暗号化されていないアクセスを許可します。 クライアント一般法 3.0 をサポートしていない暗号化されていないアクセスを許可するには、Windows PowerShell で次のスクリプトを入力します。

```PowerShell
Set-SmbServerConfiguration –RejectUnencryptedAccess $false
```

セキュリティで保護された言語やり取り機能が、次のセクションで説明するには、一般法 3.0 から一般法 2.0 を使用する暗号化されていないアクセス) への接続をダウン グレードから、中間で攻撃ができなくなります。 ただし、一般法 1.0 の結果も暗号化されていないアクセスにダウン グレードは防止できません。 一般法 3.0 クライアントが、暗号化された共有にアクセスする、一般法暗号化を常に使用することを保証するためには、一般法 1.0 サーバーを無効にする必要があります。 (手順については、[一般法 1.0 を無効にする](#disabling-smb-1.0)] セクションを参照してください)。**– RejectUnencryptedAccess**設定 **$true**の既定の設定のままには、暗号化をのみ利用できる一般法 3.0 クライアント (一般法 1.0 クライアントは拒否も) ファイル共有へのアクセス許可されます。

>[!NOTE]
>* 一般法暗号化では、[高度な暗号化標準 (AES)-CCM アルゴリズムを暗号化し、データの暗号化を解除します。 AES CCM では、データの整合性の入力規則の署名の設定に関係なく、暗号化ファイルの共有には、(署名) も提供します。 暗号化されていない署名一般法を有効にする場合は、これを行う続行することができます。 詳細については、 [[基本の一般法署名](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/)を参照してください。
>* 組織がワイド エリア ネットワーク (WAN アクセラレータ住宅設備を使用している場合、ファイル共有またはサーバーにアクセスしようとしたときに問題が発生する可能性があります。
>* 既定の構成 (はありませんが、暗号化ファイルの共有が許可されて暗号化されていないアクセス) クライアントを暗号化ファイルの共有、イベント ID 1003 にアクセスしようと一般法 3.0 はサポートされていませんが Microsoft Windows-SmbServer 運用/イベント ログにログインしている場合は、、、クライアントが、**アクセスの拒否**エラー メッセージを受信します。
>* 一般法暗号化および NTFS ファイル システムで暗号化ファイル システム (EFS)、関連、一般法暗号化を必要とまたはしません efs によって異なります。
>* 一般法暗号化および BitLocker ドライブ暗号化関連する、一般法暗号化が必要なまたは BitLocker ドライブ暗号化を使用してに依存していません。

## <a name="secure-dialect-negotiation"></a>セキュリティで保護された言語のやり取り

一般法 3.0 は、一般法 2.0 または一般法 3.0 プロトコルまたはクライアントとサーバー ネゴシエート機能をダウン グレードしようとしています。 仲介で攻撃を検出することができます。 クライアントまたはサーバーでこのような攻撃が検出されると、接続が切断し、イベント ID 1005 Microsoft Windows-SmbServer/運用のイベント ログに記録されます。 言語をセキュリティで保護されたやり取りの検出または一般法 1.0 一般法 2.0 または 3.0 から降格ようにすることはできません。 このため、一般法暗号化のすべての機能を活用するには、一般法 1.0 サーバーを無効にすることを強くお勧めします。 詳細については、[一般法 1.0 を無効にする](#disabling-smb-1.0)を参照してください。

次のセクションに記載されているセキュリティで保護された言語やり取り機能は、一般法 3 から、使用する暗号化されていないアクセス) 一般法 2 への接続をダウン グレードから、中間で攻撃を防ぐことただし、結果も暗号化されていないアクセスに一般法 1 に降格は防止できません。 一般法の Windows 以外の実装それ以前のバージョンと潜在的な問題の詳細については、 [Microsoft サポート技術情報](http://support.microsoft.com/kb/2686098)を参照してください。

## <a name="new-signing-algorithm"></a>新しい署名アルゴリズム

一般法 3.0 署名に新しい暗号化アルゴリズムを使用する: 高度な暗号化標準 (AES) - 暗号に基づくメッセージ認証コード (CMAC)。 一般法 2.0 には、古い HMAC SHA256 暗号化アルゴリズムが使用されます。 AES CMAC と AES CCM 大幅に短縮データの暗号化 AES 命令をサポートしている最新の cpu します。 詳細については、 [[基本の一般法署名](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/)を参照してください。

## <a name="disabling-smb-10"></a>一般法 1.0 を無効にします。

レガシ コンピューター ブラウザー サービスと一般法 1.0 でリモート管理プロトコル機能は、それらを除去します。 これらの機能が既定では、引き続き有効になっているが、Windows Server 2003 または Windows XP を実行しているコンピューターなど、古い一般法クライアントがあるない場合は、セキュリティを強化し、更新プログラムを軽減する一般法 1.0 機能を削除することができます。

>[!NOTE]
>Windows Server 2008 および Windows Vista 一般法 2.0 が導入されました。 Windows Server 2003 または Windows XP を実行しているコンピューターなど、以前のクライアントは一般法 2.0 をサポートしていませんそのため、することはできませんファイル共有へのアクセスまたは一般法 1.0 サーバーが無効になっている場合は、共有を印刷します。 さらに、一部の Microsoft 以外の一般法クライアントは一般法 2.0 ファイル共有へのアクセスまたは共有 (たとえば、「スキャン共有」機能を持つプリンターなど) を印刷することができないことがあります。

一般法 1.0 を無効にする前に、一般法クライアントが現在一般法 1.0 を実行しているサーバーに接続されているかどうかを確認する必要があります。 これを行うには、Windows PowerShell で次のコマンドレットを入力します。

```PowerShell
Get-SmbSession | Select Dialect,ClientComputerName,ClientUserName | ? Dialect -lt 2
```

>[!NOTE]
>監査記録を作成する (複数回毎日) 1 週間にわたる繰り返しこのスクリプトを実行する必要があります。 これは、スケジュールされたタスクとしても実行できます。

一般法 1.0 を無効にするには、Windows PowerShell で次のスクリプトを入力します。

```PowerShell
Set-SmbServerConfiguration –EnableSMB1Protocol $false
```

>[!NOTE]
>一般法 1.0 を実行するサーバーが無効になっているため、一般法クライアント接続が拒否された場合は、Microsoft Windows-SmbServer/運用のイベント ログでイベント ID 1001 にログインしています。

## <a name="more-information"></a>詳細

一般法と Windows Server 2012 で、関連するテクノロジに関するその他のリソースを紹介します。

- [サーバー メッセージ ブロック](file-server-smb-overview.md)
- [Windows Server の記憶域](../storage.md)
- [アプリケーションのデータのスケール アウト ファイル サーバー](../../failover-clustering/sofs-overview.md)