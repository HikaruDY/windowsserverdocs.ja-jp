---
title: 仮想化環境のボトルネックの検出
description: 検出し、潜在的な hyper-v のパフォーマンスのボトルネックを解決する方法
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Asmahi; SandySp; JoPoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: cdad5f0cc3b0e49ae46e975e3acc2c48a18e5f70
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59867533"
---
# <a name="detecting-bottlenecks-in-a-virtualized-environment"></a>仮想化環境のボトルネックの検出

このセクションからパフォーマンス モニターを使用して監視して、問題がありますと予想したように、ホストまたは仮想マシンをいくつかのいずれかが実行しないとを識別する方法にいくつかのヒントが提供する必要があります。

## <a name="processor-bottlenecks"></a>プロセッサのボトルネック

プロセッサのボトルネックを引き起こす可能性のある一般的なシナリオを次に示します。

-   1 つまたは複数の論理プロセッサは読み込まれます

-   1 つまたは複数の仮想プロセッサは読み込まれます

ホストから次のパフォーマンス カウンターを使用することができます。

-   論理プロセッサ使用率 - \\HYPER-V ハイパーバイザーの論理プロセッサ (\*)\\% の合計実行時間

-   仮想プロセッサ使用率 - \\HYPER-V ハイパーバイザーの仮想プロセッサ (\*)\\% の合計実行時間

-   ルートの仮想プロセッサ使用率 - \\HYPER-V ハイパーバイザーのルートの仮想プロセッサ (\*)\\% の合計実行時間

場合、 **HYPER-V ハイパーバイザーの論理プロセッサ (\_合計)\\% 合計実行時間**カウンターの 90% を超える値は、ホストはオーバー ロードされます。 処理能力を追加するか、一部の仮想マシンを別のホストに移動する必要があります。

場合、 **HYPER-V ハイパーバイザー仮想 Processor(VM Name:VP x)\\% 合計実行時間**カウンターのすべての仮想プロセッサの 90% を超える値は、次を行う必要があります。

-   ホストがオーバー ロードされていないことを確認します。

-   ワークロードがより多くの仮想プロセッサを活用できるかどうかを調べる

-   仮想マシンに複数の仮想プロセッサを割り当てる

場合**HYPER-V ハイパーバイザー仮想 Processor(VM Name:VP x)\\% 合計実行時間**カウンターの 90% 以上仮想プロセッサのすべてではありませんが、いくつかの値は、次を行う必要があります。

-   ワークロードは、ネットワークの多用を受信した場合は、vRSS の使用を検討してください。

-   仮想マシンに Windows Server 2012 R2 が実行されていない場合は、複数のネットワーク アダプターを追加する必要があります。

-   ワークロードが集中型の記憶域の場合は、仮想 NUMA を有効にし、仮想ディスクを追加する必要があります。

場合、 **HYPER-V ハイパーバイザーのルートの仮想プロセッサ (ルート担当副社長 x)\\% 合計実行時間**カウンターがなく、一部の仮想プロセッサの 90% を超えると、**プロセッサ (x)\\% Interrupt Time およびプロセッサ (x)\\% DPC Time**カウンターが約の値追加、**ルート仮想 Processor(Root VP x)\\% 合計実行時間**カウンターを確認してくださいで VMQ を有効にします。ネットワーク アダプター。

## <a name="memory-bottlenecks"></a>メモリのボトルネック

メモリのボトルネックを引き起こす可能性のある一般的なシナリオを次に示します。

-   ホストが応答していません。

-   仮想マシンを開始できません。

-   仮想マシン メモリが不足します。

ホストから次のパフォーマンス カウンターを使用することができます。

-   メモリ\\使用可能な領域のメガバイト数

-   HYPER-V Dynamic Memory Balancer (\*)\\使用可能なメモリ

仮想マシンから次のパフォーマンス カウンターを使用することができます。

-   メモリ\\使用可能な領域のメガバイト数

場合、**メモリ\\Available Mbytes**と**HYPER-V Dynamic Memory Balancer (\*)\\使用可能なメモリ**カウンターが不足しているホストを停止する必要があります不要なサービスし、1 つまたは複数の仮想マシンを別のホストに移行します。

場合、**メモリ\\Available Mbytes**カウンターが低い仮想マシンでは、仮想マシンに多くのメモリを割り当てる必要があります。 動的メモリを使用している場合は、最大メモリの設定を増やす必要があります。

## <a name="network-bottlenecks"></a>ネットワークのボトルネック

ネットワークのボトルネックを引き起こす可能性のある一般的なシナリオを次に示します。

-   ホストは、バインド先のネットワークです。

-   仮想マシンは、バインドされているネットワークです。

ホストから次のパフォーマンス カウンターを使用することができます。

-   ネットワーク インターフェイス (*ネットワーク アダプター名*)\\バイト数/秒

仮想マシンから次のパフォーマンス カウンターを使用することができます。

-   HYPER-V 仮想ネットワーク アダプター (*仮想マシン名&lt;GUID&gt;*)\\バイト数/秒

場合、**物理 NIC のバイト数/秒**カウンターがより大きいか、容量の 90% に等しい、する必要がありますを追加する追加のネットワーク アダプター、別のホストに仮想マシンを移行、およびネットワーク QoS を構成します。

場合、 **、HYPER-V 仮想ネットワーク アダプターのバイト数/秒**カウンターより大きいまたは 250 MBps と等しい必要がありますを追加する、仮想マシン内の他のチーム化されたネットワーク アダプター、vRSS を有効にして、SR-IOV を使用します。

場合は、ワークロードには、それらのネットワーク待機時間を満たすことができない、仮想マシンに物理ネットワーク アダプターのリソースを表示するには、SR-IOV を有効にします。

## <a name="storage-bottlenecks"></a>記憶域のボトルネック

記憶域のボトルネックを引き起こす可能性のある一般的なシナリオを次に示します。

-   操作は、ホストと仮想マシンは、動作を遅くしたり、タイムアウトします。

-   仮想マシンが低下します。

ホストから次のパフォーマンス カウンターを使用することができます。

-   物理ディスク (*ディスク文字*)\\平均ディスク読み取り秒数

-   物理ディスク (*ディスク文字*)\\平均ディスク書き込み秒数

-   物理ディスク (*ディスク文字*)\\平均ディスク読み取りキューの長さ

-   物理ディスク (*ディスク文字*)\\平均ディスク書き込みキューの長さ

待機時間が常に 50 ミリ秒を超える場合は、次の操作を行う必要があります。

-   追加のストレージ仮想マシンに分散します。

-   高速ストレージを購入を検討してください。

-   階層型記憶域スペース、Windows Server 2012 R2 で導入されたを検討してください。

-   Windows Server 2012 R2 で導入された記憶域の QoS の使用を検討します。

-   VHDX を使用して、

## <a name="see-also"></a>関連項目

-   [HYPER-V 用語](terminology.md)

-   [HYPER-V のアーキテクチャ](architecture.md)

-   [HYPER-V サーバーの構成](configuration.md)

-   [HYPER-V のプロセッサのパフォーマンス](processor-performance.md)

-   [HYPER-V でメモリのパフォーマンス](memory-performance.md)

-   [HYPER-V ストレージの I/O パフォーマンス](storage-io-performance.md)

-   [HYPER-V ネットワークの I/O パフォーマンス](network-io-performance.md)

-   [Linux 仮想マシン](linux-virtual-machine-considerations.md)
