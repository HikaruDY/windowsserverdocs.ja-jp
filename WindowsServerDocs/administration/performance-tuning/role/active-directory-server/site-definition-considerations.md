---
title: ADDS のパフォーマンス チューニングでサイト定義とドメイン コント ローラーの配置
description: サイト定義とドメイン コント ローラーの配置に関する考慮事項 Active Directory のパフォーマンスをチューニングします。
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: TimWi; ChrisRob; HerbertM; KenBrumf;  MLeary; ShawnRab
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 0e5c5f8b7cf5c028fbfa5d72c4bc1218565d4087
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59814023"
---
# <a name="proper-placement-of-domain-controllers-and-site-considerations"></a>適切に配置のドメイン コント ローラーとサイトに関する考慮事項

適切なサイト定義は、パフォーマンスにとって重要です。 クライアント サイトが過ぎた認証とクエリのパフォーマンスが低下が発生することができます。 さらに、クライアント上の IPv6 の導入に伴い、要求に由来するか、IPv4 または IPv6 アドレスと Active Directory は IPv6 の正しく定義されているサイトがある必要があります。 オペレーティング システムでは、両方が構成されている場合に IPv4 に IPv6 を優先します。

名前解決を使用して、クライアント、サイトを決定するために、逆引き参照を実行するドメイン コント ローラーの試行は、Windows Server 2008 以降でなければなりません。 これは、ドメイン コント ローラーが応答しなくなるを原因し、ATQ スレッド プールの枯渇が発生します。 これを適切な解像度では、正しく IPv6 のため、サイトのトポロジを定義します。 この問題を回避するには、ドメイン コント ローラーの要求に迅速に対応する名前解決のインフラストラクチャを最適化することができます。 詳細については、次を参照してください。 [Windows Server 2008 または Windows Server 2008 R2 ドメイン コント ローラーは、LDAP または Kerberos 要求に対する応答を遅延](https://support.microsoft.com/kb/2668820)します。

考慮事項の追加の領域には、Rodc が使用されているシナリオの読み取り/書き込みの Dc を検索しています。  特定の操作は、書き込み可能ドメイン コント ローラーへのアクセスを必要とまたは読み取り専用ドメイン コント ローラーがで十分なときに、書き込み可能ドメイン コント ローラーを対象します。  これらのシナリオを最適化すると、2 つのパスがかかる場合があります。
-   読み取り専用ドメイン コント ローラーがで十分な場合は、書き込み可能ドメイン コント ローラーにお問い合わせください。  これには、アプリケーション コードの変更が必要です。
-   書き込み可能ドメイン コント ローラーは、必要があります。  場所読み取り/書き込みドメイン コント ローラー中央の位置に遅延を最小化します。

さらに情報の参照。
-   [Rodc とアプリケーションの互換性](https://technet.microsoft.com/library/cc772597.aspx)
-   [Active Directory サービス インターフェイス (ADSI) と、読み取りのみのドメイン コント ローラー (RODC) – パフォーマンスの問題を回避します。](https://blogs.technet.microsoft.com/fieldcoding/2012/06/24/active-directory-service-interface-adsi-and-the-read-only-domain-controller-rodc-avoiding-performance-issues/)

## <a name="optimize-for-referrals"></a>参照用に最適化します。

参照は、LDAP クエリが、ドメイン コント ローラーは照会パーティションのコピーをホストしていないときにリダイレクトする方法です。 参照が返されると、パーティションの識別名、DNS 名、およびポート番号が含まれます。 クライアントでは、この情報を使用して、パーティションをホストするサーバーでクエリを続行します。 DCLocator シナリオは、この推奨事項のすべてのサイト定義ドメイン コント ローラーの配置を維持すると、その参照に依存するアプリケーションがしばしば見過ごされます。 サイト定義を含む AD トポロジを確認することを推奨し、ドメイン コント ローラーの配置が正しく、クライアントのニーズを反映します。 また、DNS の設定の調整やアプリケーションのサイトを再配置する 1 つのサイトで複数のドメインからドメイン コント ローラーを持つ場合があります。

## <a name="optimization-considerations-for-trusts"></a>信頼関係の最適化に関する考慮事項

フォレスト内のシナリオでの信頼は、次のドメインの階層に従って処理されます。Grand 子ドメインが&gt;子ドメイン -&gt;フォレスト ルート ドメインの&gt;子ドメイン -&gt; Grand 子ドメイン。 フォレストのルートとそれぞれの親でチャネルをセキュリティで保護することを意味は、信頼階層内の Dc を移動する際の認証要求の集約により過負荷になることができます。 大規模な地理的分散のアクティブなディレクトリでの遅延は、認証もがある、上記のフローに影響を与える待ち時間の長いリンクを通過する際にも対象にこの可能性があります。 オーバー ロードは、フォレスト間および下位レベルの信頼のシナリオで発生することができます。 次の推奨事項は、すべてのシナリオに適用されます。

-   セキュリティで保護されたチャネル経由で負荷をサポートする MaxConcurrentAPI を適切に調整します。 詳細については、次を参照してください。 [MaxConcurrentApi の設定を使用して NTLM 認証のパフォーマンスの調整を行う方法](https://support.microsoft.com/kb/2688798/EN-US)します。

-   読み込み時にベースとして適切なショートカットの信頼を作成します。

-   ドメイン内のすべてのドメイン コント ローラーが名前解決を実行し、信頼されたドメインのドメイン コント ローラーと通信できることを確認します。

-   局所性に関する考慮事項を考慮に信頼関係を確認してください。

-   可能であれば Kerberos を有効にして、MaxConcurrentAPI のボトルネックに実行されるリスクを軽減するセキュリティで保護されたチャネルの使用を最小限に抑えます。

ドメインの信頼のシナリオが一貫して多くのお客様の問題点をされている領域を通過します。 ファイアウォールにより多くの場合、名前解決と接続の問題は、信頼する側のドメイン コント ローラーでリソースの枯渇が発生して、すべてのクライアントに影響を与えます。 さらに、見落とされがちなシナリオは信頼されたドメイン コント ローラーへのアクセスを最適化します。 正しく機能することを確認する主な領域は次のとおりです。

-   信頼する側のドメイン コント ローラーを使用している DNS と WINS の名前解決は、信頼されたドメインのドメイン コント ローラーの正確な一覧を解決できるようにします。

    -   静的に追加されたレコードには、古くなるし、時間の経過と共に、接続の問題を再導入する傾向があります。 DNS の転送、動的 DNS と WINS または DNS インフラストラクチャのマージは、長い目で保守しやすくなります。

    -   フォワーダー、条件付き転送、およびクライアントがアクセスする必要がある環境のすべてのリソースの両方の転送および逆引き参照ゾーンのセカンダリ コピーの適切な構成を確認します。 ここでも、この手動メンテナンスが必要ですし、古くなる傾向があります。 インフラストラクチャの統合は最適です。

-   信頼する側のドメインのドメイン コント ローラーは、同じサイトで最初に、信頼されたドメインとし、ジェネリック ロケーターへのフェールバックでのドメイン コント ローラーを検索しようとします。

    -   DCLocator のしくみの詳細については、次を参照してください。[最も近いサイト内のドメイン コント ローラーの検索](https://technet.microsoft.com/library/cc978016.aspx)します。

    -   同じ場所にドメイン コント ローラーを反映するように、信頼できる、信頼する側のドメイン間のサイト名が収束します。 サブネットと IP アドレスのマッピングが両方のフォレスト内のサイトに正しくリンクされていることを確認します。 詳細については、次を参照してください。[ドメイン ロケーターで、フォレストの信頼](http://blogs.technet.com/b/askds/archive/2008/09/24/domain-locator-across-a-forest-trust.aspx)します。

    -   ドメイン コント ローラーの場所の DCLocator に関するニーズに沿って、開いているポートを確認します。 ドメイン間でファイアウォールが存在しない場合は、すべての信頼に対して、ファイアウォールが正しく構成されているを確認します。 ファイアウォールが開いていない場合は、信頼する側のドメイン コント ローラーを依然として、信頼されたドメインにアクセスしようとするされます。 通信は、何らかの理由で失敗すると、信頼する側のドメイン コント ローラーは最終的にタイムアウト、信頼されたドメイン コント ローラーに要求します。 ただし、これらのタイムアウトは要求ごとに数秒かかる場合があり、受信要求の量が多い場合、信頼する側のドメイン コント ローラー上のネットワーク ポートを使い果たしてしまうことができます。 クライアントとして停止したスレッドは、(アプリケーションでは、フォア グラウンド スレッドで要求を実行) する場合、ハングしたアプリケーションに変換可能性がありますがドメイン コント ローラーでのタイムアウトを待機が発生する可能性があります。 詳細については、次を参照してください。[ドメインと信頼関係のファイアウォールを構成する方法](https://support.microsoft.com/kb/179442)します。

    -   DnsAvoidRegisterRecords を使用すると、低いパフォーマンスまたは待機時間の長い、ドメイン コント ローラー汎用ロケーターに広告からのサテライト サイトにあるように削除できます。 詳細については、次を参照してください。[ドメイン コント ローラーまたはクライアントのサイト外にあるグローバル カタログの場所を最適化する方法](https://support.microsoft.com/kb/306602)します。

        **注**  クライアントが使用できるドメイン コント ローラーの数に約 50 の実用的な制限があります。 サイト最適かつ最も高い容量にするドメイン コント ローラー。

         

    -   物理的に同じ場所で信頼できる、信頼する側のドメインからドメイン コント ローラーを配置することを検討してください。

すべての信頼のシナリオは、資格情報が認証要求で指定されたドメインに従ってルーティングされます。 これは、LookupAccountName と LsaLookupNames するクエリの場合は true も (他のユーザー、およびこれら単に最もよく使用されます) の Api。 これらの Api ドメイン パラメーターが NULL 値が指定されたドメイン コント ローラーは使用可能なすべての信頼されたドメインで指定されたアカウント名を検索しようとします。

-   NULL のドメインを指定すると使用可能なすべての信頼関係のチェックを無効にします。 [LsaLookupRestrictIsolatedNameLevel のレジストリ エントリを使用して外部の信頼されたドメインの分離された名前の参照を制限する方法](https://support.microsoft.com/kb/818024)

-   無効にする使用可能なすべての信頼間で指定された NULL ドメインで認証要求を渡します。 [Lsass.exe プロセスが、Active Directory ドメイン コント ローラーに多くの外部の信頼がある場合の応答を停止する可能性があります。](https://support.microsoft.com/kb/923241/EN-US)

## <a name="see-also"></a>関連項目
- [Active Directory サーバーのチューニング パフォーマンス](index.md)
- [ハードウェアの考慮事項](hardware-considerations.md)
- [LDAP の考慮事項](ldap-considerations.md)
- [ADDS のパフォーマンスのトラブルシューティング](troubleshoot.md) 
- [Active Directory Domain Services のキャパシティ プランニング](https://go.microsoft.com/fwlink/?LinkId=324566)