---
title: パフォーマンス チューニングのリモート デスクトップ仮想化ホスト
description: リモート デスクトップ仮想化ホストのパフォーマンス チューニング
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: HammadBu; VladmiS
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 1893c0d2689657a5213b2d59e8d83cea0fc3a0db
ms.sourcegitcommit: 2977c707a299929c6ab0d1e0adab2e1c644b8306
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/24/2019
ms.locfileid: "63722719"
---
# <a name="performance-tuning-remote-desktop-virtualization-hosts"></a>パフォーマンス チューニングのリモート デスクトップ仮想化ホスト


リモート デスクトップ仮想化ホスト (RD 仮想化ホスト) は、仮想デスクトップ インフラストラクチャ (VDI) シナリオをサポートでき、複数の同時実行ユーザーが実行するサーバーでホストされている仮想マシンで Windows ベースのアプリケーションを実行する役割サービスWindows Server 2016 と Hyper-v の概要。

Windows Server 2016 では、仮想デスクトップ、個人用仮想デスクトップおよびプールされた仮想デスクトップの 2 つの種類をサポートします。

**このトピックの内容:**

-   [一般的な考慮事項](#general)

-   [パフォーマンスの最適化](#perfopt)

## <a href="" id="general"></a>一般的な考慮事項


### <a name="storage"></a>ストレージ

ストレージは、最も可能性の高いパフォーマンスのボトルネックと仮想マシンの状態の変更によって生成される I/O 負荷を正しく処理するために、ストレージのサイズを変更することが重要です。 パイロットまたはシミュレーションが実行できない場合は、適切なガイドラインでは、次の 4 つのアクティブな仮想マシンの 1 つのディスク スピンドルをプロビジョニングします。 ディスクの構成を適切な書き込みパフォーマンス (RAID 1 + 0 など) を使用します。

適切な場合は、ディスク重複除去とキャッシュをディスクの読み取り負荷を削減し、イメージの重要な部分をキャッシュすることによってパフォーマンスを向上させる、記憶域ソリューションを有効に使用します。

### <a name="data-deduplication-and-vdi"></a>データ重複除去と VDI

Windows Server 2012 R2 で導入された、データ重複除去は、開いているファイルの最適化をサポートします。 重複除去されたボリュームで実行されている仮想マシンを使用するには、仮想マシンのファイルは、HYPER-V ホストから別のホストに保存する必要があります。 Hyper-v ホストと重複除去は、同じコンピューターで実行している、2 つの機能はシステム リソースの競合し、全体的なパフォーマンスに悪影響を与えます。

ボリュームは、"仮想デスクトップ インフラストラクチャ (VDI) を使用する構成も必要があります? 重複除去の最適化の種類。 サーバー マネージャーを使用してこれを構成することができます (**File and Storage Services**  - &gt; **ボリューム** - &gt; **の重複除去設定**)または、次の Windows PowerShell を使用してコマンドします。

``` syntax
Enable-DedupVolume <volume> -UsageType HyperV
```

**注**  開いているファイルのデータ重複除去の最適化は、SMB 3.0 経由でリモート記憶域を使用して HYPER-V の VDI シナリオに対してのみサポートされます。


### <a name="memory"></a>メモリ

サーバーのメモリ使用量は、3 つの主な要素によって決まります。

-   オペレーティング システムのオーバーヘッド

-   仮想マシンごとのオーバーヘッドの HYPER-V サービス

-   各仮想マシンに割り当てられたメモリ

一般的なナレッジ ワーカーのワークロードでは、ゲスト仮想マシンの実行中の x86 Window 8 または Windows 8.1 が ~ 512 MB のベースラインとしてメモリを指定する必要があります。 ただし、動的メモリでは、800 mb のワークロードに応じて、ゲスト仮想マシンのメモリが増える可能性があります。 X64 用わかります 800 MB 起動する方法についてを 1024 MB に増加します。

そのため、これが、ゲスト仮想マシンの予想された数で必要とされるメモリを満たすために十分なサーバーのメモリを提供するさらに、サーバーのための十分なメモリ量をすることに重要です。

### <a name="cpu"></a>CPU

RD 仮想化ホスト サーバーのサーバーの容量を計画するときに、ワークロードの性質に物理コアあたりの仮想マシンの数によって異なります。 開始点では、物理コアには、12 の仮想マシンを計画し、パフォーマンスと密度を検証する適切なシナリオを実行するは適切です。 密度は、ワークロードの詳細によって達成可能な可能性があります。

ハイパースレッディングが有効にすることを勧めしましたが物理コアの数と論理プロセッサの数に基づいてオーバー サブスクリプション比率を計算することを確認します。 これにより、CPU あたりの単位でパフォーマンスの想定されているレベルです。

### <a name="virtual-gpu"></a>仮想 GPU

仮想デスクトップ インフラストラクチャ (VDI) ホスト側リモート処理、レンダリング キャプチャ エンコード パイプライン、非常に効率的な GPU ベース エンコードの RD 仮想化ホスト用 RemoteFX は、リッチ グラフィックス エクスペリエンスを提供、クライアントに基づく制限アクティビティと DirectX が有効な仮想 GPU を搭載。 RD 仮想化ホスト用 RemoteFX DirectX11 DirectX9 から仮想 GPU をアップグレードします。 また、高解像度でその他のモニターをサポートすることによって、ユーザー エクスペリエンスも向上します。

RemoteFX DirectX11 操作は、ハードウェア GPU のソフトウェア エミュレーション ドライバーを使用していない場合です。 このソフトウェア GPU には、良好なエクスペリエンスが用意されていますが、RemoteFX 仮想グラフィックス処理ユニット (VGPU) は、ハードウェア高速化エクスペリエンスを仮想デスクトップに追加します。

Windows Server 2016 を実行しているサーバーの RemoteFX VGPU エクスペリエンスを利用するには、(DirectX11.1 WDDM 1.2 など)、ホスト サーバー上の GPU ドライバーが必要です。 RD 仮想化ホスト用 RemoteFX で使用する GPU プランの詳細については、GPU プロバイダーに問い合わせてください。

VDI 展開で RemoteFX 仮想 GPU を使用する場合は、展開の処理能力が使用シナリオとハードウェア構成に基づいては異なります。 展開を計画するときに、次の操作を考慮してください。

-   システム上の Gpu の数

-   Gpu 上のビデオ メモリ容量

-   システム上のプロセッサとハードウェアのリソース

### <a name="remotefx-server-system-memory"></a>RemoteFX サーバーのシステム メモリ

仮想 GPU を搭載した有効になっているすべての仮想デスクトップの RemoteFX は、ゲスト オペレーティング システムでは、RemoteFX が有効なサーバーでシステム メモリを使用します。 ハイパーバイザーはゲスト オペレーティング システムのシステム メモリの可用性を保証します。 サーバーで、各仮想 GPU が有効な仮想デスクトップは、ハイパーバイザーに対するそのシステムのメモリ要件を提供する必要があります。 仮想 GPU が有効な仮想デスクトップを開始すると、ハイパーバイザーは VGPU が有効な仮想デスクトップ用の RemoteFX が有効なサーバーでの他のシステム メモリを予約します。

RemoteFX が有効なサーバーで消費されるメモリ量が VGPU が有効な仮想デスクトップとの最大解像度に関連付けられているモニターの数に依存するために、RemoteFX が有効なサーバーのメモリ要件は動的これらを監視します。

### <a name="remotefx-server-gpu-video-memory"></a>RemoteFX サーバー GPU のビデオ メモリ

すべて仮想 GPU が有効な仮想デスクトップでは、デスクトップを表示するために、ホスト サーバー上の GPU ハードウェアでビデオ メモリを使用します。 に加えて、レンダリング、ビデオ メモリは、表示される画面を圧縮するコーデックによって使用されます。 必要なメモリの量は、仮想マシンにプロビジョニングされているモニターの量に直接基づいています。

予約されているビデオ メモリは、モニターおよびシステムの画面解像度の数によって異なります。 一部のユーザーは、特定のタスクの高い画面解像度を必要があります。 低い解像度の設定でより高い拡張性がある場合、その他のすべての設定は変更されません。

### <a name="remotefx-processor"></a>RemoteFX のプロセッサ

ハイパーバイザーでは、RemoteFX が有効なサーバーと仮想 GPU が有効な仮想デスクトップで、CPU をスケジュールします。 システム メモリとは異なり、RemoteFX は、ハイパーバイザーと共有する必要があるその他のリソースに関連する情報がありません。 追加の CPU オーバーヘッドが仮想 GPU が有効な仮想デスクトップには、RemoteFX 仮想 GPU ドライバーとユーザー モードのリモート デスクトップ プロトコル スタックの実行に関連しています。

RemoteFX が有効なサーバー上のオーバーヘッドを増やすと、システムに追加のプロセス (rdvgm.exe) が実行されるため、仮想 GPU 対応の仮想デスクトップごと。 このプロセスは、GPU 上でコマンドを実行するのにグラフィックス デバイス ドライバーを使用します。 コーデックは、クライアントに送信する必要がある画面のデータを圧縮する場合も、Cpu を使用します。

多くの仮想プロセッサは、優れたユーザー エクスペリエンスを意味します。 仮想 GPU 対応の仮想デスクトップごとに少なくとも 2 つの仮想 Cpu を割り当てることをお勧めします。 X64 の使用をお勧め仮想 GPU 対応の仮想デスクトップのアーキテクチャのため、仮想マシンは x86 と比較より x64 でのパフォーマンスの仮想マシン。

### <a name="remotefx-gpu-processing-power"></a>RemoteFX の GPU の処理能力

すべての仮想 GPU が有効な仮想デスクトップ、RemoteFX が有効なサーバーで実行されている対応する DirectX プロセスがあります。 このプロセスは、物理 GPU に RemoteFX 仮想デスクトップから受信したすべてのグラフィックス コマンドを再生します。 物理の gpu は、同時に複数の DirectX アプリケーションの実行と同じです。

通常、グラフィックス デバイスおよびドライバーをデスクトップ上で少数のアプリケーションを実行するチューニングします。 RemoteFX は、固有の方法で使用される Gpu を拡大します。 GPU が RemoteFX サーバーで実行するしくみを測定するには、RemoteFX 要求に GPU の応答を測定するパフォーマンス カウンターが追加されました。

GPU リソースがリソース不足のとき、通常は読み取りし、書き込み操作を完了する GPU 実行時間を。 パフォーマンス カウンターを使用して、管理者は、特定、エンドユーザーのダウンタイムの可能性を排除予防措置を取得できます。

次のパフォーマンス カウンターは仮想 GPU パフォーマンスを測定する RemoteFX サーバーです。

**RemoteFX グラフィックス**

-   **スキップ/秒のフレームのクライアント リソースの不足**が不足しているクライアントのリソースのための 1 秒あたりのフレーム数がスキップされました

-   **グラフィックスの圧縮比率**に入力されたバイト数でエンコードされたバイト数の比率

**RemoteFX ルート GPU の管理**

-   **リソース:サーバー gpu TDRs** TDR がサーバー上の GPU でタイムアウト時間の合計数

-   **リソース:RemoteFX を実行する仮想マシン**RemoteFX 3D ビデオ アダプタがインストールされている仮想マシンの合計数

-   **VRAM:GPU ごとの使用可能 MB**が使用されていない専用のビデオ メモリの量

-   **VRAM:GPU あたりの予約済み %** RemoteFX の予約された専用のビデオ メモリの割合

**RemoteFX ソフトウェア**

-   **モニターの割合をキャプチャ** \[1 ~ 4\]モニター 1 ~ 4 の RemoteFX キャプチャ速度を表示します。

-   **圧縮比率**Deprecated in Windows 8 によって置き換え**グラフィックス圧縮比率**

-   **フレーム/秒の遅延**グラフィック データをない一定の時間内で送信された 1 秒あたりのフレームの数

-   **キャプチャからの応答時間の GPU**待機時間の測定される RemoteFX キャプチャ内 (マイクロ秒) で GPU の操作が完了するには

-   **レンダリングからの応答時間の GPU**待機時間を測定 RemoteFX レンダー内 (マイクロ秒) で GPU の操作が完了するには

-   **出力バイト**RemoteFX 数の合計バイト数を出力します。

-   **クライアントの数/秒の待機**Deprecated in Windows 8 によって置き換え**スキップ/秒のフレームのクライアント リソースの不足**

**RemoteFX vGPU の管理**

-   **リソース:仮想マシンにローカル TDRs**この仮想マシン (仮想マシンに反映するサーバーに含まれていないこと TDRs) で発生した TDRs の合計数

-   **リソース:サーバーによって伝達 TDRs** TDRs サーバーで発生して、仮想マシンに反映された数の合計

**RemoteFX 仮想マシンの vGPU のパフォーマンス**

-   **データ:1 秒あたりの提示を呼び出す**の 1 秒あたりの仮想マシンのデスクトップに表示する操作が存在する秒単位での合計数

-   **データ:1 秒あたりの送信**GPU 1 秒あたりのサーバーに仮想マシンから送信された現在の操作の合計数

-   **データ:読み取りバイト数/秒**1 秒あたりの RemoteFX が有効なサーバーからの読み取りバイト数の合計数

-   **データ:送信バイト数/秒**1 秒あたりで RemoteFX が有効なサーバー GPU に送信されたバイトの合計数

-   **DMA:通信バッファーの平均待機時間 (秒)** 通信バッファーにかかった時間 (秒単位) での平均の長さ

-   **DMA:DMA バッファー遅延時間 (秒)** DMA が送信されると、完了するまでの秒単位で時間

-   **DMA:キューの長さ**RemoteFX 3D ビデオ アダプタの DMA キュー長

-   **リソース:GPU あたり TDR タイムアウト**GPU ごと、仮想マシンで発生した数の TDR のタイムアウト

-   **リソース:GPU エンジンあたり TDR タイムアウト**エンジン、仮想マシンでの GPU ごとに発生した数の TDR のタイムアウト

RemoteFX 仮想 GPU パフォーマンス カウンターに加えて、ビデオ メモリ使用量と GPU 使用率を示しています。 プロセス エクスプ ローラーを使用して GPU 使用率を測定することもできます。

## <a href="" id="perfopt"></a>パフォーマンスの最適化


### <a name="dynamic-memory"></a>動的メモリ

動的メモリは、実行中の仮想マシン間のメモリの分散方法を分散させることによって、HYPER-V を実行しているサーバーのメモリ リソースの使用率ではより効率的にできます。 メモリは、仮想マシン間のワークロードの変化への応答で動的に再割り当てされることができます。

動的メモリを使用して、パフォーマンスやスケーラビリティを損なうことがなくが既にあるリソースと仮想マシンの密度を上げることができます。 管理を簡素化とコストの削減に変換する、高コストのサーバー ハードウェア リソースのより効率的に使用されます。

ゲスト オペレーティング システムでは、Windows 8 を実行していると、上にまたがる複数の論理プロセッサの仮想プロセッサとのトレードオフを考慮メモリ使用量を最小限に抑えるための動的メモリで実行されていると、パフォーマンスを向上させるために動的メモリを無効にするとの間アプリケーションのコンピューター トポロジを認識です。 このようなアプリケーションでは、スケジュール設定とメモリの割り当ての意思決定を行うには、トポロジ情報を利用できます。

### <a name="tiered-storage"></a>階層型記憶域

RD 仮想化ホストでは、仮想デスクトップ プールの階層型記憶域をサポートします。 コレクション内のすべてのプールされた仮想デスクトップによって共有されている物理コンピューターには、ミラー化されたソリッド ステート ドライブ (SSD) などの小さいサイズで高パフォーマンス記憶域ソリューションを使用できます。 プールされた仮想デスクトップは、1 + 0 RAID などの低コスト、従来のストレージに配置できます。

物理コンピューターを配置する必要があります、SSD が、ほとんど読み取り-I/Os のプールされた仮想デスクトップから、管理オペレーティング システムに移動します。 物理コンピューターで使用されているストレージがどれだけ新しいバージョンに維持する必要がありますこのため、1 秒あたりの I/o の読み取り。

この配置構成は、パフォーマンスが必要なコスト効率に優れたパフォーマンスを保証します。 SSD は、小さなサイズのディスク (構成に応じて、コレクションあたり約 20 GB) でより高いパフォーマンスを提供します。 プールされた仮想デスクトップの従来型ストレージ (RAID 1 + 0) 仮想マシンあたり約 3 GB を使用します。

### <a name="csv-cache"></a>CSV キャッシュ

フェールオーバーには、Windows Server 2012 以降がクラスタ リングは、クラスター共有ボリューム (CSV) 上のキャッシュを提供します。 プールされた仮想デスクトップ コレクションに非常に有効ですが、ほとんど読み取りの I/o が、管理オペレーティング システムから取得します。 CSV キャッシュは、2 回以上読み取られるブロックをキャッシュして、I/O を削減するシステム メモリから配信するために、桁違いによってより高いパフォーマンスを提供します。 CSV キャッシュの詳細については、次を参照してください。 [CSV キャッシュを有効にする方法](http://blogs.msdn.com/b/clustering/archive/2012/03/22/10286676.aspx)します。

### <a name="pooled-virtual-desktops"></a>プールされた仮想デスクトップ

既定では、プールされた仮想デスクトップにロールバックきれいな状態をユーザーがサインアウトは、最後のユーザー サインインが破棄された後、Windows オペレーティング システムに加えられたため、変更後にします。

ロールバックを無効にすることはできますが、まだ一時的な状態をためにはプールされた仮想デスクトップ コレクションは再作成された仮想デスクトップ テンプレートをさまざまな更新プログラムのため、通常。

Windows の機能と永続的な状態に依存するサービスをオフにかなっています。 さらに、理にかなっての非エンタープライズのシナリオでは主に、サービスをオフにします。

特定のサービスごとは、任意の広範なデプロイの前に適切に評価する必要があります。 以下は、初期考慮事項です。

| サービス                                      | なぜでしょうか。                                                                                                                                                                                                      |
|----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 自動更新                                  | プールされた仮想デスクトップは、仮想デスクトップ テンプレートを再作成して更新されます。                                                                                                                          |
| オフライン ファイル                                | 仮想デスクトップは、常にオンラインで、ネットワーク ポイントからのビューから接続されています。                                                                                                                         |
| バック グラウンドの最適化                            | (きれいな状態または結果、すべてのプールされた仮想デスクトップを再作成する仮想デスクトップ テンプレートを再作成へのロールバック) のため、ユーザーがサインオフした後、ファイル システムの変更は破棄されます。 |
| 休止状態またはスリープ状態                           | VDI のような概念はありません。                                                                                                                                                                                   |
| バグ チェック メモリ ダンプ                        | このようなプールされた仮想デスクトップの概念がありません。 バグ チェックされているプールされた仮想デスクトップは、きれいな状態から開始されます。                                                                                       |
| WLAN autoconfig サービス                              | VDI の WiFi デバイス インターフェイスはありません。                                                                                                                                                                 |
| Windows Media Player ネットワーク共有サービス | コンシューマー中心のサービス                                                                                                                                                                                  |
| ホーム グループ プロバイダー                          | コンシューマー中心のサービス                                                                                                                                                                                  |
| インターネット接続の共有                  | コンシューマー中心のサービス                                                                                                                                                                                  |
| Media Center サービスを拡張します。               | コンシューマー中心のサービス                                                                                                                                                                                  |

 

**注**  この一覧は意図するもの一覧については、意図した目的とシナリオが影響する変更を加えたので。 詳細については、次を参照してください。[ホット ニュース、手、、Windows 8 の VDI 最適化スクリプト PFE の特例!](http://blogs.technet.com/b/jeff_stokes/archive/2013/04/09/hot-off-the-presses-get-it-now-the-windows-8-vdi-optimization-script-courtesy-of-pfe.aspx)します。

 

**注**   SuperFetch Windows 8 では、既定で有効です。 VDI に対応し、無効にすることです。 SuperFetch は VDI にとって有益であるページが共有メモリ、メモリ消費をさらに削減できます。 プールされた仮想デスクトップが Windows 7 を実行して、SuperFetch を無効にする必要があります、が、個人用仮想デスクトップが Windows 7 を実行して、残すか。

 
