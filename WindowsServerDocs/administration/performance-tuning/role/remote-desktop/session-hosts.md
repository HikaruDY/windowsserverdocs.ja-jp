---
title: パフォーマンス チューニングのリモート デスクトップ セッション ホスト
description: リモート デスクトップ セッション ホストのパフォーマンス チューニング ガイドライン
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: HammadBu; VladmiS
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: e95671718616fc7c81977434e83a227c858fca17
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/07/2019
ms.locfileid: "66811420"
---
# <a name="performance-tuning-remote-desktop-session-hosts"></a>パフォーマンス チューニングのリモート デスクトップ セッション ホスト


このトピックでは、リモート デスクトップ セッション ホスト (RD セッション ホスト) のハードウェアを選択して、ホストの調整、アプリケーションをチューニングする方法について説明します。

**このトピックの内容:**

-   [パフォーマンスのための適切なハードウェアを選択します。](#selecting-the-proper-hardware-for-performance)

-   [リモート デスクトップ セッション ホスト用のアプリケーションのチューニング](#tuning-applications-for-remote-desktop-session-host)

-   [リモート デスクトップ セッション ホストがチューニング パラメーター](#remote-desktop-session-host-tuning-parameters)

## <a name="selecting-the-proper-hardware-for-performance"></a>パフォーマンスのための適切なハードウェアの選択


RD セッション ホスト サーバー展開では、ハードウェアの選択は、アプリケーション設定とユーザーがそれらを使用する方法によって制御されます。 ユーザーと経験の数に影響する主な要因は、CPU、メモリ、ディスク、およびグラフィックスです。 このセクションでは、RD セッション ホスト サーバーに固有の追加のガイドラインについて説明し、RD セッション ホスト サーバーのマルチ ユーザー環境に関連するほとんどの場合。

### <a name="cpu-configuration"></a>CPU の構成

CPU の構成は、概念的には、一時的な急増を処理するためにバッファー ゾーンを維持しながら、サポートするために、システムが想定されるセッションの数によって、セッションをサポートするために必要な CPU を乗算することによって決まります。 複数の論理プロセッサには、異常な CPU の輻輳状況のような論理プロセッサ数に含まれるいくつかの overactive スレッドで引き起こされたことは通常を減らすのに役立ちます。

以上の論理プロセッサ システムでは、そのため、CPU あたりのアクティブな負荷の大きい割合で CPU 使用状況の見積もりを作成する必要が低いクッション余白。 Cpu の数を 2 倍は覚えておく重要な要因の 1 つは、しない 2 倍の CPU 容量をしません。

### <a name="memory-configuration"></a>メモリ構成

メモリの構成はユーザーを使用して; のアプリケーションに依存ただし、次の数式を使用して必要なメモリ量を推定することができます。TotalMem = OSMem + SessionMem \* NS

OSMem は SessionMem (システム バイナリの画像、データの構造やなど) 実行するオペレーティング システムで必要なメモリが 1 つのセッションで実行されているメモリのプロセスが必要な量、その NS がアクティブなセッションの目標数。 ほとんどの場合、セッションに必要なメモリの量はプライベート メモリ参照がアプリケーションと、セッション内で実行されているシステム プロセスの設定によって決まります。 共有コードまたはデータ ページでは、1 つだけコピーは、システム上に存在するため、ほとんど効果がありません。

(ページ ファイルのバックアップはディスク システムは変更しないと仮定)、1 つの興味深い観察ことですが大きくなるほどの数の同時実行のアクティブなセッションがシステムの計画をサポートするには大きくなり、セッションごとのメモリの割り当てする必要があります。 場合セッションごとに割り当てられるメモリの量は増加しません、ページ フォールト数そのアクティブなセッションでは、セッションの数が増加生成します。 最終的に、このような障害には、I/O サブシステムが過負荷します。 セッションごとに割り当てられるメモリの量を増やすことでページ フォールトが発生する確率が減少したら、ページ フォールトの全体的な速度を低下するのに役立ちます。

### <a name="disk-configuration"></a>ディスク構成

ストレージは、RD セッション ホスト サーバーを構成すると、フィールドにデプロイされているシステムで最も一般的な制限ができる最も見過ごさのいずれかです。

一般的な RD セッション ホスト サーバーで生成されるディスク利用状況では、次の領域に影響します。

-   システム ファイルやアプリケーション バイナリ

-   ページのファイル

-   ユーザー プロファイルとユーザー データ

理想的には、これらの領域は、別のストレージ デバイスでバックアップする必要があります。 ストライプの RAID 構成または他の種類のより多くの高パフォーマンス ストレージを使用して、パフォーマンスが向上します。 バッテリ バックアップの書き込みキャッシュが記憶域アダプターを使用することを強くお勧めします。 ディスク書き込みキャッシュがコント ローラーは、同期書き込み操作のサポートの強化を提供します。 すべてのユーザーが別の hive が、同期書き込み操作は、RD セッション ホスト サーバーでより一般的に大幅にします。 レジストリ ハイブが定期的に保存された同期書き込み操作を使用してディスクにします。 開く、ディスクの管理コンソールから、これらの最適化を有効にする、**プロパティ**コピー先のディスクと、ダイアログ ボックス、**ポリシー** ] タブで、[、**でキャッシュの書き込みを有効にします。ディスク**と**Windows 書き込みキャッシュ バッファーのフラッシュ オフ**デバイスのチェック ボックスをオンします。

### <a name="network-configuration"></a>ネットワーク構成

RD セッション ホスト サーバーのネットワーク使用率には、2 つの主なカテゴリが含まれています。

-   RD セッション ホスト接続のトラフィックの使用量はほぼ例外なく、セッションとデバイスのリダイレクトされた I/O トラフィック内で実行されるアプリケーションで発生する描画パターンによって決定されます。

    たとえば、テキスト処理とデータ入力を処理するアプリケーションは、リッチ グラフィックスとビデオの再生は、使用帯域幅の大幅な増加を引き起こすは、1 秒あたり約 10 ~ 100 キロの帯域幅を消費します。

-   移動プロファイル、アプリケーションのファイル共有、データベース サーバー、電子メール サーバー、および HTTP サーバーへのアクセスなどのバック エンド接続します。

    ボリュームとネットワーク トラフィックのプロファイルは、各デプロイに固有です。

## <a name="tuning-applications-for-remote-desktop-session-host"></a>リモート デスクトップ セッション ホスト用のアプリケーションのチューニング


RD セッション ホスト サーバーの CPU 使用率の大部分は、アプリによって駆動されます。 通常、デスクトップ アプリはユーザーの要求に応答するアプリケーションにかかる時間を最小限に抑えることを目標としての応答性に最適化されます。 ただし、サーバー環境に悪影響を及ぼす他のセッションに影響を回避するために操作が完了するために必要な CPU 使用率の合計量を最小限に抑えることです。

RD セッション ホスト サーバーで使用するアプリを構成するときに、次の推奨事項を考慮してください。

-   バック グラウンド アイドル ループ処理を最小限に抑える

    一般的な例がバック グラウンド文法およびスペル チェック、データの検索では、インデックス作成を無効にして、背景を保存します。

-   アプリが、状態の確認や更新プログラムを実行する頻度を最小限に抑えます。

    このような動作を無効にするか、ポーリングのイテレーションと大幅に発生させるタイマーの間隔を増やすため、多くのアクティブなセッションのようなアクティビティの影響が増幅される迅速に CPU 使用率を利用できます。 典型的な例としては、接続の状態のアイコンとステータス バー情報の更新です。

-   同期頻度を減らすことでアプリ間でリソースの競合を最小限に抑えます。

    このようなリソースの例には、レジストリ キーと構成ファイルが含まれます。 アプリケーション コンポーネントと機能の例は、状態インジケーター (シェルの通知) など、バック グラウンドのインデックスを作成または変更の監視、およびオフライン同期されます。

-   ユーザーのサインインまたはセッションの起動と開始に登録されている不要なプロセスを無効にします。

    CPU 負荷の高いプロセスは、一般に、新しいユーザー セッションを作成するときに、これらのプロセスは CPU 使用率のコストに投稿が大幅にできるし、朝のシナリオで非常に安価であることができます。 MsConfig.exe または MsInfo32.exe を使用して、ユーザーのサインイン時に開始されたプロセスの一覧を取得します。 詳細な情報は、使用できる[Autoruns を Windows](https://technet.microsoft.com/sysinternals/bb963902.aspx)します。

メモリ消費量には、次を考慮してください。

-   アプリによって読み込まれた Dll が再配置されないことを確認します。

    -   使用して、次の図に示すように、プロセスの DLL のビューを選択して再配置された Dll を検証できる[Process Explorer](https://technet.microsoft.com/sysinternals/bb896653.aspx)します。

    -   ここでわかります x.dll にその既定のベース アドレスが既に使用されているし、ASLR が有効になっていないために、その y.dll が再配置

        ![再配置された dll](../../media/perftune-guide-relocated-dlls.png)

        Dll は再配置している場合ことはできません、セッション間でコードを共有するセッションのフット プリントが大幅に向上します。 これは、RD セッション ホスト サーバー上の最も一般的なメモリに関連するパフォーマンス問題の 1 つです。

-   共通言語ランタイム (CLR) アプリケーションでは、ページを共有し、CPU オーバーヘッドを減らすためにネイティブ イメージ ジェネレーター (Ngen.exe) を使用します。

    可能であれば、他の同様の実行エンジンを同様の手法を適用します。

## <a name="remote-desktop-session-host-tuning-parameters"></a>リモート デスクトップ セッション ホストがチューニング パラメーター


### <a name="page-file"></a>ページのファイル

不足しているページ ファイル サイズは、システム コンポーネントまたはアプリでメモリ割り当てエラーを発生ことができます。 メモリ-コミット済みのパフォーマンス カウンターを使用すると、システムにコミットされた仮想メモリの量を監視します。

### <a name="antivirus"></a>ウイルス対策

システムの全体的なパフォーマンス、特に CPU 使用率に影響が大幅に RD セッション ホスト サーバー上のウイルス対策ソフトウェアをインストールします。 アクティブな監視の一覧から一時ファイルを保持するすべてのフォルダーを除外することは、サービスを提供するものと他のシステム コンポーネント特に生成を強くお勧めします。

### <a name="task-scheduler"></a>タスク スケジューラ

タスク スケジューラでは、さまざまなイベントのようにスケジュールされたタスクの一覧を確認することができます。 RD セッション ホスト サーバーの場合は、具体的にはアイドル状態で実行、ユーザー サインイン時またはセッションに接続および切断するように構成するタスクに重点を置くと便利です。 展開の詳細、ためこれらのタスクの多くが不要になります。

### <a name="desktop-notification-icons"></a>デスクトップの通知アイコン

デスクトップ上の通知アイコンは、非常に高価な更新メカニズムを持つことができます。 スタートアップの一覧からそれらを登録するコンポーネントを削除することで、またはアプリでそれらを無効にするシステム コンポーネントの構成を変更することで、通知を無効にする必要があります。 使用することができます**通知アイコンのカスタマイズ**をサーバーで使用可能な通知の一覧を確認します。

### <a name="remotefx-data-compression"></a>RemoteFX データの圧縮

グループ ポリシーを使用して、Microsoft RemoteFX の圧縮を構成することができます**コンピューターの構成&gt;管理用テンプレート&gt;Windows コンポーネント&gt;Remote Desktop Services&gt;リモートデスクトップ セッション ホスト&gt;リモート セッション環境&gt;RemoteFX データの圧縮を構成する**します。 3 つの値が考えられます。

-   **メモリの使用に最適化された**セッションあたりのメモリ量が少なくを消費しますが、最も低い圧縮率とそのため、最も高い帯域幅の消費します。

-   **メモリとネットワーク帯域幅のバランスが取れた**(セッションごとに約 200 KB) のメモリ消費量をわずか向上と帯域幅の消費が減ります。

-   **ネットワーク帯域幅の使用に最適化された**セッションごとに約 2 MB のネットワーク帯域幅の使用をさらに削減します。 この設定を使用する場合は、セッションの最大数を評価し、運用環境でサーバーに配置する前に、この設定では、そのレベルをテストする必要があります。

RemoteFX の圧縮アルゴリズムを使用しないように選択することもできます。 RemoteFX の圧縮アルゴリズムを使用しないように選択する、複数のネットワーク帯域幅を使用して、ぜひのみのネットワーク トラフィックを最適化するように設計されたハードウェア デバイスを使用している場合。 RemoteFX の圧縮アルゴリズムを使用しないように選択した場合でも、一部のグラフィック データが圧縮されます。

### <a name="device-redirection"></a>デバイスのリダイレクト

グループ ポリシーを使用してデバイスのリダイレクトを構成できます**コンピューターの構成&gt;管理用テンプレート&gt;Windows コンポーネント&gt;Remote Desktop Services&gt;リモート デスクトップセッション ホスト&gt;デバイスとリソースのリダイレクト**またはを使用して、**セッション コレクション**ボックスでサーバー マネージャーのプロパティ。

一般に、デバイスのリダイレクトは、データがクライアント コンピューター上のデバイスとサーバーのセッションで実行されているプロセスの間で交換されるため、ネットワーク帯域幅の RD セッション ホスト サーバーの接続を使用してどの程度が向上します。 増加のエクステントは、リダイレクトされたデバイスに対してサーバーで実行されているアプリケーションによって実行される操作の頻度の機能です。

プリンターのリダイレクトとプラグ アンド プレイ デバイスのリダイレクトはサインイン時の CPU 使用率も増加します。 2 つの方法でプリンターをリダイレクトすることができます。

-   一致するプリンター ドライバー ベースのリダイレクト時にプリンターのドライバーは、サーバーにインストールする必要があります。 Windows Server の以前のリリースでは、このメソッドを使用します。

-   Windows Server 2008 で導入された、Easy Print プリンター ドライバーのリダイレクトは、すべてのプリンターの一般的なプリンター ドライバーを使用します。

Easy Print メソッドは、接続時にプリンターのインストールの小さい CPU 使用率が生じるためお勧めします。 一致するドライバー メソッドは、スプーラー サービスをさまざまなドライバーを読み込む必要があるために、CPU 使用率の向上をによりします。 帯域幅の使用の Easy Print と若干強化されたネットワーク帯域幅の使用が、その他のパフォーマンス、管理容易性、および信頼性の利点をオフセットする大きなされません。

オーディオのリダイレクトは、ネットワーク トラフィックの流れをによりします。 オーディオのリダイレクトでは、高い CPU 消費率が通常マルチ メディア アプリを実行することもできます。

### <a name="client-experience-settings"></a>クライアント エクスペリエンスの設定

既定で、右側のエクスペリエンス、サーバーとクライアント コンピューター間のネットワーク接続の適合性に基づいて設定をリモート デスクトップ接続 (RDC) は自動的に選択します。 RDC 構成のままにすることをお勧めします。**接続の品質を自動的に検出**します。

高度なユーザーの場合は、RDC は、さまざまなリモート デスクトップ サービス接続のネットワーク帯域幅のパフォーマンスに影響する設定を制御を提供します。 使用して、次の設定にアクセスすることができます、**エクスペリエンス** タブでリモート デスクトップ接続または RDP ファイルに設定します。

任意のコンピューターに接続するときに、次の設定が適用されます。

-   **壁紙を無効にする**(無効にする壁紙: i:0) には、リダイレクトされた接続でデスクトップの壁紙は表示されません。 この設定は、イメージまたは描画のコストを大幅には、その他のコンテンツのデスクトップの壁紙が構成されている場合、帯域幅の使用を大幅に短縮できます。

-   **ビットマップのキャッシュ**(Bitmapcachepersistenable:i:1) この設定が有効にすると、セッションが表示されるビットマップのクライアント側のキャッシュを作成します。 帯域幅使用量に大幅な向上を提供し、それを常に有効にする (その他のセキュリティに関する考慮事項がある) 場合を除きします。

-   **ドラッグ中にウィンドウの内容を表示**(i:1: フル ウィンドウ ドラッグを無効にする)、ウィンドウがドラッグされると、すべてのコンテンツではなく、ウィンドウ フレームのみを表示することで帯域幅が削減されますこの設定を無効にします。

-   **メニューとウィンドウのアニメーション**(メニュー anims:i:1 の無効化および無効にするカーソルの設定: i:1)。これらの設定を無効にすると、メニューのフェード) など、カーソルのアニメーションを無効にして帯域幅が削減されます。

-   **フォント スムージング**(フォント スムージングを許可する: i:0) コントロール ClearType フォント描画をサポートします。 以降 Windows 8 または Windows Server 2012 を実行しているコンピューターに接続するを有効にするか、この設定を無効にする大きな影響を与えるに対するない帯域幅の使用。 ただし、Windows 7 および Windows 2008 R2 以前のバージョンを実行しているコンピューターでこの設定を有効に影響ネットワーク帯域幅の消費量が大幅にします。

次の設定は、Windows 7 およびそれ以前のバージョンのオペレーティング システムを実行しているコンピューターに接続するときにのみ適用されます。

-   **デスクトップ コンポジション**の Windows 7 または Windows Server 2008 R2 を実行するコンピューターにリモート セッションでのみこの設定がサポートされています。

-   **Visual スタイル**(テーマ: i:1 を無効にする) この設定を無効にすると、クラシックのテーマを使用するテーマ図面を効率化し、帯域幅が減少します。

使用して、**エクスペリエンス** タブで、リモート デスクトップ接続、ネットワーク帯域幅のパフォーマンスに影響する接続の速度を選択できます。 接続速度の構成に使用できるオプションを次に示します。

-   **接続の品質を自動的に検出**(接続の種類: i:7) この設定を有効にすると、リモート デスクトップ接続が接続の品質に基づいて最適なユーザー エクスペリエンスと、設定を自動的に選択します。 (この構成は推奨以降 Windows 8 または Windows Server 2012 を実行しているコンピューターに接続するときに)。

-   **モデム (56 Kbps)** (接続の種類: i:1) この設定は永続的なビットマップのキャッシュを有効にします。

-   **低速ブロード (256 Kbps ~ 2 Mbps)** (接続の種類: i:2) この設定は永続的なビットマップのキャッシュと visual スタイルを有効にします。

-   **(2 mbps の待機時間の長い、16 Mbps) の携帯電話/衛星放送**(接続の種類: i:3) この設定により、デスクトップ コンポジション、永続的なビットマップのキャッシュ、視覚スタイル、およびデスクトップの背景。

-   **高速ブロード バンド (2 Mbps – 10 Mbps)** (接続の種類: i:4) この設定は、デスクトップ コンポジションを有効に、ドラッグ、メニューとウィンドウのアニメーション、ビットマップの永続的なキャッシュ、visual スタイル、およびデスクトップの背景の中にウィンドウの内容を表示します。

-   **WAN (10 Mbps 以上と待機時間の長い)** (接続の種類: i:5) この設定は、デスクトップ コンポジションを有効に、ドラッグ、メニューとウィンドウのアニメーション、ビットマップの永続的なキャッシュ、visual スタイル、およびデスクトップの背景の中にウィンドウの内容を表示します。

-   **LAN (10 Mbps 以上)** (接続の種類: i:6) この設定は、デスクトップ コンポジションを有効に、ドラッグ、メニューとウィンドウのアニメーション、ビットマップの永続的なキャッシュ、テーマ、およびデスクトップの背景の中にウィンドウの内容を表示します。

### <a name="desktop-size"></a>デスクトップのサイズ

リモート デスクトップ接続で [表示] タブを使用するか、RDP の構成ファイル (desktopwidth:i:1152 および desktopheight:i:864) を使用して、リモート セッションのデスクトップのサイズを制御できます。 デスクトップのサイズが大きいほどが大きいほど、メモリと帯域幅消費そのセッションに関連付けられています。 現在の最大のデスクトップ サイズでは、4096 x 2048 です。
