---
title: IIS 10.0 のチューニング
description: パフォーマンス チューニングの Windows Server 16 上の IIS 10.0 web サーバーの recommmendations
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: landing-page
ms.author: DavSo; Ericam; YaShi
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 16ea5c857d99e8a69f528e81178911236341dbb8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59869853"
---
# <a name="tuning-iis-100"></a>IIS 10.0 のチューニング

インターネット インフォメーション サービス (IIS) 10.0 が Windows ServerÂ 2016 に含まれています。 IIS 8.5、IIS 7.0 のようなプロセス モデルを使用します。 カーネル モードの web ドライバー (http.sys) は、受信し、HTTP 要求をルーティングし、その応答のキャッシュからの要求を満たします。 URL のサブスペースのワーカー プロセスを登録し、http.sys は、適切なプロセス (または一連のアプリケーション プールのプロセス) に要求をルーティングします。

HTTP.sys は、接続管理と要求の処理を担当します。 要求を HTTP.sys キャッシュから提供されたか、さらに処理するためにワーカー プロセスに渡されます。 低コストで分離を提供する、複数のワーカー プロセスを構成できます。 方法の詳細については処理の動作には、次の図を参照してください。

![要求の処理では、iis 10.0](../../media/perftune-guide-iis-request-handling.png)

HTTP.sys には、応答のキャッシュが含まれています。 要求には、応答のキャッシュ内のエントリが一致すると、HTTP.sys カーネル モードから直接キャッシュ応答を送信します。 ASP.NET など、一部の web アプリケーション プラットフォームでは、カーネル モードのキャッシュにキャッシュされるすべての動的なコンテンツを有効にするためのメカニズムを提供します。 IIS 10.0 で静的ファイル ハンドラーは、http.sys で頻繁に要求されたファイルを自動的にキャッシュします。

Web サーバーには、カーネル モードとユーザー モード コンポーネントがあるために、両方のコンポーネントは最適なパフォーマンスをチューニングする必要があります。 そのため、IIS 10.0 を特定のワークロードのチューニングには、次の構成が含まれます。

-   HTTP.sys と関連付けられているカーネル モードのキャッシュ

-   ワーカー プロセスとアプリケーション プールの構成を含む、ユーザー モードの IIS

-   パフォーマンスに影響する特定のチューニング パラメーター

次のセクションでは、IIS 10.0 のカーネル モードとユーザー モードの側面を構成する方法について説明します。

## <a name="kernel-mode-settings"></a>カーネル モードの設定

HTTP.sys のパフォーマンスに関連する設定が 2 つのカテゴリに分類されます。 管理および接続と要求の管理をキャッシュします。 すべてのレジストリ設定は、次のレジストリ エントリの下に格納されます。

``` syntax
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters
```

**注**  HTTP サービスが既に実行されている場合、変更を有効にすることを再起動する必要があります。

・・・ 

## <a name="cache-management-settings"></a>キャッシュの管理設定

HTTP.sys を提供する利点の 1 つは、カーネル モード キャッシュです。 カーネル モードのキャッシュに応答する場合は、HTTP 要求の要求を処理するのにかかる CPU コストが大幅に減少するカーネル モードから完全に満たすことができます。 ただし、IIS 10.0 のカーネル モードのキャッシュは、物理メモリに基づいて、エントリのコストが占有しているメモリ。

使用している場合にのみ、キャッシュ内のエントリの使用をお勧めします。 ただし、エントリでは常に、物理メモリを消費して、エントリが使用されているかどうか。 (CPU、物理メモリ) の使用可能なリソースとワークロードを考慮して、エントリの有効期間にわたって cache (キャッシュからサービスを提供することの節約) とそのコスト (占有されている物理メモリ) 内の項目の有用性を評価する必要があります。要件。 HTTP.sys は、キャッシュが便利で積極的にアクセスされる項目は、web サーバーのパフォーマンスを向上させる特定のワークロード用の HTTP.sys キャッシュをチューニングすることによってのみを保持しようとします。

以下は、HTTP.sys カーネル モードのキャッシュのいくつかの便利な設定です。

-   **UriEnableCache**既定値。1

    0 以外の値を有効に、カーネル モードの応答やフラグメントをキャッシュします。 ほとんどのワークロードでは、キャッシュが、有効にしておく必要があります。 非常に低い応答とフラグメント キャッシュを予想される場合は、キャッシュを無効にすることを検討してください。

-   **UriMaxCacheMegabyteCount**既定値。0

    0 以外の値で、カーネル モードのキャッシュに使用可能な最大メモリ量を指定します。 既定値 0 は、有効なキャッシュに使用可能なメモリ量を自動的に調整するシステムにします。

    **注**最大値のみを設定するサイズを指定して、システムのセットの最大サイズまで拡大キャッシュできない場合があります。

    ・・・ 

-   **UriMaxUriBytes**既定値。 262144 バイト (256 KB)

    カーネル モード キャッシュ内のエントリの最大サイズ。 応答またはこれより大きいフラグメントはキャッシュされません。 十分なメモリがあれば、制限を増やすことを検討します。 メモリに制限が、複数の小さなを大規模なエントリを増やし、場合は、下限に役立つ場合があります。

-   **UriScavengerPeriod**既定値。120 秒

    HTTP.sys キャッシュは、スカベン ジャー、によって定期的にスキャンされ、スカベン ジャー スキャン間アクセスされていないエントリが削除されます。 大きな値にスカベン ジャー期間を設定すると、スカベン ジャー スキャンの数が少なくなりますが。 ただし、アクセス頻度の低い古いエントリがキャッシュに保持できるため、キャッシュ メモリ使用量が増加する可能性があります。 期間をすぎる設定低いがより頻繁にスカベン ジャー スキャンでは、そのフラッシュが多すぎるしチャーンをキャッシュできます。

## <a name="request-and-connection-management-settings"></a>要求と接続の管理設定

Windows Server 2016 では、HTTP.sys は、接続を自動的に管理します。 次のレジストリ設定は使用されなくなりました。

-   **MaxConnections**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\MaxConnections
    ```

-   **IdleConnectionsHighMark**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleConnectionsHighMark
    ```

-   **IdleConnectionsLowMark**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleConnectionsLowMark
    ```

-   **IdleListTrimmerPeriod**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleListTrimmerPeriod
    ```

-   **RequestBufferLookasideDepth**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\RequestBufferLookasideDepth
    ```

-   **InternalRequestLookasideDepth**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\InternalRequestLookasideDepth
    ```


## <a name="user-mode-settings"></a>ユーザー モードの設定

このセクションの設定では、IISÂ 10.0 ワーカー プロセスの動作に影響します。 これらの設定のほとんどは、次の XML 構成ファイルにあります。

%SystemRoot%\\system32\\inetsrv\\config\\applicationHost.config

それらを変更するのにには、Appcmd.exe、IIS 10.0 の管理コンソール、WebAdministration または IISAdministration PowerShell コマンドレットを使用します。 ほとんどの設定が自動的に検出されると、および IIS 10.0 ワーカー プロセスまたは web アプリケーション サーバーの再起動は不要です。 ApplicationHost.config ファイルの詳細については、次を参照してください。 [ApplicationHost.config 概要](http://www.iis.net/learn/get-started/planning-your-iis-architecture/introduction-to-applicationhostconfig)します。


## <a name="ideal-cpu-setting-for-numa-hardware"></a>NUMA ハードウェアの CPU、最適な設定

IIS 10.0 以降 Windows 2016 では、パフォーマンスと NUMA ハードウェアでのスケーラビリティを強化するために、スレッド プールのスレッドの自動の最適な CPU 割り当てをサポートします。 この機能は既定で有効になっているし、次のレジストリ キーを使用して構成できます。

``` syntax
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\InetInfo\Parameters\ThreadPoolUseIdealCpu
```

この機能を有効にすると、IIS スレッド マネージャーにより、現在の負荷に基づくすべての NUMA ノード内のすべての Cpu 間での IIS プールのスレッドを均等に分散する、最も効果的になります。 一般に、この既定の設定は NUMA ハードウェアの変更を維持することをお勧めします。

**注**  、CPU、最適な設定が異なるワーカー プロセス NUMA ノードの割り当て (numaNodeAssignment および numaNodeAffinityMode) で導入された[アプリケーション プールの CPU 設定](https://www.iis.net/configreference/system.applicationhost/applicationpools/add/cpu)します。 最適な CPU の設定は、IIS がそのスレッド プールのスレッドの分配する方法、ワーカー プロセス NUMA ノード設定の割り当てを決定する NUMA ノードでワーカー プロセスを開始中に影響します。

## <a name="user-mode-cache-behavior-settings"></a>ユーザー モードのキャッシュ動作の設定

このセクションでは、IISÂ 10.0 でキャッシュの動作に影響する設定について説明します。 ユーザー モードのキャッシュは、統合パイプラインによって発生するグローバル キャッシュ イベントをリッスンするモジュールとして実装されます。 ユーザー モードのキャッシュを完全に無効にするには、applicationHost.config で system.webServer/globalModules 構成セクションではインストールされているモジュールの一覧から FileCacheModule (cachfile.dll) モジュールを削除します。

**system.webServer/caching**

|属性|説明|Default|
|--- |--- |--- |
|有効|設定すると、ユーザー モードの IIS キャッシュを無効にします。 **False**します。 キャッシュ ヒット率が非常に小さいキャッシュのコード パスに関連付けられているオーバーヘッドを回避するには、完全にキャッシュを無効にすることができます。 ユーザー モードのキャッシュを無効にするには、カーネル モード キャッシュが無効にしません。|True|
|enableKernelCache|設定すると、カーネル モード キャッシュを無効にします。 **False**します。|True|
|maxCacheSize|IIS ユーザー モードのキャッシュ サイズをメガバイト単位で指定したサイズを制限します。 IIS では、使用可能なメモリによって既定値を調整します。 アクセス RAM または IIS のプロセス アドレス領域の量とファイルを頻繁のセットのサイズに基づく慎重に値を選択します。|0|
|MaxResponseSize|指定したサイズ以下のファイルをキャッシュします。 実際の値は、使用可能な RAM と、データ セット内の最大ファイルのサイズと数によって異なります。 大規模なキャッシュ、CPU 使用率、ディスク アクセス、および関連付けられている待機時間が、頻繁に要求されたファイルは削減できます。|262144|

## <a name="compression-behavior-settings"></a>圧縮動作の設定

IIS 7.0 からは、既定では、静的コンテンツを圧縮します。 また、動的なコンテンツの圧縮は既定で有効に、DynamicCompressionModule がインストールされている場合。 圧縮は、帯域幅使用率を削減は、CPU 使用率が増加します。 圧縮されたコンテンツは、可能であれば、カーネル モード キャッシュにキャッシュされます。 8.5 以降、IIS には、静的および動的なコンテンツを個別に制御する圧縮ことができます。 静的コンテンツは、通常、変更することは、GIF、または HTM ファイルなどのコンテンツを指します。 動的なコンテンツは通常、スクリプトや、ASP.NET ページは、サーバー上のコードによって生成されます。 静的または動的なとして、特定の拡張機能の分類をカスタマイズできます。

圧縮を完全に無効にするには、applicationHost.config で system.webServer/globalModules セクションのモジュールの一覧から StaticCompressionModule と DynamicCompressionModule を削除します。

**system.webServer/httpCompression**

|属性|説明|Default|
|--- |--- |--- |
|staticCompression EnableCpuUsage<br><br>staticCompression DisableCpuUsage<br><br>dynamicCompression EnableCpuUsage<br><br>dynamicCompression DisableCpuUsage|有効または、現在の割合の CPU 使用率が指定された制限を超えない場合は、圧縮を無効にします。<br><br>IIS 7.0 以降で圧縮が自動的に無効に安定した状態の CPU が増加するしきい値を無効にするとします。 圧縮は、CPU が有効にするしきい値を下回る場合に有効です。|50、100、50、および 90 それぞれ|
|ディレクトリ|静的ファイルの圧縮バージョンはで一時的に格納されているありキャッシュ ディレクトリを指定します。 頻繁にアクセスする場合に、システム ドライブには、このディレクトリの移動を検討してください。|%SystemDrive%\inetpub\temp\IIS Temporary Compressed Files|
|doDiskSpaceLimiting|制限が存在するかどうかディスク領域のすべての圧縮されたファイルが占有できるを指定します。 圧縮されたファイルで指定されている圧縮のディレクトリに格納されます、**ディレクトリ**属性。|True|
|maxDiskSpaceUsage|圧縮ディレクトリでは、圧縮されたファイルが使用するディスク領域のバイト数を指定します。<br><br>この設定は、すべての圧縮されたコンテンツの合計サイズが大きすぎる場合に増やす必要があります。|100 MB|

**system.webServer/urlCompression**

|属性|説明|Default|
|--- |--- |--- |
|doStaticCompression|静的コンテンツを圧縮するかどうかを指定します。|True|
|doDynamicCompression|動的なコンテンツが圧縮されているかどうかを指定します。|True|

**注**を持つ平均 CPU 使用率が低い IIS 10.0 を実行しているサーバーを検討してください、動的コンテンツの圧縮を有効にすると応答のサイズが大きい場合に特にです。 ベースラインからの CPU 使用率に影響を評価するテスト環境で最初に実行する必要があります。


### <a name="tuning-the-default-document-list"></a>既定のドキュメントの一覧のチューニング

既定のドキュメントのモジュールは、ディレクトリのルートの HTTP 要求を処理し、Index.htm Default.htm などの特定のファイルに対する要求に変換します。 平均すると、インターネット上のすべての要求の 25% を aroundÂ は既定のドキュメント パスを経由します。 これは、個々 のサイトが大幅に異なります。 HTTP 要求がファイル名を指定しない場合に、既定のドキュメントのモジュールは、ファイル システムで名ごとに許可されている既定のドキュメントの一覧を検索します。 これは、パフォーマンスに悪影響をコンテンツに達するには、ネットワーク ラウンド トリップまたはディスクにアクセスを行うが必要な場合に特にです。

既定のドキュメントを選択的に無効にしてとを軽減またはドキュメントの一覧の順序によって、オーバーヘッドを回避できます。 既定のドキュメントを使用して web サイトで使用される既定のドキュメント型のみを一覧を減らす必要があります。 さらに、一覧の順序にアクセスされる既定のドキュメントのファイル名と、最も頻繁に開始できるようにします。

選択的に、applicationHost.config に場所タグの内側で構成をカスタマイズすることで、またはコンテンツのディレクトリに直接 web.config ファイルを挿入することで、既定のドキュメントの動作を特定の Url に設定できます。 これにより、既定のドキュメントのみが必要と、正しいファイルを一覧の各 URL の名前を設定できるように、ハイブリッドのアプローチです。

既定のドキュメントを完全に無効にするには、applicationHost.config で system.webServer/globalModules セクションのモジュールの一覧から DefaultDocumentModule を削除します。

**system.webServer/defaultDocument**

|属性|説明|Default|
|--- |--- |--- |
|enabled|既定のドキュメントが有効になっていることを指定します。|True|
|&lt;ファイル&gt;要素|既定のドキュメントとして構成されているファイル名を指定します。|既定の一覧は、Default.htm、Default.asp、Index.htm、Index.html、Iisstart.htm、および Default.aspx です。|

## <a name="central-binary-logging"></a>中央のバイナリ ログ

何百もの個々 のグループの URL の書式設定されたログ ファイルを作成して、ディスクにログ データの書き込みのプロセスが、パフォーマンスを作成するため貴重な CPU とメモリ リソースを利用できるすばやくサーバー セッションにその下にある多数の URL のグループがある場合、スケーラビリティの問題。 一元的なバイナリ ログには、同時にそれを必要とする組織の詳細なログ データを提供する一方で、ログ記録に使用されるシステム リソースの量が最小限に抑えます。 バイナリ形式のログを解析するには、処理後のツールが必要です。

CentralBinary と設定を centralLogFileMode 属性を設定して中央のバイナリ ログを有効にすることができます、**有効になっている**属性を**True**します。 オフ、システム パーティションとシステムのアクティビティおよびログ記録アクティビティ間の競合を回避するために専用のログ ドライブには、中央のログ ファイルの場所の移動を検討してください。

**system.applicationHost/log**

|属性|説明|Default|
|--- |--- |--- |
|centralLogFileMode|サーバーのログ記録モードを指定します。 CentralBinary 中央のバイナリ ログを有効にするには、この値を変更します。|サイト|

**system.applicationHost/log/centralBinaryLogFile**

|属性|説明|Default|
|--- |--- |--- |
|enabled|中央のバイナリ ログが有効になっているかどうかを指定します。|False|
|ディレクトリ|ログ エントリの書き込み先のディレクトリを指定します。|%SystemDrive%\inetpub\logs\LogFiles|


## <a name="application-and-site-tunings"></a>アプリケーションとサイトのチューニング

次の設定は、アプリケーション プールとサイトのチューニングに関連します。

**system.applicationHost/applicationPools/applicationPoolDefaults**

|属性|説明|Default|
|--- |--- |--- |
|queueLength|HTTP.sys にアプリケーション プールの要求の数はキューに登録前に、今後の要求が拒否されたことを示します。 このプロパティの値を超えると、IIS は 503 エラーの後続の要求を拒否します。<br><br>この 503 エラーが発生した場合の待機時間の長いバック エンドのデータ ストアと通信するアプリケーションを増やすことを検討してください。|1000|
|enable32BitAppOnWin64|True の場合、64 ビット プロセッサを搭載したコンピューターで実行する 32 ビット アプリケーションを有効にします。<br><br>メモリ消費量が心配な場合は、32 ビット モードを有効にしてください。 ポインターのサイズと命令のサイズが小さいために、32 ビット アプリケーションは 64 ビット アプリケーションよりもメモリを使用します。 64 ビット コンピューターで 32 ビット アプリケーションを実行するための欠点は、ユーザー モード アドレス空間が 4 GB に制限されています。|False|

**system.applicationHost/sites/VirtualDirectoryDefault**

|属性|説明|Default|
|--- |--- |--- |
|allowSubDirConfig|IIS が検索の web.config ファイルのコンテンツのディレクトリを現在よりも低いレベル (True) または (False) の現在のレベルより低いコンテンツ ディレクトリの web.config ファイルを検索しないかどうかを指定します。 仮想ディレクトリのみで構成できるように、単純な制限事項に強制して IISÂ 10.0 できることを把握しない限り、  **/&lt;名前&gt;.htm**仮想ディレクトリには、見えない想定する必要があります、構成ファイルです。 追加のファイル操作をスキップしています、ランダムにアクセスされる静的コンテンツの非常に大規模な一連の web サイトのパフォーマンスが大幅に向上します。|True|

## <a name="managing-iis-100-modules"></a>IIS 10.0 モジュールを管理します。

IIS 10.0 がモジュール構造をサポートするために、複数のユーザー拡張可能なモジュールに組み込まれます。 この因子分解には、少額のコストがあります。 統合パイプラインは、各モジュールのモジュールに関連するすべてのイベント、モジュールを呼び出す必要があります。 かどうか、モジュールが行う必要がありますいずれかに関係なくこのような作業です。 特定の web サイトに関係のないすべてのモジュールを削除することで、CPU サイクルとメモリを節約できます。

単純な静的ファイル用に調整された web サーバーには、次の 5 つのモジュールのみが含まれます。UriCacheModule、HttpCacheModule、StaticFileModule、AnonymousAuthenticationModule、および HttpLoggingModule します。

ApplicationHost.config からモジュールを削除するには、モジュールに system.webServer/globalModules でモジュールの宣言を削除するだけでなく、system.webServer/handlers および system.webServer/modules のセクションからすべての参照を削除します。

## <a name="classic-asp-settings"></a>クラシック ASP の設定

クラシック ASP 要求の処理の主なコストには、ASP テンプレートに、要求された ASP スクリプトをコンパイルして、スクリプト エンジンでのテンプレートの実行で、スクリプト エンジンの初期化が含まれます。 テンプレートの実行コストは、要求された ASP スクリプトの複雑さに依存、IIS クラシック ASP モジュール キャッシュできるメモリとディスクの両方でメモリおよびキャッシュ テンプレート内のスクリプト エンジン (メモリ内テンプレート キャッシュがオーバーフローした) 場合のみでパフォーマンスが向上するにはCPU バインドのシナリオ。

次の設定は、クラシック ASP テンプレート キャッシュとスクリプト エンジンのキャッシュの構成を使用し、ASP.NET の設定には影響しません。

**system.webServer/asp/cache**

|属性|説明|Default|
|--- |--- |--- |
|diskTemplateCacheDirectory|ASP を使用してメモリ内キャッシュがオーバーフローした場合は、コンパイル済みのテンプレートを格納するディレクトリの名前。<br><br>推奨事項:頻繁にアクセスされるその他のコンテンツまたは頻繁でないディレクトリに設定する使用、たとえば、オペレーティング システムと IIS ログ、共有されていないドライブ。|%SystemDrive%\inetpub\temp\ASP Compiled Templates|
|maxDiskTemplateCacheFiles|ディスクにキャッシュできるコンパイル済み ASP テンプレートの最大数を指定します。<br><br>推奨事項:0x7FFFFFFF の最大値に設定します。|2000|
|scriptFileCacheSize|この属性は、メモリにキャッシュできるコンパイル済み ASP テンプレートの最大数を指定します。<br><br>推奨事項:少なくともアプリケーション プールによって提供される、頻繁に要求された ASP スクリプトの数だけいくつでも時に設定します。 可能であれば、多くの ASP テンプレートのメモリ制限を許可するように設定します。|500|
|scriptEngineCacheMax|メモリ内キャッシュに保持はスクリプト エンジンの最大数を指定します。<br><br>推奨事項:少なくともアプリケーション プールによって提供される、頻繁に要求された ASP スクリプトの数だけいくつでも時に設定します。 可能であれば、メモリの制限により、多くのスクリプト エンジンに設定します。|250|

**system.webServer/asp/limits**

|属性|説明|Default|
|--- |--- |--- |
|数|ASP が作成できる 1 プロセッサあたりのワーカー スレッドの最大数を指定します。 現在の設定が要求を処理はときにエラーが発生したり、CPU リソースの過小使用状況が発生すると、負荷を処理するための十分な場合に増加します。|25|

**system.webServer/asp/comPlus**

|属性|説明|Default|
|--- |--- |--- |
|executeInMta|設定**True** IIS、ASP コンテンツを提供中にエラーや障害が検出された場合。 これは、たとえば、各サイトが、独自のワーカー プロセスで実行される複数の分離されたサイトをホストする場合に発生します。 エラーは通常から COM + イベント ビューアーで報告します。 この設定は、ASP でマルチ スレッド アパートメント モデルです。|False|


## <a name="aspnet-concurrency-setting"></a>ASP.NET の同時実行の設定

### <a name="aspnet-35"></a>ASP.NET 3.5
既定では、ASP.NET は、サーバー上の安定した状態のメモリ消費を抑えるため、要求の同時実行を制限します。 高い同時実行アプリケーションは、全体的なパフォーマンスを向上させるためにいくつかの設定を調整する必要があります。 Aspnet.config ファイルでこの設定を変更することができます。

``` syntax
<system.web>
  <applicationPool maxConcurrentRequestsPerCPU="5000"/>
</system.web>
```

次の設定は、システム上のリソースを完全に使用すると便利です。

-   **maxConcurrentRequestPerCpu**既定値。5000

    この設定は、同時に実行されるシステム上の ASP.NET 要求の最大数を制限します。 既定値では、ASP.NET アプリケーションのメモリ消費量を減らす保守的です。 長い、同期 I/O 操作を実行するアプリケーションを実行するシステムでは、この制限を増やすことを検討します。 それ以外の場合、ユーザーは、既定の設定を使用する場合は、高負荷のキューの制限を超過したためキューまたは要求のエラーのため高待機時間を発生することができます。

### <a name="aspnet-46"></a>ASP.NET 4.6
MaxConcurrentRequestPerCpu 設定だけでなく、ASP.NET 4.7 は、非同期操作に大きく依存するアプリケーションでパフォーマンスを向上させるために設定を提供します。 Aspnet.config ファイルでは、設定を変更できます。

``` syntax
<system.web>
  <applicationPool percentCpuLimit="90" percentCpuLimitMinActiveRequestPerCpu="100"/>
</system.web>
```

-   **percentCpuLimit**既定値。90 の非同期要求では、(ハードウェアの機能) を超える大きな負荷がこのようなシナリオに、いくつかのスケーラビリティの問題が発生します。 問題は、非同期のシナリオでの割り当てを性質があるためです。 非同期操作の開始時にこれらの条件で割り当てが発生する、完了時に使用されるとします。 その時点では、オブジェクトがジェネレーション 1 または 2 に GC によって移動された修正 s 可能性もあります。 負荷の増加との増加が表示されますこのような場合は、要求/秒 (rps) 時点までにします。 そのポイントを渡して、GC に費やされた時間は問題になるを開始し、rps は dip を開始後、は、スケーリングの悪影響を与えます。 Cpu 使用率が percentCpuLimit 設定を超えると、問題が解決するには、要求は ASP.NET ネイティブ キューに送信されます。
-   **percentCpuLimitMinActiveRequestPerCpu**既定値。要求の数は負荷の高い方法では、100 CPU 帯域幅の調整 (percentCpuLimit) は基づいていません。 その結果、少しだけ CPU 負荷の高い要求が原因でバックアップをネイティブのキューの受信要求とは別に空にする方法がない可能性があります。 この problme を解決するためには、要求の最小数に制限で開始する前に処理されることを確認する percentCpuLimitMinActiveRequestPerCpu を使用できます。

## <a name="worker-process-and-recycling-options"></a>ワーカー プロセスとオプションのリサイクル

IIS ワーカー プロセスをリサイクルするためのオプションを構成し、介入を必要とするか、サービスまたはコンピューターをリセットせずに深刻な状況やイベントの実用的なソリューションを提供できます。 このような状況とイベントは、メモリ リーク、メモリ負荷の増加、または応答していないか、アイドル状態のワーカー プロセスが含まれます。 通常の状況では、オプションのリサイクルは必要ない場合がありますやリサイクルをオフにすることを頻繁に再利用システムを構成することができます。

属性を追加することによって、特定のアプリケーション プロセスのリサイクルを有効にした、**リサイクル/periodicRestart**要素。 リサイクル イベントは、メモリ使用量、固定数の要求を指定した期間など、いくつかのイベントによってトリガーできます。 ワーカー プロセスがリサイクルされるときにキューに置かれ、実行中の要求は削除され、新しい要求を処理する新しいプロセスが開始に同時にします。 **リサイクル/periodicRestart**要素は、アプリケーションごとに、次の表の各属性が、アプリケーションごとにパーティション分割されていることを意味します。

**system.applicationHost/applicationPools/ApplicationPoolDefaults/recycling/periodicRestart**

|属性|説明|Default|
|--- |--- |--- |
|memory|仮想メモリの消費がキロバイト単位で指定された制限を超えた場合にプロセスがリサイクルを有効にします。 これは、小規模、2 GB のアドレス空間がある 32 ビット コンピューターの有用な設定です。 メモリ不足のエラーにより失敗した要求の回避に役立ちます。|0|
|privateMemory|プライベート メモリの割り当ては、キロバイト単位で指定された制限を超える場合プロセスのリサイクルを有効にします。|0|
|requests|要求数の後にプロセスのリサイクルを有効にします。|0|
|time|指定した期間後にプロセスのリサイクルを有効にします。|29:00:00|


## <a name="dynamic-worker-process-page-out-tuning"></a>動的なワーカー プロセス ページ アウトのチューニング

Windows Server 2012 R2 以降、IIS (IIS 7 以降でも提供されており、terminate のオプション) だけでなくしばらくの間アイドル状態された後に中断するワーカー プロセスの構成のオプションを提供します。

アイドル状態のワーカー プロセス ページ アウトとアイドル状態のワーカー プロセスの終了の機能の両方の主な目的は、これはただ座って、リッスンしている場合でも、サイトは、多くのメモリを利用できるため、サーバーのメモリ使用率を節約するためにです。 サイトで使用されるテクノロジに応じて (静的コンテンツと ASP.NET の vs その他のフレームワーク) に使用されるメモリには任意の場所約 10 MB ~ 数百 Mb のつまり、サーバーが最も効果的な設定を見極める多くのサイトで構成されています。サイトのアクティブおよび保留中の両方のサイトのパフォーマンスを上げるが大幅にします。

詳細に進む前に可能性がありますが、メモリの制約がない場合のベストを単に決してを中断または終了するサイトを設定することに注意して保持する必要があります。 結局のところ、thereâ s でワーカーを終了しています。 ほとんどの値を処理、マシンの 1 つだけである場合。

**注** サイトなど、メモリ リークを使用したコードの不安定なコードが実行されるか、それ以外の場合に不安定なアイドル状態で終了するサイトに設定できるコードのバグを修正する代わりに簡便場合。 これは勧め、何かがで高速処理しより永続的なソリューションは、動作中にこの機能のクリーンアップ メカニズムとして使用する方がよい場合があります。\]

・・・ 

考慮すべきもう 1 つの要素されている場合、サイトが大量のメモリを使用してコンピューターがディスクにワーカー プロセスで使用されるデータを書き込む必要があるため、中断プロセス自体が、犠牲を伴います。 ワーカー プロセスがメモリの大きなチャンクを使用している場合、一時停止しはバックアップを起動するまで待機するためのコストよりも高価あります。

ワーカー プロセスの中断機能の最適なをするためには、各アプリケーション プールでサイトを確認し、決定を中断する必要があります、これが終了する必要があり、どの active 無期限にする必要があります。 各アクションと各サイトでは、理想的なタイムアウト時間を把握する必要があります。

理想的には、訪問者を 1 日が指定されているが中断または終了を構成するサイトを維持するアクティブなすべての時間を保証するのには不十分です。 これらは、1 日の一意の訪問者を 20 個のサイトでは、通常、またはそれ以下。 サイトのログ ファイルを使用してトラフィックのパターンを分析し、トラフィックの日次平均を計算できます。

特定のユーザーは、サイトに接続すると、通常状態を保ちに、少なくともしばらくの間、追加の要求を行うと、1 日あたり要求を考慮するためだけ反映しない可能性が正確に実際のトラフィック パターンに留意してください。 正確な読み取りを取得するには、要求間の平均時間を計算するのに、Microsoft Excel などのツールを使用することもできます。 次に、例を示します。

||[要求 URL]|要求時間|デルタ|
|--- |--- |--- |--- |
|1|/SourceSilverLight/Geosource.web/grosource.html|10:01||
|2|/SourceSilverLight/Geosource.web/sliverlight.js|10:10|0:09|
|3|/SourceSilverLight/Geosource.web/clientbin/geo/1.aspx|10:11|0:01|
|4|/lClientAccessPolicy.xml|10:12|0:01|
|5|/ SourceSilverLight/GeosourcewebService/Service.asmx|10:23|0:11|
|6|/SourceSilverLight/Geosource.web/GeoSearchServer...¦ します。|11:50|1:27|
|7|/rest/Services/CachedServices/Silverlight_load_la...¦|12:50|1:00|
|8|/rest/Services/CachedServices/Silverlight_basemap...¦ します。|12:51|0:01|
|9|rest/Services/DynamicService/Silverlight_basemap......。|12:59|0:08|
|10|/rest/Services/CachedServices/Ortho_2004_cache.as...|13:40|0:41|
|11|/rest/Services/CachedServices/Ortho_2005_cache.js|13:40|0:00|
|12|/rest/Services/CachedServices/OrthoBaseEngine.aspx|13:41|0:01|

ただし、困難な作業の合理的に適用するには、どのような設定を決定です。 ここでは、サイト、ユーザーから一連の要求を取得して上の表は、4 つの一意のセッションの合計が時間 4 時間で発生したことを示しています。 アプリケーション プールのワーカー プロセスの中断の既定の設定ではこれらのユーザーの 20 分間の既定のタイムアウトが発生したサイトのスピン アップ サイクル後に、サイトを終了するは。 これにより、ワーカー プロセスの中断の最適な候補時間のほとんどは、サイトがアイドル状態になったため、および一時停止しは、リソースを節約し、ほぼ瞬時に、サイトに到達することができます。

これに関する、最終的なと非常に重要な注意事項は、ディスクのパフォーマンスがこの機能の重要なことです。 中断とウェイク アップ プロセスは、大量のハード ドライブにデータを読み書きが含まれる、ため高速なディスクを使用してこれを強くお勧めします。 ソリッド ステート ドライブ (Ssd) が最適なこれは、強くお勧めしてに Windows ページファイルが格納されていることを確認する必要があります (SSD 上のオペレーティング システム自体がインストールされていない場合、オペレーティング システムの構成をそこにページファイルを移動する)。

かどうかを使用する、SSD かもをお勧め、ページファイルのサイズを修正するファイルのサイズを変更せずにページ アウト データの書き込みに対応します。 ページファイルのサイズを変更した場合に発生既定では、Windows が構成されているため、ページファイルにデータを格納する必要があるオペレーティング システムに基づいて、サイズを自動的に調整する必要があります。 固定サイズを設定してサイズを変更しないようにし、大幅にパフォーマンスを向上できます。

事前の固定ページ ファイル サイズを構成するには、理想的なサイズを計算する必要がありますサイトの数に依存するを中断、およびメモリの量を使用します。 平均値は 200 MB、アクティブなワーカー プロセスを中断は、サーバーに 500 のサイトがあるし、かどうか、ページング ファイルは以上である必要があります (200 \* 500) ページング ファイル (この例ではそのために基本 + 100 GB) の基本サイズを MB です。

**注**サイトが中断されると、つまり、ここではすべてのサイトが中断されている場合、メモリ使用量が約 3 GB、それぞれが約 6 MB が消費されます。 実際には、ただし、またそれらをすべて同時に中断とではないでしょう。

 
## <a name="transport-layer-security-tuning-parameters"></a>トランスポート層セキュリティのチューニング パラメーター

トランスポート層セキュリティ (TLS) の使用には、追加の CPU コストが課されます。 TLS の最も高価なコンポーネントでは、完全なハンドシェイクが伴うため、セッションの確立を確立するコストです。 再接続、暗号化、および復号化は、コストにも追加します。 TLS のパフォーマンスを高めるためには、次の操作を行います。

-   TLS セッションの HTTP keep-alive を有効にします。 これは、セッションの確立のコストを削減します。

-   セッションを再利用する適切な場合、特にキープ アライブ トラフィックでします。

-   選択的にページまたはサイト全体にではなく、必要のあるサイトの一部にのみ暗号化を適用します。

**注:**
-   大きなキーが複数のセキュリティを提供しますが、多くの CPU 時間も使用します。

-   すべてのコンポーネントを暗号化する必要はありません。 ただし、プレーンな HTTP および HTTPS の混在がページ上のすべてのコンテンツが安全である警告のポップアップにあります。

 
## <a name="internet-server-application-programming-interface-isapi"></a>インターネット サーバー アプリケーション プログラミング インターフェイス (ISAPI)

ISAPI アプリケーションには、特別なチューニング パラメーターは必要ありません。 プライベート ISAPI 拡張機能を記述する場合は、パフォーマンスとリソースの使用を書き込むことを確認します。

## <a name="managed-code-tuning-guidelines"></a>マネージ コードのチューニング ガイドライン

IIS 10.0 で統合パイプライン モデルでは、高度な柔軟性と拡張性を使用します。 ネイティブまたはマネージ コードで実装されているカスタム モジュールは、パイプラインに挿入できるか、既存のモジュールを置き換えることができます。 この拡張モデルは、使いやすさとわかりやすくするためには、注意が必要グローバル イベントにフックする新しいマネージ モジュールを挿入する前にします。 マネージ コードのグローバルなマネージ モジュールは、静的ファイル要求も含めて、すべての要求に接触している必要がありますを追加します。 カスタム モジュールは、ガベージ コレクションなどのイベントを受けやすくなります。 さらに、カスタム モジュールは、ネイティブおよびマネージ コードの間でデータのマーシャ リングのための大幅な CPU コストを追加します。 可能であれば、マネージ モジュールの managedHandler に前提条件を設定してください。

コールド起動パフォーマンスの向上を取得するには、ウォーム アップ アプリケーションを ASP.NET web サイトまたは利用して IIS アプリケーションの初期化の機能をプリコンパイルすることを確認します。

セッション状態が必要でない場合は、無効にすること、各ページを確認します。

多くの I/O バインド操作でがある場合、はるかに優れたスケーラビリティを提供する関連する Api の非同期バージョンを使用しようとします。

出力キャッシュを正しく使用することも、web サイトのパフォーマンスが向上されます。

分離モード (1 サイトあたり 1 つのアプリケーション プール) での ASP.NET スクリプトが含まれている複数のホストを実行すると、メモリ使用量を監視します。 アプリケーション プールの同時実行の必要な数のサーバーに十分な RAM があることを確認します。 複数の分離プロセスではなく複数のアプリケーション ドメインの使用を検討してください。


## <a name="other-issues-that-affect-iis-performance"></a>その他の問題が IIS のパフォーマンス

次の問題は、IIS のパフォーマンスに影響します。

-   キャッシュに対応していないフィルターのインストール

    HTTP キャッシュ対応するフィルターのインストールでは、パフォーマンスの低下につながります IIS のキャッシュを完全に無効にするとします。 IISÂ 6.0 の前に記述されている ISAPI フィルターには、この動作を可能性があります。

-   Common Gateway Interface (CGI) 要求

    パフォーマンス上の理由から、IIS で要求を処理する CGI アプリケーションの使用は推奨されません。 頻繁に作成および CGI プロセスを削除するには、かなりのオーバーヘッドが含まれます。 ISAPI アプリケーション スクリプトや ASP または ASP.NET のスクリプトは、FastCGI を使用してより適切な型が含まれます。 分離は、これらの各オプションを使用できます。

# <a name="see-also"></a>関連項目
- [Web Server のパフォーマンス チューニング](index.md) 
- [HTTP 1.1/2 のチューニング](http-performance.md)
