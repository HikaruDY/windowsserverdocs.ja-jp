---
title: 能力とパフォーマンス チューニング
description: Windows Server のバランス電源プランのチューニング プロセッサの電源管理 (PPM)
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Qizha;TristanB
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 4ad58e9b477f61844dedd9f6638efb12f1a96500
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/07/2019
ms.locfileid: "66811570"
---
# <a name="power-and-performance-tuning"></a>電源とパフォーマンスのチューニング

エネルギー効率がますます重要に企業とデータ センター環境で、構成オプションの組み合わせにトレードオフの別のセットを追加します。

Windows Server 2016 は、幅広い顧客のワークロードの最小のパフォーマンスに与える影響の優れたエネルギー効率の最適化されます。 [Windows Server バランス電源のプランのプロセッサの電源管理 (PPM) チューニング](processor-power-management-tuning.md)で Windows Server 2016 では、既定のパラメーターのチューニングに使用するワークロードについて説明し、カスタマイズされたチューニングに関する推奨事項を提供します。

このセクションでは、エネルギー効率のトレードオフ、サーバーの既定の電源設定を調整する必要がある場合を情報に基づいて決定するために展開します。 ただし、サーバー ハードウェアとワークロードの大部分では、Windows Server 2016 を実行するときに、管理者の電源チューニングは不要です。

## <a name="calculating-server-energy-efficiency"></a>サーバーのエネルギー効率を計算します。

エネルギーを節約するため、サーバーをチューニングする場合は、パフォーマンスも考慮する必要があります。 チューニングは、パフォーマンス、能力、過剰な量のことがありますに影響します。 可能な調整ごとに、power 予算とのパフォーマンス目標、トレードオフが許容されるかどうかを判断するを検討してください。

能力とパフォーマンスの情報が組み込まれている便利なメトリックのサーバーのエネルギー効率の比率を計算することができます。 エネルギー効率は、一定の時間中に必要な平均電力に行われる作業の比率です。

![エネルギー効率の数式](../../media/perftune-guide-power-formula.png)

このメトリックを使用して、能力とパフォーマンスのトレードオフに該当する実際的な目標を設定することができます。 これに対し、データ センター全体の 10% 省エネの目標は、パフォーマンス、またはその逆に、対応する効果をキャプチャが失敗します。

同様に、5%、10% より高いエネルギー消費量では、その結果、パフォーマンスを向上するサーバーをチューニングする場合、合計の結果は可能性があります。 またはビジネスの目標の許容できない場合があります。 エネルギー効率性のメトリックでは、情報に基づく意思決定を行うだけで電源またはパフォーマンスのメトリックよりをできるようにします。

## <a name="measuring-system-energy-consumption"></a>システムのエネルギー消費量を測定します。

エネルギー効率のサーバーをチューニングする前に、ベースラインの電力測定を確立する必要があります。

サーバーに必要なサポートがある場合は、パフォーマンス モニターを使用して、システム レベルのエネルギー消費量を表示する使用状況測定と Windows Server 2016 の機能を予算の電源を使用できます。

サーバーが使用状況測定のサポートと、予算は、確認するかどうかを判断する方法の 1 つ、 [Windows Server Catalog](http://www.windowsservercatalog.com)します。 サーバー モデルは、Windows ハードウェア認定プログラムで新しい拡張電源管理資格条件を満たしている場合、使用状況測定と予算の機能をサポートするために保証されます。

サポートの使用状況測定をチェックするもう 1 つの方法では、パフォーマンス モニターのカウンターを手動で探します。 パフォーマンス モニターを開き、選択**カウンターの追加**を見つけて、**電源メーター**カウンター グループ。

電力メーターの名前付きインスタンスというラベルの付いたボックスに表示**選択したオブジェクトのインスタンス**使用状況測定、プラットフォームがサポートされます。 **Power**の単位はワットの電力を示すカウンターが、選択したカウンター グループに表示されます。 電源データ値の正確な派生が指定されていません。 たとえば、瞬間的な電力または一定の期間の平均電力可能性があります。

サーバー プラットフォームが使用状況測定をサポートしていない場合は、システム電源の描画または電力の消費量を測定する、電源の入力に接続されている物理的な使用状況測定デバイスを使用することができます。

ベースラインを確立するには、負荷の行を生成する 100% (最大のスループット) をアイドル状態からのさまざまなシステム負荷ポイントで必要な平均電力を測定する必要があります。 次の図は、3 つのサンプル構成の読み込みの行を示しています。

![サンプルの読み込みの行](../../media/perftune-guide-sample-loadlines.png)

評価し、パフォーマンスを比較する負荷の行を使用でき、構成の電力消費量がすべてのポイントを読み込みます。 この例では簡単、最適な構成を参照してください。 ただし、簡単にありますシナリオで負荷の高いワークロードの最適な 1 つの構成と、軽いワークロードのいずれかに最適です。

最適な構成を選択して、ワークロードの要件を十分に理解する必要があります。 起動時の構成が見つかったら、それが常に残ること最適なと仮定しないでください。 システム使用率と電力消費を定期的に、ワークロード、ワークロード レベル、またはサーバー ハードウェアの変更後を測定する必要があります。

## <a name="diagnosing-energy-efficiency-issues"></a>エネルギー効率性の問題を診断します。

**PowerCfg.exe**サーバーのアイドル状態のエネルギー効率を分析するために使用できるコマンド ライン オプションをサポートしています。 PowerCfg.exe でを実行すると、 **/energy**オプション、潜在的なエネルギー効率性の問題を検出するために 60 秒間テストを実行します。 ツールは、現在のディレクトリに単純な HTML レポートを生成します。

> [!Important]
> 正確な分析のために、実行する前に、ローカルのすべてのアプリが閉じられたことを確認します**PowerCfg.exe**します。 

タイマーのティック率が不足している電源管理をサポートし、過剰な CPU 使用率がによって検出された動作の問題のいくつかのドライバーの短縮、 **powercfg/energy**コマンド。 このツールは、特定し、大規模なデータ センターでの大幅なコスト削減になる可能性があります、電源管理の問題を修正する簡単な方法を提供します。

PowerCfg.exe の詳細については、次を参照してください。[システムのエネルギー効率の評価に PowerCfg を使用して](https://msdn.microsoft.com/windows/hardware/gg463250.aspx)します。

## <a name="using-power-plans-in-windows-server"></a>Windows Server での電源プランの使用

Windows Server 2016 では、異なる一連のビジネス ニーズを満たすよう設計された 3 つの組み込みの電源プランを持ちます。 これらのプランでは、電源やパフォーマンスの目標を満たすためにサーバーをカスタマイズするための簡単な方法を提供します。 次の表は、計画について説明し、各計画を使用するための一般的なシナリオの一覧、各プランの実装の詳細については。

| **計画** | **説明** | **一般的な適用可能なシナリオ** | **実装の要点** |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 分散 (推奨) | 既定の設定。 最小限のパフォーマンスに与える影響の優れたエネルギー効率を対象とします。 | 一般コンピューティング | 要求時に容量と一致します。 エネルギーを削減する機能は、能力とパフォーマンスを分散します。 |
| 高パフォーマンス | 高エネルギー消費量を犠牲にパフォーマンスが向上します。 電源と営業経費と信頼性に関する考慮事項、熱の制限事項が適用されます。 | アプリの低待機時間およびプロセッサ パフォーマンスの変化を受けアプリ コード | プロセッサは、最高のパフォーマンス状態 ("turbo"周波数を含む) で常にロックされます。 すべてのコアが保留中ルーティングではありません。 温度の出力は、大きな可能性があります。 |
| 省電力 | エネルギーを節約し、運用コストを削減してパフォーマンスを制限します。 十分なことを確認するための十分なテストはなしをお勧めしません。 | 電力の限られた予算や温度の制約と配置 | プロセッサの最大値 (サポートされている) 場合は、割合頻度の上限を設定し、その他の省電力機能を有効にします。 |


交流 (AC) の Windows にこれらの電源プランに存在直流 (DC) 電源システムでは、そのサーバーが AC 電源を常に使用するいると仮定されます。

電源プランと電源ポリシー構成の詳細については、次を参照してください。 [Windows の電源ポリシー構成と展開](https://msdn.microsoft.com/windows/hardware/gg463243.aspx)します。

> [!Note]
> 一部のサーバーのメーカーでは、BIOS 設定で使用できる、独自の電源管理オプションがあります。 場合は、オペレーティング システムでは、電源管理を制御することはありません、Windows の電源プランの変更は影響しませんシステムの能力とパフォーマンス。

## <a name="tuning-processor-power-management-parameters"></a>プロセッサの電源管理のパラメーターのチューニング

各電源プランでは、基になる多数の電源管理のパラメーターの組み合わせを表します。 組み込み型プランは、さまざまなワークロードとシナリオに対応する推奨設定の 3 つのコレクションです。 ただし、これらのプランはすべての顧客のニーズを満たしていないことが認識しています。

次のセクションには、次の 3 つの組み込み型プランにより対処されない目標を達成するいくつか特定のプロセッサの電源管理パラメーターを調整する方法について説明します。 幅広い power パラメーターを理解する必要がある場合は、次を参照してください。 [Windows の電源ポリシー構成と展開](https://msdn.microsoft.com/windows/hardware/gg463243.aspx)します。

## <a name="processor-performance-boost-mode"></a>プロセッサ パフォーマンスの向上モード

Intel Turbo Boost および AMD Turbo コア テクノロジは便利ですが、ときに、追加のパフォーマンスを実現するためにプロセッサの機能 (つまり、システムが高い読み込みます)。 ただし、この機能では、Windows Server 2016 の使用と特定のプロセッサの実装では、電源ポリシーに基づく Turbo テクノロジを構成するために CPU コア エネルギーの消費量が増加します。

すべての Intel と AMD プロセッサの高パフォーマンス電源プランの Turbo が有効になり、省電力電源プランを無効になっています。 P 状態ベースの頻度を従来の管理に依存するシステムでバランス電源プランの場合、プラットフォームは、EPB 登録をサポートしている場合にのみ Turbo は既定で有効にします。

> [!Note]
> EPB レジスタは、Intel Westmere と以降のプロセッサでのみサポートされます。

Intel Nehalem および AMD プロセッサを P 状態ベースのプラットフォームで既定で Turbo が無効です。 ただし、システムでは、コラボレーション プロセッサ パフォーマンス コントロール (CPPC)、これはオペレーティング システムとハードウェア (ACPI 5.0 で定義されている) の間の通信のパフォーマンスの別の新しいモードをサポートする場合 Turbo が関与すること場合 Windows オペレーティング システムシステムは、最高レベルのパフォーマンスを実現するためのハードウェアを動的に要求します。

有効または Turbo Boost 機能を無効にする、管理者または既定のパラメーター設定の選択した電源プラン、プロセッサのパフォーマンス向上モード パラメーターを構成する必要があります。 プロセッサ パフォーマンスの向上のモードは、表 5 に示すように、5 つの許容値を持ちます。

P 状態ベースのコントロールの選択は無効になっている、有効 (Turbo はハードウェアに利用可能な標準のパフォーマンスが要求されるたびに)、および効率的 (Turbo は EPB レジスタが実装されている場合にのみ使用できます)。

CPPC ベースのコントロールの選択は無効になっている、効率的な有効になっている (Windows は、提供する Turbo の正確な量を指定します、)、アグレッシブな (「最高のパフォーマンス」を Windows が要求 Turbo を有効にする)。

Windows Server 2016 では Boost モードの既定値は 3 です。

| **名前** | **P 状態ベースの動作** | **CPPC 動作** |
|--------------------------|------------------------|-------------------|
| 0 (無効) | Disabled | Disabled |
| 1 (有効)。 | 有効 | 効率的な有効になっています。 |
| 2 (アグレッシブな) | 有効 | アグレッシブです |
| 3 (効率的な有効) | 効率的 | 効率的な有効になっています。 |
| 4 (効率的なアグレッシブな) | 効率的 | アグレッシブです |

 
次のコマンドが、現在の電源プランのプロセッサ パフォーマンスの向上のモードを有効にする (GUID のエイリアスを使用して、ポリシーの指定)。

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PERFBOOSTMODE 1
Powercfg -setactive scheme_current
```

> [!Important]
> 実行する必要があります、 **powercfg setactive**コマンドを新しい設定を有効にします。 サーバーを再起動する必要はありません。

現在選択されているプラン以外の電源プランには、この値を設定することができます、スキームなどのエイリアスを使用して\_最大 (省電力)、スキーム\_MIN (高パフォーマンス) とスキーム\_スキームの代わりに、バランス(バランス)\_現在します。 "現在"のスキーム - setactive powercfg のコマンドは、その電源プランを有効にする目的の別名で以前表示を置き換えます。

たとえば、省電力プランで Boost モードを調整してその省電力、次のコマンドを実行して、現在のプランを示します。

``` syntax
Powercfg -setacvalueindex scheme_max sub_processor PERFBOOSTMODE 1
Powercfg -setactive scheme_max
```

## <a name="minimum-and-maximum-processor-performance-state"></a>最小値と最大のプロセッサのパフォーマンス状態

プロセッサは、パフォーマンスの状態 (P 状態) の間で非常に短時間に変更を要求する一致サプライ、必要に応じて、パフォーマンスを実現および可能な場合のエネルギーを節約します。 サーバーに特定の高パフォーマンスまたは最小電力消費量の要件がある場合は、構成を検討する可能性があります、**最小プロセッサのパフォーマンス状態**パラメーターまたは**プロセッサの最大のパフォーマンス状態**パラメーター。

値、**最小プロセッサのパフォーマンス状態**と**最大プロセッサのパフォーマンス状態**パラメーターは範囲 0 ~ 内の値で、プロセッサの最大周波数の割合として表されます。100。

サーバーは、非常に短い待機時間、インバリアントの CPU の周波数 (たとえば、反復可能なテスト用)、または最高のパフォーマンス レベルを必要とする場合は、下位のパフォーマンス状態への切り替えプロセッサしない可能性があります。 このようなサーバーの場合は、次のコマンドを使用して 100% 以上のプロセッサ パフォーマンスの状態の上限を設定できます。

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PROCTHROTTLEMIN 100
Powercfg -setactive scheme_current
```

サーバーは、電力消費の削減を必要とする場合は、最大の割合でプロセッサのパフォーマンス状態の上限を設定します。 たとえば、次のコマンドを使用してその最大の頻度の 75% にプロセッサを制限できます。

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PROCTHROTTLEMAX 75
Powercfg -setactive scheme_current
```

> [!Note]
> 最大の割合でプロセッサのパフォーマンスを制限することには、プロセッサのサポートが必要です。 このようなサポートが存在するかどうかを判断するプロセッサのマニュアルまたはパフォーマンス モニター カウンターを表示 **% の最大周波数**で、**プロセッサ**グループのかどうかは、頻度の上限 が参照してください適用されます。

## <a name="processor-performance-increase-and-decrease-of-thresholds-and-policies"></a>プロセッサのパフォーマンスが向上し、しきい値およびポリシーの減少

プロセッサ パフォーマンスの状態を増加または減少速度は、複数のパラメーターによって制御されます。 次の 4 つのパラメーターは、最も目立つの影響を与えます。

-   **プロセッサ パフォーマンスの向上しきい値**プロセッサのパフォーマンスの状態が増加する上記の使用率値を定義します。 大きな値には、アクティビティの増加への応答でのパフォーマンス状態の増加の速度が低下します。

-   **プロセッサ パフォーマンスの低下しきい値**以下の使用率値プロセッサのパフォーマンスの状態が少なくなりを定義します。 大きな値では、パフォーマンスの状態のアイドル時間中の減少の速度が上がります。

-   **プロセッサ パフォーマンスの向上のポリシーとプロセッサのパフォーマンスが低下**ポリシーを決定するパフォーマンスの状態は、変更が発生したときに設定する必要があります。 「1 つ」のポリシーは、次の状態が選択されますを意味します。 "Rocket"では、最大値または最小の電源のパフォーマンスの状態を意味します。 「理想的な」能力とパフォーマンスのバランスを見つけようとします。

など、サーバーは、まだアイドル時間中、低電力を享受したいときに非常に短い待機時間を必要とする場合は quicken 負荷の増加はすべてのパフォーマンスの状態が向上と負荷がダウンした場合、減少速度の遅い可能性があります。 次のコマンドは、高速状態増加が"rocket"増加ポリシーを設定し、"Single"減少ポリシーを設定します。 増減のしきい値は、それぞれ 10、および 8 に設定されます。

``` syntax
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFINCPOL 2
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFDECPOL 1
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFINCTHRESHOLD 10
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFDECTHRESHOLD 8
Powercfg.exe /setactive scheme_current
```

## <a name="processor-performance-core-parking-maximum-and-minimum-cores"></a>プロセッサ パフォーマンス コアを最大と最小のコア パーキング

コア パーキングでは、Windows Server 2008 R2 で導入された機能です。 プロセッサの電源管理 (PPM) エンジンと、スケジューラは連携して、スレッドの実行に使用できるコアの数を動的に調整します。 PPM エンジンは、スケジュールはスレッドのコアの最小数を選択します。

一般に保留されているコアには、スケジュールされたすべてのスレッドがないと、割り込み、Dpc、またはその他の厳密に関連付けられている所与の作業が処理していない場合に非常に低電力状態にドロップされます。 残りのコアでは、ワークロードの残りの部分を担当します。 コア パーキングについて説明は、使用率が低いときにエネルギー効率を高める可能性があることができます。

ほとんどのサーバーは、既定のコア パーキング動作は、スループットとエネルギー効率の適度なバランスを提供します。 プロセッサ、コア パーキングについて説明が表示されない場合ほどメリット汎用的なワークロードで、既定で無効にできます。

使用して保管するに使用できるコアの数を制御するには、サーバーに特定のコア パーキング要件がある場合、**プロセッサ パフォーマンス コア パーキング最大コア**パラメーターまたは**プロセッサパフォーマンス コア 最小コア パーキング**Windows Server 2016 でのパラメーター。

コア パーキングは適していません常に 1 つのシナリオが Cpu の NUMA ノード内の重要なサブセットに関連付けられた 1 つまたは複数のアクティブなスレッドがある場合 (つまり、1 つ以上の CPU、ノードの Cpu のセット全体よりも小さいかが)。 コア パーキング アルゴリズムが unpark にコアを選択するときに (負荷の度合いの増加が発生したと仮定した場合、)、unpark に関連付けられている所与のアクティブなサブセット (またはサブセット) 内のコアを常に選択可能性があり、したがってが unparking 最終的にコアを実際にはできません使用されます。

これらのパラメーターの値は、0 ~ 100 の範囲のパーセンテージです。 **プロセッサ パフォーマンス コア パーキング最大コア**(スレッドの実行に使用可能) に unparked できるコアの最大割合を制御するパラメーター、いつでも中に、**プロセッサ パフォーマンスのコア パーキング最小コア数**パラメーターは、保留中ルーティングできるコアの最小割合を制御します。 コア パーキングをオフに設定、**プロセッサ パフォーマンス コア パーキング最小コア**パラメーターは、次のコマンドを使用して 100% にします。

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor CPMINCORES 100
Powercfg -setactive scheme_current
```

スケジュール可能なコアの数を 50% の最大数を減らすためには、設定、**プロセッサ パフォーマンス コア パーキング最大コア**パラメーターを 50 として次のとおりです。

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor CPMAXCORES 50
Powercfg -setactive scheme_current
```

## <a name="processor-performance-core-parking-utility-distribution"></a>プロセッサ パフォーマンスのコア パーキング ユーティリティの配布

ユーティリティの分布では、一部のワークロードの電力効率を向上させるために設計された Windows Server 2016 でのアルゴリズムの最適化です。 (つまり、Dpc、割り込み、または厳密アフィニティを設定したスレッド)、ページファイルの CPU アクティビティを追跡し、すべて unparked コア間で移動可能な作業を均等に分散できることを前提として、各プロセッサの今後の作業を予測します。

ユーティリティの配布は、いくつかのプロセッサに対して、バランス電源プランの既定で有効です。 かなり安定した状態にあるワークロードの要求された CPU の周波数を下げることと、プロセッサの電力消費を削減できます。 ただし、ユーティリティの配布が必ずしも適切なアルゴリズムの選択のワークロードの高使用率の急激な増加対象である、または、ワークロード、迅速かつランダムにシフト プロセッサ間でのプログラムの

このようなワークロードでは、次のコマンドを使用して、ユーティリティの配布を無効にするお勧めします。

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor DISTRIBUTEUTIL 0
Powercfg -setactive scheme_current
```

## <a name="see-also"></a>関連項目
- [サーバー ハードウェアのパフォーマンスに関する考慮事項](../index.md)
- [サーバー ハードウェアの電源に関する考慮事項](../power.md)
- [プロセッサの電源管理チューニング](processor-power-management-tuning.md)
- [推奨されるバランスのプラン パラメーター](recommended-balanced-plan-parameters.md)
