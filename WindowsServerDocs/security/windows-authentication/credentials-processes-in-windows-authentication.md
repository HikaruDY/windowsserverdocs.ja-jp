---
title: "Windows 認証で資格情報の処理"
description: "Windows Server のセキュリティ"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-windows-auth
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 48c60816-fb8b-447c-9c8e-800c2e05b14f
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 52d50a1bb6bfbe9d35146f362a2a5184df0a6504
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
# <a name="credentials-processes-in-windows-authentication"></a>Windows 認証で資格情報の処理

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

IT プロフェッショナル向けのこのリファレンス トピックでは、Windows 認証で資格情報を処理する方法について説明します。

Windows 資格情報の管理は、オペレーティング システムが、サービスまたはユーザーから資格情報を受け取り、認証のターゲットに将来のプレゼンテーションについては、その情報をセキュリティで保護するプロセスです。 ドメインに参加しているコンピューターでは、場合は、認証のターゲットは、ドメイン コントローラーはします。 認証で使用される資格情報は、何らかの形式の証明書、パスワード、PIN などの信頼性の証拠をユーザーの ID を関連付けるデジタル ドキュメントです。

既定では、Windows 資格情報は、ローカル コンピューター上のセキュリティ アカウント マネージャー (SAM) データベースに対して、または Active Directory ドメインに参加しているコンピューターで、Winlogon サービスを通じてに対して検証されます。 ログオン ユーザー インターフェイスまたはプログラムを使用してアプリケーション プログラミング インターフェイス (API) 認証ターゲットを表示する経由でユーザーの入力による資格情報が収集されます。

ローカルのセキュリティ情報が下のレジストリに格納されている**\security**します。 保存された情報には、ポリシーの設定、既定のセキュリティ値、およびアカウントについては、キャッシュされたログオン資格情報などが含まれます。 書き込み禁止になっているが、SAM データベースのコピーはここでは、格納もされます。

次の図に必要なコンポーネントおよびパスをユーザーまたはプロセスが成功したログオンの認証資格情報がかかるシステムを経由します。

![資格情報は、必要なコンポーネントとパスを示す図は、ユーザーまたはプロセスが成功したログオンの認証にシステムを移動できます。](../media/credentials-processes-in-windows-authentication/AuthN_LSA_Architecture_Client.gif)

次の表では、ログオンの時点で、認証プロセスで資格情報を管理する各コンポーネントについて説明します。

**すべてのシステムに対して認証コンポーネント**

|コンポーネント|説明|
|-------|--------|
|ユーザーのログオン|Winlogon.exe は、セキュリティで保護されたユーザーの操作の管理を担当する実行可能ファイルです。 Winlogon サービスは、セキュリティで保護されたデスクトップ (ログオン UI) に Secur32.dll を介してローカル セキュリティ機関 (LSA) にユーザーの操作によって収集、資格情報を渡すことによって Windows オペレーティング システムの場合、ログオン プロセスを開始します。|
|アプリケーションのログオン|アプリケーションまたはサービスのログオン対話型ログオンを必要としません。 ほとんどのプロセスが Ksecdd.sys を使用して、サービスなどの起動時に開始されたプロセスがカーネル モードで実行する一方、Secur32.dll を使用してユーザー モードで実行ユーザーが開始します。<br /><br />ユーザー モードとカーネル モードの詳細については、このトピックの「アプリケーションとユーザー モードまたはサービスとカーネル モードを参照してください。|
|Secur32.dll|認証の基盤を処理する複数の認証プロバイダー。|
|Lsasrv.dll|セキュリティ ポリシーを適用して、LSA のセキュリティ パッケージ マネージャーとして機能する LSA サーバー サービス。 LSA には、どのプロトコルを成功させるのには決定した後、NTLM または Kerberos プロトコルを選択し、ネゴシエート関数が含まれています。|
|セキュリティ サポート プロバイダー|1 つまたは複数の認証プロトコルを個別に呼び出すことができるプロバイダーのセット。 カスタム プロバイダーが書き込むことができ、プロバイダーの既定のセットは、Windows オペレーティング システムのバージョンごとに変更できます。|
|Netlogon.dll|Net Logon サービスによって実行されるサービスは次のとおりです。<br /><br />-コンピューターのセキュリティで保護されたチャネルにではなく Schannel と混同しないでください) をドメイン コントローラーを維持します。<br />-ドメイン コントローラーにセキュリティで保護されたチャネルを通じて、ユーザーの資格情報を通過し、ドメインのセキュリティ識別子 (Sid) と、ユーザーのユーザー権利を返します。<br />-発行サービスのリソース レコードでドメイン ネーム システム (DNS) および DNS 名のドメイン コントローラーのインターネット プロトコル (IP) アドレスに解決を使用しています。<br />-プライマリ ドメイン コントローラー (Pdc) およびバックアップ ドメイン コントローラーの同期に関するリモート プロシージャ コール (RPC) に基づくレプリケーション プロトコルを実装します。|
|Samsrv.dll|セキュリティ アカウント マネージャー (SAM) がローカル セキュリティ アカウントを保存するには、ローカルに保存されたポリシーを強制し、API をサポートします。|
|レジストリ|レジストリには、SAM データベース、ローカル セキュリティ ポリシー設定、既定のセキュリティの値、およびのみが、システムにアクセスできるアカウント情報のコピーが含まれています。|

このトピックには、次のセクションが含まれています。

-   [ユーザー ログオンの資格情報の入力](#BKMK_CrentialInputForUserLogon)

-   [アプリケーションとサービスのログオン資格情報の入力](#BKMK_CredentialInputForApplicationAndServiceLogon)

-   [ローカル セキュリティ機関](#BKMK_LSA)

-   [キャッシュされた資格情報と検証](#BKMK_CachedCredentialsAndValidation)

-   [資格情報の格納と検証](#BKMK_CredentialStorageAndValidation)

-   [セキュリティ アカウント マネージャー データベース](#BKMK_SAM)

-   [ローカル ドメインと信頼されたドメイン](#BKMK_LocalDomainsAndTrustedDomains)

-   [Windows 認証の証明書](#BKMK_CertificatesInWindowsAuthentication)

## <a name="BKMK_CrentialInputForUserLogon"></a>ユーザー ログオンの資格情報の入力
Windows Server 2008 および Windows Vista、Graphical Identification and Authentication (GINA) のアーキテクチャは、ログオンのタイルを使用して別のログオンの種類を列挙できるように、資格情報プロバイダー モデルに置き換えられました。 両方モデルは次のとおりです。

**Graphical Identification と認証のアーキテクチャ**

Graphical Identification and Authentication (GINA) のアーキテクチャは、Windows Server 2003、Microsoft Windows 2000 Server、Windows XP、および Windows 2000 Professional オペレーティング システムに適用されます。 これらのシステムでは、すべての対話型ログオン セッションは Winlogon サービスの個別のインスタンスを作成します。 GINA アーキテクチャ Winlogon によって使用されるプロセス領域に読み込まれ、受信し、資格情報の処理と LSALogonUser を通じて認証インターフェイスへの呼び出しです。

セッション 0 で、対話型ログオンに Winlogon のインスタンスを実行します。 セッション 0 のホスト システムのサービスとローカル セキュリティ機関 (LSA) プロセスなど、他の重要なプロセスです。

次の図は、Windows Server 2003、Microsoft Windows 2000 Server、Windows XP、および Microsoft Windows 2000 Professional の資格情報プロセスを示します。

![Windows Server 2003、Microsoft Windows 2000 Server、Windows XP、および Microsoft Windows 2000 Professional の資格情報プロセスを示す図](../media/credentials-processes-in-windows-authentication/AuthN_GINA_Architecture.gif)

**資格情報プロバイダーのアーキテクチャ**

資格情報プロバイダーのアーキテクチャがで指定されているこれらのバージョンに適用、**適用先**このトピックの冒頭にリストします。 これらのシステムの資格情報の入力アーキテクチャは、資格情報プロバイダーを使用して、拡張可能な設計に変更されます。 These providers are represented by the different logon tiles on the secure desktop that permit any number of logon scenarios - different accounts for the same user and different authentication methods, such as password, smart card, and biometrics.

資格情報プロバイダーのアーキテクチャと Winlogon では、セキュリティで保護された対処シーケンス イベントを受け取った後ログオン UI が常に開始します。 ログオン UI は、別の資格情報の種類を列挙する、プロバイダーが構成されている数の各資格情報プロバイダーを照会します。 資格情報プロバイダーでは、既定値として指定することで、これらのタイルのいずれかのオプションがあります。 後、すべてのプロバイダーには、独自のタイルが列挙される、ログオン UI はそれらをユーザーに表示します。 ユーザーが自分の資格情報を提供するタイルを操作します。 ログオン UI は、認証用のこれらの資格情報を送信します。

資格情報プロバイダーは、実施メカニズムではありません。 収集し、資格情報をシリアル化に使用されます。 ローカル セキュリティ機関と認証のパッケージのセキュリティの強制します。

資格情報プロバイダーは、コンピューターに登録されてし、次を担当します。

-   認証に必要な資格情報を説明します。

-   通信と外部認証機関とロジックを処理します。

-   パッケージの資格情報の対話型とネットワーク ログオンします。

パッケージの資格情報の対話型とネットワークへのログオンにシリアル化のプロセスが含まれています。 資格情報をシリアル化して、ログオン UI に複数のログオン タイルを表示できます。 Therefore, your organization can control the logon display such as users, target systems for logon, pre-logon access to the network and workstation lock/unlock policies - through the use of customized credential providers. 複数の資格情報プロバイダーが同じコンピューターに共存できます。

標準的な資格情報プロバイダーとして、または前のアクセス プロバイダーとして、シングル サインオン (SSO) プロバイダーを開発することができます。

各バージョン Windows にはでは、1 つの既定の資格情報プロバイダーと 1 つの既定前のログオンのアクセスが含まれています Provider (PLAP)、SSO のプロバイダーとも呼ばれます。 SSO プロバイダーでは、ローカル コンピューターにログオンするときに、ネットワークに接続できます。 このプロバイダーを実装すると、プロバイダーはログオン UI にタイルを列挙されません。

SSO プロバイダーは、次のシナリオで使用する対象としています。

-   **認証、およびコンピューターにログオンするネットワークは、さまざまな資格情報プロバイダーによって処理されます。** このシナリオの種類があります。

    -   ユーザーは、コンピューターにログオンする前に仮想プライベート ネットワーク (VPN) に接続するなど、ネットワークに接続するためのオプションがありますが、この接続を作成する必要はありません。

    -   ローカル コンピューターで対話型の認証時に使用される情報を取得するネットワーク認証が必要です。

    -   複数のネットワーク認証は、その他のシナリオのいずれかによってフォローされています。 たとえば、ユーザーにインターネット サービス プロバイダー (ISP) への認証、VPN を認証し、ローカルでログオンするユーザー アカウントの資格情報を使用します。

    -   キャッシュされた資格情報が無効になり、ローカル ログオンの前にユーザーの認証に VPN を経由してリモート アクセス サービス接続が必要なです。

    -   ドメイン ユーザーは、ローカル アカウントがドメインに参加しているコンピューターで設定されていないと、対話型ログオンを完了する前に、VPN 接続を経由してリモート アクセス サービス接続を確立する必要があります。

-   **認証、およびコンピューターにログオンするネットワークは、同じ資格情報プロバイダーによって処理されます。** このシナリオでは、ユーザーはコンピューターにログオンする前に、ネットワークに接続するために必要です。

**ログオンのタイルの列挙型**

資格情報プロバイダーは、次のインスタンスでログオンのタイルを列挙します。

-   これらのオペレーティング システムで指定されている、**に適用されます**このトピックの冒頭にリストします。

-   資格情報プロバイダーは、ワークステーションへのログオンのためにタイルを列挙します。 通常、資格情報プロバイダーには、ローカル セキュリティ機関への認証資格情報がシリアル化します。 このプロセスは、各ユーザーのターゲット システムに各ユーザーの特定と特定のタイルを表示します。

-   ログオンと認証のアーキテクチャには、ユーザーの資格情報プロバイダーによって列挙されるタイルを使用して、ワークステーションのロックを解除することができます。 通常は、現在ログオンしているユーザーは既定のタイルですが、複数のユーザーがログオンして、さまざまなタイルが表示されます。

-   資格情報プロバイダーは、自分のパスワードまたは PIN など、個人情報を変更するユーザーの要求に応答内のタイルを列挙します。 通常、現在ログオンしているユーザーは、既定のタイルです。ただし、複数のユーザーがログオンして、さまざまなタイルが表示されます。

-   資格情報プロバイダーは、リモート コンピューター上での認証に使用するには、シリアル化された資格情報に基づくタイルを列挙します。 UI の資格情報は、ログオン UI、ワークステーションのロックを解除またはパスワードの変更として、プロバイダーの同じインスタンスを使用しません。 そのため、資格情報の UI のインスタンス間でプロバイダーの状態情報を維持することはできません。 この構造体は、資格情報が正しくシリアル化されたと想定すると、各リモート コンピューターのログオンの 1 つのタイルになります。 このシナリオでユーザー アカウント制御 (UAC)、可能性のあるコンピューターの動作に影響する可能性がありますまたはコンピューターの他のユーザーに影響する設定を変更する可能性があります操作を許可する前に、ユーザーの権限または管理者のパスワードを求めることで、コンピューターを未承認の変更を防ぐのに役立つも使用されます。

次の図で指定されているオペレーティング システムの資格情報プロセスを示しています、**適用先**このトピックの冒頭にリストします。

![指定されているオペレーティング システムの資格情報プロセスを示す図、* * を適用する * * このトピックの冒頭にあるリスト](../media/credentials-processes-in-windows-authentication/AuthN_CredMan_CredProv.gif)

## <a name="BKMK_CredentialInputForApplicationAndServiceLogon"></a>アプリケーションとサービスのログオン資格情報の入力
Windows 認証は、アプリケーションまたはユーザーの介入を必要としないサービスの資格情報を管理するものです。 アプリケーション ユーザー モードでは、どのようなシステム リソースがあるへのアクセスをサービスできますは無制限にアクセスをシステム メモリおよび外部のデバイス間という点で制限されています。

システム サービス、およびトランスポート レベルのアプリケーション、セキュリティ サポート プロバイダー (SSP) を Windows では、システムで利用可能なセキュリティ パッケージを列挙して、パッケージを選択すると、そのパッケージを使用して、認証された接続を取得するの機能を提供するセキュリティ サポート プロバイダー インターフェイス (SSPI) を通じてアクセスします。

クライアント/サーバー接続が認証。

-   接続のクライアント側のアプリケーションは、SSPI 関数を使用してサーバーに資格情報を送信`InitializeSecurityContext (General)`します。

-   接続のサーバー側でアプリケーションの応答 SSPI 関数を使用して`AcceptSecurityContext (General)`します。

-   SSPI 関数`InitializeSecurityContext (General)`と`AcceptSecurityContext (General)`成功または認証に失敗するすべての必要な認証メッセージが入れ替わってまで繰り返されます。

-   接続が認証されると、サーバー上の LSA は、クライアントから情報を使用して、アクセス トークンを含むセキュリティ コンテキストを作成します。

-   サーバーでは、SSPI 関数を呼び出すことができます、`ImpersonateSecurityContext`、偽装スレッド、サービスにアクセス トークンを添付します。

**アプリケーションとユーザー モード**

Windows でのユーザー モードは、I/O 要求を適切なカーネル モード ドライバーに渡すことのできる 2 つのシステムで構成されます。環境のシステムでは、さまざまな種類のオペレーティング システム用に記述されたアプリケーションを実行するには、および整数のシステムは、環境のシステムの代わりのシステムに固有の機能は動作します。

整数のシステムでは、環境のシステムの代わり system'specific 機能を管理し、セキュリティ システム プロセス (LSA)、ワークステーション サービス、およびサーバーのサービスで構成します。 セキュリティ システム プロセス セキュリティ トークンを処理、付与またはリソースのアクセス許可に基づくユーザー アカウントにアクセスする権限を拒否、ログオン要求を処理し開始ログオン認証し、オペレーティング システムを監査する必要があるどのシステム リソースを決定します。

アプリケーションは、アプリケーションがローカル システム (システム) のセキュリティ コンテキストでを含む、任意のプリンシパルとして実行できますユーザー モードで実行できます。 アプリケーションも実行できますカーネル モードで、アプリケーションがローカル システム (システム) のセキュリティ コンテキストで実行できます。

SSPI は、Secur32.dll モジュールは、認証、メッセージの整合性、およびメッセージのプライバシーの統合セキュリティ サービスを取得するために使用される API を使用します。 アプリケーション レベルのプロトコルとセキュリティ プロトコルの間の抽象化レイヤーを提供します。 別のアプリケーションには、さまざまな方法を識別する、またはユーザー認証および認証をネットワーク経由で転送されるデータを暗号化するためのさまざまな方法が必要とするため、SSPI は、別の認証および暗号化機能を含むダイナミック リンク ライブラリ (Dll) にアクセスする方法を提供します。 これらの Dll は、セキュリティ サポート プロバイダー (Ssp) と呼ばれます。

管理されたサービス アカウントと仮想アカウントは、Windows Server 2008 R2 で導入されたおよび Microsoft SQL Server、インターネット インフォメーション サービス (IIS)、独自のドメイン アカウントの分離などの重要なアプリケーションを提供する Windows 7 が不要の管理者が手動で中に管理、サービス プリンシパル名 (SPN) と、これらのアカウントの資格情報。 For more information about these features and their role in authentication, see [Managed Service Accounts Documentation for Windows 7 and Windows Server 2008 R2](https://technet.microsoft.com/library/ff641731(v=ws.10).aspx) and [Group Managed Service Accounts Overview](../group-managed-service-accounts/group-managed-service-accounts-overview.md).

**サービスとカーネル モード**

場合でも、ほとんどの Windows アプリケーションは、それらを開始したユーザーのセキュリティ コンテキストで実行、サービスの場合は true。これは、されません。 ユーザーがコンピューターを起動したとき、サービス コントローラーによってネットワークと、印刷サービスなど、多くの Windows サービスが起動します。 これらのサービスはローカル サービスまたはローカル システムとして実行する可能性があり、最後の人のユーザーがログオフ後実行し続ける可能性があります。

> [!NOTE]
> 通常、サービスはローカル システム (システム)、ネットワーク サービス、またはローカル サービスと呼ばれるセキュリティ コンテキストで実行されます。  Windows Server 2008 R2 では、管理されたサービス アカウントで実行されるサービス プリンシパルのドメインであるが導入されました。

サービスを開始する前に、サービス コントローラーは、サービスの指定は、LSA によって認証のサービスの資格情報を表示し、アカウントを使用してログオンします。 Windows サービスは、サービスを制御する、サービス コントローラ マネージャが使用できるプログラム インターフェイスを実装します。 Windows サービスは、サービス コントロール プログラムと、または手動でシステムが起動したときに自動的に起動できます。 たとえば、Windows クライアント コンピューターがドメインに参加、コンピューターのメッセンジャー サービスがドメイン コントローラーに接続してしてセキュリティで保護されたチャネルを開きます。 認証された接続を取得するには、サービスの資格情報、リモート コンピューターのローカル セキュリティ機関 (LSA) が信頼する必要があります。 ネットワーク内の他のコンピューターと通信しているときに LSA Local System およびネットワーク サービスのセキュリティ コンテキストで実行されている他のすべてのサービスを実行、ローカル コンピューターのドメインのアカウントの資格情報を使用します。 ローカル コンピューター上のサービスはシステムとして実行ための資格情報が LSA に提示する必要はありません。

Ksecdd.sys ファイルは、管理し、これらの資格情報を暗号化し、LSA にローカル プロシージャ呼び出しを使用します。 ファイルの種類のドライブ (ドライバー) し、は、既知のカーネル モードのセキュリティ サポート プロバイダー (SSP) としてで指定されているこれらのバージョンで、**適用先**FIPS 140-2 レベル 1 準拠は、このトピックの先頭にある一覧で、します。

カーネル モードでは、コンピューターのハードウェアおよびシステムのリソースへのフル アクセスを持ちます。 カーネル モードでは、ユーザー モードのサービスとアプリケーションへのアクセスが許可されていないオペレーティング システムの重要な領域へのアクセスを停止します。

## <a name="BKMK_LSA"></a>ローカル セキュリティ機関
ローカル セキュリティ機関 (LSA) は、認証し、ローカル コンピューターにログオン ユーザーをログに記録する保護されたシステム プロセスです。 さらに、LSA が (このような側面は、ローカル セキュリティ ポリシーと呼ばれます総称) コンピューター上のローカル セキュリティのすべての側面に関する情報を保持し、さまざまなサービス名とセキュリティ識別子 (Sid) の間の変換を提供します。 ローカル セキュリティ機関サーバー サービス (LSASS)、セキュリティ システムのプロセスは、セキュリティ ポリシーとコンピューターのシステムで有効になっているアカウントの追跡します。

LSA はユーザーのアカウントを発行した次の 2 つのエンティティのうち、ユーザーの身元を検証します。

-   **ローカル セキュリティ機関します。** LSA は、同じコンピューター上にある、セキュリティ アカウント マネージャー (SAM) データベースをチェックして、ユーザー情報を検証できます。 すべてのワークステーションまたはメンバー サーバーには、ローカル ユーザー アカウントとローカル グループに関する情報を格納できます。 ただし、これらのアカウントは、そのワークステーションやコンピューターにアクセスするために使用できます。

-   **ローカル ドメインまたは信頼されたドメインのセキュリティ機関します。** LSA は、エンティティのアカウントを発行して、アカウントが有効にして、要求は、アカウント所有者から発信された要求の検証を接続します。

ローカル セキュリティ機関サブシステム サービス (LSASS) では、Windows セッションがアクティブなユーザーの代わりに、資格情報をメモリを保管します。 保存された資格情報では、ユーザーがリモート サービスごとに、資格情報を再入力しなくてもファイル共有、Exchange Server メールボックス、SharePoint サイトなどのネットワーク リソースにシームレスにアクセスできるようにします。

LSASS を含め、複数のフォームに資格情報を格納できます。

-   可逆的に暗号化されたプレーン テキスト

-   Kerberos チケット (チケット保証チケット (Tgt) のサービス チケット)

-   NT ハッシュ

-   LAN Manager (LM) ハッシュ

スマート カードを使用して、Windows をユーザーがログオンすると、LSASS はプレーン テキストのパスワードは保存されませんが、アカウントとスマート カードのプレーン テキスト暗証番号 (pin) に対応する NT ハッシュ値を格納します。 対話型ログオンに必要なスマート カード、アカウントの属性が有効になって、元のパスワード ハッシュではなく、アカウントのランダム NT ハッシュ値は自動的に生成します。 属性が設定されている場合に自動的に生成されるパスワード ハッシュは変更されません。

場合は、ユーザーが LAN Manager (LM) ハッシュと互換性があるパスワードを使用して Windows ベースのコンピューターにログオンすると、この認証子はメモリ内に存在します。

必要な資格情報プロバイダーが無効になっている場合でも、メモリ内のプレーン テキストの資格情報の記憶域を無効にできません。

保存された資格情報に直接関連付けられた後、最後に開始されたローカル セキュリティ機関サブシステム サービス (LSASS) ログオン セッションを再起動し、閉じられていません。 たとえば、ユーザーが、次のいずれかと保存された LSA 資格情報を持つ LSA セッションが作成されます。

-   ローカル セッションまたはコンピューター上のリモート デスクトップ プロトコル (RDP) セッションにログオン

-   使用してタスクを実行する、**RunAs**オプション

-   コンピューター上のアクティブな Windows サービスを実行します。

-   スケジュールされたタスクまたはバッチ ジョブを実行します。

-   リモート管理ツールを使用して、ローカル コンピューター上のタスクを実行します。

いくつかの状況では、SYSTEM アカウント プロセスのみがアクセスできるデータの秘密部分であり、LSA シークレットは、ハード ディスク ドライブに保存されます。 これらのシークレットの一部は、再起動後に保持する必要がありますされる資格情報と、ハード ディスク ドライブで暗号化された形式で保存されます。 LSA シークレットとして保存された資格情報が含まれます。

-   コンピューターの Active Directory ドメイン サービス (AD DS) のアカウントのアカウントのパスワード

-   コンピューターに構成されている Windows サービスのアカウント パスワード

-   構成されたスケジュールされたタスクのアカウント パスワード

-   IIS アプリケーション プールと Web サイトのアカウントのパスワード

-   Microsoft アカウントのパスワード

Windows 8.1 で導入された、クライアントのオペレーティング システムは、追加のメモリの読み取りを回避し、保護されていないプロセスによるコード インジェクションを LSA の保護を提供します。 この保護は、LSA が格納し、管理するための資格情報のセキュリティを向上します。

これらの付加的な保護の詳細については、次を参照してください。[追加 LSA の保護を構成する](../credentials-protection-and-management/configuring-additional-lsa-protection.md)します。

## <a name="BKMK_CachedCredentialsAndValidation"></a>キャッシュされた資格情報と検証
検証機構は、ログオン時に資格情報のプレゼンテーションに依存します。 ただし、コンピューターが、ドメイン コントローラーから切断されているし、ユーザーがドメインの資格情報を表示する、Windows は検証機構でキャッシュされた資格情報のプロセスを使用します。

ユーザーがドメインにログオンするたびに Windows は、指定された資格情報をキャッシュし、オペレーティング システムのレジストリ内のセキュリティ ハイブに格納します。

キャッシュされた資格情報を持つユーザー ログオンできますドメイン メンバーにそのドメイン内のドメイン コントローラーに接続しなくても。


## <a name="BKMK_CredentialStorageAndValidation"></a>資格情報の格納と検証
これは常に望ましくありませんさまざまなリソースにアクセスするための資格情報の 1 つのセットを使用します。 たとえば、管理者可能性があります使用する管理ユーザーの資格情報ではなくリモート サーバーにアクセスする場合。 同様に、ユーザー、銀行口座などの外部のリソースにアクセスする場合かのみ使用できます、ドメイン資格情報とは異なる資格情報。 次のセクションでは、現在のバージョンの Windows オペレーティング システムと、Windows Vista および Windows XP オペレーティング システムの間での資格情報の管理の違いについて説明します。

### <a name="remote-logon-credential-processes"></a>リモートのログオン資格情報プロセス
リモート デスクトップ プロトコル (RDP) は、Windows 8 で導入されたリモート デスクトップ クライアントを使用してリモート コンピューターに接続するユーザーの資格情報を管理します。 プレーン テキスト形式で資格情報は、場所、ホスト、認証プロセスの実行を試みるし、成功した場合、ユーザーはリソースに接続許可されている、ターゲット ホストに送信されます。 RDP ではクライアントでは、資格情報は保存されませんが、LSASS でユーザーのドメイン資格情報が格納されています。

Windows Server 2012 R2 および Windows 8.1 で導入された、制限付き管理モードは、リモート ログオンのシナリオに追加のセキュリティを提供します。 リモート デスクトップのこのモードでは、クライアント アプリケーションをネットワーク ログオン チャレンジ/レスポンス NT の一方向の関数 (NTOWF) でを実行またはリモート ホストを認証するときに、Kerberos サービス チケットを使用します。 管理者が認証されると、管理者はありません、それぞれのアカウントの資格情報 LSASS でリモート ホストに指定されなかったため。 代わりに、管理者は、セッションのコンピューター アカウントの資格情報を持っています。 管理者の資格情報は、コンピューター アカウントとしての操作を実行するため、リモート ホストに提供されません。 リソースは、コンピューター アカウントに制限されても、管理者が自分のアカウントを使用してリソースにアクセスできません。

### <a name="automatic-restart-sign-on-credential-process"></a>自動再起動サインオン資格情報プロセス
ユーザーが Windows 8.1 デバイスにサインインするときに LSA はユーザーの資格情報を LSASS.exe によってのみアクセス可能な暗号化されたメモリに保存します。 Windows Update では、ユーザーが存在せず、自動再起動を開始するときは、これらの資格情報を使用して、ユーザーの自動ログオンを構成します。

、再起動時に自動ログオンのメカニズムを経由して、ユーザーが自動的にログオンされ、コンピューターがさらに、ユーザーのセッションを保護するロックし、します。 資格情報の管理は LSA によって行われますが、ロックが Winlogon によって開始されます。 自動的にログインし、本体上のユーザーのセッションのロック、によって、ユーザーのロック画面アプリケーションは、再起動して利用できます。

ARSO に関する詳細については、次を参照してください。[Winlogon 自動再起動サインオン (&) #40 です。ARSO & #41 です。](winlogon-automatic-restart-sign-on-arso.md).

### <a name="stored-user-names-and-passwords-in-windows-vista-and-windows-xp"></a>Windows Vista および Windows XP で保存されているユーザー名とパスワード
Windows Server 2008、Windows Server 2003、Windows Vista、および Windows XP で**格納されたユーザー名とパスワード**コントロール パネルの [管理とスマート カードで使用される X.509 証明書と Windows Live 資格情報 (Microsoft アカウントと呼ばれるようになりました) を含む、ログオン資格情報のセットを複数の使用を簡略化します。 The credentials - part of the user's profile - are stored until needed. この操作は、ことを保証する 1 つのパスワードが侵害された場合が損なわれないすべてのセキュリティ - リソースごとにセキュリティを強化できます。

ユーザーの既定のログオン資格情報が、アクセスを取得するために十分でない場合、ユーザーがログオンして、サーバー上の共有など、その他のパスワードで保護されたリソースにアクセスしようとした後と**格納されたユーザー名とパスワード**を照会します。 正しいログオン情報で別の資格情報が保存されているかどうかは**格納されたユーザー名とパスワード**、これらの資格情報はアクセスに使用します。 それ以外の場合、求められます後で、ログオン セッションまたはそれ以降のセッション中に、再利用できるようにし、保存できる新しい資格情報を提供します。

次の制限が適用されます。

-   場合**格納されたユーザー名とパスワード**、特定のリソース、リソースへのアクセスが拒否されたに対して無効であるか、または正しくない資格情報が含まれていて、**格納されたユーザー名とパスワード**] ダイアログ ボックスが表示されません。

-   **ユーザー名とパスワードが格納されている**NTLM、Kerberos プロトコルに対してのみ資格情報を保管する Microsoft アカウント (旧 Windows Live ID)、および Secure Sockets Layer (SSL) 認証します。 Internet Explorer のバージョンによっては、基本認証のための独自のキャッシュを維持します。

これらの資格情報では、ユーザーのローカル プロファイル \Documents and 自動 Data\Microsoft\Credentials ディレクトリの暗号化の一部になります。 その結果、これらの資格情報は、ユーザーのネットワーク ポリシーは、移動ユーザー プロファイルをサポートしている場合、ユーザーとローミングできます。 ただし、ユーザーのコピーがある場合**格納されたユーザー名とパスワード**2 つの異なるコンピューターとの変更の上、これらのコンピューターのいずれかのリソースに関連付けられている資格情報の変更には伝達されません**格納されたユーザー名とパスワード**2 つ目のコンピューターにします。

### <a name="windows-vault-and-credential-manager"></a>Windows 資格情報コンテナーと資格情報マネージャー
資格情報マネージャーは、保存し、ユーザー名とパスワードを管理するためのコントロール パネルの [機能として Windows Server 2008 R2 および Windows 7 で導入されました。 資格情報マネージャーを使用して、他のシステムや Web サイトに関連する資格情報をセキュリティで保護された Windows 資格情報コンテナーに格納できます。 いくつかのバージョンの Internet Explorer は、Web サイトへの認証、この機能を使用します。

資格情報マネージャーを使用して資格情報の管理は、ローカル コンピューター上のユーザーによって制御されます。 ユーザーは、保存し、サポートされるブラウザーとこれらのリソースにログインする必要がある場合に便利なように Windows アプリケーションからの資格情報を格納できます。 資格情報は、ユーザーのプロファイルで、コンピューター上の特別な暗号化されたフォルダーに保存されます。 アプリ、Web ブラウザーなどを使用して、資格情報マネージャー API)、この機能をサポートするアプリケーションは、ログイン プロセス時に他のコンピューターや Web サイトに正しい資格情報を提示することができます。

ときに、Web サイト、アプリケーション、または別のコンピューターの要求認証 NTLM または Kerberos プロトコルを通じて、ダイアログ ボックスが表示で、選択した、**更新の既定の資格情報**または**パスワードを保存**チェック ボックスをオンします。 このダイアログ ボックスでは、ユーザーがローカルで資格情報を保存するは、資格情報マネージャー API をサポートするアプリケーションによって生成されます。 ユーザーが選択した場合、**パスワードを保存**] チェック ボックスを資格情報マネージャーは、の追跡、ユーザーのユーザー名、パスワード、および関連サービスの情報を認証使用されています。

次回サービスを使用すると、資格情報マネージャー、Windows 資格情報コンテナーに格納されている資格情報を自動的に提供します。 それが受け付けられない場合、適切なアクセス情報の入力が求められます。 新しい資格情報のアクセスが許可されると、資格情報マネージャーは新しいもので、以前の資格情報を上書きし、Windows 資格情報コンテナーに新しい資格情報を格納します。

## <a name="BKMK_SAM"></a>セキュリティ アカウント マネージャー データベース
セキュリティ アカウント マネージャー (SAM) は、ローカル ユーザー アカウントとグループを保存するデータベースです。 すべての Windows オペレーティング システムであります。ただし、コンピューターがドメインに参加している、Active Directory は Active Directory ドメインにあるドメイン アカウントを管理します。

たとえば、Windows オペレーティング システムを実行しているクライアント コンピューターは人のユーザーがログオンしていない場合でも、ドメイン コントローラーと通信することでネットワーク ドメインに参加します。 通信を開始するには、コンピューターは、ドメイン内にアクティブなアカウントが必要です。 コンピューターからの通信を受け入れる前に、ドメイン コントローラー上の LSA は、コンピューターの ID を認証し、人間のセキュリティ プリンシパルの場合と同様、コンピューターのセキュリティ コンテキストを構築します。 このセキュリティ コンテキストでは、特定のコンピューターまたはユーザー、サービス、またはネットワーク上のコンピューターの ID と、ユーザーまたはサービスの機能を定義します。 For example, the access token contained within the security context defines the resources (such as a file share or printer) that can be accessed and the actions (such as Read, Write, or Modify) that can be performed by that principal - a user, computer, or service on that resource.

ユーザーまたはコンピューターのセキュリティ コンテキストは異なる場合 1 台のコンピューターを別のサーバーまたはワークステーション ユーザーのプライマリ ワークステーション以外に、ユーザーがログオンするとします。 管理者がユーザーの権限とアクセス許可を変更するときなどごとに、1 つのセッションを異なることができます。 さらに、ユーザーまたはコンピューターを単独で、ネットワークでは、または Active Directory ドメインの一部として動作しているときは、セキュリティ コンテキストは通常異なります。

## <a name="BKMK_LocalDomainsAndTrustedDomains"></a>ローカル ドメインと信頼されたドメイン
2 つのドメイン間で信頼関係が存在する場合、各ドメインに対して認証メカニズムは、他のドメインからの認証の有効性に依存します。 信頼された証明機関 (信頼される側のドメイン) に由来するれる認証要求を確認し、リソース ドメイン (信頼する側のドメイン) の共有リソースに対するアクセスの制御を提供するヘルプを信頼します。 これにより、信頼関係は、ドメイン間での認証要求旅行の検証のみがブリッジで機能します。

特定の信頼が認証要求を渡す方法の構成方法によって異なります。 信頼関係は、信頼される側のドメインから信頼する側のドメイン内のリソースへのアクセスを提供することによって、一方向または双方向、各ドメインから他のドメイン内のリソースへのアクセスを提供することでします。 信頼関係も 2 つの信頼のパートナー ドメイン間でのみ、信頼が存在している場合、非推移性または推移的なその場合、信頼が自動的に、パートナーのいずれかが信頼している他のドメインに拡張できます。

ドメインとフォレストの信頼関係認証に関する詳細については、次を参照してください。[委任された認証と信頼関係](https://technet.microsoft.com/library/dn169022.aspx)します。

## <a name="BKMK_CertificatesInWindowsAuthentication"></a>Windows 認証の証明書
公開キー基盤 (PKI) は、ソフトウェア、暗号化テクノロジ、プロセス、およびその通信およびビジネスのトランザクションをセキュリティで保護する組織を有効にするサービスの組み合わせです。 PKI の通信とビジネスのトランザクションをセキュリティで保護する機能は、認証されたユーザーと信頼されたリソースの間でのデジタル証明書の exchange に基づいています。

デジタル証明書は、電子ドキュメントに属しているエンティティ、によって発行されたエンティティ、固有のシリアル番号またはその他のいくつかの固有 id、発行と有効期限、およびデジタル指紋に関する情報を格納します。

認証は、リモート ホストが信頼できるかどうかのプロセスです。 信頼性を確立するには、は、リモート ホストが、許容される認証証明書を提供する必要があります。

リモート ホストでは、証明機関 (CA) から証明書を取得することで、信頼関係を確立します。 CA の信頼チェーンを作成、高い機関から証明にあるさらに、ことができます。 証明書が信頼できるかどうかを確認するのにアプリケーションはルート CA の ID を確認し、信頼できるかどうかを決定する必要があります。

同様に、リモート ホストまたはローカル コンピューター必要がありますを決定ユーザーまたはアプリケーションによって提示される証明書が本物かどうかします。 LSA と SSPI を通じてユーザーによって提示される証明書は、Active directory 証明書ストアを通じて、ローカル コンピューターのローカル ログオン、ネットワーク、またはドメインの完全性に対して評価されます。

証明書、認証データを生成するには、メッセージ ダイジェストを生成するセキュア ハッシュ アルゴリズム 1 (SHA1) などのハッシュ アルゴリズムを通過します。 [メッセージ ダイジェストがそのセンダによって生成されたメッセージ ダイジェストを証明するために、送信者の秘密キーを使用してデジタル署名です。

> [!NOTE]
> SHA1 は、Windows 7 および Windows Vista では、既定値ですが、Windows 8 で SHA2 に変更されました。

**スマート カード認証**

スマート カード テクノロジは、証明書ベースの認証の例を示します。 スマート カードを使ってネットワークにログオンすると、ドメインにユーザーを認証するときに暗号化ベース識別および所有していることの証拠を使用するために強力な認証方式が提供できます。 Active Directory 証明書サービス (AD CS) は、各スマート カード ログオン証明書の発行を通じて暗号化ベース ID を提供します。

スマート カード認証については、次を参照してください。、[Windows スマート カードのテクニカル リファレンス](https://technet.microsoft.com/library/ff404297.aspx)します。

仮想スマート カード テクノロジは、Windows 8 で導入されました。 Pc、スマート カードの証明書を保存し、デバイスの改ざんトラステッド プラットフォーム モジュール (TPM) セキュリティ チップを使用して、それを保護します。 これにより、PC にスマート カードを認証するために、ユーザーの暗証番号 (pin) を受け取る必要がありますが実際になります。

**リモートおよびワイヤレスの認証**

リモートおよびワイヤレス ネットワークの認証は、認証用の証明書を使用するもう 1 つのテクノロジです。 インターネット認証サービス (IAS) と仮想プライベート ネットワーク サーバーをネットワーク アクセス、仮想プライベート ネットワーク (VPN) およびワイヤレス接続を含むのさまざまな種類の証明書ベースの認証を実行する拡張認証プロトコル-トランスポート レベルのセキュリティ (EAP-TLS)、保護されている拡張認証プロトコル (PEAP)、またはインターネット プロトコル セキュリティ (IPsec) を使用します。

For information about certificate-based authentication in networking, see [Network access authentication and certificates](https://technet.microsoft.com/library/cc759575(WS.10).aspx).

## <a name="BKMK_SeeAlso"></a>参照してください。
[Windows 認証の概念](https://technet.microsoft.com/library/d169018.aspx)


