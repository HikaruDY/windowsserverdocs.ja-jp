---
title: Windows 認証での資格情報の処理
description: Windows Server のセキュリティ
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-windows-auth
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 48c60816-fb8b-447c-9c8e-800c2e05b14f
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 52d50a1bb6bfbe9d35146f362a2a5184df0a6504
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839863"
---
# <a name="credentials-processes-in-windows-authentication"></a>Windows 認証での資格情報の処理

>適用先:Windows Server 2016 の Windows Server (半期チャネル)

IT プロフェッショナル向けのこのリファレンス トピックでは、Windows 認証で資格情報を処理する方法について説明します。

Windows 資格情報の管理は、オペレーティング システムがサービスまたはユーザーから資格情報を受け取り、認証ターゲットを将来のプレゼンテーションについては、その情報をセキュリティで保護するプロセスです。 ドメインに参加しているコンピューターの場合は、認証の対象は、ドメイン コント ローラーです。 認証で使用される資格情報は、何らかの形式の証明書、パスワード、PIN などの完全性を実証する、ユーザーの id に関連付けるデジタル ドキュメントです。

既定では、Windows 資格情報は、ローカル コンピューターでは、セキュリティ アカウント マネージャー (SAM) データベースに対して、または、Winlogon サービスから、ドメインに参加しているコンピューターに Active Directory に対して検証されます。 資格情報は、ログオン ユーザー インターフェイスまたはプログラムによってアプリケーション プログラミング インターフェイス (API)、認証ターゲットを表示するユーザーの入力を通じて収集されます。

ローカルのセキュリティ情報が下のレジストリに格納されている**\security**します。 格納されている情報には、ポリシーの設定、既定のセキュリティの値、およびキャッシュされたログオン資格情報などのアカウント情報が含まれています。 書き込み禁止になっていますが、SAM データベースのコピーがここでは、格納もされます。

次の図は必要なコンポーネントと、パスはユーザーまたはプロセスの成功したログオンを認証する資格情報がかかるシステムを経由します。

![資格情報を必要とされるコンポーネントとパスを示す図は、ユーザーまたはプロセスの成功したログオンを認証するシステムでかかります。](../media/credentials-processes-in-windows-authentication/AuthN_LSA_Architecture_Client.gif)

次の表では、ログオン時の認証プロセスの資格情報を管理する各コンポーネントについて説明します。

**すべてのシステムの認証コンポーネント**

|Component|説明|
|-------|--------|
|ユーザー ログオン|Winlogon.exe は、実行可能ファイルをセキュリティで保護されたユーザーの操作を管理する責任を負います。 Winlogon サービスは、セキュリティで保護されたデスクトップ (ログオン UI) に Secur32.dll を介してローカル セキュリティ機関 (LSA) にユーザーの操作によって収集、資格情報を渡すことによって、Windows オペレーティング システムのログオン プロセスを開始します。|
|アプリケーションのログオン|アプリケーションまたは対話型ログオンを必要としないサービスのログオンします。 ユーザーによって開始されたほとんどのプロセスは、Ksecdd.sys を使用して、サービスの起動時に開始されたプロセスがカーネル モードで実行する一方、Secur32.dll を使用して、ユーザー モードで実行されます。<br /><br />ユーザー モードとカーネル モードの詳細については、このトピックの「アプリケーションやユーザー モードまたはサービス、およびカーネル モードを参照してください。|
|Secur32.dll|認証プロセスの基盤を形成する複数の認証プロバイダー。|
|Lsasrv.dll|LSA サーバー サービス両方のセキュリティ ポリシーを強制し、LSA のセキュリティ パッケージ マネージャーとして機能します。 LSA には、どのプロトコルを成功させるのには決定した後、NTLM または Kerberos プロトコルを選択します。 ネゴシエート関数が含まれています。|
|セキュリティ サポート プロバイダー|1 つまたは複数の認証プロトコルを個別に呼び出すことができるプロバイダーのセット。 プロバイダーの既定のセットは、Windows オペレーティング システムの各バージョンで変更でき、カスタム プロバイダーを作成できます。|
|Netlogon.dll|Net Logon サービスによって実行されるサービスは次のとおりです。<br /><br />-ドメイン コント ローラーに (いない Schannel と混同しないでください) へのコンピューターのセキュリティで保護されたチャネルを維持します。<br />-ドメイン コント ローラーにセキュリティで保護されたチャネルを介して、ユーザーの資格情報を渡すし、ドメイン セキュリティ識別子 (Sid) と、ユーザーのユーザー権限を返します。<br />-発行サービスのリソース レコード ドメイン ネーム システム (DNS) にしてで DNS 名のドメイン コント ローラーのインターネット プロトコル (IP) アドレスに解決を使用します。<br />-プライマリ ドメイン コント ローラー (Pdc) とバックアップ ドメイン コント ローラー (Bdc) を同期するためのリモート プロシージャ コール (RPC) に基づいて、レプリケーション プロトコルを実装します。|
|Samsrv.dll|セキュリティ アカウント マネージャー (SAM) ローカル セキュリティ アカウントを格納するには、これはローカルに保存されたポリシーを強制し、Api をサポートします。|
|レジストリ|レジストリには、SAM データベース、ローカル セキュリティ ポリシーの設定、既定のセキュリティの値、およびシステムへのアクセス アカウント情報のコピーが含まれています。|

このトピックには、次のセクションが含まれています。

-   [ユーザー ログオンの資格情報の入力](#BKMK_CrentialInputForUserLogon)

-   [アプリケーションおよびサービスのログオン資格情報の入力](#BKMK_CredentialInputForApplicationAndServiceLogon)

-   [ローカル セキュリティ機関](#BKMK_LSA)

-   [キャッシュされた資格情報と検証](#BKMK_CachedCredentialsAndValidation)

-   [資格情報の格納および検証](#BKMK_CredentialStorageAndValidation)

-   [セキュリティ アカウント マネージャー データベース](#BKMK_SAM)

-   [ローカル ドメインと信頼されたドメイン](#BKMK_LocalDomainsAndTrustedDomains)

-   [Windows 認証で証明書](#BKMK_CertificatesInWindowsAuthentication)

## <a name="BKMK_CrentialInputForUserLogon"></a>ユーザー ログオンの資格情報の入力
Windows Server 2008 および Windows Vista では、Graphical Identification and Authentication (GINA) のアーキテクチャは、ログオンのタイルを使用して別のログオンの種類を列挙するためにできるように、資格情報プロバイダー モデルに置き換えられました。 両方のモデルを以下に示します。

**グラフィカルな識別と認証のアーキテクチャ**

Graphical Identification and Authentication (GINA) のアーキテクチャは、Windows Server 2003、Microsoft Windows 2000 Server、Windows XP、および Windows 2000 Professional オペレーティング システムに適用されます。 これらのシステムでは、すべての対話型ログオン セッションは、Winlogon サービスの個別のインスタンスを作成します。 GINA アーキテクチャは、Winlogon によって使用されるプロセス領域に読み込まれる、受信し、資格情報を処理したうえでと LSALogonUser を通じて認証インターフェイスを呼び出します。

対話型のログオンに Winlogon のインスタンスは、セッション 0 で実行します。 セッション 0 はシステム サービスをホストし、ローカル セキュリティ機関 (LSA) のプロセスなど、他の重要なプロセスです。

次の図は、Windows Server 2003、Microsoft Windows 2000 Server、Windows XP、および Microsoft Windows 2000 Professional の資格情報のプロセスを示します。

![Windows Server 2003、Microsoft Windows 2000 Server、Windows XP、および Microsoft Windows 2000 Professional の資格情報のプロセスを示す図](../media/credentials-processes-in-windows-authentication/AuthN_GINA_Architecture.gif)

**資格情報プロバイダー アーキテクチャ**

資格情報プロバイダー アーキテクチャがで指定されているこれらのバージョンに適用されます、**適用先**このトピックの冒頭にある一覧。 これらのシステム資格情報の入力アーキテクチャは、資格情報プロバイダーを使用して、拡張可能なデザインに変更されます。 これらのプロバイダーは、任意の数のログオンのシナリオに異なるアカウントを同じユーザーとパスワード、スマート カード、および生体認証などのさまざまな認証方法が使用できる、セキュリティで保護されたデスクトップ上の別のログオン タイルで表されます。

資格情報プロバイダーのアーキテクチャと Winlogon では、セキュリティで保護された注意のシーケンス イベントを受信した後ログオン UI が常に開始します。 ログオン UI は、別の資格情報の種類を列挙するために、プロバイダーが構成されている数の各資格情報プロバイダーを照会します。 資格情報プロバイダーでは、既定値として指定することで、これらのタイルのいずれかのオプションがあります。 後、すべてのプロバイダーには、独自のタイルが列挙、ログオン UI は、ユーザーにそれらを表示します。 ユーザーは自分の資格情報を提供するタイルと対話します。 ログオン UI は、認証にこれらの資格情報を送信します。

資格情報プロバイダーは、実施メカニズムではありません。 収集し、資格情報をシリアル化に使用されます。 ローカル セキュリティ機関と認証パッケージは、セキュリティを適用します。

資格情報プロバイダーは、コンピューターに登録されてし、は、次の責任があります。

-   認証に必要な資格情報を記述します。

-   通信と外部認証機関を使用したロジックを処理します。

-   パッケージ化の資格情報の対話型およびネットワーク ログオン。

パッケージ化の資格情報の対話型とネットワーク ログオンには、シリアル化のプロセスが含まれています。 資格情報をシリアル化して、ログオン UI に複数のログオンのタイルを表示できます。 そのため、お客様の組織はなど、ユーザー、ターゲット システムのログオン、ログオン前ポリシーへのアクセス、ネットワークとワークステーション ロック/ロック解除 - カスタマイズされた資格情報プロバイダーを使用してログオン表示を制御できます。 複数の資格情報プロバイダーは、同じコンピューターに共存できます。

標準的な資格情報プロバイダーとして、または前-アクセス プロバイダーとして、シングル サインオン (SSO) プロバイダーを開発できます。

Windows の各バージョンには、1 つの既定の資格情報プロバイダーと既定の 1 つ前のログオン アクセスが含まれています Provider (PLAP)、SSO プロバイダーとも呼ばれます。 SSO プロバイダーは、ユーザーがローカル コンピューターにログオンする前に、ネットワークへの接続を許可します。 このプロバイダーが実装された場合、プロバイダーはログオン UI 上のタイルを列挙できません。

SSO プロバイダーは、次のシナリオで使用するためのもの。

-   **ネットワークの認証とコンピューターのログオンは、別の資格情報プロバイダーによって処理されます。** このシナリオの変化形は次のとおりです。

    -   ユーザーは、コンピューターにログオンする前に仮想プライベート ネットワーク (VPN) への接続など、ネットワークへの接続のオプションがありますが、この接続を確立する必要はありません。

    -   ローカル コンピューターの対話型認証時に使用される情報を取得するには、ネットワーク認証が必要です。

    -   他のシナリオのいずれかでは、複数のネットワーク認証が後にします。 たとえば、ユーザーはインターネット サービス プロバイダー (ISP) に認証、VPN を認証し、ローカルでログオンするユーザー アカウントの資格情報を使用します。

    -   キャッシュされた資格情報が無効になっているとユーザーの認証に VPN 経由のリモート アクセス サービス接続がローカル ログオンの前に必要です。

    -   ドメイン ユーザーにドメインに参加しているコンピューターにローカル アカウントがないと、対話型ログオンを完了する前に VPN 接続経由のリモート アクセス サービス接続を確立する必要があります。

-   **ネットワークの認証とコンピューターのログオンは、同じ資格情報プロバイダーによって処理されます。** このシナリオでは、ユーザーがコンピューターにログオンする前にネットワークに接続する必要があります。

**ログオンのタイルの列挙型**

資格情報プロバイダーは、次のインスタンスのログオンのタイルを列挙します。

-   これらのオペレーティング システムで指定されているため、**に適用されます**このトピックの冒頭にある一覧。

-   資格情報プロバイダーは、ワークステーションへのログオンのタイルを列挙します。 通常、資格情報プロバイダーには、ローカル セキュリティ機関に認証の資格情報がシリアル化します。 このプロセスは、各ユーザーの対象システムへのユーザーごとに特定し、特定のタイルを表示します。

-   ログオンと認証のアーキテクチャには、ユーザーの資格情報プロバイダーによって列挙されたタイルを使用して、ワークステーションのロックを解除することができます。 通常、現在ログオンしているユーザーは、既定のタイルが 1 つ以上のユーザーがログオンして、さまざまなタイルが表示されます。

-   資格情報プロバイダーは、自分のパスワードまたは PIN などの他の個人情報を変更するユーザーの要求に対する応答内のタイルを列挙します。 通常、現在ログオンしているユーザーは、既定のタイルです。ただし、1 つ以上のユーザーがログオンした場合、多数のタイルが表示されます。

-   資格情報プロバイダーは、リモート コンピューターでの認証に使用するには、シリアル化された資格情報に基づくタイルを列挙します。 UI の資格情報は、ログオン UI、ワークステーションのロックを解除またはパスワードの変更としてプロバイダーの同じインスタンスを使用していません。 そのため、資格情報の UI のインスタンス間で、プロバイダーの状態情報を維持できません。 この構造体は、資格情報が正しくシリアル化されたと仮定すると、リモート コンピューター ログオンごとに 1 つのタイルになります。 このシナリオでユーザー アカウント制御 (UAC)、コンピューターの動作に影響を与える可能性のあるアクションを許可する前に、ユーザーのアクセス許可または管理者パスワードを要求することで、コンピューターに未承認の変更を防ぐのに役立つ使用もまたは、コンピューターの他のユーザーに影響する設定を変更する可能性があります。

次の図は、資格情報のプロセスで指定されているオペレーティング システムの**適用先**このトピックの冒頭にある一覧。

![指定されているオペレーティング システムの資格情報のプロセスを示すダイアグラム、* * に適用されます * * このトピックの冒頭にある一覧](../media/credentials-processes-in-windows-authentication/AuthN_CredMan_CredProv.gif)

## <a name="BKMK_CredentialInputForApplicationAndServiceLogon"></a>アプリケーションおよびサービスのログオン資格情報の入力
Windows 認証は、アプリケーションまたはユーザーの介入を必要としないサービスの資格情報を管理する設計されています。 ユーザー モードでのアプリケーションは、どのようなシステム リソース、アクセス権を持つこれらには、サービスは、システム メモリと外部デバイスにアクセス無制限ことができますが、に関して、事実上制限。

システム サービスとトランスポート レベルのアプリケーション アクセスのセキュリティ サポート プロバイダー (SSP) で、Windows システムで使用可能なセキュリティ パッケージを列挙するための機能を提供するセキュリティ サポート プロバイダー インターフェイス (SSPI) を選択すると、パッケージ、およびそのパッケージを使用して認証された接続を取得します。

クライアント/サーバー接続が認証。

-   接続のクライアント側のアプリケーションは、SSPI 関数を使用して、サーバーに資格情報を送信`InitializeSecurityContext (General)`します。

-   SSPI 関数を使用した接続のサーバー側のアプリケーションが応答`AcceptSecurityContext (General)`します。

-   SSPI 関数`InitializeSecurityContext (General)`と`AcceptSecurityContext (General)`成功または失敗の認証に必要な認証のすべてのメッセージを交換したまで繰り返されます。

-   接続が認証された後、サーバー上の LSA はアクセス トークンを含む、セキュリティ コンテキストを構築するのにクライアントからの情報を使用します。

-   サーバーでは、SSPI 関数を呼び出すことができますし、`ImpersonateSecurityContext`アクセス トークンをサービスに、権限借用スレッドにアタッチします。

**アプリケーションとユーザー モード**

I/O 要求を適切なカーネル モード ドライバーに渡すことのできる 2 つのシステムは Windows でユーザー モードで構成されます。 さまざまな種類のオペレーティング システム用に記述されたアプリケーションで実行され、環境システムと整数システム、機能します。環境のシステムの代わりの機能をシステムに固有です。

整数のシステムでは、環境システムに代わって system'specific 機能を管理し、(LSA) のセキュリティ システムのプロセス、ワークステーション サービス、およびサーバー サービスで構成します。 セキュリティ システムのプロセス セキュリティ トークンを処理、許可またはリソースのアクセス許可に基づいて、ユーザー アカウントにアクセスする権限を拒否します、ログオン要求を処理およびログオンの認証を開始します、およびオペレーティング システムのシステム リソースを決定します監査する必要があります。

アプリケーションは、アプリケーションがローカル システム (SYSTEM) のセキュリティ コンテキストでなどのすべてのプリンシパルとして実行できますユーザー モードで実行できます。 アプリケーションも実行できますカーネル モードでアプリケーションがローカル システム (SYSTEM) のセキュリティ コンテキストで実行できます。

SSPI は、認証、メッセージの整合性、およびメッセージのプライバシーの統合されたセキュリティ サービスを取得するために使用される API である Secur32.dll モジュールから使用できます。 アプリケーション レベルのプロトコルとセキュリティ プロトコルの抽象化レイヤーを提供します。 さまざまなアプリケーションでは、さまざまな方法を識別する、またはユーザーおよびネットワークを経由して転送されるデータの暗号化のさまざまな方法を認証の必要があるため、SSPI がさまざまな認証を含むダイナミック リンク ライブラリ (Dll) にアクセスする方法を提供します暗号化機能です。 これらの Dll は、セキュリティ サポート プロバイダー (Ssp) と呼ばれます。

管理されたサービス アカウントおよび仮想アカウントは、独自のドメイン アカウントの分離を使用した Microsoft SQL Server やインターネット インフォメーション サービス (IIS) などの重要なアプリケーションを提供するには、Windows Server 2008 R2 および Windows 7 で導入されたときにこれらのアカウントの資格情報や管理者が手動でサービス プリンシパル名 (SPN) を管理する必要があります。 これらの機能と認証でのロールの詳細については、次を参照してください[管理サービス アカウントのドキュメントを Windows 7 および Windows Server 2008 R2](https://technet.microsoft.com/library/ff641731(v=ws.10).aspx)と[グループ管理サービス アカウントの概要](../group-managed-service-accounts/group-managed-service-accounts-overview.md).

**サービスとカーネル モード**

ほとんどの Windows アプリケーションは、それらを開始するユーザーのセキュリティ コンテキストで実行、サービスの true はありません。 ネットワークや印刷サービスなど、多くの Windows サービスは、ユーザー、コンピューターの起動時に、サービス コント ローラーによって開始されます。 これらのサービスでは、ローカル サービスまたはローカル システムとして実行する可能性があり、最後の人間のユーザーがログオフした後に実行し続ける可能性があります。

> [!NOTE]
> 通常、サービスはローカル システム (SYSTEM)、ネットワーク サービス、またはローカル サービスと呼ばれるセキュリティ コンテキストで実行されます。  Windows Server 2008 R2 には、ドメイン プリンシパルである、管理されたサービス アカウントで実行されるサービスが導入されました。

サービスを開始する前に、サービス コント ローラーは、サービスの指定されており、LSA によって認証サービスの資格情報を表示し、アカウントを使用してログオンします。 Windows サービスは、サービス コント ローラー マネージャーは、サービスの制御に使用できるプログラマティック インターフェイスを実装します。 Windows サービスは、サービス コントロールのプログラムで、または手動でシステムが開始されると、自動的に開始できます。 たとえば、Windows クライアント コンピューターがドメインに参加、コンピューターのメッセンジャー サービスはドメイン コント ローラーに接続しをセキュリティで保護されたチャネルを開きます。 認証された接続を取得するには、サービスは、リモート コンピューターのローカル セキュリティ機関 (LSA) が信頼している資格情報が必要です。 ネットワークの他のコンピューターを通信するときに LSA、ローカル システムとネットワーク サービスのセキュリティ コンテキストで実行されている他のすべてのサービスの操作を行います、ローカル コンピューターのドメイン アカウントの資格情報を使用します。 ローカル コンピューター上のサービスはシステムとして実行資格情報が LSA に提示する必要はありません。

Ksecdd.sys ファイルは、管理しこれらの資格情報を暗号化し、LSA に、ローカル プロシージャ呼び出しを使用します。 ファイルの種類では既知のカーネル モードのセキュリティ サポート プロバイダー (SSP) としてで指定されているこれらのバージョンであり DRV (ドライバー)、**適用先**このトピックの冒頭にある一覧では、FIPS 140-2 レベル 1 に準拠していません。

カーネル モードには、コンピューターのハードウェアおよびシステム リソースへのフル アクセス。 カーネル モードでは、ユーザー モードのサービスとアプリケーションへのアクセスが許可されていないオペレーティング システムの重要な領域へのアクセスを停止します。

## <a name="BKMK_LSA"></a>ローカル セキュリティ機関
ローカル セキュリティ機関 (LSA) では、保護されているシステム プロセスを認証し、ローカル コンピューターにユーザーです。 さらに、LSA が (これらの側面は、ローカル セキュリティ ポリシーとしてまとめて呼ばれます)、コンピューター上のローカル セキュリティのあらゆる側面に関する情報を保持し、さまざまなサービス名とセキュリティ識別子 (Sid) の間の変換を提供します。 セキュリティ システム プロセス、ローカル セキュリティ機関サーバー サービス (LSASS)、セキュリティ ポリシーと、コンピューター システム上で有効なアカウントの追跡。

LSA では、基準となるユーザーのアカウントを発行した次の 2 つのエンティティのユーザーの id を検証します。

-   **ローカル セキュリティ機関。** LSA では、同じコンピューター上にある、セキュリティ アカウント マネージャー (SAM) データベースをチェックして、ユーザー情報を検証できます。 任意のワークステーションまたはメンバー サーバーには、ローカル ユーザー アカウントとローカル グループに関する情報を格納できます。 ただし、これらのアカウントは、そのワークステーションまたはコンピューターのみにアクセスするために使用できます。

-   **ローカル ドメインまたは信頼されたドメインのセキュリティ機関。** LSA では、アカウントを発行したエンティティと、アカウントが有効なこと、およびアカウントの所有者から要求が送られた要求の検証を接続します。

ローカル セキュリティ機関サブシステム サービス (LSASS) は、Windows セッションがアクティブなユーザーの代わりに資格情報をメモリに保存します。 保存された資格情報では、ユーザーがそれぞれのリモート サービスの資格情報を再入力しなくてもファイル共有、Exchange Server メールボックス、SharePoint サイトなどのネットワーク リソースにシームレスにアクセスできるようにします。

LSASS は、以下を含む複数の形式の資格情報を保存できます。

-   可逆的に暗号化されたプレーンテキスト

-   Kerberos チケット (チケット保証チケット (Tgt) のサービス チケット)

-   NT ハッシュ

-   LAN Manager (LM) ハッシュ

スマート カードを使用して、Windows にユーザーがログオンすると、LSASS はプレーン テキストのパスワードを保存していないが、アカウントとスマート カードの暗証番号 (pin) プレーン テキストに対応する NT ハッシュ値を格納します。 対話型ログオンに必要なスマート カードに対してアカウント属性が有効な場合は、元のパスワード ハッシュではなく、ランダム NT ハッシュ値がアカウントのために自動的に生成されます。 属性の設定時に自動的に生成されたパスワード ハッシュは変更されません。

場合は、ユーザーが LAN Manager (LM) ハッシュと互換性があるパスワードを使用して Windows ベースのコンピューターにログオンすると、この認証システムがメモリ内に存在します。

プレーンテキストの資格情報を必要とする資格情報プロバイダーが無効な場合でも、プレーンテキストの資格情報をメモリに保存することは無効にできません。

保存された資格情報が直接に関連付けられた最後の後に開始されたローカル セキュリティ機関サブシステム サービス (LSASS) のログオン セッションを再起動し、閉じられていません。 たとえば、ユーザーが以下のいずれかを実行すると、保存された LSA 資格情報を使用した LSA セッションが作成されます。

-   ローカル セッションまたはコンピューター上のリモート デスクトップ プロトコル (RDP) セッションにログオン

-   **RunAs** オプションを使用してタスクを実行する

-   コンピューターでアクティブ Windows サービスを実行する

-   スケジュールされたタスクまたはバッチ ジョブを実行する

-   リモート管理ツールを使用してローカル コンピューターでタスクを実行する

状況によっては、SYSTEM アカウント プロセスのみにアクセスできるデータの秘密の部分であり、LSA シークレットは、ハード ディスク ドライブに格納されます。 これらのシークレットの一部は、再起動後も保持される必要がある資格情報で、ハード ディスク ドライブに暗号化された形式で保存されます。 LSA シークレットとして保存される資格情報には以下が含まれます。

-   コンピューターの Active Directory Domain Services (AD DS) アカウントのアカウントのパスワード

-   コンピューターで構成されている Windows サービスのアカウント パスワード

-   構成済みのスケジュールされたタスクのアカウント パスワード

-   IIS アプリケーション プールと Web サイトのアカウント パスワード

-   Microsoft アカウントのパスワード

Windows 8.1 で導入された、クライアントのオペレーティング システムは、追加のメモリの読み取りを回避し、保護されていないプロセスによるコード インジェクションを LSA の保護を提供します。 この保護は、LSA の保存、管理資格情報のセキュリティを向上します。

これらの追加の保護の詳細については、次を参照してください。 [Configuring Additional LSA Protection](../credentials-protection-and-management/configuring-additional-lsa-protection.md)します。

## <a name="BKMK_CachedCredentialsAndValidation"></a>キャッシュされた資格情報と検証
検証に関するメカニズムは、ログオン時に資格情報の表示に依存します。 ただし、コンピューターがドメイン コント ローラーから切断されているし、ユーザーがドメインの資格情報を表示する、Windows は、検証メカニズムにキャッシュされた資格情報のプロセスを使用します。

ユーザーがドメインにログオンするたびに Windows が指定された資格情報をキャッシュし、オペレーティング システムのレジストリのセキュリティのハイブに格納します。

キャッシュされた資格情報は、ユーザー ログオンできますドメイン メンバーにそのドメイン内のドメイン コント ローラーに接続しなくても。


## <a name="BKMK_CredentialStorageAndValidation"></a>資格情報の格納および検証
これは常に望ましくありませんさまざまなリソースにアクセスするための資格情報の 1 つのセットを使用します。 たとえば、管理者可能性があります使用する管理ユーザーの資格情報ではなく、リモート サーバーにアクセスするとき。 同様に、ユーザー、銀行口座などの外部リソースにアクセスする場合は、そのユーザーのみ使用できます、ドメイン資格情報とは異なる資格情報。 次のセクションでは、資格情報の管理と、現在のバージョンの Windows オペレーティング システムと、Windows Vista および Windows XP オペレーティング システムの間の違いについて説明します。

### <a name="remote-logon-credential-processes"></a>リモート ログオン資格情報の処理
リモート デスクトップ プロトコル (RDP) は、Windows 8 で導入された、リモート デスクトップ クライアントを使用してリモート コンピューターに接続するユーザーの資格情報を管理します。 プレーン テキスト形式で資格情報は、場所、ホスト、認証プロセスを実行して、成功した場合、ユーザーを許可されているリソースに接続のターゲット ホストに送信されます。 RDP がクライアントでは、資格情報を格納していませんが、LSASS にユーザーのドメインの資格情報が格納されます。

Windows Server 2012 R2 および Windows 8.1 で導入された、制限付き管理モードはリモート ログオンのシナリオに追加のセキュリティを提供します。 このモードでリモート デスクトップは、クライアント アプリケーションをネットワーク ログオンでチャレンジ応答を NT の一方向の機能 (NTOWF) を実行またはリモートのホストを認証するときに、Kerberos サービス チケットを使用するとします。 管理者が認証された後、管理者がそれぞれのアカウントの資格情報 LSASS でがリモート ホストに指定されていません。 代わりに、管理者は、セッションのコンピューター アカウントの資格情報を持ちます。 アクションは、コンピューター アカウントとして実行するため、リモートのホストには管理者の資格情報は提供されません。 リソースは、コンピューター アカウントに制限され、管理者が自分のアカウントを使用してリソースにアクセスできません。

### <a name="automatic-restart-sign-on-credential-process"></a>自動再起動サインオン資格情報の処理
ユーザーが Windows 8.1 デバイスにサインインするときに LSA は LSASS.exe によってのみアクセス可能である暗号化されたメモリ内でユーザーの資格情報を保存します。 Windows Update では、ユーザーが存在せず、自動再起動を開始するときに、これらの資格情報は、ユーザーの自動ログオンを構成に使用されます。

再起動に Autologon メカニズムを経由して、ユーザーが自動的にサインインとコンピューターがさらに、ユーザーのセッションを保護するロックし。 ロックは、資格情報の管理は LSA によって行われますが、Winlogon を使用して開始されます。 自動的にサインインして、コンソールで、ユーザーのセッションをロックで、ユーザーのロック画面アプリケーションは、再起動して利用できます。

ARSO の詳細については、次を参照してください。 [Winlogon 自動再起動サインオン&#40;ARSO&#41;](winlogon-automatic-restart-sign-on-arso.md)します。

### <a name="stored-user-names-and-passwords-in-windows-vista-and-windows-xp"></a>Windows Vista および Windows XP で格納されたユーザー名とパスワード
Windows Server 2008、Windows Server 2003、Windows Vista、および Windows XP で**格納されたユーザー名とパスワード**コントロール パネルの 管理と使用される X.509 証明書を含む、ログオン資格情報のセットを複数の使用を簡略化。スマート カードおよび Windows Live の資格情報 (Microsoft アカウントと呼ばれるようになりました)。 ユーザーのプロファイルの一部の-資格情報は、必要になるまでに格納されます。 このアクションは、1 つのパスワードが侵害された場合は損なわことのすべてのセキュリティを確保によってリソースごとにセキュリティを向上できます。

ユーザーの既定のログオン資格情報は、アクセスには不十分な場合と、ユーザーがログオンして、サーバー上の共有など、追加のパスワードで保護されたリソースにアクセスしようとしました後**格納されたユーザー名とパスワード**が照会されます. 代替資格情報を適切なログオン情報が保存されているかどうかは**格納されたユーザー名とパスワード**、これらの資格情報は、アクセスに使用されます。 それ以外の場合、ユーザーは再利用、ログオン セッションの後で、またはそれ以降のセッション中に保存する新しい資格情報を指定するように求められます。

次の制限が適用されます。

-   場合**格納されたユーザー名とパスワード**の特定のリソース、リソースへのアクセスが拒否されると、無効なまたは正しくない資格情報が含まれていますと**格納されたユーザー名とパスワード** ダイアログ ボックスではありません表示されます。

-   **ユーザー名とパスワードが格納されている**NTLM、Kerberos のプロトコルに対してのみ資格情報を格納する Microsoft アカウント (旧 Windows Live ID)、および Secure Sockets Layer (SSL) 認証します。 Internet Explorer のバージョンによっては、基本認証用の独自のキャッシュを維持します。

これらの資格情報では、\Documents and 自動 Data\Microsoft\Credentials ディレクトリでユーザーのローカル プロファイルの暗号化の一部になります。 結果として、これらの資格情報は、ユーザーのネットワーク ポリシーは、移動ユーザー プロファイルをサポートしている場合、ユーザーと共に移動できます。 ただし、ユーザーのコピーがある場合**格納されたユーザー名とパスワード**2 つの異なるコンピューターや変更に、これらのコンピューターのいずれかのリソースに関連付けられている資格情報の変更には反映されません**ユーザー名とパスワードが格納されている**2 つ目のコンピューターにします。

### <a name="windows-vault-and-credential-manager"></a>Windows コンテナーと資格情報マネージャー
資格情報マネージャーは、格納、ユーザー名とパスワードを管理してコントロール パネルの 機能として Windows Server 2008 R2 および Windows 7 で導入されました。 資格情報マネージャーを使用して、セキュリティで保護された Windows 資格情報コンテナーに他のシステムや web サイトに関連する資格情報を格納できます。 いくつかのバージョンの Internet Explorer では、この機能を web サイトへの認証を使用します。

資格情報マネージャーを使用した資格情報管理は、ローカル コンピューター上でユーザーが制御します。 ユーザーは、サポートされるブラウザーや Windows アプリケーションにサインインする必要があるときに便利なように、それらのリソースに資格情報を保存および格納することができます。 資格情報は、ユーザーのプロファイルの下にあるコンピューターに特別な暗号化されたフォルダーに保存されます。 Web ブラウザーやアプリなど、(資格情報マネージャー Api にある) を使用してこの機能をサポートするアプリケーションでは、ログオン プロセス中に、その他のコンピューターと web サイトに正しい資格情報を表示できます。

Web サイト、アプリケーション、または別のコンピューターの要求認証 NTLM または Kerberos プロトコルを通じて、ダイアログ ボックスが表示されたら選択で、**既定の資格情報の更新**または**パスワードの保存**チェック ボックスをオンします。 ユーザーが資格情報をローカルに保存できるように、このダイアログ ボックスは、資格情報マネージャー Api をサポートするアプリケーションによって生成されます。 ユーザーが選択した場合、**パスワードの保存**資格情報マネージャー チェック ボックスは、ユーザーのユーザー名、パスワード、および使用されている認証サービスに関連する情報の追跡。

次回、サービスを使用すると、資格情報マネージャー、Windows コンテナーに格納されている資格情報を自動的に提供します。 それが受け付けられない場合は、ユーザーは正しいアクセス情報の入力を要求されます。 場合は、新しい資格情報でアクセスを許可すると、資格情報マネージャーは新しい以前の資格情報で上書きし、Windows コンテナーで新しい資格情報を格納します。

## <a name="BKMK_SAM"></a>セキュリティ アカウント マネージャー データベース
セキュリティ アカウント マネージャー (SAM) は、ローカル ユーザー アカウントとグループを格納するデータベースです。 すべての Windows オペレーティング システムであります。ただし、コンピューターがドメインに参加しているときに Active Directory は、Active Directory ドメインにドメイン アカウントを管理します。

たとえば、Windows オペレーティング システムを実行しているクライアント コンピューターは人間のユーザーがログオンしていない場合でも、ドメイン コント ローラーと通信することでネットワーク ドメインに参加します。 通信を開始するには、コンピューターは、アクティブなアカウントをドメインが必要です。 コンピューターからの通信を受け入れる前に、ドメイン コント ローラー上の LSA は、コンピューターの id を認証しは、人間のセキュリティ プリンシパルのと同様に、コンピューターのセキュリティ コンテキストを構築します。 このセキュリティ コンテキストでは、特定のコンピューターまたはユーザー、サービス、またはネットワーク上のコンピューターの id とユーザーまたはサービスの機能を定義します。 たとえば、セキュリティ コンテキスト内に含まれるアクセス トークンにアクセスできるリソース (ファイル共有またはプリンター) など、およびそのプリンシパルのユーザー、コンピューター、またはサービスを実行できる操作 (読み取り、書き込み、または変更) などが定義されていますリソースです。

ユーザーまたはコンピューターのセキュリティ コンテキストは、1 台のコンピューターから別、ユーザーが、サーバーまたはユーザーのプライマリ ワークステーション以外のワークステーションにログオンするときなどに異なります。 管理者がユーザーの権限とアクセス許可を変更する場合など、別に、1 つのセッションを異なることができます。 さらに、ユーザーまたはコンピューターがネットワークでは、または Active Directory ドメインの一部として、単独で動作しているときは、セキュリティ コンテキストは、通常は異なります。

## <a name="BKMK_LocalDomainsAndTrustedDomains"></a>ローカル ドメインと信頼されたドメイン
2 つのドメイン間に信頼関係が存在する場合、各ドメインの認証メカニズムは、その他のドメインから別の認証の有効性に依存します。 信頼認証要求を確認することにより、リソース ドメイン (信頼する側のドメイン) 内の共有リソースに対するアクセスの制御を提供するヘルプは、信頼された証明機関 (信頼されたドメイン) から取得します。 これにより、ドメイン間での認証要求の移動の検証のみを使用するブリッジの信頼関係が機能します。

特定の信頼が認証要求を渡す方法を構成する方法によって異なります。 信頼関係は、各ドメインから他のドメイン内のリソースへのアクセスを提供することで、信頼されたドメインから信頼する側のドメイン内のリソースへのアクセスを提供することで、一方向または双方向を指定できます。 信頼も信頼の 2 つのパートナー ドメイン間のみ、信頼が存在する場合、非推移性または推移的なその場合、信頼を自動的に、パートナーのいずれかが信頼している他のドメインに拡張です。

認証に関するドメインとフォレストの信頼関係について詳しくは、次を参照してください。[委任の認証と信頼関係](https://technet.microsoft.com/library/dn169022.aspx)します。

## <a name="BKMK_CertificatesInWindowsAuthentication"></a>Windows 認証で証明書
公開キー基盤 (PKI) は、ソフトウェア、暗号化テクノロジ、プロセス、およびその通信およびビジネス トランザクションをセキュリティで保護する組織を有効にするサービスの組み合わせです。 通信およびビジネス トランザクションをセキュリティで保護する、PKI の機能は、認証されたユーザーと信頼できるリソースの間でのデジタル証明書の交換に基づいています。

デジタル証明書は、電子ドキュメントに属しているエンティティ、によって発行されたエンティティ、一意のシリアル番号またはその他のいくつかの固有 id、発行と有効期限の日付、およびデジタル フィンガー プリントに関する情報を含むです。

認証は、リモート ホストが信頼できる場合を決定するプロセスです。 信頼性を確立するには、リモート ホストが使用する認証の証明書を指定してください。

リモート ホストでは、証明機関 (CA) から証明書を取得することにより、信頼関係を確立します。 CA では、信頼チェーンを作成しより高い機関から証明書を含めることはできます、します。 証明書が信頼できるかどうかを確認するのには、アプリケーションは、ルート CA の id を確認し、は信頼できるかどうかを判断しする必要があります。

同様に、リモート ホストまたはローカル コンピュータ決定する必要がありますユーザーまたはアプリケーションによって提示された証明書が信頼できるかどうか。 LSA と SSPI を通じてユーザーによって提示された証明書は、Active Directory で証明書ストアで、ローカル コンピューターのローカル ログオン、ネットワーク、またはドメインの完全性が評価されます。

証明書、認証データを生成するには、メッセージ ダイジェストを生成するハッシュ アルゴリズム、セキュア ハッシュ アルゴリズム 1 (SHA1) などを通過します。 メッセージ ダイジェストは、メッセージ ダイジェストが、送信側で生成されたことを証明するために送信者の秘密キーを使用して、デジタル署名します。

> [!NOTE]
> SHA1 では、Windows 7 および Windows Vista では、既定値ですが、SHA2 Windows 8 に変更されました。

**スマート カード認証**

スマート カード テクノロジは、証明書ベースの認証の例を示します。 スマート カードでのネットワークにログオンしているドメインにユーザーを認証するときに暗号化ベースの id と所有証明を使用しているため、強力な認証方式を提供します。 Active Directory 証明書サービス (AD CS) は、各スマート カード ログオン証明書の発行を通じて暗号化ベース id を提供します。

スマート カード認証については、次を参照してください。、 [Windows スマート カードのテクニカル リファレンス](https://technet.microsoft.com/library/ff404297.aspx)します。

仮想スマート カード テクノロジは、Windows 8 で導入されました。 PC、スマート カードの証明書を格納し、デバイスの改ざんトラステッド プラットフォーム モジュール (TPM) セキュリティ チップを使用して保護します。 これにより、PC には、スマート カードを認証するために、ユーザーの PIN を受け取る必要がありますが実際になります。

**リモートおよびワイヤレス認証**

リモートおよびワイヤレス ネットワーク認証には、認証に証明書を使用するもう 1 つのテクノロジです。 インターネット認証サービス (IAS) と仮想プライベート ネットワークのサーバーに、拡張認証プロトコル-トランスポート レベル セキュリティ (EAP-TLS)、保護されている拡張認証プロトコル (PEAP)、またはインターネット プロトコル セキュリティ (IPsec) を使用します。さまざまな種類のネットワーク アクセス (仮想プライベート ネットワーク (VPN) およびワイヤレス接続を含む) の証明書ベースの認証を実行します。

ネットワークでの証明書ベースの認証については、次を参照してください。[ネットワーク アクセスの認証と証明書](https://technet.microsoft.com/library/cc759575(WS.10).aspx)します。

## <a name="BKMK_SeeAlso"></a>参照してください。
[Windows 認証の概念](https://technet.microsoft.com/library/d169018.aspx)


