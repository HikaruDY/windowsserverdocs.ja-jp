---
title: "ユーザー アカウント制御のしくみ"
description: "Windows Server のセキュリティ"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-tpm
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: da83ddb2-6182-417c-aa8e-0b47b2e17d13
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 7f5ad234959ebfe0687b8bc10f9e43f2092252f2
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/17/2017
---
# <a name="how-user-account-control-works"></a>ユーザー アカウント制御のしくみ

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

ユーザー アカウント制御 (UAC) は、悪意のあるソフトウェア (マルウェアとも呼ばれます) によるコンピューター損傷と適切に管理されたデスクトップを展開するのに役立ちます。 UAC では、管理者が具体的には、システム管理者レベルのアクセスを承認しない限り、アプリケーションとタスクは常に管理者以外のアカウントのセキュリティ コンテキストで実行します。 UAC は、承認されていないアプリケーションの自動インストールをブロックし、システムの設定を誤って変更されないようにできます。

## <a name="uac-process-and-interactions"></a>UAC プロセスとの相互作用
管理者のアクセス トークンを必要とする各アプリケーションは、同意の管理者を求める必要があります。 1 つの例外は、親と子のプロセスに存在する関係です。 子プロセスは、親プロセスからユーザーのアクセス トークンを継承します。 ただし、親と子の両方のプロセスは同じ整合性レベルが必要です。 Windows Server 2012 は、その整合性レベルをマークすることによって、プロセスを保護します。 整合性レベルは、信頼の測定値です。 「高」整合性アプリケーションは、ディスクの「低」整合性アプリケーションがいずれかの Web ブラウザーなど、オペレーティング システムを損なう可能性のあるおそれのあるタスクを実行するときに、アプリケーションをパーティション分割などのシステムのデータを変更するタスクを実行する 1 つです。 下位の整合性レベルを持つアプリケーションより高い整合性レベルでのアプリケーションでデータを変更できません。 標準ユーザーが管理者のアクセス トークンを必要とするアプリケーションを実行しようとすると、UAC では、ユーザーが有効な管理者資格情報を提供することが必要です。

このプロセスが発生する方法をより深く理解するためには、Windows Server 2012 のログオン プロセスの詳細を確認する重要なのです。

### <a name="windows-server-2012-logon-process"></a>Windows Server 2012 のログオン プロセス
次の図は、管理者がログオン プロセスが標準ユーザーのログオン プロセスを異なる方法を示します。

![管理者がログオン プロセスが標準ユーザーのログオン プロセスを異なる方法を示す図](../media/How-User-Account-Control-Works/UACWindowsLogonProcess.gif)

既定では、標準ユーザーと管理者リソースにアクセスし、標準ユーザーのセキュリティ コンテキストでアプリケーションを実行します。 ときに、ユーザーがコンピューターにログオンするには、システムはそのユーザーのアクセス トークンを作成します。 アクセス トークンには、ユーザーを許可すると、特定のセキュリティ識別子 (Sid) など、Windows の特権アクセスのレベルについての情報が含まれています。

ユーザーの 2 つの異なるアクセス トークンを作成、管理者がログオンしたときに: 標準ユーザーのアクセス トークンと管理者のアクセス トークン。 標準ユーザーのアクセス トークンには、管理者のアクセス トークンと同じユーザーに固有の情報が含まれていますが、Windows の管理者特権と Sid が削除されます。 標準ユーザーのアクセス トークンを使用すると、(アプリケーションの標準のユーザー) の管理タスクを実行しないアプリケーションを起動します。 標準ユーザーのアクセス トークンを使用し、デスクトップ (Explorer.exe) を表示します。 Explorer.exe は、他のすべてのユーザーによって開始されたプロセスが、アクセス トークンを継承元となる親プロセスです。 その結果、すべてのアプリケーションは、ユーザーの同意を提供または資格情報の完全な管理アクセス トークンを使用するアプリケーションを承認する場合を除き、標準ユーザーとして実行します。

Administrators グループのメンバであるユーザーでは、ログオン、Web の閲覧、および標準ユーザーのアクセス トークンを使用しているときに電子メールを読んだりことができます。 管理者が、管理者のアクセス トークンを Windows Server 2012 が自動的に必要なタスクを実行する必要がある場合に、ユーザーに承認するように求められます。 このプロンプトで、昇格時のプロンプトが呼び出され、ローカル セキュリティ ポリシー スナップイン (Secpol.msc) またはグループ ポリシーを使用してその動作を構成することができます。

> [!NOTE]
> 「昇格させる」という用語がために、同意を求めるまたは完全な管理者のアクセス トークンを使用する資格情報を Windows Server 2012 でのプロセスを参照してください。

### <a name="the-uac-user-experience"></a>UAC のユーザー エクスペリエンス
UAC が有効な場合、標準ユーザーのユーザー エクスペリエンスが管理者承認モードで管理者の異なるです。 Windows Server 2012 を実行していることをお勧めとより安全な方法は、プライマリのユーザーが標準ユーザー アカウントをアカウントにです。 標準ユーザーとして実行している管理対象環境のセキュリティを高めるために役立ちます。 組み込みの UAC 昇格コンポーネントと、標準ユーザーは、ローカル管理者アカウントの有効な資格情報を入力して管理タスクを簡単に実行できます。 既定では、標準ユーザーに対する組み込みの UAC 昇格コンポーネントは、資格情報プロンプトです。

標準ユーザーは、管理者承認モードで管理者として実行するように、実行する代わりに、します。 組み込みの UAC 昇格コンポーネントと、ローカルの Administrators グループのメンバーは承認を提供することで管理タスクを簡単に実行できます。 既定では、管理者承認モードで管理者アカウントの組み込みの UAC 昇格コンポーネントには、同意を求めるメッセージが呼び出されます。 UAC の昇格のプロンプトを表示する動作は、ローカル セキュリティ ポリシー スナップイン (Secpol.msc) またはグループ ポリシーを使用して構成できます。

**同意と資格情報プロンプト**

UAC は有効になっている、Windows Server 2012 に関する同意プロンプトまたはプログラムまたは完全な管理者のアクセス トークンが必要なタスクを開始する前に有効なローカル管理者アカウントの資格情報の入力を求めます。 このプロンプトは、悪意のあるソフトウェアをサイレント インストールしないことにより、します。

**同意プロンプト**

ユーザーが、ユーザーの管理アクセス トークンが必要なタスクを実行しようとすると、同意を求めるメッセージが表示されます。 UAC 同意のプロンプトのスクリーン ショットを次に示します。

![UAC 同意のプロンプトのスクリーン ショット](../media/How-User-Account-Control-Works/UACConsentPrompt.gif)

**資格情報プロンプト**

標準ユーザーが、ユーザーの管理アクセス トークンが必要なタスクを実行しようとすると、資格情報プロンプトが表示されます。 この標準ユーザーの既定プロンプトの動作は、ローカル セキュリティ ポリシー スナップイン (Secpol.msc) またはグループ ポリシーを使用して構成できます。 管理者は、ユーザー アカウント制御を設定して、資格情報を提供する必要もことができます。 資格情報のプロンプトの値を設定する管理者承認モード ポリシーでの管理者に対する昇格時のプロンプトの動作します。

次のスクリーン ショットは、資格情報の UAC プロンプトの例を示します。

![UAC 資格情報プロンプトの例を示すスクリーン ショット](../media/How-User-Account-Control-Works/UACCredentialPrompt.gif)

**UAC 昇格時のプロンプト**

UAC の昇格時のプロンプトは色分けするアプリケーションの潜在的なセキュリティ リスクの即時の id を有効にすると、アプリケーションに固有です。 アプリケーションが管理者のフル アクセス トークンを使用して実行しようとすると、Windows Server 2012 はまず、発行元を判断する実行可能ファイルを分析します。 アプリケーションが実行可能ファイルの発行元に基づく 3 つのカテゴリに分けられますまず: (署名)、Windows Server 2012、発行元を検証し、発行元が検証されない (符号なし)。 次の図は、Windows Server 2012 で、ユーザーに提示するどの色昇格時のプロンプトを決定する方法を示しています。

昇格のプロンプト色分けのとおりです。

-   赤の背景に赤い盾アイコン: アプリケーションはグループ ポリシーによってブロックまたはブロックされている発行元がします。

-   青青と金色の盾アイコンがバック グラウンド: アプリケーションがコントロール パネルの項目などの Windows Server 2012 管理用アプリケーション。

-   青の青い盾アイコンがバック グラウンド: アプリケーションは、Authenticode を使用して署名され、ローカル コンピューターによって信頼されています。

-   黄色のシールド アイコンでバック グラウンドの黄色い: アプリケーションが署名されていない、または署名されているが、ローカル コンピューターによって信頼されていません。

**盾アイコン**

一部のコントロール パネル項目など、**日付と時刻のプロパティ**、管理者と標準的なユーザー操作の組み合わせが含まれます。 標準ユーザーの時計の表示し、タイム ゾーンを変更することができますが、ローカル システム時刻を変更するには完全な管理者のアクセス トークンが必要です。 スクリーン ショットを次に示します、**日付と時刻のプロパティ**コントロール パネルの項目。

![スクリーン ショットを示す、* * 日付と時刻のプロパティ * * コントロール パネルの項目](../media/How-User-Account-Control-Works/UACShieldIcon.gif)

盾アイコン、**日付と時刻を変更する**ボタンことを示し、プロセスは完全な管理者のアクセス トークンが必要 UAC 昇格時のプロンプトが表示されます。

**昇格時のプロンプトをセキュリティで保護します。**

昇格プロセスはさらに、セキュリティで保護されたデスクトップにプロンプトを参照させることによって保護されます。 同意と資格情報プロンプトは、Windows Server 2012 では既定でセキュリティで保護されたデスクトップに表示されます。 Windows プロセスのみ、セキュリティで保護されたデスクトップにアクセスできます。 セキュリティのより高いレベルのことをお勧め状態で保持する、**ユーザー アカウント制御: 昇格のプロンプト時にセキュリティで保護されたデスクトップに切り替える**ポリシー設定を有効にします。

実行可能ファイルは、昇格を要求するときは、対話型のデスクトップでは、ユーザーのデスクトップとも呼ばれますが、セキュリティで保護されたデスクトップに切り替えられます。 セキュリティで保護されたデスクトップでは、ユーザーのデスクトップを暗くし、続行する前に応答する必要があります、昇格時のプロンプトを表示します。 ユーザーが [はい] をクリックし、デスクトップがユーザーのデスクトップに切り替えるいいえ、または場合。

マルウェアがセキュリティで保護されたデスクトップで、ユーザー アカウント制御模倣を表示できます: 管理者承認モード ポリシー設定での管理者に対する昇格時のプロンプトの動作は同意のプロンプトに設定されて、マルウェアが昇格を取得してできない場合は、ユーザーが、模倣を [はい] をクリックします。 資格情報のプロンプトに、ポリシー設定を設定すると、資格情報プロンプトを偽装するマルウェアがユーザーから資格情報を収集できる可能性があります。 ただし、マルウェアが、昇格された特権を取得できないと、収集されたパスワードを使っても、ユーザー インターフェイスの制御を奪われるマルウェアを軽減するその他の保護がシステムにします。

マルウェアは、セキュリティで保護されたデスクトップの模倣おそれ、中に、ユーザーでは、コンピューターにマルウェアがインストールされていた場合を除き、この問題が発生することはできません。 管理者のアクセス トークンを必要とするプロセスは、UAC が有効になっているときにサイレント インストールことはできません、ため、ユーザー必要がありますを明示的に指定の同意をクリックして**はい**または管理者の資格情報を提供することでします。 UAC の昇格時のプロンプトの特定の動作は、グループ ポリシーによって異なります。

## <a name="uac-architecture"></a>UAC アーキテクチャ
次の図では、UAC アーキテクチャについて説明します。

![UAC アーキテクチャの詳細を示す図](../media/How-User-Account-Control-Works/UACArchitecture.gif)

各コンポーネントをより深く理解するには、次の表を確認します。

|コンポーネント|説明|
|-------|--------|
|**ユーザー**||
|ユーザーが特権を必要とする操作を行う|操作は、ファイル システムまたはレジストリを変更する場合は、仮想化が呼び出されます。 その他のすべての操作は、ShellExecute を呼び出します。|
|ShellExecute|ShellExecute CreateProcess を呼び出します。 ShellExecute が CreateProcess からの ERROR_ELEVATION_REQUIRED エラーを探します。 エラーを受信した場合、ShellExecute は管理者特権でのプロンプトで要求されたタスクを実行しようとするアプリケーション情報サービスを呼び出します。|
|CreateProcess|アプリケーションでは、昇格が必要とする場合、CreateProcess は ERROR_ELEVATION_REQUIRED の呼び出しを拒否します。|
|**システム**||
|アプリケーション情報サービス|システム サービスを 1 つ以上の昇格された特権または実行するには、ローカルの管理タスクなどのユーザー権限を必要とするアプリケーションを開始しより高い整合性レベルを必要とするアプリケーションを支援します。 アプリケーションの情報のサービスにより開始昇格が必要な場合と、(グループ ポリシー) によって、管理ユーザーのフル アクセス トークンを使用してアプリケーションの新しいプロセスを作成することでこのようなアプリケーションに同意するものはそのためには、ユーザーが与えられます。|
|ActiveX インストールを昇格します。|ActiveX がインストールされていない場合、システムは、UAC スライダーのレベルを確認します。 ActiveX がインストールされている場合、**ユーザー アカウント制御: 昇格のプロンプト時にセキュリティで保護されたデスクトップに切り替える**グループ ポリシー設定を確認します。|
|UAC スライダーのレベルを確認します。|UAC は、4 つのレベルの通知から選択して、スライダーを使用して通知レベルを選択するようになりました。<br /><br /><ul><li>高<br /><br />    スライダー設定されている場合**常に通知する**、システムは、セキュリティで保護されたデスクトップが有効になっているかどうかを確認します。</li><li>[中]<br /><br />    スライダー設定されている場合**既定通知のみプログラムしようとしたら [マイ コンピューターに変更を加える**、**ユーザー アカウント制御: 署名され検証された実行可能ファイルの昇格のみ**ポリシー設定がオンになっています。<br /><br /><ul><li>ポリシー設定が有効になっている場合は、実行が許可される前に指定された実行可能ファイルの公開キー基盤 (PKI) 証明書パス検証は適用します。</li><li>ポリシーの設定がない場合 (既定)、有効になっている、指定した実行可能ファイルの実行が許可される前に、PKI 証明書パス検証は強制されません。 **ユーザー アカウント制御: 昇格のプロンプト時にセキュリティで保護されたデスクトップに切り替える**グループ ポリシー設定を確認します。</li></ul></li><li>低<br /><br />    スライダー設定されている場合**通知プログラムがコンピューターに変更を加えるとする場合にのみ (デスクトップを暗転しない)**、CreateProcess が呼び出されます。</li><li>通知しません。<br /><br />    スライダー設定されている場合**通知しないときに**、UAC プロンプトは、通知しない場合、プログラムをインストールしようとしています。 または、コンピューター上の変更を加えたしようとしています。 **重要:**この設定は推奨されません。 この設定は、設定と同じ、**ユーザー アカウント制御: 管理者承認モードでの管理者に対する昇格時のプロンプトの動作**ポリシー設定を**メッセージを表示せずに昇格**します。</li></ul>|
|セキュリティで保護されたデスクトップを有効になっています。|**ユーザー アカウント制御: 昇格のプロンプト時にセキュリティで保護されたデスクトップに切り替える**ポリシー設定を確認します。<br /><br />-セキュリティで保護されたデスクトップが有効になっている場合、すべての昇格要求は、管理者と標準ユーザーのプロンプトの動作のポリシー設定に関係なく、セキュリティで保護されたデスクトップに移動します。<br />-セキュリティで保護されたデスクトップが有効でない場合、昇格のすべての要求が、対話ユーザーのデスクトップに移動し、管理者と標準ユーザーのユーザーごとの設定を使用します。|
|CreateProcess|CreateProcess は、AppCompat、Fusion、インストーラーの検出機能をアプリケーションには、昇格が必要とする場合の評価を呼び出します。 実行可能ファイルを実行可能ファイルのアプリケーション マニフェストに格納されている、要求された実行レベルを決定し、検証されます。 CreateProcess がマニフェストで指定された要求実行レベルがアクセス トークンと一致しない場合は失敗し、ShellExecute にエラー (ERROR_ELEVATION_REQUIRED) を返します。 |
|AppCompat|AppCompat データベースでは、アプリケーションのアプリケーションの互換性修正プログラムのエントリの情報を格納します。|
|Fusion|Fusion データベースは、アプリケーションを記述するアプリケーションのマニフェストから情報を格納します。 新しい要求実行レベル フィールドを追加するのには、マニフェスト スキーマが更新されます。|
|インストーラーの検出|インストーラーの検出は、セットアップの実行可能ファイル、インストール、ユーザーの知識と同意なしに実行されるを防ぎやすくを検出します。|
|**カーネル**||
|仮想化|仮想化テクノロジは、非対応のアプリケーションはサイレントが失敗しないように実行するかが失敗する原因を特定できないことを確認します。 UAC は、ファイルおよびレジストリの仮想化と保護された領域に書き込むアプリケーションのログにも提供します。|
|ファイル システムとレジストリ|ユーザーごとのファイルおよびレジストリの仮想化は、ユーザーごとのと同じ場所に、コンピューターごとのレジストリとファイルの書き込み要求をリダイレクトします。 読み取り要求、ユーザーごとの仮想化された場所にリダイレクトする 2 番目の最初と、コンピューターごとの場所にします。|

以前のバージョンの Windows から Windows Server 2012 の UAC の変更があります。 新しいスライダーが決して UAC 完全にオフにします。 新しい設定が実施されます。

-   UAC サービスを実行してください。

-   原因すべて昇格を要求に自動承認 UAC プロンプトを表示することがなく管理者によって開始します。

-   標準ユーザーに対するすべての昇格要求を自動的に拒否されます。

> [!IMPORTANT]
> UAC を完全に無効にするために、ポリシーを無効にする必要があります**ユーザー アカウント制御: 管理者承認モードでのすべての管理者の実行**します。

> [!WARNING]
> カスタマイズされたアプリケーションは、UAC を無効にすると Windows Server 2012 では機能しません。

### <a name="virtualization"></a>仮想化
エンタープライズ環境でシステム管理者がシステムをセキュリティで保護しようとすると、ために、多くの基幹業務 (LOB) アプリケーションが標準ユーザーのアクセス トークンのみを使用する設計されています。 その結果、IT 管理者は、uac を有効になっている Windows Server 2012 を実行しているときに、アプリケーションの大部分を置き換えるには必要ありません。

 Windows Server 2012 には、UAC 対応ではないと正常に実行する管理者のアクセス トークンを必要とするアプリケーションのファイルおよびレジストリの仮想化テクノロジが含まれています。 仮想化により UAC 対応ではないアプリケーションを Windows Server 2012 と互換性があるようになります。 UAC 対応ではない管理アプリケーション、プログラム ファイルなど、保護されたディレクトリへの書き込みを試みるときに UAC は独自の仮想化されたビューを変更しようとすると、リソースのアプリケーションを示します。 仮想化されたコピーは、ユーザーのプロファイルに維持されます。 この方法では、非対応のアプリケーションを実行する各ユーザーの仮想化されたファイルの個別のコピーを作成します。

仮想化機能を使用して、ほとんどのアプリケーションのタスクが適切に動作します。 仮想化には、多くのアプリケーションを実行することができますが、短期的な修正プログラムと長期的なソリューションではなくなります。 アプリケーションの開発者は、ファイル、フォルダー、およびレジストリの仮想化の証明書利用者のではなく、できるだけ早く、Windows Server 2012 のロゴ プログラムに準拠するようにアプリケーションを変更する必要があります。

仮想化はオプションで、次のシナリオではありません。

1.  仮想化は、アプリケーションが昇格し、完全な管理アクセス トークンを使用して実行するには適用されません。

2.  仮想化には、32 ビットのアプリケーションのみがサポートしています。 非特権を持つ 64 ビット アプリケーションでは、アクセス拒否メッセージを Windows オブジェクトへのハンドル (一意の識別子) を取得するときだけで表示されます。 ネイティブの 64 ビットの Windows アプリケーションでは、UAC 互換性があると、正しい場所にデータを書き込む必要があります。

3.  アプリケーションが要求された実行レベルの属性を持つアプリケーション マニフェストに含まれる場合、アプリケーションの仮想化は無効です。

### <a name="request-execution-levels"></a>実行レベルを要求します。
アプリケーション マニフェストは、XML ファイルが説明されているアプリケーションは実行時にバインドする必要があります共有およびプライベートのサイド バイ サイド アセンブリを指定します。 Windows Server 2012 では、アプリケーション マニフェストには、UAC アプリケーション互換性のためのエントリが含まれます。 アプリケーション マニフェストでのエントリを含む管理アプリケーションは、ユーザーにユーザーのアクセス トークンにアクセスする許可を求められます。 アプリケーション マニフェストでのエントリを持っていないものがほとんどの管理アプリケーションは、アプリケーションの互換性修正プログラムを使用して、変更なし実行できます。 アプリケーションの互換性修正プログラムは、Windows Server 2012 で正しく動作する対応 UAC ではないアプリケーションを有効にするデータベース エントリです。

UAC に対応のすべてのアプリケーションには、要求された実行レベルをアプリケーション マニフェストに追加される必要があります。 場合は、アプリケーションは、システムへの管理アクセスを必要とするレベルを要求する管理者] の要求の実行を使用するアプリケーションとしてマークにより、システムが管理アプリケーションとしてこのプログラムを識別し、昇格のために必要な手順を実行します。 実行レベルを指定のアプリケーションに必要な特権を要求します。

### <a name="installer-detection-technology"></a>インストーラーの検出のテクノロジ
インストール プログラムは、アプリケーション ソフトウェアを展開するよう設計されています。 ほとんどのインストール プログラムは、システム ディレクトリやレジストリ キーに書き込みます。 これらの保護されたシステムの場所は、通常、インストーラーの検出テクノロジは、標準ユーザーに、プログラムをインストールするための十分なアクセスがないことを意味で管理者のみが書き込み可能なです。 Windows Server 2012 では、アクセス特権で実行するために、インストール プログラムと管理者の資格情報を要求または承認、管理者ユーザーからがヒューリスティックによってが検出します。 Windows Server 2012 は、ヒューリスティックによっても、更新プログラムとアプリケーションをアンインストールするプログラムを検出します。 UAC の設計目標の 1 つは、ユーザーの知らない間に実行されるをインストールできないようにすると、インストール プログラムは、ファイル システムとレジストリの保護された領域に書き込むために同意するものです。

インストーラーの検出にのみ適用されます。

-   32 ビット実行可能ファイルです。

-   要求された実行レベルの属性がないアプリケーション。

-   対話型プロセスが有効になっている UAC で標準ユーザーとして実行しています。

32 ビット プロセスが作成される前に、インストーラーであるかどうかを決定する、次の属性が確認されます。

-   ファイル名には、「更新プログラム」または「インストール」、「セットアップ」などのキーワードが含まれます

-   バージョン管理リソースのフィールドに次のようなキーワードが含まれている: 仕入先、会社名、製品名、ファイルの説明、元のファイル名、内部名、およびエクスポートの名前。

-   サイド バイ サイドのマニフェストでのキーワードは、実行可能ファイルに埋め込まれます。

-   特定のエントリが持つ StringTable キーワードは、実行可能ファイルにリンクされています。

-   リソース スクリプトのデータのキー属性は、実行可能ファイルにリンクされています。

-   対象となるシーケンスの実行可能ファイル内のバイトがあります。

> [!NOTE]
> キーワードとバイトのシーケンスはされたさまざまなインストーラーのテクノロジから観察された共通の特性から派生します。

> [!NOTE]
> ユーザー アカウント制御: アプリケーションのインストールを検出し、インストール プログラムを検出するためにインストーラー検出するため、昇格のポリシー設定を有効にする必要がありますの入力を求めます。 この設定は既定で有効になっているとは、ローカル セキュリティ ポリシー スナップイン (Secpol.msc) を使用してローカルで構成されているまたはグループ ポリシー (Gpedit.msc) で、ドメイン、OU、または特定のグループ用に構成されました。


