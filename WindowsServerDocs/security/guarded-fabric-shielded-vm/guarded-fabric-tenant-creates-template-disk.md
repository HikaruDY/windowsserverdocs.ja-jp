---
title: 省略可能なテンプレート ディスク - の作成 - テナント用のシールドされた Vm
ms.custom: na
ms.prod: windows-server-threshold
ms.topic: article
ms.assetid: c1992f8b-6f88-4dbc-b4a5-08368bba2787
manager: dongill
author: rpsqrd
ms.technology: security-guarded-fabric
ms.date: 08/29/2018
ms.openlocfilehash: 2709c84a16dadc2211af4a6f5b43c13266ede155
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59874633"
---
# <a name="shielded-vms-for-tenants---creating-a-template-disk-optional"></a>(省略可能) テンプレート ディスクを作成する - テナント用のシールドされた Vm

>適用対象:Windows Server 2019、Windows Server (半期チャネル)、Windows Server 2016

新しいシールドされた VM を作成するには特別に準備された、署名付きテンプレート ディスクを使用する必要があります。 署名付きテンプレート ディスクからのメタデータにより、作成した後、ディスクが変更されないように、どのディスクを制限するテナントを使用して、シールドされた Vm を作成することにできます。 このディスクを提供する 1 つの方法は、作成して、このトピックで説明したように、テナントです。 

> [!IMPORTANT]
> 場合は、代わりに、ホスティング サービス プロバイダーによって提供されたテンプレート ディスクを使用することができます。 これを行う場合は、ディスクを検証する VM テンプレート ディスクを使用して (ウイルス対策や脆弱性スキャナー、)、独自のツールを実行するが、実際には、信頼できる状態でテストの配置に重要です。

## <a name="prepare-an-operating-system-vhdx"></a>オペレーティング システム VHDX を準備します。

シールドされたテンプレート ディスクを作成するには、まずテンプレート ディスク ウィザードを実行する OS ディスクを準備する必要があります。 このディスクは、シールドされた Vm で OS ディスクとして使用されます。 既存のツールを使用してなど Microsoft Desktop イメージ サービス マネージャー (DISM)、このディスクを作成または手動で vhdx フォーマットの空白を使用して VM をセットアップし、そのディスクに OS をインストールすることができます。 ディスクを設定する場合はジェネレーション 2 に固有のものや、シールドされた Vm を次の要件に従う必要があります。 

| VHDX の要件 | Reason |
|-----------|----|
|GUID パーティション テーブル (GPT) ディスクにする必要があります。 | UEFI をサポートするために第 2 世代仮想マシンに必要な|
|ディスクの種類である必要があります**基本的な**ではなく**動的**します。 <br>注:これは、「可変」VHDX 機能ではありません、HYPER-V でサポートされている、論理ディスクの種類を指します。 | BitLocker は、ダイナミック ディスクをサポートしていません。|
|ディスクでは、少なくとも 2 つのパーティションがあります。 1 つのパーティションには、Windows がインストールされているドライブを含める必要があります。 これは、BitLocker が暗号化するドライブです。 もう一方のパーティションは、アクティブ パーティションがブートローダーを含まれておりは、コンピューターを起動できるように暗号化されていません。|BitLocker に必要な|
|ファイル システムは NTFS です。 | BitLocker に必要な|
|VHDX にインストールされているオペレーティング システムは、次のいずれか。<br>-Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、または Windows Server 2012 <br>Windows 10、Windows 8.1、Windows 8| 第 2 世代仮想マシンと Microsoft セキュア ブート テンプレートをサポートするために必要|
|オペレーティング システムが一般化された (実行 sysprep.exe) をする必要があります。 | 専門テンプレート プロビジョニングでは、特定のテナントのワークロード用の Vm| 

> [!NOTE]
> この段階で、VMM ライブラリにテンプレート ディスクをコピーしないでください。 

### <a name="required-packages-to-create-a-nano-server-template-disk"></a>Nano Server のテンプレート ディスクを作成するパッケージが必要

シールドされた Vm では、ゲスト OS として Nano Server を実行しようとしている場合、Nano Server イメージには、次のパッケージが含まれています。 ことを確認する必要があります。

- Microsoft-NanoServer-Guest-Package
- Microsoft-NanoServer-SecureStartup-Package

## <a name="run-windows-update-on-the-template-operating-system"></a>テンプレートのオペレーティング システムで Windows Update を実行します。

テンプレート ディスク上には、オペレーティング システムがすべての最新の Windows 更新プログラムがインストールされていることを確認します。 最近リリースされた更新プログラムがエンド ツー エンドのシールド プロセスの信頼性を向上させる - プロセスが失敗する場合は、完全にテンプレートのオペレーティング システムが最新ではありません。

## <a name="sign-and-protect-the-vhdx-with-the-template-disk-wizard"></a>サインインし、テンプレート ディスク ウィザードを使用して VHDX を保護します。

でシールドされた Vm をテンプレート ディスクを使用するには、ディスクを署名され、BitLocker で暗号化する必要があります。 これを行うには、シールドされたテンプレート ディスクの作成ウィザードを使用します。 このウィザードでは、ディスクのハッシュを生成し、ボリューム シグネチャ カタログ (VSC) に追加します。 VSC を指定し、プロビジョニング プロセス中にテナントの展開されているディスクが変更またはテナントによって信頼されていないディスクと交換されていないことを確認するために使用する証明書を使用して署名されます。 最後に、BitLocker が VM のプロビジョニング中の暗号化にディスクを準備するれる (これがまだ存在しない) 場合、ディスクのオペレーティング システムにインストールします。

> [!NOTE]
> テンプレート ディスク ウィザードでは、インプレースを指定するテンプレート ディスクを変更します。 後で、ディスクを更新するウィザードを実行する前に、保護されていない VHDX のコピーを作成することがあります。 テンプレート ディスク ウィザードを使用して保護されているディスクを変更することはできません。

(保護されたホストまたは VMM サーバーにするは必要ありません)、Windows Server 2016 を実行するコンピューターで、次の手順に従います。

1. コピーで作成された一般化された VHDX [VHDX オペレーティング システムを準備する](#prepare-an-operating-system-vhdx)がない場合は、サーバーにします。

2. インストール、**シールドされた VM ツール**機能**リモート サーバー管理ツール**コンピューターにします。

        Install-WindowsFeature RSAT-Shielded-VM-Tools -Restart

3. 取得するか、新しいシールドされた Vm のテンプレート ディスクになる VHDX を署名する証明書を作成します。 この証明書の詳細は、信頼されたディスクとしてディスクを承認するシールド データ ファイルに組み込まれる予定です。 したがってをホストするサービスのプロバイダーの信頼された証明機関から証明書を入手する重要なは。 ホスト側とテナントの両方がエンタープライズ シナリオでは、PKI からこの証明書を発行することを検討する可能性があります。

    テスト環境のセットアップされ、テンプレート ディスクの署名に自己署名証明書を使用する場合は、コンピューターに、次のようなコマンドを実行します。

        New-SelfSignedCertificate -DnsName publisher.fabrikam.com

4. 開始、**テンプレート ディスク ウィザード**から、**管理ツール**フォルダーの [スタート] メニューまたは」と入力して**TemplateDiskWizard.exe**コマンド プロンプトにします。

5. **証明書**] ページで [**参照**証明書の一覧を表示します。 ディスクのテンプレートの署名に使用する証明書を選択します。 **[OK]** をクリックし、**[次へ]** をクリックします。

6. 仮想ディスク ページで、次のようにクリックします。**参照**準備した VHDX を選択する をクリックし、**次**します。

7. 署名カタログ ページで、提供、わかりやすい**ディスク名**と**バージョン。** これらのフィールドは、署名された後に、ディスクを識別するために存在します。

    たとえば、**ディスク名**入力_WS2016_および**バージョン**、 _1.0.0.0_

8. ウィザードの [設定の確認] ページで選択内容を確認します。 クリックすると**生成**ウィザードがテンプレート ディスク上の BitLocker を有効にする、ディスクのハッシュを計算および VHDX メタデータに格納されているボリューム署名カタログを作成します。

    マウントまたはテンプレート ディスクを移動する前に、署名プロセスが完了するまで待機します。 このプロセスが、ディスクのサイズによっては、完了にかかる可能性があります。 

9. **概要**ページで、ディスクのテンプレートを使用して、テンプレートの署名証明書に関する情報と証明書の発行者が表示されます。 **[閉じる]** をクリックしてウィザードを終了します。


」の説明に従って、ディスクのシールドされたテンプレートを作成したシールド データ ファイルと共に、ホスティング サービス プロバイダーに提供[シールド データ定義のシールドされた VM を作成する](guarded-fabric-tenant-creates-shielding-data.md)します。

## <a name="see-also"></a>関連項目

- [シールドされた Vm をデプロイします。](guarded-fabric-configuration-scenarios-for-shielded-vms-overview.md)
- [保護されたファブリックとシールドされた Vm](guarded-fabric-and-shielded-vms-top-node.md)
