---
title: 保護されたファブリックとシールドされた VM のホスト向けのガイドの計画
ms.custom: na
ms.prod: windows-server-threshold
ms.topic: article
ms.assetid: 854defc8-99f8-4573-82c0-f484e0785859
manager: dongill
author: nirb-ms
ms.technology: security-guarded-fabric
ms.date: 08/29/2018
ms.openlocfilehash: 320723f7a0a25784180b232ce05d42c2ced933c8
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/20/2019
ms.locfileid: "67284184"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-hosters"></a>保護されたファブリックとシールドされた VM のホスト向けのガイドの計画

>適用対象:Windows Server 2019、Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、シールドされた仮想マシンに、fabric で実行できるようにする必要がある計画の決定について説明します。 既存の HYPER-V ファブリックのアップグレードまたは新しいファブリックを作成するかどうかシールドされたを実行している Vm から成る 2 つの主要なコンポーネント。

- ホスト ガーディアン サービス (HGS) は、構成証明およびキーの保護を提供するため、承認され、正常な HYPER-V ホストでのみシールドされた Vm を実行することを確認することができます。 
- シールドされた Vm (および通常の Vm) が実行できる承認され、正常な状態の HYPER-V ホスト-これらは、保護されたホストと呼ばれます。

![HGS と保護されたホスト](../media/Guarded-Fabric-Shielded-VM/guarded-host-hgs-plus-host-diagram-basic.png)

## <a name="decision-1-trust-level-in-the-fabric"></a>決定 1:ファブリック内のレベルを信頼します。

ホスト ガーディアン サービスと保護された HYPER-V ホストを実装する方法は、主に、ファブリックに実現するために表示されている信頼強度に依存します。 信頼関係の強さは、構成証明モードが適用されます。 2 つの相互に排他的なオプションがあります。

1. TPM によって信頼された構成証明

    目標は、悪意のある管理者またはセキュリティを侵害されたファブリックから仮想マシンを保護するためには、TPM によって信頼された構成証明を使用します。 このオプションは、マルチ テナント ホスティング シナリオにも対応のドメイン コント ローラー、SQL や SharePoint などのコンテンツ サーバーなど、エンタープライズ環境で高価値資産の場合とよく動作します。
    ハイパーバイザーで保護されているコード整合性 (HVCI) ポリシーが測定され、シールドされた Vm のホストの実行が許可される前に、HGS によって適用される、妥当性。 

2. ホスト キーの構成証明

    場合は、要件主に中心とコンプライアンスを必要とする仮想マシンは必要ホスト キーの構成証明を使用して、保存時と、実行中の両方と暗号化されます。 このオプションは汎用のデータ センターのも、準備が整うの HYPER-V ホストとファブリック管理者に日常的なメンテナンスと運用用仮想マシンのゲスト オペレーティング システムにアクセスすることです。 

    このモードでは、ファブリック管理者は、HYPER-V ホストの正常性を確保するため責任を負うものです。 
    HGS は何かを実行することはできませんを決定するときに役割を果たしますありません、ためマルウェアとデバッガーが機能に設計されています。 
    
    ただし、デバッガー (WinDbg.exe) などのプロセスに直接アタッチするには、VM のワーカー プロセス (VMWP.exe) が保護されているプロセス light (PPL) であるために、シールドされた Vm のブロックされます。 
    LiveKd.exe で使用されるものなど、別のデバッグ技術はブロックされません。 
    シールドされた Vm とは異なり、従来のデバッガーよう WinDbg.exe、PPL が引き続き正常に機能の暗号化サポート Vm ワーカー プロセスは実行されません。

    同様の構成証明モードが管理者によって信頼された構成証明書を名前付き Windows Server 2019 以降非推奨です (Active Directory に基づく)。 

信頼レベルを選択するには、ファブリックに適用するポリシーと同様に、HYPER-V ホストのハードウェア要件が決まります。 必要に応じては、既存のハードウェアおよび管理者によって信頼された構成証明を使用して、保護されたファブリックを展開しに変換し TPM によって信頼された構成証明書とハードウェアがアップグレードされ、fabric のセキュリティを強化する必要があります。

## <a name="decision-2-existing-hyper-v-fabric-versus-a-new-separate-hyper-v-fabric"></a>決定 2:個別の新しい HYPER-V ファブリックと既存の HYPER-V ファブリック

既存のファブリックがある場合を通常の Vm とシールドされた Vm の実行に使用できますが非常に高くなります (HYPER-V またはそれ以外の場合)。 ビジネス上の理由から、ファブリックを区切る他のユーザー間を既存のツールやファブリックにシールドされた Vm を統合する一部の顧客を選択します。

## <a name="hgs-admin-planning-for-the-host-guardian-service"></a>HGS 管理者は、ホスト ガーディアン サービスの計画

専用の物理サーバー、シールドされた VM、または別の Azure を使用して論理的に分離されます (その保護対象のファブリックから区切られます)、分離の HYPER-V ホスト上の VM であるかどうかに高度なセキュリティ環境でホスト ガーディアン サービス (HGS) をデプロイします。サブスクリプション。   

| エリア | 詳細 |
|------|---------|
| インストール要件 | <ul><li>1 つのサーバー (3 ノード クラスターの高可用性のためお勧めします)</li><li>フォールバック HGS の少なくとも 2 台のサーバーが必要です。</li><li>仮想または物理サーバーを指定できます (物理サーバーで推奨されるは TPM 2.0TPM 1.2 もサポートされています)</li><li>Windows Server 2016 以降の server Core インストール</li><li>HTTP を許可するファブリックにネットワークの認識または[フォールバックの構成](guarded-fabric-manage-branch-office.md#fallback-configuration)</li><li>HTTPS 証明書のアクセスの検証をお勧めします。</li></ul> |
| サイズ変更 | 各中規模 (8 コア/4 GB) HGS サーバー ノードには、1,000 の HYPER-V ホストを処理できます。 |
| 管理 | HGS を管理するユーザーを指定します。 ファブリック管理者から個別があります。 比較については、HGS クラスターを管理の分離、物理的な展開および全体的なレベルのセキュリティの観点から証明機関 (CA) と同じ方法で考えることができます。 |
| ホスト ガーディアン サービスの Active Directory | 既定では、HGS には、独自の内部 Active Directory の管理がインストールされます。 これは自己完結型の自己管理型フォレストであり、ファブリックから HGS を特定しやすく構成はお勧めします。<br><br>まだ、高い特権を持つ Active Directory フォレストを分離するために使用する場合は、HGS の既定のフォレストではなく、そのフォレストを使用できます。 HGS が HYPER-V ホストまたはファブリックの管理ツールと同じフォレスト内のドメインに参加していないことが重要です。 これにより、HGS を制御するファブリック管理者。 |
| ディザスター リカバリー | 次の 3 つのオプションがあります。<br><ol><li>各データ センターでの HGS は別のクラスターをインストールし、シールドされた Vm をプライマリとバックアップ データ センターの両方で実行を承認します。 これにより、WAN 経由でクラスターを拡張する必要がなくなります、指定されたサイトでのみ実行されるように、バーチャル マシンを分離することができます。</li><li>2 つ (以上) のデータ センター間でストレッチ クラスターには、HGS をインストールします。 これにより、WAN がダウンしても、フェールオーバー クラスタ リングの制限をプッシュする場合、回復性を提供します。 1 つのサイトへのワークロードを分離することはできません。他の任意の 1 つのサイトで実行する承認された VM を実行できます。</li><li>フェールオーバーとして、HYPER-V ホストを別の HGS に登録します。</li></ol>ローカルで常に回復できるように、その構成をエクスポートすることによってもすべて HGS をバックアップする必要があります。 詳細については、次を参照してください。[エクスポート HgsServerState](https://docs.microsoft.com/powershell/module/hgsserver/export-hgsserverstate)と[インポート HgsServerState](https://docs.microsoft.com/powershell/module/hgsserver/import-hgsserverstate)します。 |
| ホスト ガーディアン サービス キー | ホスト ガーディアン サービスが 2 つの非対称キー ペアを使用して、暗号化キーと署名キー-SSL 証明書によって表される各します。 これらのキーを生成する 2 つのオプションがあります。<br><ol><li>内部証明書機関 – 内部 PKI インフラストラクチャを使用してこれらのキーを生成できます。 これは、データ センター環境に適しています。</li><li>公的に信頼された証明書機関 – は、公的に信頼された証明書機関から取得したキーのセットを使用します。 これは、ホストが使用するオプションです。</li></ol>ある自己署名証明書を使用することはできますが、しないでの概念実証ラボ以外の展開シナリオに注意してください。<br><br>HGS キーに加え、ホスト側を使用できます"bring your own key、"一部 (またはすべて) のテナントがある独自の特定の HGS キーなるように、テナントで、独自のキーに提供できます。 このオプションは、テナント キーをアップロードするため、帯域外のプロセスを提供するホスティング企業に適しています。 |
| ホスト ガーディアン サービスのキー ストレージ | 可能なセキュリティ上最も強力な HGS キーが作成され、排他的で、ハードウェア セキュリティ モジュール (HSM) に格納されていることを勧めします。 Hsm を使用していない場合は、HGS サーバー上で BitLocker を適用することが強くお勧めします。 |

## <a name="fabric-admin-planning-for-guarded-hosts"></a>保護されたホスト ファブリックを計画する管理者

| エリア | 詳細 |
|------|---------|
| ハードウェア | <ul><li>ホスト キーの構成証明:任意の既存のハードウェアは、保護されたホストとして使用できます。 いくつかの例外があります (ホストが Windows Server 2016 以降で、新しいセキュリティ メカニズムを使用できるようにするには、次を参照してください。[コードの整合性の Windows Server 2016 の仮想化ベースの保護との互換性のあるハードウェア](guarded-fabric-compatible-hardware-with-virtualization-based-protection-of-code-integrity.md)します。</li><li>TPM によって信頼された構成証明書:持つ任意のハードウェアを使用することができます、[ハードウェア保証の追加資格認定](https://msdn.microsoft.com/windows/hardware/commercialize/design/compatibility/systems#system-server-assurance)が正しく構成されている限り (を参照してください[シールドされた Vm に対応しているサーバーの構成と仮想化ベースコードの整合性の保護を](guarded-fabric-compatible-hardware-with-virtualization-based-protection-of-code-integrity.md)の特定の構成)。 これは TPM 2.0、および UEFI 2.3.1c のバージョンが含まれます。 以上。</li></ul> |
| OS | HYPER-V ホスト OS の Server Core オプションを使用することをお勧めします。 |
| パフォーマンスへの影響 | パフォーマンス テストに基づき、予測、Vm と Vm のシールドされていない約 5% 密度の実行の間の差分がシールドされました。 これは、特定の HYPER-V ホストがシールドされていない Vm が 20 を実行する場合と思っている 19 のシールドされた Vm を実行できることを意味します。<br><br>一般的なワークロードとサイズ変更を確認してください。 たとえば、処理を要する書き込み指向 IO ワークロードでさらに密度の違いに影響を与えるいくつかの外れ値があります。 |
| ブランチ オフィスに関する考慮事項 | Windows Server バージョン 1709 以降、ブランチ オフィスでシールドされた VM としてローカルで実行されている仮想化された HGS サーバーのフォールバック URL を指定できます。 フォールバック URL は、ブランチ オフィスが、データ センターでの HGS サーバーへの接続を失ったときに使用できます。 以前のバージョンの Windows Server では、ホスト ガーディアン サービスまたはライブ マイグレーションを電源オンにするブランチ オフィスのニーズの接続で実行されている HYPER-V ホストにシールドされた Vm。 詳細については、次を参照してください。 [office に関する考慮事項を分岐](guarded-fabric-manage-branch-office.md)します。 |
