---
title: 保護されたファブリックとシールドされた VM のホスト向けのガイドの計画
ms.custom: na
ms.prod: windows-server-threshold
ms.topic: article
ms.assetid: 392af37f-a02d-4d40-a25d-384211cbbfdd
manager: dongill
author: nirb-ms
ms.technology: security-guarded-fabric
ms.openlocfilehash: 0a43cedf8ce0138e89624ff3df5bc7088f583252
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59875303"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-tenants"></a>保護されたファブリックとシールドされた VM の計画ガイドのテナント

>適用対象:Windows Server 2019、Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、コンプライアンスとセキュリティのため、仮想マシン (Vm) を保護したい VM 所有者に重点を置いています。 ホスティング プロバイダーの保護されたファブリックまたはプライベート、保護されたファブリックで Vm が実行、かどうかに関係なく、VM 所有者は、保守が必要な場合、そのファイルを復号化する機能が含まれていますが、シールドされた Vm のセキュリティ レベルを制御する必要があります。

ときに、Vm をシールドを使用して考慮すべき 3 つの領域があります。

- Vm のセキュリティ レベル
- それらを保護するために使用する暗号化キー
- シールド データ: シールドされた Vm の作成に使用される機密性の高い情報 

## <a name="security-level-for-the-vms"></a>Vm のセキュリティ レベル

シールドされた Vm を展開するときに 2 つのセキュリティ レベルのいずれかを選択する必要があります。

- シールドされました。 
- 暗号化をサポート

両方のシールドされ、暗号化サポート Vm と Windows の実行が BitLocker によって保護されているものにアタッチされている仮想 TPM が搭載されています。 主な違いに Vm の暗号化でサポートされているファブリック管理者が同じレベルのアクセスに通常の VM は、Vm はファブリック管理者のアクセスをブロックをシールドされたです。 これらの違いの詳細については、次を参照してください。[保護され、fabric と、Vm の概要をシールドされた](guarded-fabric-and-shielded-vms.md)します。 

選択**シールドされた Vm** (侵害された管理者を含む) のセキュリティを侵害されたファブリックから VM を保護しようとする場合。 ファブリック管理者とファブリック自体がない信頼された環境でを使用する必要があります。 選択**暗号化サポート Vm**にデータの暗号化と (たとえば、ライブ マイグレーション) 中に、ネットワーク上で VM の暗号化の両方を必要とするコンプライアンス基準を満たしているかどうか。

暗号化サポート Vm はファブリック管理者が完全に信頼があるものの、暗号化要件が残ります環境に最適です。

保護されたファブリック上と同じ HYPER-V ホスト上であっても、通常の Vm をシールドされた Vm と暗号化サポート Vm の組み合わせを実行できます。 

VM をシールドまたは暗号化でサポートされているかどうかは、VM の作成時に選択されているシールド データによって決定されます。 シールド データを作成するときに、VM 所有者が、セキュリティ レベルを構成する (を参照してください、[シールド データ](#shielding-data)セクション)。
この選択を行った後、変更できないこと、VM の仮想化ファブリックのままに注意してください。

## <a name="cryptographic-keys-used-for-shielded-vms"></a>シールドされた Vm に使用される暗号化キー

仮想化ファブリック攻撃ベクトルから暗号化されたディスクとさまざまな他の暗号化された要素を使用してのみ暗号化を解除できますが、シールドされた Vm が保護されます。

- 所有者キーの場合 – これは、最後の手段の回復やトラブルシューティングのために通常使用される VM 所有者によって保持される暗号化キーです。 VM 所有者は、安全な場所に所有者のキーの管理を担当します。
- 1 つまたは複数の Guardians (ホスト ガーディアン キー) – 各ガーディアンは所有者がシールドされた Vm を実行を承認する仮想化ファブリックを表します。 多くの場合、企業は、プライマリとディザスター リカバリー (DR) の仮想化ファブリックの両方があるし、両方で実行する、シールドされた Vm を通常承認は。 場合によっては、セカンダリ (DR) のファブリックをパブリック クラウド プロバイダーによってホストする可能性があります。 すべての保護されたファブリックの秘密キーには、その公開キーをダウンロードでき、そのガーディアン内に含まれるときに、仮想化ファブリックでのみ保持されます。 

**所有者、キーを作成する方法はありますか** 所有者、キーは、2 つの証明書によって表されます。 暗号化と署名証明書の証明書。 独自の PKI インフラストラクチャを使用してこれら 2 つの証明書を作成したり、公的証明機関 (CA) から SSL 証明書を取得することができます。 テスト目的で、上で Windows 10 または Windows Server 2016 コンピューター始まるすべての自己署名証明書を作成することもできます。

**所有者の数のキーがあるか。** 1 人の所有者または所有者の複数のキーを使用することができます。 ベスト プラクティスは、同じセキュリティ、信頼関係またはリスクのレベルを共有する Vm のグループと管理に、1 人の所有者のキーをお勧めします。 すべてのドメインに参加しているシールドされた Vm の 1 人の所有者のキーを共有し、ドメイン管理者によって管理される場合は、その所有者キーをエスクローできます。

**ホスト ガーディアンの独自のキーを使用できますか。** はい、「Your を表示する独自」キー、ホスティング プロバイダーと使用する、シールドされた Vm 用のキーにすることができます。 これにより、(ホスティング プロバイダーのキーを使用) と、特定のキーを使用することができ、特定のセキュリティや規制を遵守する必要がある場合に使用できます。 キーの検疫のためは、ホスト ガーディアン キーが、所有者のキーを異なる必要があります。

## <a name="shielding-data"></a>シールド データ

シールド データには、シールドされたまたは暗号化サポート Vm をデプロイするために必要な機密情報が含まれます。 シールドされた Vm の通常の Vm を変換するときにも使用されます。

シールド データでは、シールド データ ファイル ウィザードを使用して作成され、VM 所有者は、保護されたファブリックにアップロードする PDK ファイルに格納されます。

シールドされた Vm を保護、侵害された仮想化ファブリックからの攻撃に対して安全に公開することがなく、管理者のパスワード、ドメイン参加の資格情報、または RDP 証明書などの機密性の高い初期化データを渡すための機構にする必要があります。仮想化ファブリック自体またはその管理者にします。 さらに、シールド データには、以下あります。

1. セキュリティ レベル: シールドされたまたは暗号化サポート
2. 所有者と、VM が実行できる信頼済みのホスト ガーディアンの一覧
3. 仮想マシンの初期化データ (unattend.xml、RDP 証明書)
4. 仮想化環境で、VM を作成するための信頼された署名付きテンプレート ディスクの一覧 

ときにシールドまたは暗号化サポート VM の作成または既存の VM を変換する、求められます機密情報が表示されないのではなくシールド データを選択します。

**シールド データ ファイルの数が必要ですか。** すべてのシールドされた VM を作成するシールド データ ファイルを 1 つを使用できます。 ただし、特定のシールドされた VM では、4 つの項目のいずれかが異なっている必要がある場合は、追加のシールド データ ファイルは必要があります。 たとえば、ため、初期管理者パスワードと RDP 証明書と一致しません。 シールド データ ファイルを 1 つを IT 部門と人事部の異なるシールド データ ファイルのがあります。

それぞれのシールドされた VM のシールド データ ファイルを個別を使用することは可能ですが、必ずしも最適な選択肢ではありませんし、右上の理由から行う必要があります。 たとえばが別の管理者パスワードをすべてのシールドされた VM が必要な場合を考えてみますサービスまたはなどのツールの代わりにパスワード管理を使用して[Microsoft のローカル管理者パスワード Solution (LAPS)](https://www.microsoft.com/en-us/download/details.aspx?id=46899)します。

## <a name="creating-a-shielded-vm-on-a-virtualization-fabric"></a>仮想化ファブリックにシールドされた VM を作成します。

(次と暗号化でサポートされているシールドの両方の vm) の仮想化ファブリックにシールドされた VM を作成するためのいくつかのオプションがあります。

1. 環境内でシールドされた VM を作成し、仮想化ファブリックにアップロード
2. 仮想化ファブリックでの署名付きテンプレートから新しいシールドされた VM を作成します。
3. (既存の VM は、第 2 世代である必要があり、2012 またはそれ以降 Windows Server を実行する必要があります)、既存の VM のシールド

通常の手法は、テンプレートから新しい Vm を作成します。 ただし、仮想化ファブリックで新しいシールドされた VM の作成に使用されるテンプレート ディスクが存在するため追加のメジャーは、これが改ざんされていない、fabric で実行されているマルウェア、悪意のあるファブリック管理者が確実に行うため。 署名付きテンプレート ディスクを使用してこの問題が解決された、署名付きテンプレート ディスクと、ディスク署名が信頼されている管理者または VM 所有者が作成されます。 シールドされた VM を作成すると、指定したシールド データ ファイル内に含まれる署名付きテンプレート ディスクの署名が比較されます。 かどうかは、テンプレート ディスクの署名、シールド データ ファイルの署名のいずれかと一致、展開プロセスが続行されます。 かどうかの一致が見つからない、展開プロセスが中止されたこと、VM シークレットは、信頼できないテンプレート ディスクのため損なわれないことを確認します。

シールドされた Vm を作成する署名付きテンプレート ディスクを使用する場合は、2 つのオプションを使用できます。

1. 仮想化は、プロバイダーによって提供される既存の署名付きテンプレート ディスクを使用します。 この場合、仮想化プロバイダーは、署名付きテンプレート ディスクを保持します。
2. 署名付きテンプレート ディスクを仮想化ファブリックにアップロードします。 VM 所有者は、署名付きテンプレート ディスクの管理を担当します。 


