---
title: フェールオーバー クラスターを作成する
description: Windows Server 2012 R2、Windows Server 2012、および Windows Server 2016 のフェールオーバー クラスターを作成する方法。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 11/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: f919e69488c4f2272ddd07e535ba4e2248ddf79c
ms.sourcegitcommit: 5cbaca9685720f11d896c4ca167c86e74c032feb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/06/2018
ms.locfileid: "6068980"
---
# フェールオーバー クラスターを作成する

>適用対象: Windows Server 2012 R2、Windows Server 2012、Windows Server 2016

このトピックでは、フェールオーバー クラスター マネージャー スナップインまたは Windows PowerShell を使用して、フェールオーバー クラスターを作成する方法を示しています。 このトピックでは、Active Directory ドメイン サービス (AD DS) のクラスターとその関連のクラスター化された役割のコンピューター オブジェクトを作成する場所の一般的な展開について説明します。 代わりに、記憶域スペース ダイレクト クラスターを展開している場合、[記憶域スペース ダイレクトの展開](../storage/storage-spaces/deploy-storage-spaces-direct.md)表示します。

Active Directory デタッチのクラスターを展開することもできます。 この展開方法を使用すると、AD DS でコンピューター オブジェクトまたはそのコンピューター オブジェクトが AD DS で事前登録を要求する必要があるを作成する権限がない場合は、フェールオーバー クラスターを作成できます。 このオプションは、Windows PowerShell を使って利用可能なのみは、特定のシナリオに対してのみお勧めします。 詳細については、[展開 Active Directory-Detached クラスター](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11))を参照してください。

#### チェックリスト: フェールオーバー クラスターを作成します。

|状態|タスク|リファレンス|
|:---:|---|---|
|☐|前提条件を確認します。|[前提条件を確認します。](#verify-the-prerequisites)|
|☐|クラスター ノードとして追加するすべてのサーバーでのフェールオーバー クラスタ リング機能をインストールします。|[フェールオーバー クラスタ リング機能をインストールします。](#install-the-failover-clustering-feature)|
|☐|構成を検証するクラスター検証ウィザードを実行します。|[構成を検証します。](#validate-the-configuration)|
|☐|フェールオーバー クラスターを作成するクラスターの作成ウィザードの実行します。|[フェールオーバー クラスターを作成します。](#create-the-failover-cluster)|
|☐|クラスターのワークロードをホストをクラスター化された役割を作成します。|[クラスター化された役割を作成します。](#create-clustered-roles)|

## 前提条件を確認します。

開始する前に、次の前提条件を確認します。

- クラスター ノードとして追加するすべてのサーバーが、同じバージョンの Windows Server を実行していることを確認します。
- 構成がサポートされているかどうかを確認するためのハードウェア要件を確認します。 詳細については、[フェールオーバー クラスタ リングのハードウェア要件と記憶域オプション](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj612869(v%3dws.11))を参照してください。 記憶域スペース ダイレクト クラスターを作成する場合は、[記憶域スペース ダイレクトのハードウェア要件](../storage/storage-spaces/storage-spaces-direct-hardware-requirements.md)を参照してください。
- クラスターの作成中にクラスター化された記憶域を追加するには、すべてのサーバーが、記憶域にアクセスできることを確認します。 (追加することもクラスター化された記憶域クラスターを作成した後です。)
- クラスター ノードとして追加するすべてのサーバーが同じ Active Directory ドメインに参加していることを確認します。
- (省略可能)組織単位 (OU) を作成し、ou のクラスター ノードとして追加するサーバーのコンピューター アカウントを移動します。 ベスト プラクティスとして、AD DS に独自の OU には、フェールオーバー クラスターを配置することをお勧めします。 どのグループ ポリシー設定またはセキュリティ テンプレートの設定、クラスター ノードに影響をより細かく制御できます。 独自の OU のクラスターを分離することでにも役立ちますクラスター コンピューター オブジェクトが誤って削除を防止します。

さらに、次のアカウントの要件を確認します。

- クラスター ノードとして追加するすべてのサーバー上の管理者権限を持つドメイン ユーザーを使用してクラスターを作成するアカウントであることを確認します。
- 次のいずれかが true であることを確認します。
    - クラスターを作成するユーザーでは、OU またはクラスターを形成するサーバーが存在するコンテナー**を作成するコンピューター オブジェクト**の権限を持っています。
    - ユーザーがあるない場合、**作成コンピューター オブジェクト**アクセス許可、クラスターのクラスター コンピューター オブジェクトを用意するドメイン管理者に問い合わせてください。 詳細については、 [Active Directory Domain Services でクラスター コンピューター オブジェクトを Prestage](prestage-cluster-adds.md)を参照してください。

>[!NOTE]
>この要件は、Windows Server 2012 R2 で Active Directory デタッチ クラスターを作成する場合に適用されません。 詳細については、[展開 Active Directory-Detached クラスター](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11))を参照してください。

## フェールオーバー クラスタ リング機能をインストールします。

フェールオーバー クラスター ノードとして追加するすべてのサーバーには、フェールオーバー クラスタ リング機能をインストールする必要があります。

### フェールオーバー クラスタ リング機能をインストールします。

1. サーバー マネージャーを起動します。
2. [**管理**] メニューで、**追加の役割と機能**を選択します。
3. **開始する前に**] ページで、 **[次へ]** を選択します。
4. [**インストールの種類の選択**] ページで、**役割ベースまたは機能ベースのインストール**を選択し、 **[次へ]** を選択します。
5. **レプリケーション先サーバーの選択**] ページで、機能をインストールするサーバーを選択し、 **[次へ]** を選択します。
6. [**サーバーの役割の選択**] ページで、 **[次へ]** を選択します。
7. **[機能の選択**] ページで、**フェールオーバー クラスタ リング**のチェック ボックスを選択します。
8. フェールオーバー クラスターの管理ツールをインストールするには、**機能の追加**を選択し、 **[次へ]** を選択します。
9. **インストール オプションの確認**] ページで、**インストール**を選択します。
<br>サーバーの再起動は、フェールオーバー クラスタ リング機能の必要はありません。

10. インストールが完了したら、[**閉じる**] を選択します。
11. フェールオーバー クラスター ノードとして追加するすべてのサーバーで、この手順を繰り返します。

>[!NOTE]
>フェールオーバー クラスタ リング機能をインストールした後は、Windows Update から最新の更新プログラムを適用することをお勧めします。 また、Windows Server 2012 ベースのフェールオーバー クラスターでは、については、[推奨される修正プログラム、更新プログラムを Windows Server 2012 ベースのフェールオーバー クラスター](https://support.microsoft.com/help/2784261/recommended-hotfixes-and-updates-for-windows-server-2012-based-failove)の Microsoft サポート資料を確認し、適用されるすべての更新プログラムをインストールします。

## 構成を検証します。

フェールオーバー クラスターを作成する前に、ハードウェアとハードウェアの設定のフェールオーバー クラスタ リングと互換性があるかどうかを確認する構成を検証することを強くお勧めします。 Microsoft は、完全な構成がすべての検証に合格している場合のみ、クラスター ソリューションをサポートしているテストとすべてのハードウェアは、クラスター ノードが実行されている Windows Server のバージョンの認定済みのかどうか。

>[!NOTE]
>すべてのテストを実行する少なくとも 2 つのノードが必要です。 1 つのノードがあれば、多くのストレージの重要なテスト実行されません。

### クラスター検証テストを実行します。

1. フェールオーバー クラスターの管理ツールからリモート サーバー管理ツールをインストールしたコンピューターまたはフェールオーバー クラスタ リング機能がインストールされているサーバーでは、フェールオーバー クラスター マネージャーを起動します。 これを行うにはサーバーには、サーバー マネージャーを起動し、し、[**ツール**] メニューで、**フェールオーバー クラスター マネージャー**を選択します。
2. **フェールオーバー クラスター マネージャー**のウィンドウで、[**管理**] で**構成の検証**を選択します。
3. **開始する前に**] ページで、 **[次へ]** を選択します。
4. **選択のサーバーまたはクラスター** ] ページで、[**名**] ボックスで、NetBIOS 名またはフェールオーバー クラスター ノードとして追加することを予定しているサーバーの完全修飾ドメイン名を入力し、**追加**] をクリックします。 各サーバーに追加するのには、この手順を繰り返します。 同時に複数のサーバーを追加するには、コンマまたはセミコロンで名前を区切ります。 たとえば、形式*server1.contoso.com、server2.contoso.com*に名前を入力します。 終了したら、 **[次へ]** を選択します。
5. **テストのオプション**] ページは、 **(推奨) のすべてのテストを実行**するにはを選択し、 **[次へ]** を選択します。
6. [**確認**] ページで、 **[次へ]** を選択します。

    検証のページには、テストの実行状態が表示されます。
7. [**概要**] ページには、次のいずれかの操作を行います。
    
      - 結果なったテストが正常に完了したことと、クラスタ リングの構成が適しています、すぐにクラスターを作成する場合、**現在検証済みのノードを使用してクラスターを作成する**] チェック ボックスがオンになっていること確認し、**終了**を選択します。 手順 4 の[フェールオーバー クラスターを作成する](#create-the-failover-cluster)手順に進みます。
      - 結果は、警告やエラーが発生したことを示す場合、は、詳細を表示し、どの問題を修正する必要がありますかを判断する**レポートの表示**を選択します。 フェールオーバー クラスターのこの側面がサポートすることができますが、推奨されるベスト プラクティスを満たさない可能性がある特定の検証テストの警告が表示することに気付きます。
        
        >[!NOTE]
        >記憶域スペース永続的な予約を検証テストの警告を受信した場合は、ブログの詳細については[Windows フェールオーバー クラスター検証の警告は、ディスクが記憶域スペースの永続的な予約をサポートしないことを示します](https://blogs.msdn.microsoft.com/clustering/2013/05/24/validate-storage-spaces-persistent-reservation-test-results-with-warning/)を投稿を参照してください。

ハードウェア検証テストについて詳しくは、[フェールオーバー クラスター用ハードウェアを検証](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>)を参照してください。

## フェールオーバー クラスターを作成します。

この手順を完了するには、としてログオンするユーザー アカウントが、このトピックの[前提条件の確認](#verify-the-prerequisites)セクションに記載されている要件を満たしていることを確認します。

1. サーバー マネージャーを起動します。
2. [**ツール**] メニューで、**フェールオーバー クラスター マネージャー**を選択します。
3. **フェールオーバー クラスター マネージャー**のウィンドウで、[**管理**] で、**クラスターの作成**を選択します。
    
    クラスターの作成ウィザードが開きます。
4. **開始する前に**] ページで、 **[次へ]** を選択します。
5. **名**] ボックスに、**サーバーの選択**] ページが表示される場合は、NetBIOS 名またはフェールオーバー クラスター ノードとして追加することを予定しているサーバーの完全修飾ドメイン名を入力し、**追加**] をクリックします。 各サーバーに追加するのには、この手順を繰り返します。 同時に複数のサーバーを追加するには、コンマまたはセミコロンで名を区切ります。 たとえば、形式*server1.contoso.com; server2.contoso.com*に名前を入力します。 終了したら、 **[次へ]** を選択します。
    
    >[!NOTE]
    >[構成の検証手順](#validate-the-configuration)で検証を実行したらすぐにクラスターを作成することを選択した場合に、**サーバーの選択**ページは表示されません。 検証されているノードは、それらを再入力があるないようにクラスターの作成ウィザードを自動的に追加します。
6. 前の検証をスキップする場合は、**検証の警告**ページが表示されます。 クラスター検証を実行することを強くお勧めします。 Microsoft では、すべての検証テストに合格したクラスターのみがサポートされています。 検証テストを実行するには、**はい**、選択し、 **[次へ]** を選択します。 [構成の検証](#validate-the-configuration)」の説明に従って、構成の検証ウィザードを完了します。
7. **クラスターを管理するためのアクセス ポイント**] ページで、次の操作を行います。
    
    1. **クラスター名**] ボックスで、クラスターの管理に使用する名前を入力します。 次の情報を確認するには、: 前に
        
          - クラスターの作成中には、この名前は、クラスター内のコンピューター オブジェクト (*クラスター名オブジェクト*または*CNO*とも呼ばれます) AD DS として登録されます。 クラスターの NetBIOS 名を指定する場合、クラスター ノードのコンピューター オブジェクトが存在する同じ場所に CNO が作成されます。 既定のコンピューターのコンテナーまたは OU のいずれかを指定できます。
          - CNO の別の場所を指定するには、**クラスター名**] ボックスに OU の識別名を入力できます。 例: *CN = ClusterName、OU クラスターの場合、DC = = Contoso, DC = com*します。
          - ドメイン管理者は、クラスター ノードが存在するよりも別の OU に CNO を事前登録された場合、は、ドメイン管理者が提供する識別名を指定します。
    2. サーバーが DHCP を使用して構成されているネットワーク アダプターを持たない場合は、1 つ以上の静的 IP アドレス、フェールオーバー クラスターを構成する必要があります。 各クラスターの管理に使用するネットワークの横にあるチェック ボックスを選択します。 選択されたネットワークでは、横にある**アドレス**フィールドを選択し、クラスターに割り当てる IP アドレスを入力します。 この IP アドレス (または) は、クラスター名では、ドメイン ネーム システム (DNS) に関連付けられます。
    3. 終了したら、 **[次へ]** を選択します。
8. [**確認**] ページで、設定を確認します。 既定では、**すべての対象となる記憶域クラスターに追加**チェック ボックスがオンです。 次のいずれかを実行する場合は、このチェック ボックスをオフにします。
    
      - 記憶域を後で構成します。
      - フェールオーバー クラスター マネージャーを通じてまたはフェールオーバー クラスタ リングの Windows PowerShell のコマンドレットを通じて、クラスター化された記憶域スペースを作成し、まだ作成していない記憶域スペースでは、ファイル サービスおよび記憶域のサービスを計画します。 詳細については、[クラスター化された記憶域スペースの展開](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11)>)を参照してください。
9. **[次へ]** をフェールオーバー クラスターを作成するを選択します。
10. [**概要**] ページで、フェールオーバー クラスターが正常に作成されたことを確認します。 あった場合は、概要の出力を表示、警告やエラー、またはフル レポートを表示する**レポートの表示**を選択します。 **終了**を選択します。
11. クラスターが作成されたことを確認するには、ナビゲーション ツリーにおける、**フェールオーバー クラスター マネージャー**の下に、クラスター名が表示されていることを確認します。 クラスター名を展開し、関連付けられているリソースを表示するには、**ノード**、**記憶域**または**ネットワーク**の下の項目を選択できます。
    
    認識して、クラスター名を DNS に正常にレプリケートするためにしばらく時間がかかる場合があります。 成功した場合の DNS 登録とのレプリケーションでは、[**すべてのサーバー**をサーバー マネージャーで、選択した場合クラスター名は、**オンライン**の**管理**状態を持つサーバーとして表示する必要があります。

クラスターが作成されたらを行うことが次のように、クラスター クォーラムの構成を確認し、必要に応じて、クラスター共有ボリューム (CSV) を作成します。 詳細については、[記憶域スペース ダイレクトでクォーラムを理解して](../storage/storage-spaces/understand-quorum.md) [、フェールオーバー クラスターで使用してクラスター共有ボリューム](failover-cluster-csvs.md)を参照してください。

## クラスター化された役割を作成します。

フェールオーバー クラスターを作成した後は、クラスターのワークロードをホストをクラスター化された役割を作成できます。

>[!NOTE]
>クライアント アクセス ポイントを必要とするクラスター化された役割、AD DS で仮想コンピューター オブジェクト (VCO) が作成されます。 既定では、クラスターのすべての Vco は CNO として同じコンテナーまたは OU 内に作成されます。 クラスターを作成したら、移動することを CNO 任意の OU を実現します。

クラスター化された役割を作成する方法を次に示します。

1. サーバー マネージャーを使用してまたは Windows PowerShell の役割またはフェールオーバー クラスターのノードごとにクラスター化された役割に必要な機能をインストールします。 たとえば、クラスター化されたファイル サーバーを作成する場合は、すべてのクラスター ノードで、ファイル サーバーの役割をインストールします。
    
    次の表では、高可用性ウィザードと関連付けられているサーバーの役割や機能の前提条件としてインストールする必要のある構成できるクラスター化された役割を示します。
    
    <table>
    <thead>
    <tr class="header">
    <th>クラスター化された役割</th>
    <th>役割または機能の前提条件</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>DFS Namespace サーバー</td>
    <td>DFS 名前空間 (ファイル サーバーの役割の一部)</td>
    </tr>
    <tr class="even">
    <td>DHCP サーバー</td>
    <td>DHCP サーバーの役割</td>
    </tr>
    <tr class="odd">
    <td>分散トランザクション コーディネーター (DTC)</td>
    <td>なし</td>
    </tr>
    <tr class="even">
    <td>ファイル サーバー</td>
    <td>ファイル サーバーの役割</td>
    </tr>
    <tr class="odd">
    <td>汎用アプリケーション</td>
    <td>該当なし</td>
    </tr>
    <tr class="even">
    <td>汎用スクリプト</td>
    <td>該当なし</td>
    </tr>
    <tr class="odd">
    <td>汎用的なサービス</td>
    <td>該当なし</td>
    </tr>
    <tr class="even">
    <td>HYPER-V レプリカ ブローカー</td>
    <td>HYPER-V の役割</td>
    </tr>
    <tr class="odd">
    <td>iSCSI ターゲット サーバー</td>
    <td>iSCSI ターゲット サーバー (ファイル サーバーの役割の一部)</td>
    </tr>
    <tr class="even">
    <td>iSNS サーバー</td>
    <td>iSNS サーバー サービスの機能</td>
    </tr>
    <tr class="odd">
    <td>メッセージ キュー</td>
    <td>メッセージ キュー サービスの機能</td>
    </tr>
    <tr class="even">
    <td>その他のサーバー</td>
    <td>なし</td>
    </tr>
    <tr class="odd">
    <td>仮想マシン</td>
    <td>HYPER-V の役割</td>
    </tr>
    <tr class="even">
    <td>WINS サーバー</td>
    <td>WINS サーバーの機能</td>
    </tr>
    </tbody>
    </table>
2. フェールオーバー クラスター マネージャーで、クラスター名を展開して、**役割**を右クリックし**役割の構成**を [します。
3. クラスター化された役割を作成する高可用性のウィザードの手順に従います。
4. **ロール**のウィンドウで、クラスター化された役割を作成したことを確認するには、役割が**実行中**の状態を確認します。 ロールのウィンドウでは、所有者ノードも示します。 フェールオーバーをテストするにロールを右クリックしてポイントに**移動**して、**ノードの選択**を選択します。 **クラスター化された役割の移動**] ダイアログ ボックスで、目的のクラスター ノードを選択し、[ **ok]** を選択します。 [**所有者ノード**列で、所有者ノードが変更されたことを確認します。

## Windows PowerShell を使用して、フェールオーバー クラスターを作成します。

次の Windows PowerShell コマンドレットは、このトピックの前の手順と同じ機能を実行します。 表示される場合でも可能性がありますワード ラップいくつかの行全体の制約を書式設定のために、1 行に各コマンドレットを入力します。

>[!NOTE]
>Windows PowerShell を使用して、Windows Server 2012 R2 で Active Directory デタッチ クラスターを作成する必要があります。 構文について詳しくは、[展開 Active Directory-Detached クラスター](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11))を参照してください。

次の例では、フェールオーバー クラスタ リング機能をインストールします。

```PowerShell
Install-WindowsFeature –Name Failover-Clustering –IncludeManagementTools
```

次の例では、名前は、*サーバ 1*と*サーバ 2*しているコンピューターですべてのクラスター検証テストが実行されます。

```PowerShell
Test-Cluster –Node Server1, Server2
```

>[!NOTE]
>**テスト クラスター**コマンドレットは、現在の作業ディレクトリ内のログ ファイルに結果を出力します。 例: C:\Users\ < ユーザー名 > \AppData\Local\Temp します。

次の例では、ノード*サーバ 1*と*します。* と*サーバ 2*に名前が、割り当てる、静的 IP アドレス*192.168.1.12*、およびフェールオーバー クラスターにすべての対象となる記憶域を追加するフェールオーバー クラスターを作成します。

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12
```

次の例は、前の例のように、同一のフェールオーバー クラスターを作成しますが、フェールオーバー クラスターを対象となるストレージは追加されません。

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12 -NoStorage
```

次の例では、*クラスター*のドメイン*Contoso.com*の OU に*します。* というクラスターを作成します。

```PowerShell
New-Cluster -Name CN=MyCluster,OU=Cluster,DC=Contoso,DC=com -Node Server1, Server2
```

クラスター化された役割を追加する方法の例については、[追加 ClusterFileServerRole](https://docs.microsoft.com/powershell/module/failoverclusters/add-clusterfileserverrole?view=win10-ps)と[追加 ClusterGenericApplicationRole](https://docs.microsoft.com/powershell/module/failoverclusters/add-clustergenericapplicationrole?view=win10-ps)などのトピックを参照してください。

## 詳細

  - [フェールオーバー クラスタリング](failover-clustering.md)
  - [HYPER-V クラスターを展開します。](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj863389(v%3dws.11)>)
  - [アプリケーション データのスケール アウト ファイル サーバー](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831349(v%3dws.11)>)
  - [クラスターを展開する Active Directory デタッチ](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11))
  - [高可用性のためのゲスト クラスタリングの使用](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn440540(v%3dws.11)>)
  - [クラスター対応更新](cluster-aware-updating.md)
  - [新しいクラスター](https://docs.microsoft.com/powershell/module/failoverclusters/new-cluster?view=win10-ps)
  - [テスト クラスター](https://docs.microsoft.com/powershell/module/failoverclusters/test-cluster?view=win10-ps)
