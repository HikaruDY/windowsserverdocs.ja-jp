---
ms.assetid: 0cd1ac70-532c-416d-9de6-6f920a300a45
title: "フェールオーバー クラスターのクラウド監視を展開します。"
ms.prod: windows-server-threshold
manager: eldenc
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.topic: article
author: JasonGerend
ms.date: 10/2/2017
description: "Microsoft Azure を使用してクラウド - Windows Server フェールオーバー クラスターの監視をホストする方法をクラウド ミラーリング監視サーバーを展開する方法に別名します。"
ms.openlocfilehash: 564c6668fcc80a8bd1531c05c142996689de8154
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/17/2017
---
# <a name="deploy-a-cloud-witness-for-a-failover-cluster"></a>フェールオーバー クラスターのクラウド監視を展開します。

> 適用対象: 適用対象: Windows Server (半期チャネル)、Windows Server 2016

クラウド監視は、Windows Server 2016 で導入されたフェールオーバー クラスターのクォーラム監視の新しい型です。 このトピックでは、クラウド監視機能をサポートしているシナリオと、Windows Server 2016 を実行しているフェールオーバー クラスターのクラウド監視を構成する手順については、の概要を説明します。

## <a name="CloudWitnessOverview"></a>クラウド監視の概要

図 1 は、Windows Server 2016 でマルチサイト ストレッチ フェールオーバー クラスター クォーラム構成を示しています。 構成ではこの例 (図 1)、2 つのノードには 2 つのデータ センター ("サイト"と呼ばれますです)。 クラスターに 2 つ以上のデータ センターを及ぶ可能性が注意してください。 また、各データ センターでは、2 つ以上のノードをことができます。 このセットアップ (自動フェールオーバー SLA) では一般的なクラスター クォーラム構成は、各ノード投票を示します。 電源障害が発生して、データ センターのいずれかの場合でも実行中の 1 つのクラスターを許可するように、クォーラム監視を余分な投票が指定されているします。 計算は単純な - 5 合計投票があるし、動作させるために、クラスターの 3 つの投票する必要があります。  

![3 番目の個別のファイル共有監視が 2 では 2 つのノードで他のサイトをサイト](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_1.png "ファイル共有監視")  
**図 1: は、クォーラム監視としてファイル共有監視を使用します。**  

1 つのデータ センターで電源障害、発生した場合のクラスターに他のデータ センターを実行している場合、それを保持する機会を平等にすることが推奨以外、2 つのデータ センターの場所でクォーラム監視をホストします。 これ通常 3 つ目を必要とすることを意味個別のデータ センター (サイト)、ファイル サーバーをホストするクォーラム監視 (ファイル共有監視) として使用されるファイル共有をバックアップしています。  

ほとんどの組織では、第 3 の個別のファイル サーバーをバックアップするファイル共有監視をホストするデータ センターは必要ありません。 つまり、組織は主にする拡張機能でプライマリ データ センターで、データ センターは、次の 2 つのデータ センターは、のいずれかのファイル サーバーをホストします。 シナリオでプライマリ データ センターで停電では、クラスターは下がりますように、その他のデータ センターが、クォーラムの過半数のために必要な 3 つの投票の下にある 2 つの投票のみです。 ファイル サーバーをホストする 3 番目の独立したデータ センターのお客様向けは、高可用性ファイル サーバーをバックアップするファイル共有監視を維持するためのオーバーヘッドが発生します。 セットアップとメンテナンスの両方の観点から大きなオーバーヘッドは、ゲスト OS で実行されているファイル共有監視のファイル サーバーを持つパブリック クラウドに仮想マシンをホストしています。  

クラウド監視は、フェールオーバー クラスターのクォーラム監視が判別ポイント (図 2) として Microsoft Azure を活用するの新しい型です。 スプリット ブレインの解像度が発生した場合、判別ポイントとして使用される、blob ファイルの読み取り/書き込みを Azure Blob Storage を使用します。  

ある重要なメリットをこの方法。
1. Microsoft Azure (第 3 の個別のデータ センターの必要はありません) を活用します。  
2. 標準的な使用可能な Azure Blob Storage (パブリック クラウドでホストされているバーチャル マシンのメンテナンスの余分なオーバーヘッドはありません) を使用します。  
3. 複数のクラスター (クラスターごとに 1 つの blob のファイル、blob ファイル名として使用されるクラスターの一意の id) は、同じ Azure ストレージ アカウントを使用できます。  
4. 記憶域アカウント (blob ファイルは、クラスター ノードの状態が変更されたときに 1 回だけを更新、blob ファイルあたり書き込まれた非常に小さいデータ) に継続的な $cost 非常に低いです。  
5. 組み込みのクラウド監視リソースの種類。  

![クラウド監視をクォーラム監視としてを使用する複数のサイトのストレッチ クラスターを示す図](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_2.png)  
**クォーラム監視として図 2: マルチサイトの拡大クラウド監視を持つクラスター**  

図 2 に示すように、必要な 3 番目の別のサイトはありません。 クォーラム監視などのクラウド監視は、投票を取得し、クォーラムの計算に参加できます。  

## <a name="CloudWitnessSupportedScenarios"></a>サポートされるシナリオを 1 つの監視の種類のクラウド監視。
フェールオーバー クラスターの展開では、ここですべてのノードに到達できるインターネット (を Azure の拡張機能) がある場合は、クォーラム監視リソースとして、クラウド監視を構成することをお勧めします。  

クォーラム監視は、次のとおり、クラウド監視のサポートされるシナリオのいくつか使用します。  
- 障害回復は、マルチサイト クラスター (図 2 を参照) を拡大します。  
- 共有記憶域 (SQL 常に [など) のないフェールオーバー クラスター。  
- Microsoft Azure 仮想マシンの役割 (またはその他の任意のパブリック クラウド) でホストされているゲスト OS 内部で実行するフェールオーバー クラスター。  
- 内部ゲスト OS の仮想マシンのプライベート クラウドでホストされているを実行しているフェールオーバー クラスター。
- 記憶域は、対応するスケール アウト ファイル サーバー クラスターなど、クラスターの共有記憶域の有無。  
- 小規模のブランチ オフィス クラスター (2 つのノードでもクラスター)  

Windows Server 2012 R2 以降では、常に、クラスターは、監視の投票を自動的に管理し、ノードの投票の動的なクォーラム監視を構成することが推奨されます。  

## <a name="CloudWitnessSetUp"></a>クラスターのクラウド監視を設定します。
クラスターのクォーラム監視として、クラウド監視を設定するには、次の手順を実行します。
1. クラウド監視として使用する Azure ストレージ アカウントを作成します
2. クラスターのクォーラム監視として、クラウド監視を構成します。

## <a name="create-an-azure-storage-account-to-use-as-a-cloud-witness"></a>クラウド監視として使用する Azure ストレージ アカウントを作成します

このセクションでは、記憶域アカウントと表示とコピー エンドポイント Url を作成し、そのアカウントのキーにアクセスする方法について説明します。

クラウド監視を構成するのには、(調停の使用)、blob ファイルを格納するために使用できる有効な Azure ストレージ アカウントが必要です。 クラウド監視のよく知られているコンテナーを作成する**クラウド監視の msft** Microsoft 記憶域アカウント。 クラウド監視の書き込みに対応する 1 つの blob のファイルをクラスターの下にあるこの blob ファイルのファイル名として使用される一意の ID**クラウド監視の msft**コンテナー。 つまり、複数の異なるクラスターのクラウド監視を構成するのと同じ Microsoft Azure ストレージ アカウントを使用することができます。

異なる複数のクラウド監視を構成するため、同じ Azure ストレージ アカウントを使用するときにクラスターを 1 つ**クラウド監視の msft**コンテナーが自動的に作成を取得します。 このコンテナーは、クラスターあたり 1 つ blob ファイルが含まれます。

### <a name="to-create-an-azure-storage-account"></a>Azure ストレージ アカウントを作成するには

1. ログイン、[Azure ポータル](http://portal.azure.com)します。
2. [ハブ] メニューの選択は、データを新しい -> + 記憶域ストレージ アカウント]-> [します。
3. ストレージ アカウント] ページの作成には、次の操作を行います。
    1. ストレージ アカウントの名前を入力します。
    <br>記憶域アカウント名は、3 ~ 24 文字の長さである必要があり、数字と小文字のみが含まれている可能性があります。 記憶域アカウント名は、Azure 内で一意でもあります。
        
    2. **アカウントの種類**[**汎用**します。
    <br>クラウド監視の Blob ストレージ アカウントを使用することはできません。
    3. **パフォーマンス**[**標準**します。
    <br>クラウド監視の Azure Premium Storage を使用することはできません。
    2. **レプリケーション**[**冗長なローカル ストレージ (LRS)**します。
    <br>フェールオーバー クラスタ リングでは blob としてデータを読み取るときに、いくつかの一貫性の保証を必要とする判別ポイント。 公開選択する必要があります**冗長のローカル記憶域**の**レプリケーション**の種類。

### <a name="view-and-copy-storage-access-keys-for-your-azure-storage-account"></a>Azure ストレージ アカウントの表示とコピーの記憶域アクセス キー

Microsoft Azure ストレージ アカウントを作成する場合は、2 つのアクセス キーに自動的に生成される主要なアクセス キーとセカンダリのアクセス キーに関連付けられます。 クラウド監視の初回作成、使用、**プライマリのアクセス キー**します。 クラウド監視に使用するには、どのキーに関する制限はありません。  

#### <a name="to-view-and-copy-storage-access-keys"></a>表示して記憶域アクセス キーをコピーするには

Azure ポータルで、ストレージ アカウントに移動] をクリックして**すべての設定**] をクリックし、**アクセス キー**を表示するには、コピー、およびアカウントのアクセス キーを再生成します。 アクセス キーのブレードでは、(図 4 を参照)、アプリケーションで使用するコピーすることができます、プライマリとセカンダリ キーを使用して事前構成済みの接続文字列も含まれます。

![Microsoft Azure でのアクセス キーの管理] ダイアログのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_4.png)  
**図 4: 記憶域のアクセス キー**

### <a name="view-and-copy-endpoint-url-links"></a>表示し、エンドポイント URL リンクをコピーします。  
ストレージ アカウントを作成するときに、形式を使用して、次の Url が生成されます。 `https://<Storage Account Name>.<Storage Type>.<Endpoint>`  

クラウド監視は常に使用**Blob**記憶域の種類として。 Azure の使用**. core.windows.net**エンドポイントとして。 クラウド監視を構成すると、そのことが構成され、別のエンドポイント (たとえば、中国で、Microsoft Azure データ センターが別のエンドポイント)、シナリオに従った可能性があります。  

> [!NOTE]  
> クラウド監視リソースでエンドポイント URL は自動的に生成し、URL のために必要な構成の追加の手順はありません。  

#### <a name="to-view-and-copy-endpoint-url-links"></a>表示してエンドポイントの URL リンクをコピーするには
Azure ポータルで、ストレージ アカウントに移動] をクリックして**すべての設定**] をクリックし、**プロパティ**を表示し、(図 5 を参照)、エンドポイントの Url をコピーします。  

![クラウド監視エンドポイントへのリンクのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_5.png)  
**図 5: クラウド監視のエンドポイント URL リンク**

作成と Azure ストレージ アカウントの管理に関する詳細については、次を参照してください[Azure ストレージ アカウントについて。](https://azure.microsoft.com/documentation/articles/storage-create-storage-account/)

## <a name="configure-cloud-witness-as-a-quorum-witness-for-your-cluster"></a>クラスターのクォーラム監視としてクラウド監視を構成します。
クラウド監視の構成は、フェールオーバー クラスター マネージャーに組み込まれている既存のクォーラム構成ウィザードで適切に統合されたです。  

### <a name="to-configure-cloud-witness-as-a-quorum-witness"></a>クラウド監視をクォーラム監視として構成するには
1. フェールオーバー クラスター マネージャーを起動します。
2. 右クリックし、クラスター]-> [**他の操作** -> **クラスター クォーラム設定の構成**(図 6 を参照してください)。 これにより、クラスター クォーラムの構成ウィザードが起動します。  
    ![メニューへのパス、フェールオーバー クラスター マネージャーの UI で Configue クラスターのクォーラム設定のスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_7.png)**図 6 です。クラスター クォーラム設定**

3. **クォーラム構成の選択**ページで、選択**クォーラム監視の選択**(図 7 を参照してください)。  

    ![スナップショット 'quotrum 監視を選択する' のラジオ ボタンをクラスターのクォーラムのウィザード](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_8.png)  
    **図 7 です。 クォーラム構成を選択します。**

4. **クォーラム監視の選択**ページで、選択**クラウド監視を構成する**(図 8 を参照してください)。  

    ![クラウド監視を選択する適切なオプション ボタンのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_9.png)  
    **図 8 です。 クォーラム監視を選択します。**  

5. **クラウド監視の構成**] ページで、次の情報を入力します。  
    1. (必要なパラメーター)Azure ストレージ アカウント名。  
    2. (必要なパラメーター)ストレージ アカウントに対応するキーにアクセスします。  
        1. を初めて作成する場合は、プライマリのアクセス キーを使用して (図 5 を参照してください)  
        2. プライマリのアクセス キーを回転の場合は、セカンダリのアクセス キーを使用して (図 5 を参照してください)  
    3. (省略可能なパラメーター)別の Azure サービス エンドポイント (たとえば、Microsoft Azure サービス中国で) を使用する場合は、エンドポイントのサーバー名を更新します。  

    ![クラスター クォーラム ウィザードで、クラウド監視の構成] ウィンドウのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_10.png)  
    **図 9: は、クラウド監視を構成します。**

6. クラウド監視の正常な構成にすることができますを表示、新しく作成した監視リソース、フェールオーバー クラスター マネージャー スナップイン (図 10 参照)。

    ![クラウド監視の成功した構成](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_11.png)  
    **クラウド監視の正常な構成を図 10:**

### <a name="configuring-cloud-witness-using-powershell"></a>PowerShell を使用してクラウド監視の構成  
既存の Set-ClusterQuorum PowerShell コマンドには、クラウド監視に対応する新しいの追加パラメーターがあります。  

クラウド監視を使用して構成することができます、[`Set-ClusterQuorum`](https://technet.microsoft.com/library/ee461013.aspx)PowerShell コマンドを実行します。  

```PowerShell
Set-ClusterQuorum -CloudWitness -AccountName <StorageAccountName> -AccessKey <StorageAccountAccessKey>
```

場合に、別のエンドポイント (まれな) を使用する必要があります。  

```PowerShell
Set-ClusterQuorum -CloudWitness -AccountName <StorageAccountName> -AccessKey <StorageAccountAccessKey> -Endpoint <servername>  
```

### <a name="azure-storage-account-considerations-with-cloud-witness"></a>クラウド監視と azure ストレージ アカウントの考慮事項  
クラウド監視として、フェールオーバー クラスターのクォーラム監視を構成する場合は、次を考慮してください。
* アクセス キーを保存するには、代わりに、フェールオーバー クラスターを生成し、共有アクセス セキュリティ (SAS) トークンを安全に保管します。  
* 生成された SAS トークンは、有効なアクセス キーが残っている限り有効です。 プライマリのアクセス キーを回転の場合は、プライマリのアクセス キーを再生成する前にセカンダリのアクセス キーを使用して、クラウド監視 (すべてのクラスターでそのストレージ アカウントを使用している) を最初に更新する必要があります。  
* クラウド監視ストレージ アカウントの Azure サービスの HTTPS の REST インターフェイスを使用します。 これは、すべてのクラスター ノード上で開いているに HTTPS ポートが必要であることを意味します。

### <a name="proxy-considerations-with-cloud-witness"></a>クラウド監視をプロキシに関する考慮事項  
クラウド監視は、HTTPS (既定のポート 443) を使用して、Azure blob サービスとの通信を確立します。 HTTPS ポートはネットワーク プロキシ経由でアクセスできることを確認します。

## <a name="see-also"></a>参照してください。
- [Windows Server のフェールオーバー クラスタ リングの新機能](whats-new-in-failover-clustering.md)
