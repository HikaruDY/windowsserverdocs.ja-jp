---
ms.assetid: 0cd1ac70-532c-416d-9de6-6f920a300a45
title: フェールオーバー クラスターのクラウド監視をデプロイします。
ms.prod: windows-server-threshold
manager: eldenc
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.topic: article
author: JasonGerend
ms.date: 01/18/2019
description: Microsoft Azure を使用して、クラウドでの Windows Server フェールオーバー クラスターのミラーリング監視サーバーをホストする方法、クラウドのミラーリング監視サーバーをデプロイする方法とも呼ばれます。
ms.openlocfilehash: f7e1c84e54f08044a772f06e591588c1add33026
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59857983"
---
# <a name="deploy-a-cloud-witness-for-a-failover-cluster"></a>フェールオーバー クラスターのクラウド監視を展開する

> 適用対象:Windows Server 2019、Windows Server 2016、Windows Server (半期チャネル)

クラウド監視には、Microsoft Azure を使用してクラスター クォーラムの投票を提供するフェールオーバー クラスター クォーラム監視の一種です。 このトピックでは、クラウド監視機能、サポートされるシナリオとフェールオーバー クラスターのクラウド監視を構成する方法についての概要を示します。

## <a name="CloudWitnessOverview"></a>クラウド ミラーリング監視サーバーの概要

図 1 は、Windows Server 2016 で複数のサイト拡張フェールオーバー クラスター クォーラム構成を示しています。 構成ではこの例 (図 1)、2 つのノードには 2 つのデータ センター ("サイト"と呼ばれますです)。 2 つ以上のデータ センターにまたがるクラスター可能性がありますに注意してください。 また、各データ センターでは、ノードの 2 つ以上のことができます。 このセットアップ (自動フェールオーバー SLA) では、一般的なクラスターのクォーラム構成は、投票を各ノードに提供します。 クォーラム監視を許可して、データ センターの場合は、いずれかで実行されても 1 つのクラスターに余分な投票が指定された 1 つで停電が発生します。 計算は簡単です - 5 合計投票数があるし、を実行しているようにする、クラスターの 3 つの投票する必要があります。  

![3 番目の個別のファイル共有監視が 2 で 2 つのノードで他のサイトをサイト](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_1.png "ファイル共有監視")  
**図 1: クォーラム監視としてファイル共有監視を使用します。**  

1 つのデータ センターで電源障害が発生した場合のクラスターを実行しているようにするその他のデータ センターに等しい機会を与えるためにお勧めする 2 つのデータ センターは別の場所でクォーラム監視をホストします。 これは、通常 3 つ目を必要とすることを意味分離データ センター (サイト) ファイル サーバーをホストするクォーラム監視 (ファイル共有監視) として使用されるファイル共有をバックアップしています。  

ほとんどの組織では、ファイル サーバーをバックアップするファイル共有監視をホストするデータ センターを分離する 3 つ目はありません。 つまり、組織が主に、プライマリ データ センターで、データ センターは、拡張機能では 2 つのデータ センターは、のいずれかでファイル サーバーをホストします。 シナリオが、プライマリ データ センターの停電がある場合、クラスターはダウンするように、その他のデータ センターにクォーラムの過半数のために必要な 3 つの投票の下にある 2 つの投票だけで済みます。 ファイル サーバーをホストする 3 つ目の離れたデータ センターを結んでいるお客様、ファイル共有のミラーリング監視サーバーをバックアップ、高可用性ファイル サーバーを維持するオーバーヘッドになります。 セットアップとメンテナンスの両方の観点からかなりのオーバーヘッドは、ゲスト OS で実行されているファイル共有監視のファイル サーバーがあるパブリック クラウドでの仮想マシンをホストします。  

クラウド監視は、新しい種類が判別ポイント (図 2) として Microsoft Azure を利用しているフェールオーバー クラスター クォーラム監視の。 Azure Blob Storage は、解像度のスプリット ブレインが発生した場合、判別ポイントとして使用する blob ファイルの読み取り/書き込みに使用します。  

必要があるこのアプローチがメリットがあります。
1. Microsoft Azure (第 3 に別のデータ センターの必要はありません) を活用します。  
2. 標準的な使用可能な Azure Blob Storage (パブリック クラウドでホストされている仮想マシンのメンテナンスの余分なオーバーヘッドはありません) を使用します。  
3. 同じ Azure ストレージ アカウントは、複数のクラスター (クラスターごとに 1 つの blob ファイルは blob ファイル名として使用されるクラスターの一意の id) で使用できます。  
4. ストレージ アカウント (非常に小さいデータ blob ファイルには、クラスター ノードの状態が変更されたときに 1 回だけが更新された blob のファイルあたりの書き込み) に非常に低い継続的 $cost します。  
5. 組み込みのクラウド監視リソースの種類。  

![クォーラム監視としてクラウド ミラーリング監視サーバーでマルチサイト ストレッチ クラスターを示す図](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_2.png)  
**図 2:クォーラム監視としてクラウド ミラーリング監視サーバーでマルチサイト ストレッチ クラスター**  

図 2 に示すように、必要な 3 番目の個別のサイトはありません。 クォーラム監視などのクラウド監視は、投票を取得し、クォーラムの計算に参加できます。  

## <a name="CloudWitnessSupportedScenarios"></a>クラウド監視:1 つのミラーリング監視サーバーの種類でサポートされるシナリオ
フェールオーバー クラスターのデプロイでは、すべてのノードが (Azure の拡張機能) をインターネットに到達できる場所がある場合、クォーラム監視リソースとしてのクラウド監視を構成することをお勧めします。  

クォーラム監視は、次のとおり、クラウド監視のサポートされるシナリオのいくつか使用します。  
- ディザスター リカバリーでは、(図 2 参照) マルチサイト クラスターを拡大します。  
- 共有ストレージ (SQL Always 上など) のないフェールオーバー クラスター。  
- フェールオーバー クラスターが Microsoft Azure の仮想マシン ロール (またはその他のパブリック クラウド) でホストされているゲスト OS 内で実行されています。  
- 内でゲスト OS の仮想マシンのプライベート クラウドでホストされているを実行しているフェールオーバー クラスター。
- 記憶域では、スケール アウト ファイル サーバー クラスターなどの共有記憶域の有無をクラスター化します。  
- 小規模のブランチ オフィスのクラスター (も 2 つのノードのクラスター)  

Windows Server 2012 R2 以降では、常に監視の投票を自動的に管理するクラスターとノードの投票の動的なクォーラム監視を構成することが推奨されます。  

## <a name="CloudWitnessSetUp"></a> クラスターのクラウド監視を設定します。
クラスターのクォーラム監視としてクラウド監視を設定するには、次の手順を完了します。
1. クラウドのミラーリング監視サーバーとして使用する Azure ストレージ アカウントの作成します。
2. クラスターのクォーラム監視としてのクラウド監視を構成します。

## <a name="create-an-azure-storage-account-to-use-as-a-cloud-witness"></a>クラウドのミラーリング監視サーバーとして使用する Azure ストレージ アカウントの作成します。

このセクションでは、ストレージ アカウントと表示とコピーのエンドポイント Url の作成、そのアカウントのキーにアクセスする方法について説明します。

クラウド監視を構成するには、(調停に使用)、blob ファイルを格納するために使用できる有効な Azure ストレージ アカウントが必要です。 クラウド監視は、よく知られているコンテナーを作成します。 **msft クラウド ミラーリング監視サーバー**マイクロソフトのストレージ アカウント。 クラウド ミラーリング監視サーバーの書き込みと、対応する 1 つの blob ファイルをクラスターの blob ファイルのファイル名として使用される一意の ID **msft クラウド ミラーリング監視サーバー**コンテナー。 つまり、複数の異なるクラスターのクラウド監視を構成する同じ Microsoft Azure ストレージ アカウントを使用することができます。

異なる複数のクラウド監視を構成するため、同じ Azure ストレージ アカウントを使用する場合のクラスターを 1 つ**msft クラウド ミラーリング監視サーバー**コンテナーが自動的に作成されます。 このコンテナーは、クラスターごとに 1 つの blob ファイルが格納されます。

### <a name="to-create-an-azure-storage-account"></a>Azure storage アカウントを作成するには

1. サインイン、 [Azure Portal](http://portal.azure.com)します。
2. ハブ メニューで、選択新規]、[データ + ストレージ ストレージ アカウント]-> [します。
3. 作成、ストレージ アカウント ページで、次の操作を行います。
    1. ストレージ アカウントの名前を入力します。
    <br>ストレージ アカウント名は 3 から 24 文字である必要があり、数字と小文字のみを含めることができます。 ストレージ アカウント名は、Azure 内で一意でもあります。
        
    2. **アカウントの種類**、 **General purpose**します。
    <br>クラウド ミラーリング監視サーバーの Blob ストレージ アカウントを使用することはできません。
    3. **パフォーマンス**、**標準**します。
    <br>クラウドのミラーリング監視サーバーの Azure Premium Storage を使用することはできません。
    2. **レプリケーション**、**ローカル冗長ストレージ (LRS)** します。
    <br>フェールオーバー クラスタ リング、データを読み取るときにいくつかの一貫性の保証を必要とする判別ポイントとして blob ファイルを使用します。 このために選択する必要がある**ローカル冗長ストレージ**の**レプリケーション**型。

### <a name="view-and-copy-storage-access-keys-for-your-azure-storage-account"></a>Azure ストレージ アカウントのストレージ アクセス キーの表示とコピー

Microsoft Azure ストレージ アカウントを作成するときに、2 つのアクセス キーに自動的に生成されるプライマリ アクセス キーとセカンダリ アクセス キーに関連付けられます。 クラウドのミラーリング監視サーバーの初回作成、使用、**プライマリ アクセス キー**します。 クラウド監視を使用するキーに関する制限はありません。  

#### <a name="to-view-and-copy-storage-access-keys"></a>表示してストレージ アクセス キーをコピーするには

Azure ポータルでストレージ アカウントに移動 をクリックして**すべて設定**順にクリックします**アクセス キー**を表示するには、コピー、および、アカウント アクセス キーを再生成します。 [アクセス キー] ブレードには、(図 4 参照)、アプリケーションで使用するコピーできるプライマリおよびセカンダリ キーを使用してあらかじめ構成された接続文字列も含まれています。

![Microsoft Azure でのアクセス キーの管理ダイアログのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_4.png)  
**図 4:ストレージ アクセス キー**

### <a name="view-and-copy-endpoint-url-links"></a>表示し、エンドポイントの URL リンクをコピー  
ストレージ アカウントを作成するときに、形式を使用して、次の Url が生成されます。 `https://<Storage Account Name>.<Storage Type>.<Endpoint>`  

クラウド監視は常に使用**Blob**ストレージ型として。 Azure は **. core.windows.net**エンドポイントとして。 クラウド監視を構成するには、構成することで別のエンドポイント (たとえば、中国で Microsoft Azure データ センターは別のエンドポイント) のシナリオに従ってになります。  

> [!NOTE]  
> エンドポイント URL を自動的にクラウド ミラーリング監視サーバーのリソースによって生成され、URL に必要な構成の追加の手順はありません。  

#### <a name="to-view-and-copy-endpoint-url-links"></a>リンクを表示し、エンドポイントの URL をコピーするには
Azure ポータルでストレージ アカウントに移動 をクリックして**すべての設定**順にクリックします**プロパティ**を表示し、(図 5 参照)、エンドポイント Url をコピーします。  

![クラウド監視エンドポイントへのリンクのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_5.png)  
**図 5:クラウドのミラーリング監視サーバー エンドポイントの URL リンク**

作成して、Azure ストレージ アカウントを管理する方法の詳細についてを参照してください[Azure ストレージ アカウントについて。](https://azure.microsoft.com/documentation/articles/storage-create-storage-account/)

## <a name="configure-cloud-witness-as-a-quorum-witness-for-your-cluster"></a>クラスターのクォーラム監視としてクラウド監視を構成します。
クラウド監視の構成は、フェールオーバー クラスター マネージャーに構築された既存のクォーラム構成ウィザード内で適切に統合します。  

### <a name="to-configure-cloud-witness-as-a-quorum-witness"></a>クラウド監視をクォーラム監視として構成するには
1. フェールオーバー クラスター マネージャーを起動します。
2. クラスター -> を右クリックして**その他のアクション** -> **クラスター クォーラム設定の構成**(図 6 参照)。 これは、クラスター クォーラムの構成ウィザードを起動します。  
    ![フェールオーバー クラスター マネージャーの UI でのクラスター クォーラム設定の構成] メニューの [パスのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_7.png)**図 6。クラスター クォーラムの設定**

3. **クォーラム構成の選択**] ページで [**クォーラム監視を選択する**(図 7 を参照してください)。  

    !['Quotrum ミラーリング監視サーバーを選択する' のスナップショット オプションで、クラスター クォーラム ウィザード ボタンをクリックします。](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_8.png)  
    **図 7。クォーラム構成を選択します。**

4. **クォーラム監視の選択**] ページで [**クラウド監視を構成する**(図 8 参照)。  

    ![クラウド監視を選択して該当するラジオ ボタンのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_9.png)  
    **図 8。クォーラム監視を選択します。**  

5. **クラウド監視の構成**ページで、次の情報を入力します。  
    1. (必須のパラメーター)Azure ストレージ アカウント名。  
    2. (必須のパラメーター)ストレージ アカウントに対応するキーにアクセスします。  
        1. を初めて作成する場合は、プライマリ アクセス キーを使用して (図 5 参照)  
        2. プライマリ アクセス キーのローテーションを行う場合は、セカンダリ アクセス キーを使用して (図 5 参照)  
    3. (省略可能なパラメーター)別の Azure サービス エンドポイント (たとえば中国で Microsoft Azure サービス) を使用する場合は、エンドポイントのサーバー名を更新します。  

    ![クラスター クォーラム ウィザードで、クラウド監視の構成ウィンドウのスナップショット](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_10.png)  
    **図 9:クラウド監視を構成します。**

6. クラウド監視の正常な構成時にリソースを表示できます、新しく作成されたミラーリング監視サーバー、フェールオーバー クラスター マネージャー スナップイン (図 10 参照)。

    ![クラウド監視の正常な構成](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_11.png)  
    **図 10:クラウド監視の正常な構成**

### <a name="configuring-cloud-witness-using-powershell"></a>PowerShell を使用してクラウド監視を構成します。  
既存の Set-clusterquorum PowerShell コマンドには、クラウドのミラーリング監視サーバーに対応する新しい追加のパラメーターがあります。  

クラウド監視を使用して構成することができます、 [ `Set-ClusterQuorum` ](https://technet.microsoft.com/library/ee461013.aspx) PowerShell コマンドを実行します。  

```PowerShell
Set-ClusterQuorum -CloudWitness -AccountName <StorageAccountName> -AccessKey <StorageAccountAccessKey>
```

場合に、(まれな) 別のエンドポイントを使用する必要があります。  

```PowerShell
Set-ClusterQuorum -CloudWitness -AccountName <StorageAccountName> -AccessKey <StorageAccountAccessKey> -Endpoint <servername>  
```

### <a name="azure-storage-account-considerations-with-cloud-witness"></a>クラウドのミラーリング監視サーバーでの azure のストレージ アカウントにに関する考慮事項  
クラウドのミラーリング監視サーバーとして、フェールオーバー クラスターのクォーラム監視を構成する場合は、次を考慮してください。
* アクセス キーを格納するには、代わりに、フェールオーバー クラスターは生成し、共有アクセス セキュリティ (SAS) トークンを安全に保管します。  
* 生成された SAS トークンは、アクセス キーが有効な限り有効です。 プライマリ アクセス キーのローテーションを行う場合は、(すべてのクラスターでそのストレージ アカウントを使用している)、クラウドのミラーリング監視サーバーをセカンダリ アクセス キーを使用してプライマリ アクセス キーを再生成する前にまず更新する必要があります。  
* クラウド監視は、Azure ストレージ アカウントのサービスの HTTPS REST インターフェイスを使用します。 つまり、すべてのクラスター ノードに開かれる HTTPS ポートが必要です。

### <a name="proxy-considerations-with-cloud-witness"></a>クラウド監視のプロキシに関する考慮事項  
クラウド監視は、HTTPS (既定のポート 443) を使用して、Azure blob サービスとの通信を確立します。 HTTPS ポートがネットワーク プロキシ経由でアクセスできることを確認します。

## <a name="see-also"></a>関連項目
- [新機能では、Windows Server フェールオーバー クラスタ リングの新機能](whats-new-in-failover-clustering.md)
