---
ms.assetid: 2f4b6641-0ec2-4b1c-85fb-a1f1d16685c8
title: "洗練された対応更新の [詳細オプションと更新実行プロファイル"
ms.topic: article
ms.prod: storage-failover-clustering
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 6/7/2017
description: "高度なオプションと更新実行プロファイルのクラスター対応更新 (CAU) を構成する方法"
ms.openlocfilehash: 5b6f035791a946ff96ff6a95a1f753ef505d54b4
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/17/2017
---
# <a name="cluster-aware-updating-advanced-options-and-updating-run-profiles"></a>クラスター対応更新を高度なオプションと更新実行プロファイル

>適用対象: Windows Server (半期チャネル)、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックの構成可能な更新実行オプションをについて説明、[Cluster-aware Updating](cluster-aware-updating.md)更新 (CAU) を実行します。 更新プログラムを適用するか、自己更新オプションを構成する、CAU UI または CAU Windows PowerShell コマンドレットを使用すると、これらの高度なオプションを構成できます。

XML ファイルは、更新実行プロファイルと呼ばれ、以降の更新実行に再利用すると、ほとんどの構成設定を保存できます。 CAU によって提供される更新実行オプションの既定値は、多くのクラスター環境でも使用できます。

各更新実行に指定できる追加のオプションと更新実行プロファイルについての詳細については、このトピックの後で次のセクションを参照してください。

更新実行の更新実行プロファイル オプションを使用して更新実行プロファイルで設定できるを要求したときに指定するオプション

次の表は、CAU 更新実行プロファイルで設定できるオプションを示します。 

> [!NOTE] 
> PreUpdateScript または PostUpdateScript オプションを設定するには、Windows PowerShell と .NET Framework 4.6 または 4.5 がインストールされていることと、クラスター内の各ノードで PowerShell リモート処理が有効になっていることを確認します。 詳細については、次を参照してください。ノードでリモート管理の構成[要件とクラスター対応更新のベスト プラクティス](cluster-aware-updating-requirements.md)します。


|オプション|既定値|詳細|  
|------------|-------------------|-------------|  
|**StopAfter**|時間無制限|時間 (分) 後、更新実行は停止が完了していない場合。 **注:**更新前スクリプトまたは更新後の PowerShell スクリプトを指定する場合のスクリプトを実行して、更新を実行するプロセス全体が内に完了する必要があります、**StopAfter**時間制限します。|  
|**WarnAfter**|既定では、警告は表示されません。|時間 (分)、Updating Run (構成されている場合は更新前スクリプトおよび更新後スクリプトを含む) が完了していない場合になる警告を表示します。|  
|**MaxRetriesPerNode**|3|ノードごとに更新プロセス (構成されている場合は更新前スクリプトおよび更新後スクリプトを含む) を再試行する時間の最大数。 最大値は 64 です。|  
|**MaxFailedNodes**|ほとんどのクラスターでは、約 1-サード クラスター ノードの数を示す整数|更新できるために、失敗するかノードの障害またはを実行しているクラスター サービスが停止上のノードの最大数。 1 つ以上のノードに失敗した場合、Updating Run は停止されます。<br /><br /> 有効な値の範囲は、0 ~ 1 未満のクラスター ノードの数です。|  
|**RequireAllNodesOnline**|[なし]|すべてのノードをオンラインにする必要があります、開始を更新する前に到達できることを指定します。|  
|**RebootTimeoutMinutes**|15|時間 (分) は、CAU が (再起動が必要な場合) にノードを再起動すると、すべての自動起動サービスを開始できるようにします。 この時間内再起動処理を完了していない場合は、そのノード上で、更新実行マークが付きますできませんでした。|  
|**PreUpdateScript**|[なし]|実行する各ノードで、更新の開始前に、ノードがメンテナンス モードに切り替わる前に、PowerShell スクリプトのパスとファイル名。 ファイル名拡張子がある必要があります**.ps1**、およびパスとファイル名の長さの合計は、260 文字を超えない必要があります。 ベスト プラクティスとして、クラスターの記憶域または可用性の高いネットワーク ファイル共有が常にすべてのクラスター ノードにアクセスできることを確認するには、ディスク上スクリプトを配置する必要があります。 スクリプトは、ネットワーク ファイル共有に存在する場合は、Everyone グループ、および承認されていないユーザーによってファイルが改ざんを防ぐための書き込みアクセスを制限するため、ファイル共有の読み取りアクセス許可を構成することを確認します。<br /><br /> 更新前スクリプトを指定する場合は、時間などの設定が制限されていることを確認する (たとえば、**StopAfter**) が正常に実行するスクリプトを許可するように構成されています。 これらの制限は、スクリプトを実行すると、更新プログラムのインストール プロセスだけでなく、更新プログラムをインストールするプロセス全体に適用します。|  
|**PostUpdateScript**|[なし]|(ノードのメンテナンス モード終了後の更新が完了した後に実行する PowerShell スクリプトのパスとファイル名。 ファイル名拡張子がある必要があります**.ps1**およびパスとファイル名の長さの合計は、260 文字を超えない必要があります。 ベスト プラクティスとして、クラスターの記憶域または可用性の高いネットワーク ファイル共有が常にすべてのクラスター ノードにアクセスできることを確認するには、ディスク上スクリプトを配置する必要があります。 スクリプトは、ネットワーク ファイル共有に存在する場合は、Everyone グループ、および承認されていないユーザーによってファイルが改ざんを防ぐための書き込みアクセスを制限するため、ファイル共有の読み取りアクセス許可を構成することを確認します。<br /><br /> 更新後スクリプトを指定する場合は、時間などの設定が制限されていることを確認する (たとえば、**StopAfter**) が正常に実行するスクリプトを許可するように構成されています。 これらの制限は、スクリプトを実行すると、更新プログラムのインストール プロセスだけでなく、更新プログラムをインストールするプロセス全体に適用します。|  
|**ConfigurationName**|この設定にのみ影響スクリプトを実行する場合。<br /><br /> 更新前スクリプトまたは更新後スクリプトを指定するが、指定しない場合、**ConfigurationName**、既定のセッションの PowerShell (Microsoft.PowerShell) 用の構成を使用します。|スクリプトでセッションを定義する PowerShell セッション構成を指定します (で指定された**PreUpdateScript**と**PostUpdateScript**) 実行し、実行可能なコマンドを制限することができます。|  
|**CauPluginName**|**Microsoft.WindowsUpdatePlugin**|プラグインを使用して更新プログラムをプレビューしたり、Updating Run を実行するクラスター対応更新を構成することです。 詳細については、次を参照してください。[どのクラスター対応更新プラグインの動作](cluster-aware-updating-plug-ins.md)します。|  
|**CauPluginArguments**|[なし]|一連の*名前 = 値*組 (引数) を使用する更新プラグインの。<br /><br /> **Domain=Domain.local**<br /><br /> これら*名前 = 値*ペアは、プラグインにとって意味のあるである必要がありますで指定した**CauPluginName**します。<br /><br /> CAU UI を使用して引数を指定するには、入力、*名*Tab キーを押し、対応するように入力し、*値*します。 次の引数を提供するには、もう一度 Tab キーを押します。 各*名*と*値*は、自動的に等号 (=) で区切られます。 複数の組は自動的にセミコロンで区切られます。<br /><br /> 既定の**Microsoft.WindowsUpdatePlugin**プラグイン引数は必要ありません。 ただし、たとえば、プラグインによって適用される更新プログラムのセットを絞り込むに標準の Windows Update Agent クエリ文字列を指定する、省略可能な引数を指定することができます。 *名*を使用して**QueryString**、および、*値*、クエリ全体を引用符で囲みます。<br /><br /> 詳細については、次を参照してください。[どのクラスター対応更新プラグインの動作](cluster-aware-updating-plug-ins.md)します。|  
  
##  <a name="BKMK_runtime"></a>更新実行の要求時に指定するオプション  
 次の表は、更新実行を要求するときに指定することができます (更新実行プロファイルで以外) のオプションを示します。 更新実行プロファイルで設定できるオプションについては、前の表を参照してください。  
  
|オプション|既定値|詳細|  
|------------|-------------------|-------------|  
|**ClusterName**|[なし] <br>**注:**、フェールオーバー クラスター ノードで、CAU UI を実行していないか、CAU UI を実行するいるとは異なるフェールオーバー クラスターを参照する場合にのみ、このオプションを設定する必要があります。|Updating Run を実行するクラスターの NetBIOS 名。|  
|**資格情報**|現在のアカウントの資格情報|管理者の資格情報のターゲット クラスターを更新実行が実行されます。 既にした必要な資格情報、CAU UI を開始 (または PowerShell セッションを開いた場合、CAU の PowerShell コマンドレットを使用している場合) をクラスター上で管理者権限とアクセス許可を持つアカウントからします。|  
|**NodeOrder**|既定では、CAU はクラスター化された役割は、の最小数を所有し、2 番目に小さな番号、およびなどのあるノードまで進行をノードで開始します。|更新するように (可能な場合)、順序に並んだクラスター ノードの名前です。|  
  
##  <a name="BKMK_profile"></a>更新実行プロファイルを使用してください。  
 各更新実行は、特定の更新実行プロファイルを関連付けることができます。 既定値で更新実行プロファイルが格納されている、*%windir%\cluster*フォルダー。 リモート更新で、CAU UI を使用しているかどうかことができますモードでは、更新の適用時に、更新実行プロファイルを指定するか、既定の更新実行プロファイルを使用することができます。 自己更新モードで CAU を使用している場合、自己更新オプションを構成するときに、指定した更新実行プロファイルから設定をインポートすることができます。 どちらの場合も、必要に応じて表示される更新実行オプションの値を上書きできます。 する場合は、同じファイル名または別のファイル名に更新実行プロファイルとして更新実行オプションを保存することができます。 次回更新プログラムを適用するか、CAU の自己更新オプションを自動的に構成するは、更新実行プロファイル] を選択したことを選択します。  
  
 既存の更新実行プロファイルを変更するか、またはを選択して新しいものを作成**作成または更新実行プロファイルを変更する**、CAU UI でします。

更新実行プロファイルの使用に関する重要な注意事項を次に示します。

* 更新実行プロファイルには、管理者の資格情報など、クラスターに固有の情報を保存しません。 自己更新モードで CAU を使用している場合、更新実行プロファイルもしない情報を格納自己更新スケジュールします。 これにより、指定したクラスのすべてのフェールオーバー クラスター間で、更新実行プロファイルを共有します。
* 更新実行プロファイルを使用して自己更新オプションを構成し、後で更新実行オプションの値をプロファイルを変更する場合は、自己更新の構成が自動的に変更されません。 新しい更新実行設定を適用するには、もう一度、自己更新オプションを構成する必要があります。
* 実行プロファイル エディターは残念ながら、スペースにはなどが含まれているファイルのパスをサポートしていません*C:\Program Files*します。 この問題を回避するには、保存、前のスペースを入れるしない、または PowerShell を使用して、実行しているときに、引用符で囲むのパスを減らし、実行プロファイルを管理するには、排他的パスにある更新スクリプトを投稿してください。**Invoke-caurun**します。

### <a name="windows-powershell-equivalent-commands"></a>Windows PowerShell と同等のコマンド
  
 実行すると、更新実行プロファイルから設定をインポートすることができます、**Invoke-caurun**、**Add-cauclusterrole**、または**Set-cauclusterrole**コマンドレット。  
  
 次の例では、スキャンし、フル更新実行という名前のクラスターで*contoso-fc1*で指定されている更新実行オプションを使用して*C:\Windows\Cluster\DefaultParameters.xml*します。 既定値は、他のコマンドレット パラメーターに使用されます。  
  
```powershell  
$MyRunProfile = Import-Clixml C:\Windows\Cluster\DefaultParameters.xml  
Invoke-CauRun –ClusterName CONTOSO-FC1 @MyRunProfile   
```  
  
 更新実行プロファイルを使用すると、例外の管理、時間制約など、およびその他の運用パラメーターについて一貫した設定で反復可能な方法でフェールオーバー クラスターを更新できます。 これらの設定は通常、フェールオーバー クラスターのクラスに固有のため —「すべての Microsoft SQL Server クラスター」や「ビジネス クリティカルなクラスター」など — 各更新実行プロファイルで使用するフェールオーバー クラスターのクラスに応じたの名前を付ける可能性があります。 さらに、IT 組織内の特定のクラスのフェールオーバー クラスターのすべてにアクセスできるファイル共有に更新実行プロファイルを管理することがあります。  
  
  
  
## <a name="see-also"></a>参照してください。

-   [クラスター対応更新](cluster-aware-updating.md)
  
-   [Windows PowerShell のクラスター対応更新のコマンドレット](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating)