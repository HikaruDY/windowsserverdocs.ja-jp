---
ms.assetid: 2f4b6641-0ec2-4b1c-85fb-a1f1d16685c8
title: クラスター対応更新を高度なオプションと更新実行プロファイル
ms.topic: article
ms.prod: windows-server-threshold
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 08/06/2018
description: 高度なオプションと更新実行プロファイルをクラスター対応更新 (CAU) を構成する方法
ms.openlocfilehash: 5fac31ad35422e623b98caaabdd9eae183e2e5d8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59830553"
---
# <a name="cluster-aware-updating-advanced-options-and-updating-run-profiles"></a>クラスター対応更新を高度なオプションと更新実行プロファイル

>適用対象:Windows Server (半期チャネル)、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、更新実行に対して構成できるオプションを説明します、 [Cluster-aware Updating](cluster-aware-updating.md)更新 (CAU) を実行します。 CAU UI または CAU Windows PowerShell コマンドレットのいずれかを使用する更新プログラムを適用するか自己更新オプションを構成するときに、これらの高度なオプションを構成できます。

構成設定のほとんどは、XML ファイル (更新実行プロファイル) として保存し、以降の更新実行に再利用することができます。 CAU の更新実行オプションの既定値は、多くのクラスター環境でも使用できます。

各更新実行に指定できる追加のオプションおよび更新実行プロファイルについては、このトピックの以下のセクションを参照してください。

更新実行の更新実行プロファイル オプションを使用して更新実行プロファイルで設定できるを要求すると、指定したオプション

次の表に、CAU の更新実行プロファイルで設定できるオプションを示します。 

> [!NOTE] 
> PreUpdateScript または PostUpdateScript オプションを設定するには、Windows PowerShell と .NET Framework 4.6、または 4.5 がインストールされていることと、クラスター内の各ノードで PowerShell リモート処理が有効になっていることを確認してください。 詳細については、次を参照してください。 ノードでリモート管理の構成[要件とクラスター対応更新のベスト プラクティス](cluster-aware-updating-requirements.md)します。


|オプション|既定値|詳細|  
|------------|-------------------|-------------|  
|**StopAfter**|時間無制限|更新実行が完了しなかった場合に、更新実行を停止するまでの時間 (分単位)。 **注:** 更新前または更新後の PowerShell スクリプトを指定する場合は、スクリプトの実行と更新を実行するプロセス全体が内に完了する必要がありますに、 **StopAfter**制限時間。|  
|**WarnAfter**|既定では、警告は表示されません|更新実行 (構成されている場合は更新前スクリプトと更新後スクリプトを含む) が完了しなかった場合に警告が表示されるまでの時間 (分単位)。|  
|**MaxRetriesPerNode**|3|ノードごとに更新プロセス (構成されている場合は更新前スクリプトと更新後スクリプトを含む) を再試行する最大回数。 最大値は 64 です。|  
|**MaxFailedNodes**|ほとんどのクラスターでは、クラスター ノードの数の約 3 分の 1 に相当する整数|ノードの障害またはクラスター サービスの実行停止を原因とした更新の失敗を許容できるノードの最大数。 この数を超えるノードで失敗すると、更新実行は停止します。<br /><br /> 有効な値の範囲は、0 からクラスター ノードの数より 1 少ない数までです。|  
|**RequireAllNodesOnline**|なし|更新開始前にすべてのノードがオンラインで、到達可能である必要があることを指定します。|  
|**RebootTimeoutMinutes**|15|ノードの再起動が必要な場合に CAU がノードを再起動し、自動開始サービスをすべて開始するまでの時間 (分単位)。 この時間内再起動プロセスを完了していない場合は、失敗としてマークは、そのノード上で、更新実行します。|  
|**PreUpdateScript**|なし|更新の開始前に、ノードがメンテナンス モードに切り替わる前に、各ノードで実行する PowerShell スクリプトのパスとファイル名。 ファイル名拡張子である必要があります **.ps1**パスとファイル名の合計の長さが 260 文字を超えないとします。 すべてのクラスター ノードからスクリプトに常にアクセスできるように、クラスター記憶域のディスク上か、可用性の高いネットワーク ファイル共有にスクリプトを配置することをお勧めします。 スクリプトをネットワーク ファイル共有に配置した場合には、承認を受けていないユーザーによってファイルが改ざんされることのないよう、Everyone グループに対してはそのファイル共有の読み取りだけを許可し、書き込みアクセスは制限するようにファイル共有の構成を変更する必要があります。<br /><br /> 更新前スクリプトを指定する場合は、時間制限などの設定 (たとえば、**StopAfter**) を、スクリプトが正常に実行できるように構成しておいてください。 これらの制限は、更新プログラムのインストール プロセスだけでなく、スクリプトの実行と更新プログラムのインストールのプロセス全体に適用されます。|  
|**PostUpdateScript**|なし|(ノードのメンテナンス モード終了) した後、更新が完了した後に実行する PowerShell スクリプトのパスとファイル名。 ファイル名拡張子である必要があります **.ps1**パスとファイル名の合計の長さが 260 文字を超えないとします。 すべてのクラスター ノードからスクリプトに常にアクセスできるように、クラスター記憶域のディスク上か、可用性の高いネットワーク ファイル共有にスクリプトを配置することをお勧めします。 スクリプトをネットワーク ファイル共有に配置した場合には、承認を受けていないユーザーによってファイルが改ざんされることのないよう、Everyone グループに対してはそのファイル共有の読み取りだけを許可し、書き込みアクセスは制限するようにファイル共有の構成を変更する必要があります。<br /><br /> 更新後スクリプトを指定する場合は、時間制限などの設定 (たとえば、**StopAfter**) を、スクリプトが正常に実行できるように構成しておいてください。 これらの制限は、更新プログラムのインストール プロセスだけでなく、スクリプトの実行と更新プログラムのインストールのプロセス全体に適用されます。|  
|**ConfigurationName**|この設定はスクリプトを実行した場合にのみ影響します。<br /><br /> 更新前スクリプトまたは更新後のスクリプトを指定するが、指定しない場合、 **ConfigurationName**既定のセッション構成 (Microsoft.PowerShell) の powershell を使用します。|スクリプトで、セッションを定義する、PowerShell セッション構成を指定します (で指定された**PreUpdateScript**と**PostUpdateScript**) 実行し、実行できるコマンドを制限することができます。|  
|**CauPluginName**|**Microsoft.WindowsUpdatePlugin**|クラスター対応更新を構成して更新プログラムのプレビューや更新実行の実行に使用するプラグイン。 詳細については、次を参照してください。[どのクラスター対応更新プラグインの作業](cluster-aware-updating-plug-ins.md)します。|  
|**で**|なし|使用する更新プラグインの*名前=値*の組 (引数)。次に例を示します。<br /><br /> **Domain=Domain.local**<br /><br /> これらの*名前=値*の組は、**CauPluginName** で指定するプラグインにとって必ず意味のある内容にします。<br /><br /> CAU UI を使用して引数を指定するには、*名前*を入力して Tab キーを押し、対応する*値*を入力します。 次の引数を指定するには、もう一度 Tab キーを押します。 *名前*と*値*は自動的に等号 (=) で区切られます。 複数の組は、セミコロンで自動的に区切られます。<br /><br /> 既定の**Microsoft.WindowsUpdatePlugin**プラグイン引数は必要ありません。 ただし、オプション引数を指定することはできます。たとえば、プラグインによって適用される更新プログラムのセットを絞り込むために、Windows Update エージェントの標準のクエリ文字列を指定する場合が考えられます。 *名前*を使用して、 **QueryString**、および、*値*、完全なクエリを引用符で囲みます。<br /><br /> 詳細については、次を参照してください。[どのクラスター対応更新プラグインの作業](cluster-aware-updating-plug-ins.md)します。|  
  
##  <a name="BKMK_runtime"></a> 更新実行を要求したときに指定するオプション  
 次の表に、更新実行の要求時に指定できるオプション (更新実行プロファイルのオプション以外のオプション) を示します。 更新実行プロファイルで設定できるオプションについては、前の表を参照してください。  
  
|オプション|既定値|詳細|  
|------------|-------------------|-------------|  
|**ClusterName**|なし <br>**注:** このオプションは、CAU UI をフェールオーバー クラスター ノードで実行していない場合か、CAU UI を実行しているものとは異なるフェールオーバー クラスターを参照する場合にのみ設定します。|更新実行を実行するクラスターの NetBIOS 名。|  
|**資格情報**|現在のアカウントの資格情報|更新実行が実行されるターゲット クラスターの管理資格情報。 既に必要な資格情報、CAU UI を起動 (または PowerShell セッションを開いた場合、CAU の PowerShell コマンドレットを使用している場合) をクラスター上で管理者権限とアクセス許可を持つアカウントから。|  
|**NodeOrder**|既定では、CAU は、クラスター役割の所有数が最も少ないノードから始まり、次に、2 番目に所有数が少ないノードへと順番に処理を進めます。|更新される順序に並んだクラスター ノードの名前 (可能な場合)。|  
  
##  <a name="BKMK_profile"></a> 更新実行プロファイルを使用して、  
 更新実行はそれぞれ、特定の更新実行プロファイルに関連付けることができます。 既定値に更新実行プロファイルが格納されている、 *%windir%\cluster*フォルダー。 リモート更新で、CAU UI を使用しているかどうかことができます、モード、更新の適用時に更新実行プロファイルを指定するか、既定の更新実行プロファイルを使用することができます。 自己更新モードで CAU を使用する場合は、自己更新オプションを構成するときに、指定した更新実行プロファイルから設定をインポートすることができます。 いずれの場合も、必要に応じて更新実行オプションに表示されている値を上書きすることができます。 必要があれば、更新実行オプションを更新実行プロファイルとして保存しておくこともできます。このとき、ファイル名は同じであっても、違うものであってもかまいません。 次回に更新を適用するか、自己更新オプションを構成するときには、前回選択した更新実行プロファイルが CAU によって自動的に選択されます。  
  
 既存の更新実行プロファイルを変更したり、選択して、新しく作成**作成または更新実行プロファイルを変更する**CAU UI で。

更新実行プロファイルの使用に関する重要な注意事項を次に示します。

* 更新実行プロファイルには、管理者の資格情報などのクラスターに固有の情報を格納しません。 CAU 自己更新モードでを使用している場合、更新実行プロファイルも格納しません自己更新のスケジュール情報。 このため、指定されたクラスに属するすべてのフェールオーバー クラスターで更新実行プロファイルを共有できます。
* 更新実行プロファイルを使用して、自己更新オプションを構成し、後で更新実行オプションの値が異なるプロファイルを変更すると場合、は、自己更新の構成が自動的に変更されません。 更新実行の新しい設定を適用するには、自己更新オプションを再度構成する必要があります。
* 実行プロファイルのエディターは残念ながら、スペースを含めるファイル パスをサポートしない*C:\Program Files*します。 この問題を回避するには、格納、プレとスペースが含まれていない、またはだけを実行しているときに、引用符で囲むのパスを配置する実行プロファイルの管理に PowerShell を使用しているパスの更新スクリプトを投稿**Invoke-caurun**します。

### <a name="windows-powershell-equivalent-commands"></a>Windows PowerShell と同等のコマンド
  
 実行すると、更新実行プロファイルから設定をインポートすることができます、 **Invoke-caurun**、 **Add-cauclusterrole**、または**Set-cauclusterrole**コマンドレット。  
  
 以下の例では、*CONTOSO-FC1* という名前のクラスターにスキャンを実行した後、*C:\Windows\Cluster\DefaultParameters.xml* で指定された更新実行オプションを使用してフル更新実行を実行します。 指定のないコマンドレット パラメーターについては既定値が使用されます。  
  
```powershell  
$MyRunProfile = Import-Clixml C:\Windows\Cluster\DefaultParameters.xml  
Invoke-CauRun –ClusterName CONTOSO-FC1 @MyRunProfile   
```  
  
 更新実行プロファイルを使用すると、フェールオーバー クラスターを繰り返し更新する場合に、例外の管理、時間制約など、運用面のパラメーターについて一貫した設定を適用できます。 このような設定は通常、"すべての Microsoft SQL Server クラスター"、"ビジネスクリティカルなクラスター" などのフェールオーバー クラスターのクラスに特有のものであるため、各更新実行プロファイルには、その更新実行プロファイルを使用するフェールオーバー クラスターのクラスに応じた名前を付けることをお勧めします。 また、更新実行プロファイルは IT 組織内の特定のクラスに属するすべてのフェールオーバー クラスターからアクセスできるファイル共有に置いて管理することもお勧めします。  
  
  
  
## <a name="see-also"></a>関連項目

-   [クラスター対応更新](cluster-aware-updating.md)
  
-   [Windows PowerShell でクラスター対応更新のコマンドレット](https://docs.microsoft.com/powershell/module/clusterawareupdating/?view=win10-ps)