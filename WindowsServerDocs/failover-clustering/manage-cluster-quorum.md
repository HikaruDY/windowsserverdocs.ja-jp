---
title: Windows Server 2012 フェールオーバー クラスターでクォーラムを構成および管理する
description: Windows Server フェールオーバー クラスターでクラスターのクォーラムを管理する方法の詳細情報。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 01/18/2019
ms.localizationpriority: medium
ms.openlocfilehash: 21f99362205e0a6aa90ebd26cef8f3a779bdc1dc
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59836493"
---
# <a name="configure-and-manage-quorum"></a>クォーラムを構成および管理する

>適用対象:Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、背景と手順の構成し、Windows Server フェールオーバー クラスターのクォーラムの管理を提供します。

## <a name="understanding-quorum"></a>Understanding クォーラム

クラスターのクォーラムは、そのクラスターが正常に起動するか、または動作を継続するためにアクティブなクラスター メンバーシップに含まれる必要がある投票要素の数によって決定されます。 詳細については、次を参照してください。、[理解とプールのクラスター クォーラム doc](../storage/storage-spaces/understand-quorum.md)します。

## <a name="quorum-configuration-options"></a>クォーラム構成オプション

Windows Server でのクォーラム モデルは柔軟です。 クラスターのクォーラム構成を変更する必要がある場合は、クラスター クォーラムの構成ウィザードまたはフェールオーバー クラスター Windows PowerShell コマンドレットを使用できます。 クォーラムを構成するための手順と考慮事項については、このトピックの「[クラスター クォーラムを構成する](#configure-the-cluster-quorum)」を参照してください。

次の表に、クラスター クォーラム構成ウィザードに用意されている 3 つのクォーラム構成オプションを示します。

<table>
<thead>
<tr class="header">
<th>オプション</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>標準設定を使用する</td>
<td>クラスターは、自動的に各ノードに投票を割り当て、ノードの投票を動的に管理します。 このオプションがクラスターに適しており、クラスターの共有記憶域が使用可能な場合、クラスターはディスク監視を選択します。 ほとんどの場合はこのオプションお勧めします。クラスターの可用性を最大限に引き出すクォーラムと監視の構成がクラスター ソフトウェアによって自動的に選択されるためです。</td>
</tr>
<tr class="even">
<td>クォーラム監視を追加または変更する</td>
<td>監視リソースを追加、変更、または削除できます。 ファイル共有またはディスク監視を構成できます。 クラスターは、自動的に各ノードに投票を割り当て、ノードの投票を動的に管理します。</td>
</tr>
<tr class="odd">
<td>高度なクォーラム構成および監視の選択</td>
<td>このオプションは、クォーラムの構成にアプリケーション固有またはサイト固有の要件がある場合にのみ選択します。 クォーラム監視の変更、ノードの投票の追加または削除、およびクラスターがノードの投票を動的に管理するかどうかの選択が可能です。 既定では、投票はすべてのノードに割り当てられ、ノードの投票は動的に管理されます。</td>
</tr>
</tbody>
</table>

選択したクォーラム構成オプションと固有の設定に応じて、クラスターは次のいずれかのクォーラム モードで構成されます。

<table>
<thead>
<tr class="header">
<th>Mode</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ノード マジョリティ (監視なし)</td>
<td>ノードのみが票を持ちます。 クォーラム監視は構成されません。 クラスター クォーラムは、アクティブなクラスター メンバーシップの投票ノードの過半数です。</td>
</tr>
<tr class="even">
<td>ノード マジョリティと監視 (ディスクまたはファイル共有)</td>
<td>ノードは票を持ちます。 さらに、クォーラム監視も票を持ちます。 クラスター クォーラムは、アクティブなクラスター メンバーシップの投票ノードの過半数と監視の投票です。<br />
<br />
クォーラム監視は、指定されたディスク監視または指定されたファイル共有監視です。</td>
</tr>
<tr class="odd">
<td>非マジョリティ (ディスク監視のみ)</td>
<td>ノードは票を持ちません。 票を持つのはディスク監視のみです。 クラスター クォーラムは、ディスク監視の状態によって決定されます。<br />
<br />
1 つのノードが使用可能であり、クラスター記憶域内の特定のディスクと通信していれば、クラスターはクォーラムを獲得します。 一般に、このモデルは推奨されません。また、クラスターの単一障害点が生成されるため、選択しないでください。</td>
</tr>
</tbody>
</table>

次のサブセクションでは、高度なクォーラム構成設定の詳細についてを提供します。

### <a name="witness-configuration"></a>監視の構成

一般に、クォーラムを構成する場合は、クラスター内の投票要素は奇数である必要があります。 そのため、クラスターに含まれている投票ノードが偶数の場合は、ディスク監視またはファイル共有監視を構成する必要があります。 これにより、クラスターはさらに 1 つのノードの障害に耐えることができるようになります。 さらに、監視の投票を追加すると、クラスター ノードの半数が同時にダウンまたは切断状態になった場合でも、クラスターは実行を継続できます。

ディスク監視は通常、すべてのノードでそのディスクを表示できる場合に推奨されます。 ファイル共有監視は、レプリケートされた記憶域を使用するマルチサイト障害回復を検討する必要がある場合に推奨されます。 レプリケートされた記憶域を使用するディスク監視は、記憶域のベンダーがすべてのサイトからレプリケートされた記憶域への読み取り/書き込みアクセスをサポートしている場合にのみ構成できます。 <strong>*記憶域スペース ダイレクトのディスク監視はサポートされていません*</strong>します。

次の表に、クォーラム監視の種類に関する追加情報と考慮事項を示します。

<table>
<thead>
<tr class="header">
<th>監視の種類</th>
<th>説明</th>
<th>要件と推奨事項</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ディスク監視</td>
<td>- クラスター データベースのコピーを格納する専用の LUN<br />
- 共有 (レプリケートされない) 記憶域をクラスターの場合は、最も役に立つ</td>
<td>- LUN のサイズは 512 MB 以上である必要があります。<br />
- クラスター専用し、クラスター化された役割に割り当てられていない必要があります<br />
- 記憶域とパスのクラスター化された記憶域の検証テストに含める必要があります。<br />
- クラスター共有ボリューム (CSV) であるディスクにすることはできません。<br />
- 1 つのボリュームを持つベーシック ディスク<br />
- ドライブ文字がする必要はありません。<br />
- NTFS または ReFS でフォーマットできます。<br />
- 必要に応じてハードウェア RAID フォールト トレランス用に構成できます。<br />
- バックアップおよびウイルス対策スキャンから除外します。<br />
- 記憶域スペース ダイレクトのディスク監視はサポートされていません</td>
</tr>
<tr class="even">
<td>ファイル共有監視</td>
<td>- Windows Server を実行するファイル サーバーで構成されている SMB ファイル共有<br />
- クラスター データベースのコピーを保存できません。<br />
- クラスターのに関する情報を witness.log ファイルでのみ管理します。<br />
- レプリケートされた記憶域を使用するマルチサイト クラスターの最も役に立つ</td>
<td>- 5 MB の空き領域の最小値があります。<br />
- 1 つのクラスター専用し、しないユーザーまたはアプリケーション データを格納するために使用する必要があります<br />
- クラスター名のコンピューター オブジェクトの有効な書き込みアクセス許可がある必要があります。<br />
<br />
ファイル共有監視をホストするファイル サーバーに関する追加の考慮事項は次のとおりです。<br />
<br />
- 複数のクラスター ファイル共有監視は、1 つのファイル サーバーを構成できます。<br />
- クラスターのワークロードとは別サイトのファイル サーバーがある必要があります。 このようにすると、サイト間ネットワーク通信が失われたときにどのクラスター サイトにも継続して動作する機会が平等に与えられます。 ファイル サーバーが同じサイトに存在する場合、そのサイトがプリマリ サイトになり、ファイル共有にアクセスできる唯一のサイトになります。<br />
- ファイル サーバーは、仮想マシンが、ファイル共有監視を使用する同じクラスターでホストされていない場合、仮想マシンで実行できます。<br />
- 高可用性のため、フェールオーバー クラスターを別のファイル サーバーを構成できます。</td>
</tr>

<tr class-"odd">
<td>クラウド監視</td>
<td>- Azure blob ストレージに格納されているミラーリング監視サーバーのファイル<br>
-クラスター内のすべてのサーバーが信頼性の高いインターネット接続をお勧めします。</td>
<td>参照してください<a href="https://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness">クラウド監視を展開</a>します。</td>
<td>
</td>
</tr>

</tbody>
</table>

### <a name="node-vote-assignment"></a>ノードの投票の割り当て

高度なクォーラム構成オプションとしては、割り当てまたはノード単位でクォーラム投票を削除できます。 既定では、すべてのノードに投票が割り当てられます。 投票の割り当てに関係なく、クラスター内のすべてのノードは引き続き正常に動作し、クラスター データベース更新を受信し、アプリケーションをホストできます。

特定の障害回復構成では、ノードから投票を削除できます。 たとえば、マルチサイト クラスターでは、バックアップ サイトのノードから投票を削除して、それらのノードがクォーラムの計算に影響しないようにできます。 この構成は、サイト間の手動のフェールオーバーでのみ推奨されます。 詳細については、このトピックの後半の「[障害回復構成で使用するクォーラムに関する考慮事項](#quorum-considerations-for-disaster-recovery-configurations)」を参照してください。

構成されたノードの投票を検索することで確認できます、 **NodeWeight**を使用してクラスター ノードの共通プロパティ、 [Get-clusternode](http://technet.microsoft.com/library/hh847268.aspx)Windows PowerShell コマンドレット。 0 の値は、ノードにクォーラム投票が構成されていないことを示しています。 1 の値は、ノードのクォーラム投票が割り当てられ、クラスターによって管理されていることを示しています。 ノードの投票の管理については、このトピックの後半の「[動的なクォーラム管理](#dynamic-quorum-management)」を参照してください。

すべてのクラスター ノードに対する投票の割り当ては、**クラスター クォーラムの検証**テストによって検証できます。

#### <a name="additional-considerations-for-node-vote-assignment"></a>ノードの投票の割り当ての追加の考慮事項

  - 投票ノードを奇数にするためにノードの投票を割り当てることは推奨されません。 代わりに、ディスク監視またはファイル共有監視を構成する必要があります。 詳細については、次を参照してください。[監視の構成](#witness-configuration)このトピックで後述します。
  - 動的なクォーラム管理を有効にした場合、ノードの投票が割り当てられるように構成されているノードに対してのみ、投票の割り当てまたは削除が動的に行われます。 詳細については、このトピックの後半の「[動的なクォーラム管理](#dynamic-quorum-management)」を参照してください。

### <a name="dynamic-quorum-management"></a>動的なクォーラム管理

Windows Server 2012 では、高度なクォーラム構成オプションとしてできますクラスターによる動的なクォーラム管理を有効にします。 動的クォーラムのしくみの詳細については、次を参照してください。[この説明](../storage/storage-spaces/understand-quorum.md#dynamic-quorum-behavior)します。

動的なクォーラム管理では、クラスターは正常に動作している最後のクラスター ノードで動作できます。 クォーラムの過半数の要件を動的に調整することによって、クラスターは連続的なノードのシャットダウンに最後の 1 つのノードまで耐えることができます。

動的な投票ノードのクラスターに割り当てられたで確認できます、 **DynamicWeight**を使用してクラスター ノードの共通プロパティ、 [Get-clusternode](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusternode?view=win10-ps) Windows PowerShell コマンドレット。 0 の値は、ノードにクォーラム投票が割り当てられていないことを示しています。 1 の値は、ノードにクォーラム投票が割り当てられていることを示しています。

すべてのクラスター ノードに対する投票の割り当ては、**クラスター クォーラムの検証**テストによって検証できます。

#### <a name="additional-considerations-for-dynamic-quorum-management"></a>動的なクォーラム管理の追加の考慮事項

- 動的なクォーラム管理では、クラスターは投票メンバーの過半数の同時障害に耐えることができません。 動作を継続するには、クラスターはノードのシャットダウンまたは障害時にクォーラムの過半数を常に満たしている必要があります。

- ノードの投票を明示的に削除した場合、クラスターは動的にその投票を追加または削除することはできません。
- 記憶域スペース ダイレクトが有効にすると、クラスターは 2 つのノードの障害をのみサポートできます。 より詳細については、[プールのクォーラム セクション](../storage/storage-spaces/understand-quorum.md#poolQuorum)

## <a name="general-recommendations-for-quorum-configuration"></a>クォーラム構成に関する一般的な推奨事項

クラスター ソフトウェアは、構成されているノードの数と共有記憶域の可用性に基づいて、新しいクラスターのクォーラムを自動的に構成します。 これは通常、そのクラスターに最適なクォーラム構成です。 しかし、クラスターが作成されたら、そのクラスターを運用環境に展開する前にクォーラム構成を確認することをお勧めします。 できますが、クラスター クォーラム構成の詳細を表示する検証の構成ウィザードを使用して、または[テスト クラスター](https://docs.microsoft.com/powershell/module/failoverclusters/test-cluster?view=win10-ps) Windows PowerShell コマンドレットを実行する、**クォーラム構成の検証**をテストします。 フェールオーバー クラスター マネージャーでは、基本クォーラム構成は選択したクラスターの要約情報に表示されますまたはを実行するときに返されるクォーラム リソースに関する情報を確認することができます、 [Get-clusterquorum](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusterquorum?view=win10-ps) 。Windows PowerShell コマンドレットを使用します。

**クォーラム構成の検証** テストを実行すると、クォーラム構成がクラスターに最適であることをいつでも検証できます。 テストの出力は、クォーラム構成の変更が推奨されるかどうか、および設定が最適かどうかを示します。 変更が推奨される場合は、クラスター クォーラム構成ウィザードを使用して推奨設定を適用できます。

クラスターを運用環境に展開したら、変更がクラスターに適していると判断した場合を除いて、クォーラム構成を変更しないでください。 クォーラム構成の変更を検討する必要があるのは、次のような場合です。

- ノードを追加または削除する。
- 記憶域を追加または削除する。
- ノードまたは監視の障害が長期にわたっている。
- マルチサイト障害回復シナリオでクラスターを回復する。

フェールオーバー クラスターの検証の詳細については、「 [Validate Hardware for a Failover Cluster](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>)」を参照してください。

## <a name="configure-the-cluster-quorum"></a>クラスター クォーラムを構成する

フェールオーバー クラスター マネージャーまたはフェールオーバー クラスター Windows PowerShell コマンドレットを使用してクラスター クォーラム設定を構成することができます。

>[!IMPORTANT]
>通常、最適な結果を得るには、クラスター クォーラム構成ウィザードによって推奨されるクォーラム構成を使用します。 変更することによってクラスターに適した構成になる場合にのみ、クォーラム構成をカスタマイズしてください。 詳細については、このトピックの「[クォーラム構成に関する一般的な推奨事項](#general-recommendations-for-quorum-configuration)」を参照してください。

### <a name="configure-the-cluster-quorum-settings"></a>クラスター クォーラム設定を構成する

この手順を完了するには、少なくともクラスター化された各サーバーでローカルの **Administrators** グループ、またはそれと同等のメンバーシップが必要です。 また、使用するアカウントはドメイン ユーザー アカウントである必要があります。

>[!NOTE]
>クラスター クォーラム構成の変更は、クラスターを停止したり、クラスター リソースをオフラインにしたりせずに実行できます。

### <a name="change-the-quorum-configuration-in-a-failover-cluster-by-using-failover-cluster-manager"></a>フェールオーバー クラスター マネージャーを使用してフェールオーバー クラスターのクォーラム構成を変更します。

1. フェールオーバー クラスター マネージャーで、変更するクラスターを選択または指定します。
2. クラスターを選択すると、**アクション**を選択します**その他のアクション**、し、**クラスター クォーラム設定の構成**します。 クラスター クォーラム構成ウィザードが表示されます。 **[次へ]** を選びます。
3. **[クォーラム構成オプションの選択]** ページで、3 つの構成オプションの 1 つを選択し、そのオプションの手順を完了します。 クォーラム設定を構成する前に、選択内容を確認できます。 オプションの詳細については、次を参照してください。[フェールオーバー クラスターのクォーラムの概要](#overview-of-the-quorum-in-a-failover-cluster)、このトピックの「以前のバージョン。

    - クラスターの現在のクラスター構成に最適なクォーラム設定を自動的にリセットできるように、次のように選択します。**標準設定を使用**、ウィザードを完了します。
    - クォーラム監視を変更または追加を選択**を追加または変更、クォーラム監視**、次の手順を完了します。 クォーラム監視に関する情報と考慮事項については、このトピックで前述した「 [監視の構成](#witness-configuration) 」を参照してください。

      1. **[クォーラム監視の選択]** ページで、ディスク監視またはファイル共有監視を構成するオプションを選択します。 ウィザードには、対象のクラスターに対して推奨される監視選択オプションが示されます。

          >[!NOTE]
          >**[クォーラム監視を構成しない]** をクリックしてウィザードを完了することもできます。 クラスター内の投票ノード数が偶数の場合、この構成は推奨されません。

      2. ディスク監視を構成するオプションを選択した場合は、 **[記憶域監視の構成]** ページで、ディスク監視として割り当てる記憶域ボリュームを選択してウィザードを完了します。
      3. ファイル共有監視を構成するオプションを選択した場合は、**[ファイル共有監視の構成]** ページで、監視リソースとして使用されるファイル共有を入力または指定してウィザードを完了します。

    - クォーラム管理設定を構成およびを追加またはクォーラム監視を変更する次のように選択します。**クォーラムの構成とミラーリング監視サーバーの選択を高度な**、し、次の手順を完了します。 高度なクォーラム構成設定に関する情報と考慮事項については、このトピックの前半の「[ノードの投票の割り当て](#node-vote-assignment)」および「[動的なクォーラム管理](#dynamic-quorum-management)」を参照してください。

      1. **[投票構成の選択]** ページで、投票をノードに割り当てるオプションを選択します。 既定では、すべてのノードに投票が割り当てられます。 しかし、特定のシナリオでは、一部のノードにのみ投票を割り当てることができます。

          >[!NOTE]
          >また、**[ノードなし]** を選択することもできます。 通常、これは推奨されません。この構成にすると、ノードがクォーラム投票に参加できず、ディスク監視を構成する必要があるからです。 このディスク監視は、クラスターの単一障害点になります。

      2. **[クォーラム管理の構成]** ページで、**[クラスターがノードの投票の割り当てを動的に管理できるようにする]** オプションを有効または無効にできます。 このオプションを選択すると、通常クラスターの可用性が向上します。 このオプションは既定で有効にされており、無効にしないことを強くお勧めします。 このオプションを選択すると、クラスターはこのオプションが無効になっている場合では不可能な障害シナリオでも動作を継続できます。
      3. **[クォーラム監視の選択]** ページで、ディスク監視またはファイル共有監視を構成するオプションを選択します。 ウィザードには、対象のクラスターに対して推奨される監視選択オプションが示されます。

          >[!NOTE]
          >**[クォーラム監視を構成しない]** をクリックしてウィザードを完了することもできます。 クラスター内の投票ノード数が偶数の場合、この構成は推奨されません。

      4. ディスク監視を構成するオプションを選択した場合は、 **[記憶域監視の構成]** ページで、ディスク監視として割り当てる記憶域ボリュームを選択してウィザードを完了します。
      5. ファイル共有監視を構成するオプションを選択した場合は、**[ファイル共有監視の構成]** ページで、監視リソースとして使用されるファイル共有を入力または指定してウィザードを完了します。

4. **[次へ]** を選びます。 [確認] ページが表示されたら、クリックして選択内容を確認**次**します。

ウィザードを実行後し、**概要**ページが表示されたら、ウィザードの実行タスクのレポートを表示するを選択する場合**レポートの表示**します。 最新のレポートは、 *systemroot * * *\\クラスター\\レポート** 名前のフォルダー **QuorumConfiguration.mht**します。

>[!NOTE]
>クラスター クォーラムを構成したら、**クォーラム構成の検証** テストを実行して、更新されたクォーラム設定を検証することをお勧めします。

### <a name="windows-powershell-equivalent-commands"></a>Windows PowerShell と同等のコマンド

次の例を使用する方法を示して、 [Set-clusterquorum](https://docs.microsoft.com/powershell/module/failoverclusters/set-clusterquorum?view=win10-ps)コマンドレットとクラスター クォーラムを構成するには、その他の Windows PowerShell コマンドレット。

次の例では、クラスター *CONTOSO-FC1* のクォーラム構成を、クォーラム監視がない単純なノード マジョリティ構成に変更します。

```PowerShell
Set-ClusterQuorum –Cluster CONTOSO-FC1 -NodeMajority
```

次の例では、ローカル クラスターのクォーラム構成をノード マジョリティと監視構成に変更します。 *Cluster Disk 2* という名前のディスク リソースがディスク監視として構成されます。

```PowerShell
Set-ClusterQuorum -NodeAndDiskMajority "Cluster Disk 2"
```

次の例では、ローカル クラスターのクォーラム構成をノード マジョリティと監視構成に変更します。 という名前のファイル共有リソース *\\ \\CONTOSO FS\\fsw*ファイル共有監視として構成されます。

```PowerShell
Set-ClusterQuorum -NodeAndFileShareMajority "\\fileserver\fsw"
```

次の例では、ローカル クラスターのノード *ContosoFCNode1* からクォーラム投票を削除します。

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=0
```

次の例では、ローカル クラスターのノード *ContosoFCNode1* にクォーラム投票を追加します。

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=1
```

次の例では、クラスター **CONTOSO-FC1** の *DynamicQuorum* プロパティを有効にします (以前に無効にされた場合)。

```PowerShell
(Get-Cluster CONTOSO-FC1).DynamicQuorum=1
```

## <a name="recover-a-cluster-by-starting-without-quorum"></a>クォーラムなしでクラスターを起動して回復する

十分なクォーラム投票を持たないクラスターは起動しません。 最初の手順として、クラスター クォーラム構成を常に確認し、クラスターがクォーラムを失った理由を調べる必要があります。 これは、応答を停止したノードが存在するか、またはマルチサイト クラスターでプライマリ サイトにアクセスできない場合に発生する可能性があります。 クラスター障害の根本原因を特定したら、このセクションで説明する回復手順を実行できます。

>[!NOTE]
> * クォーラムが失われたためクラスター サービスが停止した場合は、イベント ID 1177 がシステム ログに表示されます。
> * クラスター クォーラムが失われた理由を常に調べる必要があります。
> * クォーラムなしでクラスターを起動するより、ノードまたはクォーラム監視を正常な状態に戻す (クラスターに参加させる) ことが常に推奨されます。

### <a name="force-start-cluster-nodes"></a>クラスター ノードを強制的に起動する

ノードまたはクォーラム監視を正常な状態に戻すことによってクラスターを回復できない場合は、クラスターを強制的に起動することが必要になります。 クラスターを強制的に起動すると、クラスターのクォーラム構成設定が無効になり、クラスターは **ForceQuorum** モードで起動します。

クォーラムを持たないクラスターを強制的に起動する方法は、特にマルチサイト クラスターで役立ちます。 異なる場所に配置されているプライマリ サイト *SiteA* とバックアップ サイト *SiteB*が含まれるクラスターで障害回復を行うシナリオを考えてみましょう。 *SiteA*で本当の障害が発生した場合、このサイトがオンラインに復帰するまで非常に長い時間がかかる可能性があります。 このような場合、クォーラムを持たない *SiteB* を強制的にオンラインにすることを検討します。

クラスターが **ForceQuorum** モードで起動し、十分なクォーラム投票を再び獲得すると、クラスターは強制された状態を自動的に終了して正常な状態で動作します。 そのため、クラスターを正常に再起動する必要はありません。 クラスターは強制された状態ではなくなったため、クラスターがノードを失い、さらにクォーラムを失うと、再びオフラインに戻ります。 オンラインに戻すとき、クォーラムがあるないクォーラムなしで開始するクラスターの強制が必要です。

>[!IMPORTANT]
>* クラスターが強制的に起動したら、管理者はクラスターに対する完全な制御権限を持ちます。
>* クラスターは、強制的に起動したノードのクラスター構成を使用し、使用可能なその他のすべてのノードにその構成をレプリケートします。
>* クラスターをクォーラムなしで強制的に起動すると、クラスターが **ForceQuorum** モードの間、すべてのクォーラム構成が無視されます。 これには、特定のノードの投票の割り当てと動的なクォーラム管理の設定が含まれます。

### <a name="prevent-quorum-on-remaining-cluster-nodes"></a>残りのクラスター ノードがクォーラムに準拠しないようにする

ノードでクラスターを強制的に起動したら、クラスター内の残りのノードをクォーラムに準拠しない設定で起動する必要があります。 クォーラムに準拠しない設定で起動したノードは、クラスター サービスに対して、新しいクラスター インスタンスを形成する代わりに、既存の実行中のクラスターに参加するように指示します。 このようにすることで、残りのノードによって 2 つの競合するインスタンスから成る分割クラスターが形成されるのを防ぎます。

これが必要になるのは、バックアップ サイト *SiteB* でクラスターを強制的に起動した後に、一部のマルチサイト障害回復シナリオでクラスターを回復する必要がある場合です。 *SiteB* で強制的に再起動したクラスターに参加するには、プライマリ サイト *SiteA* のノードをクォーラムに準拠しない設定で起動する必要があります。

>[!IMPORTANT]
>クラスターがノードで強制的に再起動したら、残りのノードを常にクォーラム非準拠で起動することをお勧めします。

フェールオーバー クラスター マネージャーでクラスターを回復する方法を次に示します。

1. フェールオーバー クラスター マネージャーで、回復するクラスターを選択または指定します。
2. クラスターを選択すると、**アクション**、**クラスターの強制起動**します。

    フェールオーバー クラスター マネージャーは、アクセスできるすべてのノードでクラスターを強制的に起動します。 クラスターは、起動時に現在のクラスター構成を使用します。

>[!NOTE]
>* 使用するクラスター構成を含む特定のノードで開始するクラスターを強制的には、この手順の後に示すように、Windows PowerShell コマンドレットまたは同様のコマンド ライン ツールを使用する必要があります。 
> * フェールオーバー クラスター マネージャーを使用して強制的に起動したクラスターに接続し、 **[クラスター サービスの開始]** アクションを使用してノードを起動した場合、ノードは自動的に非準拠クォーラム設定を使用して起動します。

#### <a name="windows-powershell-equivalent-commands-start-clusternode"></a>Windows PowerShell の同等のコマンド (Start-clusternode)

次の例では、 **Start-ClusterNode** コマンドレットを使用してノード *ContosoFCNode1*でクラスターを強制的に起動する方法を示します。

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –FQ
```

代わりに、ノードで次のコマンドをローカルに実行することもできます。

```PowerShell
Net Start ClusSvc /FQ
```

次の例では、**Start-ClusterNode** コマンドレットを使用して、ノード *ContosoFCNode1* でクラスター サービスをクォーラム非準拠で起動する方法を示します。

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –PQ
```

代わりに、ノードで次のコマンドをローカルに実行することもできます。

```PowerShell
Net Start ClusSvc /PQ
```

## <a name="quorum-considerations-for-disaster-recovery-configurations"></a>障害回復構成で使用するクォーラムに関する考慮事項

このセクションでは、障害回復を展開する際の 2 つのマルチサイト クラスター構成の特性とクォーラム構成をまとめます。 クォーラム構成のガイドラインは、サイト間でワークロードの自動フェールオーバーが必要なのか、または手動フェールオーバーが必要なのかによって異なります。 構成は通常、サイトで障害が発生したときにクラスター化されたワークロードを提供およびサポートするために組織で規定されるサービス レベル アグリーメント (SLA) によって決まります。

### <a name="automatic-failover"></a>自動フェールオーバー

この構成では、クラスターはクラスター化された役割をホストできる 2 つ以上のサイトから構成されています。 いずれかのサイトで障害が発生した場合、クラスター化された役割は残りのサイトに自動的にフェールオーバーされます。 したがって、クラスター クォーラムは、どのサイトもサイト全体の障害に耐えることができるように構成する必要があります。

次の表に、この構成に関する考慮事項と推奨事項をまとめます。

<table>
<thead>
<tr class="header">
<th>項目</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>各サイトのノード数</td>
<td>同数にする必要があります。</td>
</tr>
<tr class="even">
<td>ノードの投票の割り当て</td>
<td>すべてのノードが等しく重要なので、ノードの投票は削除してはなりません。</td>
</tr>
<tr class="odd">
<td>動的なクォーラム管理</td>
<td>有効にする必要があります。</td>
</tr>
<tr class="even">
<td>監視の構成</td>
<td>ファイル共有監視が推奨されます。これはクラスター サイトとは別個のサイトに配置します。</td>
</tr>
<tr class="odd">
<td>ワークロード</td>
<td>ワークロードは任意のサイトで構成できます。</td>
</tr>
</tbody>
</table>

#### <a name="additional-considerations-for-automatic-failover"></a>自動フェールオーバーの追加の考慮事項

- 各サイトに継続して動作する機会を平等に与えるために、ファイル共有監視を別個のサイトに構成する必要があります。 詳細については、このトピックの前半の「[監視の構成](#witness-configuration)」を参照してください。

### <a name="manual-failover"></a>手動フェールオーバー (manual failover)

この構成では、クラスターはプライマリ サイト *SiteA*およびバックアップ (回復) サイト *SiteB*から構成されます。 クラスター化された役割は、*SiteA* でホストされます。 クラスター クォーラム構成のため、障害が *SiteA* 内のすべてのノードで発生した場合、クラスターは動作を停止します。 このシナリオでは、管理者はクラスター サービスを *SiteB* に手動でフェールオーバーし、追加の手順を実行してクラスターを回復する必要があります。

次の表に、この構成に関する考慮事項と推奨事項をまとめます。

<table>
<thead>
<tr class="header">
<th>項目</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>各サイトのノード数</td>
<td>異なっていてもかまいません。</td>
</tr>
<tr class="even">
<td>ノードの投票の割り当て</td>
<td>- ノードの投票をプライマリ サイトでのノードから削除してはなりません<em>SiteA</em><br />
- ノードの投票バックアップ サイト ノードから削除する必要があります<em>SiteB</em><br />
- 長期的な障害が発生した場合<em>SiteA</em>、ノードの投票を割り当てる必要があります<em>SiteB</em>回復の一部としてそのサイトでクォーラム マジョリティを有効にするには</td>
</tr>
<tr class="odd">
<td>動的なクォーラム管理</td>
<td>有効にする必要があります。</td>
</tr>
<tr class="even">
<td>監視の構成</td>
<td>- 偶数のノードがある場合は、ミラーリング監視サーバーを構成する<em>SiteA</em><br />
- ミラーリング監視サーバーが必要な場合は、ファイル共有監視または内のノードにのみアクセス可能なディスク監視を構成する<em>SiteA</em> (非対称ディスク監視とも呼ばれます)</td>
</tr>
<tr class="odd">
<td>ワークロード</td>
<td>優先所有者を使用して、<em>SiteA</em> のノードでワークロードの動作を維持します。</td>
</tr>
</tbody>
</table>

#### <a name="additional-considerations-for-manual-failover"></a>手動フェールオーバー用に追加の考慮事項

- クォーラム投票が最初に構成されるのは、 *SiteA* のノードのみです。 これは、*SiteB* のノードの状態がクラスター クォーラムに影響を与えないようにするために必要です。
- 回復手順は、 *SiteA* が一時的な障害に耐えることができるか、または長期の障害に耐えることができるかによって異なります。

## <a name="more-information"></a>詳細情報

* [フェールオーバー クラスタ リング](failover-clustering.md)
* [フェールオーバー クラスター Windows PowerShell コマンドレット](https://docs.microsoft.com/powershell/module/failoverclusters/?view=win10-ps)
* [クラスターとプールのクォーラム](../storage/storage-spaces/understand-quorum.md)