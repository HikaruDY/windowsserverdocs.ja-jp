---
ms.assetid: e6fa9069-ec9c-4615-b266-957194b49e11
title: AD RMS を Windows Server 2016 にアップグレードします。
description: ''
author: msmbaldwin
ms.author: esaggese
ms.date: 05/30/2019
ms.topic: article
ms.openlocfilehash: f5d621a0ba06f5b1beb97ccdbffb8376b5503168
ms.sourcegitcommit: 927adf32faa6052234ad08f21125906362e593dc
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/12/2019
ms.locfileid: "67033343"
---
# <a name="upgrading-ad-rms-to-windows-server-2016"></a>AD RMS を Windows Server 2016 にアップグレードします。

## <a name="introduction"></a>概要

Active Directory Rights Management サービス (AD RMS) とは、機密性の高いドキュメントや電子メールを保護する Microsoft サービスです。 ファイアウォールや Acl などの従来の保護方法とは異なり、AD RMS 暗号化と保護が、ファイルの行き先やは転送方法に関係なく永続的なは。 

このドキュメントは、SQL Server 2012 と Windows Server 2012 R2 から Windows Server 2016 および SQL Server 2016 への移行に関するガイダンスを提供します。 古いがサポートされているバージョンの AD RMS から移行するのと同じプロセスを使用できます。
Active Directory Rights Management サービスがアクティブな開発では、不要になったことと、顧客の最新機能への移行を検討する必要がありますに注意してください[Azure Information Protection](https://azure.microsoft.com/services/information-protection/)などを提供します。詳細なデバイスとアプリケーションのサポート機能の包括的なセット。 

コンテンツを再保護することがなく AD RMS から Azure Information Protection への移行に関する情報を参照してください。 [Azure Information Protection の移行に関するドキュメント](https://docs.microsoft.com/azure/information-protection/migrate-from-ad-rms-to-azure-rms)します。

## <a name="about-the-environment-used-in-this-guide"></a>このガイドで使用される環境について

AD FS は、AD RMS のインストールのオプションのコンポーネントです。 このガイドでは、ADFS の使用と見なされます。 ADFS は、AD RMS のユーザーをサポートするため環境内で使用されていない、ADFS を参照するすべての手順をスキップすることができます。

このガイドでは、SQL Server は並列インストールを実行して、バックアップを使用して経由でデータベースの移動によって SQL Server 2016 にアップグレードされます。 または、AD RMS と ad FS データベース サーバーをアップグレードするには SQL Server 2016 での場所に場合、移動できますこのドキュメントでは、次のセクションにこのセクションの手順を実行することがなくを行った後。  

## <a name="installation"></a>インストール

### <a name="configuring-sql-server-2016"></a>SQL Server 2016 の構成

次のセクションの詳細の実装のタスクは、SQL Server 2016 の構成に直接関連します。 このガイドは、サーバー マネージャーと、SQL Server Management Studio を使用して、これらのタスクを完了するについて説明します。

これらの手順は、SQL Server 2016 のインストールを完了する必要があります。 組織の標準的なプラクティスとポリシーに従って適切なハードウェア上で SQL Server 2016 をインストールします。 

#### <a name="preparing-the-sql-server"></a>SQL Server の準備

次のセクションでは、Windows Server 2016 を使用する AD RMS のプラットフォームの他のサービスをアップグレードする前に SQL Server 2016 にアップグレードできるように、SQL Server を準備する方法について説明します。

##### <a name="adding-cname-for-sql-server-2016-to-dns"></a>SQL Server 2016 の CNAME を DNS に追加

CNAME は、確実に、Windows Server 2016 セットアップが発生、適切なデータは、新しい SQL Server 2016 に指しているために使用されます。 **注:既に ad FS と AD RMS サービスの CNAME を使用して場合、次の手順に移動することができます。**


**SQL Server 2016 の CNAME を DNS に追加するには**

1.  Windows Server 2012 R2 ドメイン コント ローラーのドメイン管理者の資格情報でログオンします。

2.  サーバー マネージャーを開きます。

3.  をクリックして**ツール**選択**DNS** DNS マネージャーを開きます。

4.  左側のナビゲーション ウィンドウで、ドメイン コント ローラーを展開し、起動**前方参照ゾーン**します。

5.  適切なドメインのリソースを開くし、選択して、右側のビュー ペイン内を右クリックして**新しいエイリアス (CNAME)** CNAME の作成を開始します。

6.  その他を区別するために論理名を (エ存在する可能性がありますにエイリアス名を入力します SQLADRMS または SQLADFS)

7.  名前を入力した後は、新しい SQL Server 2016 サーバーとなるターゲット ホストの FQDN を指定します。 (例: SQL2016.contoso.com)

8.  すべての情報を入力すると、クリックして**OK**します。

##### <a name="backup-the-ad-rms-and-adfs-databases"></a>AD RMS と ad FS データベースをバックアップします。

AD RMS と ad FS データベースは、サーバー ライセンサー証明書、権利ポリシー テンプレート、ad FS 構成データ、およびログ情報の公開キーなどの AD RMS に必要な重要な情報を保持します。 これらのデータベースなしのクライアントは、その他の問題の間での保護されたコンテンツを使用するライセンスを発行できません。

AD RMS 構成データベースが最も重要なデータベースの権限ポリシー テンプレート、ユーザーのキー、および構成情報のように、slc が除去、格納します。 そのため、すべての AD RMS と ad FS データベースをバックアップするように注意する必要がある、ただし、構成データベースを定期的にバックアップを計画してください。

ログ データベースには、証明書と使用ライセンスの AD RMS クラスターへのユーザーの要求に関する情報が格納されます。 このデータベースのバックアップ戦略は、この種の情報を保持するための会社のポリシーに基づく必要があります。

ディレクトリ サービス データベースが AD RMS の機能に重要でないと、最新のデータが失われた場合は、データベースは、AD RMS サーバーが証明書の要求を受け取るためにの情報を再作成し、ライセンスを使用しています。 このデータベースを定期的にバックアップする必要はありませんが、ように AD RMS の展開後に最初に構成されたデータベースのコピーを少なくともが存在する必要は。

**Microsoft SQL Server では、AD RMS や ad FS データベースをバックアップするには**

1.  SQL 2012、Windows Server 2012 R2 の AD RMS のデータベース サーバーにログオンします。

2.  クリックして**開始**、 をクリックして**すべてのプログラム**、 をクリックして**Microsoft SQL Server**、 をクリック**SQL Server Management Studio**します。

3.  **サーバーへの接続**ウィンドウで、AD RMS データベースをホストするサーバーがあることを確認、**サーバー名**ボックスし、をクリックして**Connect**します。

4.  **[データベース]** を展開します。 適切なデータベースを右クリックして (**DRM**と**Adfs**)、 をポイント**タスク**、選択および**バックアップ**します。

5.  残りのデータベースには、手順 4. を繰り返します。

6.  その他のマシン、ネットワークまたはストレージ デバイスを使用するように、移行中に後の手順で必要になりますが、データベースのバックアップにアクセスできることを確認します。

安全な場所にデータベースのコピーを格納します。 データベースのバックアップを頻繁に注意してください。

##### <a name="adding-domain-admin-sql-ad-rms-andor-adfs-service-account-to-sql-server-2016"></a>SQL Server 2016 へのドメイン管理者を追加するには、SQL、AD RMS、または ADFS サービス アカウントします。

次の手順では、Windows Server 2012 R2 環境からのデータの移行を支援する SQL Server 2016 にさまざまなサービス アカウントを追加する方法が紹介されます。 コンテンツにアクセスし、データを処理しようとするときは、適切なアクセス許可になります。

**SQL Server をドメイン管理者、SQL、AD RMS、または ADFS サービス アカウントを追加するには**

1.  SQL Server 2016 でサーバーにローカル管理者アカウントとしてログオンします。

2.  クリックして**開始**、 をクリックして**すべてのプログラム**、 をクリックして**Microsoft SQL Server**、 をクリック**SQL Server Management Studio**します。

3.  **サーバーへの接続**ウィンドウで、AD RMS データベースをホストするサーバーがあることを確認、**サーバー名**ボックスし、認証ドロップダウン メニューをクリックして選択して**SQL Server認証**します。

4.  **ログイン**フィールド (例: ローカル管理者アカウントの名前を入力します。 localadmin) 適切なパスワードを指定して、クリックして**Connect**します。

5.  展開**セキュリティ**し、右クリックし、**ログイン**選択**新しいログイン**表示されるコンテキスト メニューから。

6.  ウィンドウでドメイン管理者のアカウントでの入力が表示されたら、**ログイン名**フィールド (例。 Contoso\\ContosoAdmin)

7.  左側のナビゲーション ウィンドウで、次のように選択します。**サーバーの役割**します。

8.  チェック ボックスをオンし**sysadmin** サーバーの役割とクリック**OK**。

9.  再起動**SQL Server Management**します。

10. **サーバーへの接続**ウィンドウで、AD RMS データベースをホストするサーバーがあることを確認、**サーバー名**ボックスし、認証ドロップダウン メニューをクリックして選択して**Windows認証**クリック**Connect**します。

##### <a name="restoring-the-ad-rms-and-adfs-databases-to-sql-server-2016"></a>SQL Server 2016 への AD RMS と ad FS データベースを復元します。

次の手順では、新しい 2016年インスタンスに以前の SQL Server インスタンスからデータを復元する方法が紹介されます。 これにより、以前の AD RMS と ad FS データベースから関連する構成データを利用する新しい SQL が許可されます。

**新しい SQL Server に以前の SQL Server からデータを復元するには**

1.  適切なアカウントでは、SQL Server 2016 でのサーバーにログオンします。

2.  左側のナビゲーション ウィンドウで、右クリックして**データベース**選択**データベースの復元**復元プロセスを開始します。

3.  **ソース**選択**デバイス**し、前の手順で、データベース ファイルが格納されている場所を参照します。

4.  ファイルを選択すると、クリックして**OK**します。

5.  すべてのデータベース ファイルが追加されをクリックして、プロセスを完了することを確認します。 **OK**します。

### <a name="configuring-windows-server-2016-active-directory-federation-services-ad-fs"></a>Windows Server 2016 の Active Directory フェデレーション サービス (AD FS) を構成します。

AD RMS アプリケーションにシングル サインオン (SSO) アクセスを提供するには、AD FS を展開されています。 AD RMS モバイル デバイス拡張機能 (MDE)、これにより、Mac、およびエンドユーザーのモバイル デバイスのサポートも構成されています。

次のセクションでは、運用のタスクが、AD FS の配置で実行する必要がありますのガイダンスを説明します。

#### <a name="adding-a-2016-ad-fs-server-to-the-farm"></a>2016 の AD FS サーバーをファームに追加します。

AD RMS 展開をサポートするために AD FS サーバーを展開することができます。 AD RMS サーバー、またはその他のアプリケーションへのトラフィックが増加が発生した場合は、この操作を実行することができます、またはいずれかの AD FS で現在使用されているサーバーをインベントリから削除する必要がある場合。

**2016 の AD FS サーバーをファームに追加するには**

1.  Azure AD Connect サーバーで、クリックして、 **Azure AD Connect** Azure AD Connect ウィザードを起動するにはアイコン。

2.  ようこそ ページで、次のようにクリックします。**構成**します。

3.  その他のタスク ページで、次のようにクリックします。**追加のフェデレーション サーバーをデプロイ**順にクリックします**次**します。

4.  Azure AD のページへの接続、ユーザー名とグローバル管理アクセス許可を持つアカウントのパスワードを入力し、クリックして**次**します。

5.  ドメイン管理者の資格情報 ページで、ユーザー名とドメイン管理者のアクセス許可を持つアカウントのパスワードを入力し、クリックして**次**します。

6.  をクリックして**参照**および構成する Azure AD Connect を使用して、AD FS ファームのときに使用した証明書ファイルを選択します。

7.  クリックして**パスワードの入力**証明書のパスワード ダイアログ ボックスを開きます。

8.  パスワード フィールドに、証明書のパスワードを入力し、クリックして**OK**します。

9.  **[次へ]** をクリックします。

10. AD FS サーバー ページで、名前または新しい AD FS サーバーの IP アドレスを入力し、クリックして**追加**します。

11. 準備完了の構成] ページで、[クリックして**インストール**します。

12. インストールの完了 ページで、次のようにクリックします。**終了**します。

#### <a name="raising-the-adfs-farm-behavior-level"></a>Ad FS ファーム動作レベルを上げる

などの現在の環境レベルを超える ADFs サーバーをデプロイするときに、ADFS を Windows Server 2012 R2 で発生し、追加する ADFS Windows Server 2016、ファームレベルの動作は大きく必要があります。 これは、最新の情報と機能、環境を使用していることを確認する必要です。

**ADFS ファーム動作レベルを上げる**

1.  Windows Server 2016 の ad FS に移動します。

2.  管理 PowerShell セッションを開きます。

3.  次のコマンドを入力します:  **\$cred Get-credential を =**

4.  ドメイン管理者の資格情報を入力、資格情報を求めるウィンドウが表示されます。

5.  このコマンドを入力します。**Invoke-AdfsFarmBehaviorLevelRaise -Credential \$cred**

6.  プロンプトが表示され、**この操作を続行しますか?** Enter **、** プロンプトを受け入れる。

7.  コマンドが完了すると、ファーム動作レベルはように設定して、準備が完了します。

#### <a name="enabling-mobile-device-extension-logging"></a>モバイル デバイス拡張機能のログ記録を有効にします。

モバイル デバイス拡張機能は、エンド ユーザー デバイスから受信した要求を記録できます。 ログ記録が既定で無効にし、トラブルシューティングのシナリオでのログ記録を有効にするだけをお勧めします。 します。 モバイル デバイスとデスクトップ コンピューターで、ブートス トラップ、または、エンドユーザーによる使用ライセンスの取得から、すべての要求は、AD RMS ログ データベースまたは Azure ストレージ アカウントに記録されます。 MDE のログ記録を AD RMS で使用される SQL Server の 2 つのテーブルが作成されます: クライアントは、ログ テーブルと、クライアント パフォーマンスのログ テーブルをデバッグします。

**モバイル デバイス拡張機能のログ記録を有効にするには**

1.  AD RMS サーバーから管理者として Windows PowerShell を開きます。

2.  次のコマンドとキーを押して入力**Enter**:**Import-module AdRmsAdmin**

3.  次のコマンドとキーを押して入力**Enter**:**New-PSDrive -Name AdrmsCluster -PsProvider AdRmsAdmin -Root https://localhost**

4.  次のコマンドとキーを押して入力**Enter**:**Set-itemproperty-Path AdrmsCluster:\\ -名前 IsLoggingEnabled-値\$は true。**

MDE ログのトラブルシューティングを使用している場合は、問題を解決した後に無効にすることをお勧めします。

**モバイル デバイス拡張機能のログ記録を無効にするには**

1.  AD RMS サーバーから管理者として Windows PowerShell を開きます。

2.  次のコマンドとキーを押して入力**Enter**:**Import-module AdRmsAdmin**

3.  次のコマンドとキーを押して入力**Enter**:**New-PSDrive -Name AdrmsCluster -PsProvider AdRmsAdmin -Root https://localhost**

4.  次のコマンドとキーを押して入力**Enter**:**Set-itemproperty-Path AdrmsCluster:\\ -名前 IsLoggingEnabled-値\$false**

### <a name="upgrading-ad-rms-to-windows-server-2016"></a>AD RMS を Windows Server 2016 にアップグレードします。

次のセクションでは、現在の Windows Server 2012 R2 クラスターに Windows Server 2016 ベースの AD RMS サーバーを追加する方法のガイダンスを提供します。 サーバーがクラスターに追加され、情報は、以前の AD RMS サーバーがリソースを解放する非推奨となるようにしてレプリケートされます。

Windows Server 2016 ベースの AD RMS サーバーが、AD RMS クラスターに追加されているいずれかを追加すると後、は、Windows の以前のバージョンに基づくすべてのノードが非アクティブになります。 これが完了した後、それらのサーバー (例: シャット ダウン、用途を変更または再インストール、AD RMS クラスターに参加する Windows Server 2016) がプロビジョニング解除できます。 

追加の AD RMS サーバーは、AD RMS のデプロイメントで負荷をサポートするクラスターにデプロイできます。 AD RMS サーバーへのトラフィックが増加が発生した場合は、この操作を実行することもできます。

このガイドを負荷分散メカニズムを使用している環境内で非推奨にするサーバーを除外して、クラスターに追加するものが含まれますを変更するために必要な手順については説明しません。 

#### <a name="adding-a-2016-ad-rms-server"></a>2016 の AD RMS サーバーを追加します。

AD RMS クラスターは、そのサーバー ライセンサー証明書の一元管理型のキーの代わりにハードウェア セキュリティ モジュールを使用されている場合は、サーバーに AD RMS をインストールする前に、ソフトウェアおよびその他の HSM の成果物 (キーと構成ファイルなど) をインストールする必要があります。 また、物理的にまたは関連するネットワーク構成のいずれかに、サーバーに、HSM を接続する必要があります。 これらの手順については、HSM のガイダンスに従ってください。 

**2016 の AD RMS サーバーを追加するには**

1.  必要な Windows Server 2016 の展開には、AD RMS の役割をインストールします。

2.  リンクを選択してインストールの完了後**追加の構成を行います**します。

3.  選択**既存の AD RMS クラスターに参加** をクリック**次**します。

4.  **構成データベースの選択** ページで、2016年の SQL server (FQDN) の DNS で指定した CNAME を入力します。

5.  クリックして**一覧**2 番目の行をクリックし、 **[defaultinstance]** ドロップダウン リストから。

6.  **構成データベース名**ドロップダウン メニューを選び、表示される DRM 構成を選択します。 **[次へ]** をクリックします。

7.  **データベース情報** ページで、指定されたフィールドにクラスター キー パスワードを入力します。 その後、次のようにクリックします。**次**します。

8.  ウィザードの次のページで AD RMS サービス アカウントを指定し、そのパスワードを入力し、 をクリックして**次**が確認されたとします。

9.  1 回、**クラスター Web サイト**ページが表示されたら、単に適切な web サイトが選択されていることを確認し をクリックして**次**します。

10. **サーバー認証証明書を選択**ページでインポートした SSL 証明書を選択し、をクリックして**次**します。

11. クリックして**インストール**インストールを開始します。

12. 構成が完了すると、AD RMS を管理する記録オフにする必要があります。

13. 背面のログオンすると開く**サーバー マネージャー**選択**ツール**し**Active Directory Rights Management**します。 管理 ウィンドウが表示され、クラスターのクラスターで追加のサーバーがあるかを指定する必要があります。

14. 元の AD RMS クラスターで AD RMS モバイル デバイス拡張機能がインストールされた場合は、更新済みのクラスター ノードで、MDE にもインストールする必要があります。 MDE を AD RMS クラスターに追加するのには、MDE ドキュメントの手順に従います。 この時点では、既存のすべてのノードとして再利用、Windows Server 2016 にアップグレードまたはとそれらを上記で説明したのと同じプロセスを使用して AD RMS クラスターに再度参加させます。 

### <a name="configuring-windows-server-2016-web-application-proxy-wap"></a>Windows Server 2016 の Web アプリケーション プロキシ (WAP) を構成します。

次のセクションでは、Web アプリケーション プロキシの配置で実行する必要のある運用タスクでガイダンスを提供します。 これは、オプションの手順かどうかに、パブリッシュする AD RMS、インターネットを介して他のメカニズムは必要ありません。 

#### <a name="adding-a-windows-server-2016-wap-server"></a>Windows Server 2016 の WAP サーバーを追加します。

AD RMS 展開をサポートするために Web アプリケーション プロキシ サーバーを展開することができます。 AD RMS サーバーへのトラフィックが増加またはいずれかの Web アプリケーション プロキシの現在使用されているサーバーをインベントリから削除する必要があるかどうかが発生した場合は、この操作を実行することができます。

**2016 Web アプリケーション プロキシ サーバーを追加するには**

1.  Web アプリケーション プロキシとしてセットアップする、サーバーからサーバー マネージャーのコンソールに移動し、をクリックして**役割と機能の追加**します。

2.  **追加の役割と機能ウィザード**、 をクリックして**次**サーバーの役割の選択画面に表示されるまでです。

3.  サーバーの役割の選択画面で、次のように選択します。**リモート アクセス**、順にクリックします**次**、サーバーの役割の選択画面に戻ってができるまで。

4.  [サーバーの役割の選択画面で、次のように選択します。 **Web アプリケーション プロキシ**、] をクリック**機能の追加**、順にクリックします**次**します。

5.  インストール オプションの確認画面で、次のようにクリックします。**インストール**します。

6.  インストールが完了すると、クリックして**閉じる**します。

7.  ここには、サーバーを構成します。 これを行うには、Web アプリケーション プロキシ サーバーでリモート アクセス管理コンソールを開きます。 開く、**開始**メニューで、「 **RAMgmtUI.exe**、し、アプリケーションを選択します。

8.  ナビゲーション ウィンドウで、 **Web アプリケーション プロキシ**します。

9.  リモート アクセス管理コンソールで  **Web アプリケーション プロキシ構成ウィザードを実行して**します。 1 回ウィザードで、次のようにクリックします。**次**します。

10. フェデレーション サーバーの画面で、(例: AD FS サーバーの完全修飾ドメイン名を入力します。 adfs.contoso.com) AD FS サーバーで管理者の資格情報を入力するとします。

11. AD FS プロキシの証明書 画面で、現在、Web アプリケーション プロキシ サーバーにインストールされている証明書の一覧で、AD FS プロキシの Web アプリケーション プロキシで使用される証明書を選択し、をクリックし、**次**します。

12. 確認画面で、設定を確認しをクリックして**構成**します。

13. 構成が完了したら、クリックして**閉じる**します。

#### <a name="dns-configuration-for-2016-wap-server"></a>2016 の DNS 構成を WAP サーバー

Windows Server 2016 の Web アプリケーション プロキシ サーバーは、場所に設定されているが、DNS の変更がいくつかにする必要があります。 これは、2016年の WAP サーバーで ADFS をポイントする GoDaddy などのサービスと AD RMS サービスを使用する必要があります。

**WAP サーバーで DNS をポイントするには**

1.  プロバイダーの web サイト (例: に移動します GoDaddy)。

2.  ドメインの管理と、DNS の管理に移動します。

3.  Ad FS と AD RMS サービス検索し、置換、**指す**2016 WAP サーバーのパブリック IP アドレス部分と**保存**します。

4.  変更が、反映されるまでの時間をかかる場合がありますが、このセットアップを完了するとします。

#### <a name="enabling-debugging-logs"></a>デバッグ ログを有効にします。

詳細なログ情報は、Web アプリケーション プロキシ サーバーで使用できます。 イベント ビューアーを使用して、高度なデバッグ ログを構成することができます。 追加の設定を analytics は、ビューアーに役立つことを確保しやすく、ログのサイズの選択もできます。

**Web アプリケーション プロキシのデバッグ ログを有効にします。**

1.  開く、**イベント ビューアー**コンソール、Web アプリケーション プロキシをします。

2.  展開、 **Microsoft**ノード。

3.  展開、 **Windows**ノード。

4.  開く、 **Web アプリケーション プロキシ**ログ。

5.  開くことがなります、**管理者**ログ。

6.  開く、**アクション**メニューをクリックし、左、上にある**プロパティ**します。

7.  下、**全般** タブで、オプションを選択**ログ記録を有効にする**します。

8.  最後に、ログの最大サイズとイベント ログの最大サイズに達したときの動作をカスタマイズすることは。

### <a name="configuring-high-availability-for-windows-server-2016-services"></a>Windows Server 2016 サービスの高可用性の構成

次のセクションでは、運用のタスクでは、高可用性 Windows Server 2016 環境を設定する必要がありますのガイダンスを説明します。

#### <a name="adding-a-2016-ad-rms-server-for-high-availability"></a>高可用性のため、2016年の AD RMS サーバーを追加します。

高可用性をセットアップするために AD RMS サーバーを展開することができます。 AD RMS サーバーへのトラフィックが増加が発生した場合は、この操作を実行することができます。

**高可用性の 2016年の AD RMS サーバーを追加するには**

1.  必要な Windows Server 2016 の展開には、AD RMS の役割をインストールします。

2.  リンクを選択してインストールの完了後**追加の構成を行います**します。

3.  選択**既存の AD RMS クラスターに参加** をクリック**次**します。

4.  **構成データベースの選択** ページで、2016年の SQL server (FQDN) の DNS で指定した CNAME を入力します。

5.  クリックして**一覧**2 番目の行をクリックし、 **[defaultinstance]** ドロップダウン リストから。

6.  **構成データベース名**ドロップダウン メニューを選び、表示される DRM 構成を選択します。 **[次へ]** をクリックします。

7.  **データベース情報** ページで、指定されたフィールドにクラスター キー パスワードを入力します。 その後、次のようにクリックします。**次**します。

8.  ウィザードの次のページで AD RMS サービス アカウントを指定し、そのパスワードを入力し、 をクリックして**次**が確認されたとします。

9.  1 回、**クラスター Web サイト**ページが表示されたら、単に適切な web サイトが選択されていることを確認し をクリックして**次**します。

10. **サーバー認証証明書を選択**ページでインポートした SSL 証明書を選択し、をクリックして**次**します。

11. クリックして**インストール**インストールを開始します。

12. 構成が完了すると、AD RMS を管理する記録オフにする必要があります。

13. 背面のログオンすると開く**サーバー マネージャー**選択**ツール**し**Active Directory Rights Management**します。 管理 ウィンドウが表示され、クラスターのクラスターで追加のサーバーがあるかを指定する必要があります。

14. サーバーのセットアップを確定した後、クラスター内の別の AD RMS サーバーの間で負荷を分散する負荷分散サービスを構成します。

#### <a name="adding-a-windows-server-2016-ad-fs-server-for-high-availability"></a>高可用性のための Windows Server 2016 AD FS サーバーの追加

高可用性をセットアップするために AD FS サーバーを展開することができます。 AD FS サーバーへのトラフィックが増加が発生した場合は、この操作を実行することができます。 **注: ファーム動作レベルを上げるには、後に新しいデータベースのエントリが入力されます (Adfs Configv3) の SQL Server 2016 にして、次の手順を続行する前に古い構成データベースを削除する必要があります。**

**高可用性のため、Windows Server 2016 の AD FS サーバーを追加するには**

1.  必要な Windows Server 2016 の展開には、AD RMS の役割をインストールします。

2.  リンクを選択してインストールの完了後**このサーバーで、フェデレーション サービスを構成**します。

3.  ウィザードの ようこそ のセクションで、オプションを選択**フェデレーション サーバー ファームにフェデレーション サーバーを追加** をクリックし、**次**します。

4.  適切な管理者アカウントを指定し、クリックして**次**します。

5.  **Specify Farm**  ページで、選択、 **SQL Server を使用して既存のファームのデータベースの場所を指定**し、データベースのホスト名の SQL サービスの CNAME を入力し、クリックして**次へ**.

6.  下、**サービス アカウントの指定**領域ウィザードの AD FS サービス アカウントの資格情報を入力し、順にクリックします**次**します。

7.  **オプションの確認**、 をクリックして**次**します。

8.  クリックして**構成**ボタンが使用できるになります。

9.  構成した後、マシンを再起動します。

10. 後、サーバーのセットアップ、負荷分散を必要に応じて、AD FS サーバーを確認します。

#### <a name="adding-a-windows-server-2016-wap-server-for-high-availability"></a>高可用性のため、Windows Server 2016 の WAP サーバーを追加します。

高可用性をセットアップする追加の WAP サーバーを展開することができます。 AD RMS サーバーへのトラフィックが増加が発生した場合は、この操作を実行することができます。

**高可用性 Windows Server 2016 の Web アプリケーション プロキシ サーバーを追加するには**

1.  Web アプリケーション プロキシとしてセットアップする、サーバーからサーバー マネージャーのコンソールに移動し、をクリックして**役割と機能の追加**します。

2.  **追加の役割と機能ウィザード**、 をクリックして**次**サーバーの役割の選択画面に表示されるまでです。

3.  サーバーの役割の選択画面で、次のように選択します。**リモート アクセス**、順にクリックします**次**、サーバーの役割の選択画面に戻ってができるまで。

4.  [サーバーの役割の選択画面で、次のように選択します。 **Web アプリケーション プロキシ**、] をクリック**機能の追加**、順にクリックします**次**します。

5.  インストール オプションの確認画面で、次のようにクリックします。**インストール**します。

6.  インストールが完了すると、クリックして**閉じる**します。

7.  ここには、サーバーを構成します。 これを行うには、Web アプリケーション プロキシ サーバーでリモート アクセス管理コンソールを開きます。 開く、**開始**メニューで、「 **RAMgmtUI.exe**、し、アプリケーションを選択します。

8.  ナビゲーション ウィンドウで、 **Web アプリケーション プロキシ**します。

9.  リモート アクセス管理コンソールで  **Web アプリケーション プロキシ構成ウィザードを実行して**します。 1 回ウィザードで、次のようにクリックします。**次**します。

10. フェデレーション サーバーの画面で、(例: AD FS サーバーの完全修飾ドメイン名を入力します。 adfs.contoso.com) AD FS サーバーで管理者の資格情報を入力するとします。

11. AD FS プロキシの証明書 画面で、現在、Web アプリケーション プロキシ サーバーにインストールされている証明書の一覧で、AD FS プロキシの Web アプリケーション プロキシで使用される証明書を選択し、をクリックし、**次**します。

12. 確認画面で、設定を確認しをクリックして**構成**します。

13. 構成が完了したら、クリックして**閉じる**します。

14. サーバーのセットアップを確定した後は、負荷は、DMZ 内の WAP サーバーを分散します。

#### <a name="adding-a-sql-server-2016-node-for-always-on-high-availability"></a>Always On 高可用性の SQL Server 2016 ノードを追加します。

Always On 高可用性をセットアップするために SQL サーバーを展開することができます。 AD RMS サーバーへのトラフィックが増加が発生した場合は、この操作を実行することができます。 **注: では、両方の SQL Server の受信ポート 5022 はオープンであることを確認します。**

**Always On 高可用性の SQL server 2016 サーバーを追加するには**

1.  その他の SQL Server 2016 サーバーとしてセットアップする、サーバーからサーバー マネージャーのコンソールに移動し、をクリックして**役割と機能の追加**します。

2.  クリックして**次**まで、**機能の選択** ダイアログ ボックス。

3.  選択、**フェールオーバー クラスタ リング**チェック ボックスをオンします。 **注: は両方の SQL Server フェールオーバー クラスタ リング機能があるように、元の SQL server 2016 サーバーもこの手順に従います。**

4.  クリックして**インストール**フェールオーバー クラスタ リング機能をインストールします。

5.  これで、開く**サーバー マネージャー**選択**ツール**し**フェールオーバー クラスター マネージャー**します。

6.  左側のメニュー ウィンドウで、右クリックして**フェールオーバー クラスター マネージャー**選択**クラスターの作成**

7.  開き、**クラスターの作成ウィザード**します。

8.  Always On 高可用性のために使用される、クリックに入力している SQL server 2016 サーバーの参照**次**します。

9.  検証の警告が表示されます。 選択**はい**をクラスター ノードを検証し、をクリックし、 **[次へ]** します。

10. 下、**テスト オプション**オプションを選択 ページで、**テストをすべて実行** をクリック**次へ。**

11. **注:クラスター検証ウィザードは、共有記憶域を使用していない場合に特に、複数の警告メッセージを返すと想定されます。それ以外、エラー メッセージを検索する場合、Windows Server フェールオーバー クラスターを作成する前にそれを修正する**します。

12. **クラスター管理用のアクセス ポイント**ダイアログ ボックスでは、Windows Server フェールオーバー クラスターの仮想 IP アドレスとクラスターの名前を入力し、をクリックして**次**します。

13. 構成が成功したことを確認**概要** をクリック**完了**します。

14. 戻り、**フェールオーバー クラスター マネージャー、** クリックし、クラスターを右クリックして**その他のアクション**選択**クラスター クォーラム設定の構成**

15. をクリックして **[次へ]** してオプションを選択してください**クォーラム監視を選択する**とヒット **[次へ]** もう一度です。

16. **クォーラム監視の選択**ページで、選択、**ファイル共有監視を構成する**オプション。 **[次へ]** をクリックします。

17. 選択**参照** ダイアログ ボックスでファイル共有のパスを使用するファイル共有のパスを見つけるとします。 **[次へ]** をクリックします。

18. [確認] ページで、次のようにクリックします。**次**します。

19. [概要] ページで、次のようにクリックします。**完了**します。

20. これで、開く、**開始**メニューを検索して**SQL Server 構成マネージャー**します。

21. SQL Server 名を右クリックし、選択**プロパティ**します。

22. プロパティ ダイアログ ボックスで、選択、 **AlwaysOn 高可用性**タブ。チェック、 **AlwaysOn 可用性グループを有効にする**チェック ボックスをオンします。 **[OK]** をクリックします。 **注: これを行う両方の SQL server 2016 サーバー。**

23. SQL Server サービスを再起動します。

24. これで、開く、**開始**メニューを検索して**SQL Server Management Studio**左側のナビゲーション ウィンドウで、右クリックして**可用性グループ**をクリックします **。新しい可用性グループ ウィザード**クリックして**次**します。

25. **可用性グループ名の指定**ページは、グループ名 (Ex.SQLAvailabilityGroup2016) を選択します。 **[次へ]** をクリックします。

26. で、**データベースの選択**セクションで、データベースを指定します。 それから、[次へ] をクリックします。 **注: 一部のデータベースは、もう一度バックアップまたは完全復旧モードにする必要があります**します。

27. 1 回、**レプリカの指定** ページで、をクリックして、**のレプリカ追加**ボタンをクリックし、その他の 2016 SQL Server を選択します。

28. 他のサーバーを追加すると、チェック ボックスをクリックし、読み取り可能なセカンダリのセカンダリ サーバーを設定します。

29. 移動し、**エンドポイント** タブでをクリックし、**更新**オプション。 ここでは、中にスクロールし、同じサービス アカウントがプライマリとセカンダリ ノードであることを確認します。

30. ここで、選択、**バックアップの設定**  タブで選択し、**セカンダリを優先**オプション。

31. 移動、**リスナー**タブ。

32. 指定の名前 (例。 SQLListener) ポートがあることを確認および**1433**順にクリックします**次**します。

33. **初期データ同期を選択**ページ、ウィザードの次のように選択します、**完全**オプションと、すべての SQL server によってアクセスできるネットワーク場所を指定し、クリック**次**.

34. 最後に、クリックして**完了**され、プロセスが完了します。

### <a name="decommission-windows-server-2012-r2-nodes"></a>Windows Server 2012 R2 ノードを使用停止します。

次のセクションを正常に AD RMS クラスターを Windows Server 2016 にアップグレードした後、Windows Server 2012 R2 サーバーを削除する必要のある運用タスクでガイダンスを提供します。

#### <a name="removing-a-windows-server-2012-r2-ad-rms-server"></a>Windows Server 2012 R2 AD RMS サーバーを削除します。

アップグレードした後、不要な AD RMS サーバーを削除できます。 AD RMS サーバーの使用を停止する必要がときに、この操作を実行することができます。

**削除する、** **Windows Server 2012 R2 の AD RMS サーバー**

1.  サーバー マネージャーで Windows Server 2012 R2 の AD RMS サーバーで次のように選択します。**管理**上部のメニューを右クリックして**役割の削除と機能**。

2.  **役割の削除と機能ウィザード**とでが開きます、**開始する前に**画面で、**次**します。

3.  **サーバーの選択** 画面で、をクリックして**次**。

4.  **サーバーの役割**画面で、横にチェック ボックスをオフ**Active Directory Rights Management サービス** をクリック**次**します。

5.  **機能** 画面で、をクリックして**次**します。

6.  **確認** 画面で、をクリックして**削除**します。

7.  これが完了すると、サーバーを再起動します。

8.  このサーバーをシャット ダウンし、必要に応じて、リソースの再割り当てできます。
