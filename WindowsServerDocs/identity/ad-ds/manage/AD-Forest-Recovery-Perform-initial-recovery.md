---
title: "AD フォレストの回復 - 最初の回復を実行"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 07/07/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: 5a291f65-794e-4fc3-996e-094c5845a383
ms.technology: identity-adfs
ms.openlocfilehash: fc2ec09c5b96b76229d532adc6a254c8108d8940
ms.sourcegitcommit: ac73f0f0dca04be731b928183bfdffc97d82c277
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/02/2018
---
# <a name="perform-initial-recovery"></a>初期の回復を実行します。  

>Windows Server 2016、Windows Server 2012 および 2012 R2、Windows Server 2008 および 2008 の R2 を適用対象:

 このセクションには、次の手順が含まれています。  
  
-   [各ドメインの最初の書き込み可能なドメイン コントローラーを復元します。](#Restore-the-first-writeable-domain-controller-in-each-domain)  

-   [各復元された書き込み可能なドメイン コントローラがネットワークに再接続します。](#Reconnect-each-restored-writeable-domain-controller-to-a-common-network)  
  
-   [フォレスト ルート ドメインのドメイン コントローラーをグローバル カタログを追加します。](#Add-the-global-catalog-to-a-domain-controller-in-the-forest-root-domain)  
  
  
## <a name="restore-the-first-writeable-domain-controller-in-each-domain"></a>各ドメインの最初の書き込み可能なドメイン コントローラーを復元します。  
 以降、フォレスト ルート ドメイン内の書き込み可能な DC では、最初の DC を復元するためにこのセクションの手順を完了します。 Schema Admins と Enterprise Admins グループが格納されるため、フォレスト ルート ドメインが重要です。 フォレストの信頼階層の管理にも役立ちます。 さらに、フォレスト ルート ドメインでは、通常、フォレスト DNS 名前空間に対して DNS ルート サーバーを保持します。 その結果、そのドメインの Active Directory 統合 DNS ゾーンには、その他のすべての Dc (これは、レプリケーションに必要な) フォレストおよびグローバル カタログの DNS リソース レコードのエイリアス (CNAME) リソース レコードが含まれています。  
  
 フォレスト ルート ドメインを回復した後は、フォレスト内の残りのドメインを回復すると同じ手順を繰り返します。 1 つ以上のドメインを同時に、回復することができます。ただし、信頼階層または DNS 名前解決で任意の中断を防ぐために、子を回復する前に常に親ドメインを回復します。  
  
 回復するドメインごとに 1 つだけの書き込み可能な DC をバックアップから復元します。 これは、DC がないされて影響を受けるため、フォレストの原因が失敗するデータベースがある必要があるために、回復の最も重要な部分です。 実稼働環境に導入されたが、前に徹底的にテストいる信頼されたバックアップに重要です。  
  
 次の手順を実行します。 特定の手順を実行する手順については[AD フォレストの回復 - 手順](AD-Forest-Recovery-Procedures.md)します。  
  
1.  物理サーバーを復元する場合は、ターゲット DC が接続されていないと、そのため、実稼働ネットワークに接続されていないネットワーク ケーブルを確認します。 仮想マシンのネットワーク アダプターを削除したり、実稼働ネットワークから分離する間、回復プロセスをテストする別のネットワークに接続されているネットワーク アダプターを使用できます。  
  
2.  これは、ドメインの最初の書き込み可能な DC であるため、AD DS の権限のない復元および SYSVOL の authoritative restore を実行する必要があります。 復元操作が Active Directory 対応のバックアップを使用して完了する必要あるし、復元の Windows Server バックアップなどのアプリケーション (つまり、復元しないで DC VM スナップショットの復元などのサポートされていない方法で)。  
  
     SYSVOL の権限のある復元が必要、SYSVOL のレプリケーションがレプリケートされるため、障害から回復した後、フォルダーを開始する必要があります。 以降のドメインに追加されているすべての Dc には、権限のあるフォルダーを提供する前に選択されたフォルダーのコピーを使用して、SYSVOL フォルダーが再同期する必要があります。  
  
    > [!CAUTION]
    >  フォレスト ルート ドメインに復元する最初の DC に対してのみ SYSVOL の権限のある (プライマリ) の復元操作を実行します。 SYSVOL データのレプリケーションの競合する潜在顧客、SYSVOL の主な復元操作の他の Dc で実行します。  
  
     AD DS の権限のない復元および SYSVOL の authoritative restore を実行する 2 つのオプションがあります。  
  
    -   サーバーの完全回復を実行し、SYSVOL の権限のある、同期を強制します。 詳細な手順については、次を参照してください。[サーバーの完全回復を実行する](AD-Forest-Recovery-Perform-a-Full-Recovery.md)と[DFSR でレプリケートされた SYSVOL の権限のある、同期実行](AD-Forest-Recovery-Authoritative-Recovery-SYSVOL.md)します。  
  
    -   システム状態の復元後にサーバーの完全回復を実行します。 このオプションは、事前にバックアップの両方の種類を作成することが必要です。サーバーの完全バックアップとシステム状態のバックアップします。 詳細な手順については、次を参照してください。[サーバーの完全回復を実行する](AD-Forest-Recovery-Perform-a-Full-Recovery.md)と[権限のない Active Directory ドメイン サービスの復元を実行する](AD-Forest-Recovery-Nonauthoritative-Restore.md)します。  
  
3.  復元し、書き込み可能な DC を再起動した後、エラーでした DC 上のデータに影響しないことを確認します。 DC のデータが破損している場合は、別のバックアップと手順 2. を繰り返します。  
  
     復元されたドメイン コントローラーは、操作マスターの役割をホストしている場合を使用不可になる書き込み可能なディレクトリ パーティションのレプリケーションを完了するまで AD DS を避けるためには、次のレジストリ エントリを追加する必要があります。  
  
     **HKLM\System\CurrentControlSet\Services\NTDS\Parameters\Repl 初期同期を実行します。**  
  
     データの種類でのエントリを作成**REG_DWORD**の値と**0**します。 このエントリの値をリセットするには、フォレストが完全に復元した後**1**クライアントにサービスの既知のレプリカ パートナー ドメイン コントローラーとしてアドバタイズして提供を開始する前に、と出力方向のレプリケーション、AD DS の受信が再起動し、成功した操作がマスターの役割を保持するドメイン コントローラーが必要です。 初期同期要件、サポート技術情報記事の「」を参照の詳細については[305476](https://support.microsoft.com/kb/305476)します。  
  
     復元し、データを確認した後にのみ、このコンピューターを実稼働ネットワークに参加させる前に、次の手順に進みます。  
  
4.  フォレスト全体の障害がネットワークへの侵入または悪意のある攻撃に関連していると思われる場合は、Enterprise Admins、Domain Admins、Schema Admins、Server Operators、Account Operators グループ、およびなどのメンバーを含む、すべての管理アカウントのアカウントのパスワードをリセットします。 管理者アカウントのパスワードのリセットは、追加のドメイン コントローラーはフォレスト回復の次のフェーズ中にインストールする前に完了する必要があります。  
  
5.  フォレスト ルート ドメインの最初の復元された DC では、すべてのドメイン全体およびフォレスト全体の操作マスターの役割を強制します。 フォレスト全体の操作マスターの役割を強制するのには、Enterprise Admins および Schema Admins の資格情報が必要です。  
  
     各子ドメインのドメイン全体の操作マスターの役割を強制します。 これらの役割を強制する場合、一時的にのみ、復元された DC で操作マスターの役割を保持可能性がありますが、フォレストの回復プロセスでこの時点では DC をに関するホストするが保証されます。 回復後、プロセスの一環として、必要に応じてで、操作マスターの役割を再配布することができます。 詳細については、操作マスターの役割を強制する場合、次を参照してください。[操作マスターの役割の強制移動](AD-forest-recovery-seizing-operations-master-role.md)します。 操作マスターの役割を配置する場所に関する推奨事項は、次を参照してください[操作マスタは何ですか?。](https://technet.microsoft.com/en-us/library/cc779716.aspx).  
  
6.  (この最初の DC を除くドメイン内のすべて書き込み可能な Dc) のバックアップから復元しているフォレスト ルート ドメイン内の他のすべての書き込み可能な Dc のメタデータをクリーンアップしません。 後で、メタデータのクリーンアップが自動的に実行 DC オブジェクトを削除すると、Active Directory ユーザーとコンピューター、または Active Directory サイトとは以降の Windows Server 2008 に含まれているサービスまたは Windows Vista 用の RSAT バージョンを使用する場合。 さらに、サーバー オブジェクトおよび削除された DC のコンピューター オブジェクトも自動的に削除されます。 詳細については、次を参照してください。[書き込み可能ドメイン コントローラーのメタデータのクリーンアップ削除](AD-Forest-Recovery-Cleaning-Metadata.md)します。  
  
     AD DS が別のサイトの DC にインストールされている場合、メタデータのクリーンアップ、NTDS 設定オブジェクトが重複ができないようにします。 可能性のある、このも保存でした知識整合性チェッカー (KCC) 自体 Dc が存在していない可能性があるときに、レプリケーション リンクを作成するプロセス。 さらに、メタデータのクリーンアップの一部として、ドメイン内の他のすべての Dc の DC ロケーター DNS リソース レコードを DNS から削除されます。  
  
     ドメイン内の他のすべての Dc のメタデータが解消されるまでこの DC は、RID マスターの役割は考えないで場合は、回復の前に RID マスターであるかし、そのため、新しい Rid を発行できませんがします。 このエラーを示すイベント ビューアーでシステム ログのイベント ID 16650 を表示可能性がありますが、イベント ID 16648 成功を示す中に少しメタデータをクリーンアップした後に表示されます。  
  
7.  AD DS に格納されている DNS ゾーンを使っている場合は、ローカル DNS サーバー サービスがインストールされ、復元した DC で実行されていることを確認します。 した場合はこのドメイン コントローラー、DNS サーバーのフォレストの障害発生前は、インストールして、DNS サーバーを構成する必要があります。  
  
    > [!NOTE]
    >  復元されたドメイン コントローラーは、Windows Server 2008 を実行する場合は、サポート技術情報の記事では、修正プログラムをインストールする必要があります。[975654](https://support.microsoft.com/kb/975654)または DNS サーバーをインストールするために一時的に分離されたネットワークにサーバーを接続します。 修正プログラムは、その他の任意のバージョンの Windows Server の必要はありません。  
  
     フォレスト ルート ドメインには、独自の IP アドレス (またはループバック アドレス、127.0.0.1 など) の優先 DNS サーバーとして復元されたドメイン コントローラーを構成します。 この設定は、ローカル エリア ネットワーク (LAN) アダプターの TCP/IP のプロパティで構成できます。 これは、フォレスト内の最初の DNS サーバーです。 詳細については、次を参照してください。[DNS を使用して TCP/IP を構成する](https://technet.microsoft.com/library/cc779282\(WS.10\).aspx)します。  
  
     それぞれの子ドメインでは、復元されたドメイン コントローラーをフォレスト ルート ドメインの最初の DNS サーバーの IP アドレスを持つの優先 DNS サーバーとして構成します。 この設定は、LAN アダプターの TCP/IP のプロパティで構成できます。 詳細については、次を参照してください。[DNS を使用して TCP/IP を構成する](https://technet.microsoft.com/library/cc779282\(WS.10\).aspx)します。  
  
     _Msdcs とドメインの DNS ゾーンでは、メタデータのクリーンアップ後に存在しなくなった Dc の NS レコードを削除します。 クリーンアップを Dc の SRV レコードが削除されたかどうかを確認します。 DNS SRV レコードの削除を高速化するには、次のコマンドを実行します。  
  
    ```  
    nltest.exe /dsderegdns:server.domain.tld  
    ```  
  
8.  100,000 で利用可能な RID プールの値を生成します。 詳細については、次を参照してください。[利用可能な RID プールの値を発生させる](AD-Forest-Recovery-Raise-RID-Pool.md)します。 RID プールを 100,000 によって発生することがないことを特定の状況に十分なと思う理由を使っている場合でも安全に使用できる最小の増加を決定する必要があります。 Rid は使用しないでを不必要にいる限られたリソースです。  
  
     新しいセキュリティ プリンシパルは、復元操作に使用するバックアップの時刻の後、ドメインで作成された、これらのセキュリティ プリンシパルは、特定のオブジェクトに対するアクセス権があります。 これらのセキュリティ プリンシパル存在しないの回復後に、回復が、バックアップを元に戻すためただし、そのアクセス権があります。 利用可能な RID プールが復元した後は発生しない、新しいユーザーはオブジェクトをフォレスト回復と同じセキュリティ ID (Sid) を取得した後は、作成されるは、当初想定していませんが、これらのオブジェクトにアクセスします。  
  
     理解するには、概要で説明した Amy という名前の新しい従業員の例を検討してください。 ドメインの復元に使用したバックアップ後に作成されたために、復元操作後に Amy のユーザー オブジェクトが存在しません。 ただし、その user オブジェクトに割り当てられたすべてのアクセス権は、復元操作後に保持可能性があります。 復元操作後に、新しいオブジェクトをそのユーザー オブジェクトの SID を再割り当てする場合、新しいオブジェクトは、これらのアクセス権を入手します。  
  
9. 現在の RID プールが無効にします。 システム状態の復元後に、現在の RID プールが無効にします。 システム状態の復元が実行されていない場合、現在の RID プールは復元されたドメイン コントローラーのバックアップの作成時に割り当てられた、RID プールから再 Rid 発行することを防止を無効にする必要があります。 詳細については、次を参照してください。[現在の RID プールを無効にする](AD-Forest-Recovery-Invaildate-RID-Pool.md)します。  
  
    > [!NOTE]
    >  RID プールを無効にした後、SID を持つオブジェクトを作成しようとする最初の時間、エラーが表示されます。 オブジェクトを作成しようとすると、新しい RID プールの要求がトリガーされます。 新しい RID プールが割り当てられるために、操作の再試行が成功します。  
  
10. 2 回この DC のコンピューター アカウントのパスワードをリセットします。 詳細については、次を参照してください。[ドメイン コントローラーのコンピューター アカウントのパスワードをリセットする](AD-Forest-Recovery-Reset-Computer-Account-DC.md)します。  
  
11. Krbtgt パスワードのリセット 2 回クリックします。 詳細については、次を参照してください。[krbtgt パスワードのリセット](AD-Forest-Recovery-Resetting-the-krbtgt-password.md)します。  
  
     Krbtgt パスワードの履歴は、2 つのパスワードであるために、パスワードの履歴から元の (初期不良な) パスワードを削除するには、2 回パスワードをリセットします。  
  
    > [!NOTE]
    >  フォレストの回復がセキュリティ侵害への応答である場合は、信頼のパスワードをリセットすることもできます。 詳細については、次を参照してください。[信頼関係の 1 つの側での信頼のパスワードをリセットする](AD-Forest-Recovery-Reset-Trust.md)します。  
  
12. フォレストに複数のドメインがあり、ユーザーが復元されたドメイン コントローラーが、障害発生前に、グローバル カタログ サーバーは場合、は、オフ、**グローバル カタログ**DC からグローバル カタログを削除する NTDS 設定プロパティのチェック ボックスをオンします。 この規則の例外は、1 つだけのドメインとフォレストの一般的なケースです。 この場合、グローバル カタログを削除する必要はありません。 詳細については、次を参照してください。[グローバル カタログを削除する](AD-Forest-Recovery-Remove-GC.md)します。  
  
     グローバル カタログの詳細は、バックアップから復元することによって他のドメイン内の Dc の復元に使用される他のバックアップよりも新しい可能性がありますを導入する残留オブジェクト。 次の例を検討してください。 ドメイン A、DC1 は、time T1 で行われたバックアップから復元されます。 ドメイン B、DC2 が time T2 で行われた、グローバル カタログのバックアップから復元されます。 T2 は T1 より新しい T1 と T2 の間に作成された一部のオブジェクトを考えてみます。 これらの Dc が復元されると、DC2 で、グローバル カタログには、それ以降のデータが保持ドメイン A の部分的なレプリカ ドメイン A の保留よりも自体です。 DC2 では、それらのオブジェクトが DC1 上に存在しないために、ここでは、残留オブジェクトが保持されます。  
  
     残留オブジェクトの存在が問題につながる可能性ことができます。 たとえば、ドメイン間で移動してユーザー オブジェクトがユーザーに電子メール メッセージを配信する可能性がありますされません。 した後、古い DC またはグローバル カタログ サーバーをオンラインに戻す、グローバル カタログにユーザー オブジェクトの両方のインスタンスが表示されます。 両方のオブジェクトがある同じ電子メール アドレスです。そのため、電子メール メッセージを配信できません。  
  
     2 番目の問題は、存在しなくなったユーザー アカウントが、グローバル アドレス一覧に表示可能性がありますもことです。 3 番目の問題は、存在しなくなったユニバーサル グループが、ユーザーのアクセス トークンに表示可能性がありますもことです。  
  
     かどうかは、グローバル カタログ DC を復元しました — か、誤って信頼している単独のバックアップがあるため、または — 復元操作が完了した後すぐには、グローバル カタログを無効にして残留オブジェクトの発生を禁止することをお勧めします。 グローバル カタログのフラグを無効にすると、すべての部分的なレプリカ (パーティション) が失われると、DC ステータスを定期的に relegating 自体のコンピューターが発生します。  
  
13. Windows タイム サービスを構成します。 フォレストのルート ドメインでは、外部のタイム ソースから時刻を同期する、PDC エミュレーターを構成します。 詳細については、次を参照してください。[フォレスト ルート ドメインの PDC エミュレーターで Windows タイム サービスを構成する](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29)します。  
  
 

## <a name="reconnect-each-restored-writeable-domain-controller-to-a-common-network"></a>一般的なネットワークに各復元された書き込み可能なドメイン コントローラーを再接続します。  
 この段階でフォレスト ルート ドメインと残りのドメインのそれぞれで、復元された 1 つの DC (と回復の手順を実行) が必要です。 これらの Dc には、環境の残りの部分から分離する一般的なネットワークに参加し、フォレストの正常性とレプリケーションを検証するために、次の手順を完了します。  
  
> [!NOTE]
>  物理 Dc を分離されたネットワークに参加する場合は、その IP アドレスを変更する必要があります。 その結果、DNS レコードの IP アドレスが正しくないされます。 グローバル カタログ サーバーが使用できないために、DNS のセキュアな動的更新は失敗します。 仮想 Dc はよりも利点ここでは、IP アドレスを変更することがなく、新しい仮想ネットワークに参加できます。 これは、フォレストの回復時に復元する仮想 Dc が最初のドメイン コントローラーとして推奨理由理由の 1 つです。  
  
 検証と、Dc を実稼働ネットワークに参加し、フォレストのレプリケーションの正常性を確認する手順を完了します。  
  
-   名前解決を修正するのには、DNS 委任レコードを作成し、DNS 転送やルート ヒント必要に応じてを構成します。 実行**repadmin/replsum** Dc 間でレプリケーションを確認します。  
  
-   復元された DC は直接のレプリケーション パートナーではない場合、レプリケーションの回復されますはるかに高速でそれらの間で一時的な接続オブジェクトを作成します。  
  
-   メタデータのクリーンアップを検証するには、実行**Repadmin /viewlist \ ***フォレスト内のすべての Dc の一覧についてはします。 実行**Nltest /DCList:***< domain > \*ドメイン内のすべての Dc の一覧についてはします。  
  
-   DC および DNS のヘルスを確認するには、フォレスト内のすべての Dc でエラーを報告する DCDiag/v を実行します。  
  
  

## <a name="add-the-global-catalog-to-a-domain-controller-in-the-forest-root-domain"></a>フォレスト ルート ドメインのドメイン コントローラーをグローバル カタログを追加します。  
 グローバル カタログは、これらの設定およびその他の理由に必要です。  
  
-   ユーザーのログオンを有効にします。  
  
-   登録して、ルート ドメインの DNS サーバー上のレコードを削除するそれぞれの子ドメイン内の Dc で実行されている、Net Logon サービスを有効にします。  
  
 お勧めですが、フォレスト ルート DC 良好でなくなっているグローバル カタログをすることはグローバル カタログに復元されたドメイン コントローラーのいずれかを選択します。  
  
> [!NOTE]
>  フォレスト内のすべてのディレクトリ パーティションの完全な同期を完了するまで、DC はグローバル カタログ サーバーとしてアドバタイズされません。 そのため、各フォレストで復元されたドメイン コントローラーにレプリケートする DC を強制する必要があります。  
>   
>  ディレクトリ サービス イベント ログを監視イベント ビューアーでイベント ID 1119、このドメイン コントローラーがグローバル カタログ サーバーであることを示す、または次のレジストリ キーが 1 の値を確認します。  
>   
>  **HKLM\System\CurrentControlSet\Services\NTDS\Parameters\Global カタログのプロモーションの完了**  
  
 詳細については、次を参照してください。[グローバル カタログを追加する](AD-Forest-Recovery-Add-GC.md)します。  
  
 この段階では、フォレスト内の安定したフォレスト、ドメインごとに 1 つの DC と、1 つのグローバル カタログが必要です。 復元した Dc のそれぞれの新しいバックアップを作成する必要があります。 AD DS をインストールすることによって、フォレスト内の他の Dc を再展開を開始できます。  

## <a name="next-steps"></a>次の手順
-   [AD フォレストの回復の前提条件](AD-Forest-Recovery-Prerequisties.md)  
-   [AD フォレストの回復 - カスタム フォレスト回復計画を立てる](AD-Forest-Recovery-Devising-a-Plan.md)  
- [AD フォレストの回復 - 問題の特定](AD-Forest-Recovery-Identify-the-Problem.md)
-   [AD フォレストの回復 - を回復する方法を決定します。](AD-Forest-Recovery-Determine-how-to-Recover.md)
-   [AD フォレストの回復 - 最初の回復を実行](AD-Forest-Recovery-Perform-initial-recovery.md)  
-   [AD フォレストの回復の手順](AD-Forest-Recovery-Procedures.md)  
-   [AD フォレストの回復のよく寄せられる質問](AD-Forest-Recovery-FAQ.md)  
-   [AD フォレストの回復であれば、マルチ ドメイン フォレスト内で 1 つのドメインの回復](AD-Forest-Recovery-Single-Domain-in-Multidomain-Recovery.md)  
-   [AD フォレストの回復 - Windows Server 2003 ドメイン コントローラーとフォレストの回復](AD-Forest-Recovery-Windows-Server-2003.md)  
  
