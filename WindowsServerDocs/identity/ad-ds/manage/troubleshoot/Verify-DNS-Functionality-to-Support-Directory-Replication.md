---
ms.assetid: 709353b0-b913-4367-8580-44745183e2bc
title: "ディレクトリ レプリケーションをサポートする DNS 機能を確認します。"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.service: 
ms.suite: na
ms.technology: identity-adds
ms.author: billmath
ms.date: 05/31/2017
ms.tgt_pltfrm: na
author: Femila
ms.openlocfilehash: 49f2795e1042438a50850fcb7fd8224eff2cca37
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
# <a name="verify-dns-functionality-to-support-directory-replication"></a>ディレクトリ レプリケーションをサポートする DNS 機能を確認します。

>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

 Active Directory のレプリケーションに干渉がドメイン ネーム システム (DNS) 設定を確認するには、確実に DNS が正しく動作しているドメインの基本的なテストを実行して開始できます。 基本のテストを実行した後は、リソース レコードの登録と動的更新など、DNS の機能の他の面をテストできます。

任意のドメイン コント ローラーの DNS の基本的な機能には、このテストを実行できますが、通常テストを実行するこの可能性がありますが発生しているレプリケーションの問題、ドメイン コント ローラーなど、そのレポート イベント Id 1844、1925、2087、2088、イベント ビューアーのディレクトリ サービス DNS ログにすると思われるドメイン コント ローラーにします。



## <a name="running-the-domain-controller-basic-dns-testtitle"></a>ドメイン コント ローラーの基本的な DNS のテストを実行しています。</title>

DNS の基本的なテストでは、DNS の機能の以下の点をチェックします。


- **接続:**テストしてコント ローラーが DNS に登録されているドメインが接続可能かどうかを決定する、 <system>ping</system>コマンドを使用して、ライトウェイト ディレクトリ アクセス プロトコル]、[リモート プロシージャ コール (LDAP/RPC) 接続します。 ドメイン コント ローラーに接続テストに失敗した場合、そのドメイン コント ローラーに対して他のテストは実行されません。 その他の DNS のテストの実行前に、接続のテストが自動的に実行します。
- **重要なサービス:**テストでは、次のサービスが実行し、テスト済みのドメイン コント ローラーで使用可能であることを確認します。 DNS クライアント サービス、Net Logon サービス、キー配布センター (KDC) サービス、および DNS サーバー サービス (DNS がドメイン コント ローラーにインストールされている) 場合。
- **DNS クライアントの構成:** 、テスト、DNS クライアント コンピューターのすべてのネットワーク アダプター上の DNS サーバーが到達可能であることを確認します。
- **リソース レコードの登録:**テスト クライアント コンピュータで構成されている DNS サーバーの 1 つ以上の各ドメイン コント ローラーのホスト (A) リソース レコードが登録されていることを確認します。
- **ゾーンと (authority) の開始:**テスト場合は、ドメイン コント ローラーには、DNS サーバー サービスが実行されているが、ドメイン ゾーンの Active Directory と Active Directory ドメインのゾーンの (authority) リソース レコードの開始が存在することを確認します。
- **ルート ゾーン:**ルート (.) ゾーンが存在するかどうかを確認します。

Enterprise admins グループ、またはそれと同等のメンバーシップは、これらの手順を完了するために必要な最低限です。

DNS の基本的な機能を確認するのには、次の手順を使用できます。
     
### <a name="to-verify-basic-dns-functionality"></a>DNS の基本的な機能を確認します。


1. テストする場合、ドメイン コント ローラーまたは Active Directory ドメイン サービス (AD DS) のツールがインストールされているドメイン メンバー コンピューターでは、管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くにはクリックして**開始**します。 
2. [検索の開始には、コマンド プロンプトを入力します。 
3. [スタート] メニューの上部には、コマンド プロンプトでを右クリックし、[管理者として実行] をクリックします。 場合は、ユーザー アカウント制御] ダイアログ ボックスが表示されたら、操作が表示にする必要があることを確認し、[続行します。
4. コマンド プロンプトで、次のコマンドを入力し、Enter キーを押します。 `dcdiag /test:dns /v /s: &lt;DCName&gt; /DnsBasic f:/dcdiagreport.txt`
</br></br>実際の識別名、NetBIOS 名、またはドメイン コント ローラーの DNS 名に置き換えてください&lt;DCName&gt;します。 代わりに、/s: ではなく/e:」と入力して、フォレストのすべてのドメイン コント ローラーをテストできます。 /F スイッチでは、前のコマンドでは dcdiagreport.txt するファイル名を指定します。 現在の作業ディレクトリ以外の場所にファイルを配置する場合は、/f:c:reportsdcdiagreport.txt などのファイルのパスを指定できます。

5. メモ帳または同様のテキスト エディターで dcdiagreport.txt ファイルを開きます。 コマンド プロンプトで、メモ帳で、ファイルを開くには、メモ帳 dcdiagreport.txt を入力し、ENTER キーを押します。 さまざまな作業ディレクトリにファイルを配置する場合は、ファイルへのパスを含めます。 たとえば、c:reports にファイルを配置する場合、メモ帳 c:reportsdcdiagreport.txt のように入力し、し、ENTER キーを押します。
6. ファイルの下部にある概要テーブルにスクロールします。 
</br></br>概要テーブルで「警告」または「失敗」の状態を報告するすべてのドメイン コントローラの名前に注意してください。  DCName がドメイン コント ローラーの実際の名前をここでは、文字列"DC:: DCName,"を検索し、詳細な上回った」セクションを知ることによって問題のドメイン コント ローラーがあるかどうかを判断しようとしてください。

明確な構成の変更に必要な場合は、ように、適切なとして。 たとえば、ドメイン コント ローラーのいずれかが明らかに正しくない IP アドレスであることを確認する場合は、それを解決できます。 次に、テストを再実行します。

構成の変更を検証するには、必要に応じて、/e: または/s: スイッチ Dcdiag/test:DNS/v コマンドを再実行します。 IP version 6 (IPv6) のドメイン コント ローラーで有効になっていない場合、ホスト (AAAA) の検証プロセスが失敗し、テストを想定する必要がありますが、これらのレコードが不要な場合は、ネットワークで IPv6 を使用していません。
            
## <a name="verifying-resource-record-registration"></a>リソース レコードの登録を確認します。
    
移行先のドメイン コント ローラーでは、DNS エイリアス (CNAME) リソース レコードを使用して、ソース ドメイン コント ローラーのレプリケーション パートナーを見つけます。 (Windows Server 2003 Service Pack 1 (SP1) 以降) Windows Server を実行するドメイン コント ローラーは、完全修飾ドメイン名 (Fqdn) を使用してソース レプリケーション パートナーを見つけることができますが、または失敗した場合、エイリアス (CNAME) リソース レコードの NetBIOS 名のプレゼンスが予想され、適切な DNS の機能を確認する必要があります。 
      
次の手順を使用すると、リソース レコードの登録、エイリアス (CNAME) リソース レコードの登録を含むことを確認します。
      
### <a name="to-verify-resource-record-registrationtitle"></a>リソース レコードの登録を確認するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、[開始] をクリックします。 [検索の開始には、コマンド プロンプトを入力します。 
2. [スタート] メニューの上部には、コマンド プロンプトでを右クリックし、[管理者として実行] をクリックします。 場合は、ユーザー アカウント制御] ダイアログ ボックスが表示されたら、操作が表示にする必要があることを確認し、[続行します。  </br></br>Dcdiag ツールを使用するを実行してドメイン コント ローラーの場所に必要なすべてのリソース レコードの登録を確認、`dcdiag /test:dns /DnsRecordRegistration`コマンド。

このコマンドには、次のリソース レコードの DNS 登録を確認します。


- **エイリアス (CNAME):**グローバル一意識別子 (GUID)-ベースのレプリケーション パートナーを検索するリソース レコード
- **ホスト (A):**ドメイン コント ローラーの IP アドレスを含むホスト リソース レコード
- **LDAP SRV:** LDAP サーバーを検索するサービス (SRV) リソース レコード
- **GC SRV**: カタログ サーバーのグローバル検索サービス (SRV) リソース レコード
- **PDC SRV**: プライマリ ドメイン コント ローラー (PDC) エミュレータ操作マスタを特定するサービス (SRV) リソース レコード

次の手順を使用すると、エイリアス (CNAME) リソース レコードの登録だけでことを確認します。

### <a name="to-verify-alias-cname-resource-record-registration"></a>エイリアス (CNAME) リソース レコードの登録を確認するには

1. DNS スナップインを開きます。 DNS を開くには、[開始] をクリックします。 [検索の開始 dnsmgmt.msc を入力し、ENTER キーを押します。 ユーザー アカウント制御] ダイアログ ボックスが表示されたら場合、は、し、[続行] をクリックして操作を表示することを確認します。
2. DNS スナップインを使用して、サーバーがドメイン コント ローラーの Active Directory ドメインと同じ名前を持つ DNS ゾーンをホスト、DNS サーバー サービスを実行している任意のドメイン コント ローラーを探します。
3. コンソール ツリーで、という _msdcs ゾーンをクリックします。Dns_Domain_Name します。
4. 詳細ウィンドウで、次のリソース レコードが存在することを確認します: Dsa_Guid._msdcs というエイリアス (CNAME) リソース レコードです。<placeholder>Dns_Domain_Name</placeholder>し、対応する DNS サーバーの名前 (A) リソース レコードをホストします。

エイリアス (CNAME) リソース レコードが登録されていない場合は、動的な更新プログラムが正しく機能していることを確認します。 次のセクションで、テストを使用すると、動的更新を確認します。
    
## <a name="verifying-dynamic-update"></a>動的更新を確認します。
    
基本的な DNS のテストでは、リソース レコードが DNS に存在しないことを示している場合は、動的更新のテストを使用して、理由、Net Logon サービスが登録されていないリソース レコードに自動的に決定します。 Active Directory ドメインのゾーンが構成されている保護された動的更新をそのまま使用し、テスト レコード (_dcdiag_test_record) の登録を実行することを確認するには、次の手順を使用します。 テスト レコードは、テストした後に自動的に削除します。

### <a name="to-verify-dynamic-updatetitle"></a>動的更新を確認するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、[開始] をクリックします。 [検索の開始には、コマンド プロンプトを入力します。 [スタート] メニューの上部には、コマンド プロンプトでを右クリックし、[管理者として実行] をクリックします。 場合は、ユーザー アカウント制御] ダイアログ ボックスが表示されたら、操作が表示にする必要があることを確認し、[続行します。
2. コマンド プロンプトで、次のコマンドを入力し、Enter キーを押します。 

    dcdiag/test:dns/v/s:&lt;DCName&gt; /DnsDynamicUpdate
</br></br>識別名、NetBIOS 名、またはドメイン コント ローラーの DNS 名に置き換えてください&lt;DCName&gt;します。 代わりに、/s: ではなく/e:」と入力して、フォレストのすべてのドメイン コント ローラーをテストできます。 ドメイン コント ローラーで有効になっている IPv6 を持っていない場合、ホスト (AAAA) リソース レコードの部分、テストが失敗し、IPv6 が有効でないときに通常の状況であるが予想されます。

保護された動的更新が構成されていない場合、次の手順を使用してこれらを構成することができます。

### <a name="to-enable-secure-dynamic-updates"></a>保護された動的更新を有効にするには


1. DNS スナップインを開きます。 DNS を開くには、[開始] をクリックします。 
2. [検索の開始 dnsmgmt.msc を入力し、ENTER キーを押します。 ユーザー アカウント制御] ダイアログ ボックスが表示されたら場合、は、[続行] をクリックして、操作が表示されることを確認します。
3. コンソール ツリーで、該当するゾーンを右クリックし、[プロパティ] をクリックします。
4. [全般] タブで、ゾーンの種類では、Active Directory 統合があることを確認します。
5. [動的更新で、[セキュリティで保護されたのみ] をクリックします。

## <a name="registering-dns-resource-records"></a>DNS リソース レコードを登録します。
    
ソース ドメイン コント ローラーの DNS に DNS リソース レコードは表示されません、動的更新を確認したら、DNS リソース レコードをすぐに登録して、次の手順を使用して手動で登録を強制できます。 ドメイン コント ローラーで Net Logon サービスは、ネットワーク上にあるドメイン コント ローラーに必要な DNS リソース レコードを登録します。 DNS クライアント サービスは、エイリアス (CNAME) レコードを指しているホスト (A) リソース レコードを登録します。

### <a name="to-register-dns-resource-records-manuallytitle"></a>DNS リソース レコードを手動で登録するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、[開始] をクリックします。 
2. [検索の開始には、コマンド プロンプトを入力します。 
3. スタート画面の上部には、コマンド プロンプトを右クリックし、[管理者として実行] をクリックします。 場合は、ユーザー アカウント制御] ダイアログ ボックスが表示されたら、操作が表示にする必要があることを確認し、[続行します。
4. ドメイン コント ローラー ロケーター リソースの登録を開始するには、は、コマンド プロンプトで、ソース ドメイン コント ローラー上で手動でレコードは、次のコマンドを入力し、し、ENTER キーを押します。 `net stop net logon &amp; net start net logon`
5. ホストの登録を開始するには、(A) リソース レコード、手動でコマンド プロンプトで、次のコマンドを入力し、し、ENTER キーを押します。 `ipconfig /flushdns &amp; ipconfig /registerdns`
6. コマンド プロンプトで、次のコマンドを入力し、ENTER キーを押します dcdiag/test:dns/v/s:&lt;DCName。&gt; </br>,</br>識別名、NetBIOS 名、またはドメイン コント ローラーの DNS 名に置き換えてください&lt;DCName&gt;します。 DNS のテストが成功したことを確認するテストの出力を確認します。 ドメイン コント ローラーで有効になっている IPv6 を持っていない場合、ホスト (AAAA) リソース レコードの部分、テストが失敗し、IPv6 が有効でないときに通常の状況であるが予想されます。
