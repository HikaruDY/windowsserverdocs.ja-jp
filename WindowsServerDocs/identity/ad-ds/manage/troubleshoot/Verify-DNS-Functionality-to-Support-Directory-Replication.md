---
ms.assetid: 709353b0-b913-4367-8580-44745183e2bc
title: ディレクトリ レプリケーションをサポートする DNS 機能を確認する
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.service: ''
ms.suite: na
ms.technology: identity-adds
ms.author: joflore
ms.date: 05/31/2017
ms.tgt_pltfrm: na
author: Femila
ms.openlocfilehash: a55b95ee516abda8bdbae6e9829a161ef060012e
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59871873"
---
# <a name="verify-dns-functionality-to-support-directory-replication"></a>ディレクトリ レプリケーションをサポートする DNS 機能を確認する

>適用先:Windows Server 2016 では、Windows Server 2012 R2、Windows Server 2012

 Active Directory のレプリケーションに干渉する可能性がドメイン ネーム システム (DNS) 設定を確認するには、確実に DNS が正しく動作しているドメインの基本的なテストを実行して開始できます。 基本的なテストを実行した後は、リソース レコードの登録、動的更新など、DNS の機能の他の側面をテストできます。

このテストを実行できますが、通常と思われるドメイン コント ローラーでこのテストを実行するドメイン コント ローラーの基本的な DNS 機能発生可能性のあるレポートのイベント Id 1844、1925、2087、ドメイン コント ローラーなど、レプリケーションに関する問題またはイベント ビューアーのディレクトリ サービスの DNS ログ 2088 します。



## <a name="running-the-domain-controller-basic-dns-testtitle"></a>ドメイン コント ローラーの基本的な DNS のテストを実行しています。</title>

基本的な DNS のテストは、DNS の機能の次の側面を確認します。


- **接続:** テスト コント ローラーが DNS では、登録されているドメインをによって接続できるかどうかを判断します、 <system>ping</system>コマンドを使用して、ライトウェイト ディレクトリ アクセス プロトコル/リモート プロシージャ コール (LDAP/RPC) 接続します。 ドメイン コント ローラーの接続テストに失敗した場合、そのドメイン コント ローラーに対するその他のテストは実行されません。 その他の DNS のテストの実行前に、接続のテストが自動的に実行されます。
- **重要なサービス:** テストは、次のサービスが実行され、テスト対象のドメイン コント ローラーで使用できることを確認します。DNS クライアント サービス、Net Logon サービス、キー配布センター (KDC) サービス、および DNS サーバー サービス (DNS がドメイン コント ローラーにインストールされている) 場合。
- **DNS クライアントの構成:** テストは、DNS クライアント コンピューターのすべてのネットワーク アダプター上の DNS サーバーが到達できることを確認します。
- **リソース レコードの登録:** テストは、各ドメイン コント ローラーのホスト (A) リソース レコードが 1 つ以上のクライアント コンピューターで構成されている DNS サーバーに登録されていることを確認します。
- **ゾーンと authority (SOA) の開始:** ドメイン コント ローラーが DNS サーバー サービスを実行中の場合、Active Directory ドメインのゾーンと Active Directory ドメインのゾーンの authority (SOA) リソース レコードの開始が存在するテストを確認します。
- **ルート ゾーン:** ルート (.)、ゾーンが存在するかどうかを確認します。

Enterprise Admins、またはそれと同等のメンバーシップは、これらの手順を完了するために必要な最小値です。

次の手順を使用すると、DNS の基本的な機能を確認します。
     
### <a name="to-verify-basic-dns-functionality"></a>DNS の基本的な機能を確認するには。


1. テストする、ドメイン コント ローラーまたは Active Directory Domain Services (AD DS) のツールがインストールされているドメイン メンバー コンピューターでは、管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、**[スタート]** ボタンをクリックします。 
2. 検索の開始には、コマンド プロンプトを入力します。 
3. スタート メニューの上部にあるコマンド プロンプトを右クリックし、管理者として実行 をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。
4. コマンド プロンプトで次のコマンドを入力し、ENTER キーを押します。 `dcdiag /test:dns /v /s:<DCName> /DnsBasic /f:dcdiagreport.txt`
</br></br>実際の識別名、NetBIOS 名、またはドメイン コント ローラーの DNS 名に置き換えてください&lt;DCName&gt;します。 代わりに、/s: ではなく/e:」と入力して、フォレストのすべてのドメイン コント ローラーをテストできます。 /F スイッチでは、ファイル名を前のコマンドは dcdiagreport.txt を指定します。 現在の作業ディレクトリ以外の場所にファイルを配置する場合は、/f:c:reportsdcdiagreport.txt などのファイル パスを指定できます。

5. Dcdiagreport.txt ファイルをメモ帳または同様のテキスト エディターで開きます。 コマンド プロンプトで、メモ帳で、ファイルを開くには、メモ帳の dcdiagreport.txt を入力し、し、ENTER キーを押します。 別の作業ディレクトリにファイルを配置した場合に、ファイルへのパスが含まれます。 たとえば、c:reports でファイルを配置した場合はメモ帳の c:reportsdcdiagreport.txt を入力し、し、ENTER キーを押します。
6. ファイルの下部にある概要テーブルにスクロールします。 
</br></br>概要テーブルで、「警告」または「失敗」の状態を報告するすべてのドメイン コント ローラーの名前に注意してください。  文字列を検索して、詳細なブレーク アウト セクションを検索して問題のドメイン コント ローラーがあるかどうかを判断しようとしています"DC:。DCName,"DCName はドメイン コント ローラーの実際の名前。

必要な明確な構成の変更を表示する場合は、適切なとして、それらを作成します。 など、ドメイン コント ローラーのいずれかが明らかに不適切な IP アドレスであることを確認する場合は、これを修正できます。 次に、テストを再実行します。

構成の変更を検証するには、/e: または/s: スイッチの適切な Dcdiag/test:DNS/v コマンドを再実行します。 IP version 6 (IPv6) のドメイン コント ローラーで有効になっていない場合、テストが失敗するのホスト (AAAA) 検証の部分と予想されますが、これらのレコードが必要ない場合は、ネットワークで IPv6 を使用していません。
            
## <a name="verifying-resource-record-registration"></a>リソース レコードの登録の確認
    
宛先ドメイン コントローラでは、DNS エイリアス (CNAME) リソース レコードを使用して、ソース ドメイン コント ローラーのレプリケーション パートナーを見つけます。 失敗した場合、エイリアス (CNAME) の NetBIOS 名の存在または完全修飾ドメイン名 (Fqdn) を使用して、ソース レプリケーション パートナーを見つけることができます (Windows Server 2003 Service Pack 1 (SP1) 以降)、Windows Server を実行するドメイン コント ローラーがリソース レコードが推測され、適切な DNS が機能しているを確認する必要があります。 
      
次の手順を使用すると、エイリアス (CNAME) リソース レコードの登録を含め、リソース レコードの登録を確認します。
      
### <a name="to-verify-resource-record-registrationtitle"></a>リソース レコードの登録を確認するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、開始をクリックします。 検索の開始には、コマンド プロンプトを入力します。 
2. スタート メニューの上部にあるコマンド プロンプトを右クリックし、管理者として実行 をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。  </br></br>Dcdiag ツールを使用して、実行してドメイン コント ローラーの場所に必要なすべてのリソース レコードの登録を確認することができます、`dcdiag /test:dns /DnsRecordRegistration`コマンド。

このコマンドは、DNS で次のリソース レコードの登録を確認します。


- **エイリアス (CNAME):** グローバル一意識別子 (GUID)-ベースのレプリケーション パートナーを検索するリソース レコード
- **ホスト (A):** ドメイン コント ローラーの IP アドレスを含むホスト リソース レコード
- **LDAP SRV:** LDAP サーバーを検索するサービス (SRV) リソース レコード
- **GC の SRV**: サービス (SRV) リソース レコードを検索、グローバル カタログ サーバー
- **PDC SRV**: プライマリ ドメイン コント ローラー (PDC) エミュレーター操作マスターを検索するサービス (SRV) リソース レコード

次の手順を使用すると、エイリアス (CNAME) リソース レコードの登録だけを確認します。

### <a name="to-verify-alias-cname-resource-record-registration"></a>エイリアス (CNAME) リソース レコードの登録を確認するには

1. DNS スナップインを開きます。 DNS を開くには、開始をクリックします。 検索の開始 dnsmgmt.msc、入力し、し、ENTER キーを押します。 場合は、ユーザー アカウント制御 ダイアログ ボックスが表示されたら、し、続行 をクリックし、アクションが表示されることを確認します。
2. DNS スナップインを使用して、サーバーがドメイン コント ローラーの Active Directory ドメインと同じ名前で DNS ゾーンをホスト、DNS サーバー サービスを実行している任意のドメイン コント ローラーを探します。
3. コンソール ツリーで、_msdcs というゾーンをクリックします。Dns_Domain_Name します。
4. 詳細ペインで、次のリソース レコードが存在することを確認します: Dsa_Guid._msdcs というエイリアス (CNAME) リソース レコード。<placeholder>Dns_Domain_Name</placeholder>と、対応する DNS サーバーの名前 (A) リソース レコードをホストします。

エイリアス (CNAME) リソース レコードが登録されていない場合は、その動的な更新プログラムが正常に機能を確認します。 次のセクションでは、テストを使用して、動的更新を確認します。
    
## <a name="verifying-dynamic-update"></a>動的更新を確認しています
    
基本的な DNS のテストでは、リソース レコードが DNS に存在しないことを示している場合は、動的更新のテストを使用して、理由、Net Logon サービス登録しませんでしたリソース レコードは、自動的に決定します。 安全な動的更新を受け入れテスト レコード (_dcdiag_test_record) の登録を実行する Active Directory ドメインのゾーンが構成されていることを確認するには、次の手順を使用します。 テスト レコードは、テスト後に自動的に削除されます。

### <a name="to-verify-dynamic-updatetitle"></a>動的更新を確認するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、開始をクリックします。 検索の開始には、コマンド プロンプトを入力します。 スタート メニューの上部にあるコマンド プロンプトを右クリックし、管理者として実行 をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。
2. コマンド プロンプトで次のコマンドを入力し、ENTER キーを押します。 `dcdiag /test:dns /v /s:<DCName> /DnsDynamicUpdate`
   </br></br>識別名、NetBIOS 名、またはドメイン コント ローラーの DNS 名に置き換えてください&lt;DCName&gt;します。 代わりに、/s: ではなく/e:」と入力して、フォレストのすべてのドメイン コント ローラーをテストできます。 IPv6 のドメイン コント ローラーで有効になっていない場合は、ホスト (AAAA) リソース レコードの部分、テストが失敗すると、IPv6 が有効になっていないときに通常の状態であると予想されます。

安全な動的更新が構成されていない場合は、次の手順を使用して構成します。

### <a name="to-enable-secure-dynamic-updates"></a>安全な動的更新を有効にするには


1. DNS スナップインを開きます。 DNS を開くには、開始をクリックします。 
2. 検索の開始 dnsmgmt.msc、入力し、し、ENTER キーを押します。 場合は、ユーザー アカウント制御 ダイアログ ボックスが表示されたら、し、続行 をクリックしてアクションが表示されることを確認します。
3. コンソール ツリーで、該当のゾーンを右クリックし、[プロパティ] をクリックします。
4. [全般] タブで、ゾーンの種類は、Active Directory 統合を確認します。
5. 動的更新でのみセキュリティで保護されたをクリックします。

## <a name="registering-dns-resource-records"></a>DNS リソース レコードを登録します。
    
ソース ドメイン コント ローラーを DNS に DNS リソース レコードは表示されません、動的更新を確認、DNS リソース レコードをすぐに登録して、次の手順を使用して手動で登録を強制することができます。 ドメイン コント ローラーで、Net Logon サービスは、ネットワーク上にあるドメイン コント ローラーに必要な DNS リソース レコードを登録します。 DNS クライアント サービスは、エイリアス (CNAME) レコードが指すホスト (A) リソース レコードを登録します。

### <a name="to-register-dns-resource-records-manuallytitle"></a>DNS リソース レコードを手動で登録するには</title>


1. 管理者としてコマンド プロンプトを開きます。 管理者としてコマンド プロンプトを開くには、開始をクリックします。 
2. 検索の開始には、コマンド プロンプトを入力します。 
3. 開始の上部にあるコマンド プロンプトを右クリックし、[管理者として実行] をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします。
4. ドメイン コント ローラー ロケーターのリソースの登録を開始するには、は、コマンド プロンプトで、ソース ドメイン コント ローラーに手動でレコードは、次のコマンドを入力し、し、ENTER キーを押します。 `net stop netlogon && net start netlogon`
5. ホストの登録を開始するには、(A) リソース レコード、手動でコマンド プロンプトで次のコマンドを入力し、し、ENTER キーを押します。 `ipconfig /flushdns && ipconfig /registerdns`
6. コマンド プロンプトで次のコマンドを入力し、ENTER キーを押します。 `dcdiag /test:dns /v /s:<DCName>` </br></br>識別名、NetBIOS 名、またはドメイン コント ローラーの DNS 名に置き換えてください&lt;DCName&gt;します。 DNS のテストが渡されることを確認するテストの出力を確認します。 IPv6 のドメイン コント ローラーで有効になっていない場合は、ホスト (AAAA) リソース レコードの部分、テストが失敗すると、IPv6 が有効になっていないときに通常の状態であると予想されます。
