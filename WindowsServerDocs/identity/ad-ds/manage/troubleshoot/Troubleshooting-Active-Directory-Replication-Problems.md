---
ms.assetid: b11f7a65-ec7b-4c11-8dc4-d7cabb54cd94
title: Active Directory レプリケーションの問題のトラブルシューティングに関するページ
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: ffc0933f70a2ab518c575a944efdac4c2dcd6a1a
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59869423"
---
# <a name="troubleshooting-active-directory-replication-problems"></a>Active Directory レプリケーションの問題のトラブルシューティングに関するページ

>適用先:Windows Server 2016 では、Windows Server 2012 R2、Windows Server 2012

Active Directory レプリケーションの問題は、さまざまなソースを持つことができます。 たとえば、ドメイン ネーム システム (DNS) の問題、ネットワークの問題、またはセキュリティの問題すべて可能性が Active Directory レプリケーションが失敗します。 

このトピックの残りの部分では、ツールと Active Directory レプリケーション エラーを解決する一般的な方法について説明します。 次のサブトピックでは、現象、原因、および特定のレプリケーション エラーを解決する方法を説明します。

## <a name="introduction-and-resources-for-troubleshooting-active-directory-replication"></a>概要と Active Directory レプリケーションのトラブルシューティングに関するリソース

入力方向または出力方向のレプリケーション エラーがレプリケーション トポロジ、レプリケーション スケジュール、ドメイン コント ローラー、ユーザー、コンピューター、パスワード、セキュリティ グループ、グループ メンバーシップ、および一貫性のあるグループ ポリシーを表す Active Directory オブジェクトドメイン コント ローラーの間 Directory 不整合とレプリケーション エラーは現在動作障害や、操作のために接続するドメイン コント ローラーによって、矛盾した結果のいずれかが発生し、グループ ポリシーの適用を防ぐため、およびコントロールのアクセス許可にアクセスできます。 Active Directory Domain Services (AD DS) は、ネットワーク接続、名前解決、認証と承認、ディレクトリ データベース、レプリケーション トポロジ、およびレプリケーション エンジンに依存します。 レプリケーションの問題の根本原因がすぐに明らかでない場合は、多くの考えられる原因の間で原因を特定する可能性のある原因の体系的な削除が必要です。

レプリケーションの監視や、エラーを診断に役立つ UI ベース ツールでは、次を参照してください[Active Directory レプリケーションの状態のツール。](https://www.microsoft.com/download/details.aspx?id=30005)

Active Directory のトラブルシューティングを行う Repadmin ツールを使用する方法について説明する包括的なドキュメントのレプリケーションは使用できません。参照してください[監視とトラブルシューティング Active Directory レプリケーションを使用して Repadmin](https://go.microsoft.com/fwlink/?LinkId=122830)します。

Active Directory レプリケーションのしくみについては、次のテクニカル リファレンスを参照してください。

- [Active Directory レプリケーション モデルのテクニカル リファレンス](https://go.microsoft.com/fwlink/?LinkId=65958)
- [Active Director レプリケーション トポロジのテクニカル リファレンス](https://go.microsoft.com/fwlink/?LinkId=93578)

## <a name="event-and-tool-solution-recommendations"></a>イベントとツールのソリューションに関する推奨事項

理想的には、赤色 (エラー) と、ディレクトリ サービス イベント ログで黄色 (警告) のイベントは、ソースまたは変換先のドメイン コント ローラーでレプリケーション エラーを原因となっている特定の制約をお勧めします。 イベント メッセージには、ソリューションの手順からわかるようにの場合は、イベントに記載されている手順を実行します。 Repadmin ツールおよびその他の診断ツールは、レプリケーション エラーを解決するのに役立つ情報も提供します。 

Repadmin を使用して、レプリケーションの問題のトラブルシューティングの詳細については、次を参照してください。[監視とトラブルシューティング Active Directory レプリケーションを使用して Repadmin](https://go.microsoft.com/fwlink/?LinkId=122830)します。

## <a name="ruling-out-intentional-disruptions-or-hardware-failures"></a>意図的な中断やハードウェア障害は除きます

レプリケーション エラーは、意図的な中断が原因で発生します。 たとえば、Active Directory レプリケーションの問題をトラブルシューティングする際に除外して意図的な切断し、ハードウェア障害またはアップグレード最初。

### <a name="intentional-disconnections"></a>意図的な接続の切断

ステージング サイトでビルドされており、最終的な運用環境のサイト (リモート サイトに、ブランチ オフィスなどの配置を待機していますが現在オフラインのドメイン コント ローラーを使用したレプリケーションを試行するドメイン コント ローラーでレプリケーション エラーが報告された場合)、それらのレプリケーション エラーを考慮することができます。 ドメイン コント ローラーがドメイン コント ローラーが再接続されるまで継続的なエラーが発生した場合、長時間のレプリケーション トポロジから分離することを回避するには、メンバー サーバーとして、最初にこのようなコンピューターを追加して、メディア (からのインストールを使用を検討してください。IFM) メソッドを使用して、Active Directory Domain Services (AD DS) をインストールします。 Ntdsutil コマンド ライン ツールを使用すると、リムーバブル メディア (CD、DVD、またはその他のメディア) を格納して、移行先サイトに返送するインストール メディアを作成します。 次に、インストール メディアを使用して、レプリケーションを使用せず、サイトでドメイン コント ローラーを AD DS をインストールすることができます。 

### <a name="hardware-failures-or-upgradestitle"></a>ハードウェア障害またはアップグレード</title>

レプリケーションの問題がハードウェア障害 (たとえば、マザーボード、ディスク サブシステム、またはハード ドライブの障害) の結果として発生した場合は、ハードウェアの問題を解決できるように、サーバーの所有者を通知します。

定期的なハードウェアのアップグレードでは、ドメイン コント ローラー サービスを停止することもあります。 サーバーの所有者は、このような障害を事前に通知する適切なシステムであることを確認します。

### <a name="firewall-configuration"></a>ファイアウォールの構成

既定では、Active Directory レプリケーションのリモート プロシージャ コール (Rpc) はポート 135 で RPC エンドポイント マッパー (RPCSS) を通じて使用可能なポートを動的に発生します。 セキュリティが強化された Windows ファイアウォールを確認し、レプリケーションを許可するその他のファイアウォールが正しく構成されています。 Active Directory のレプリケーションとポートの設定のポートを指定する方法の詳細については、次を参照してください。 [224196 で Microsoft サポート技術情報の記事](https://go.microsoft.com/fwlink/?LinkId=22578)します。 

Active Directory のレプリケーションを使用するポートについては、次を参照してください。 [Active Directory レプリケーション ツールと設定](https://go.microsoft.com/fwlink/?LinkId=123774)します。

ファイアウォール経由での Active Directory レプリケーションの管理方法の詳細については、次を参照してください。[ファイアウォール経由で Active Directory のレプリケーション](https://go.microsoft.com/fwlink/?LinkId=123775)します。

## <a name="responding-to-failure-of-an-outdated-server-running-windows-2000-server"></a>Windows 2000 Server を実行して、古いサーバーの障害への対応

Windows 2000 Server を実行するドメイン コント ローラーが廃棄 (tombstone) の有効期間の日数を超えて失敗した場合、ソリューションは常に同じです。 

1. サーバーを企業ネットワークからプライベート ネットワークを移動します。
2. 強制的に削除する Active Directory か、オペレーティング システムを再インストールします。
3. サーバー オブジェクトを復元できないように、Active Directory からサーバーのメタデータを削除します。 

ほとんどの Windows オペレーティング システムでサーバーのメタデータをクリーンアップするスクリプトを使用できます。 このスクリプトの使用方法の詳細については、次を参照してください。 [Active Directory ドメイン コント ローラーの削除メタデータ](https://go.microsoft.com/fwlink/?LinkID=123599)します。 

既定では、NTDS 設定オブジェクトが削除されるは 14 日の期間を自動的に復元します。 そのため、サーバーのメタデータを削除しない場合 (Ntdsutil またはメタデータのクリーンアップを実行する前に説明したスクリプトを使用)、サーバーのメタデータはレプリケーションの試行が発生するように求められますディレクトリに復元します。 この場合、エラーは、不足しているドメイン コント ローラーを複製することができないの結果として永続的に記録されるは。

## <a name="root-causes"></a>根本的な原因

意図的な切断、ハードウェアの障害、および古い Windows 2000 ドメイン コント ローラーを除外する場合のレプリケーションの問題の残りの部分ほぼ常に、次の根本原因の 1 つがあります。

- ネットワーク接続:ネットワーク接続を使用できない可能性があります。 またはネットワークの設定が正しく構成されていません。
- 名前解決:DNS の構成の誤りは、レプリケーション エラーの一般的な原因です。
- 認証と承認:ドメイン コント ローラーがレプリケーション パートナーに接続しようとしました。「アクセスが拒否されました」エラーが発生する認証と承認の問題。
- ディレクトリ データベース (ストア):ディレクトリ データベースできないレプリケーションのタイムアウトを十分に高速トランザクションを処理することがあります。
- レプリケーション エンジン:サイト間レプリケーション スケジュールが短すぎる場合は、レプリケーション キューが出力方向のレプリケーション スケジュールで必要な時間で処理するには大きすぎる場合があります。 この場合は、いくつかの変更のレプリケーションでは、可能性のある無期限に停止している、廃棄 (tombstone) の有効期間を超過するのに十分な時間を指定できます。
- レプリケーション トポロジ:ドメイン コント ローラーは、実際のワイド エリア ネットワーク (WAN) 接続または仮想プライベート ネットワーク (VPN) 接続にマップされる AD DS サイト間のリンクが必要です。 オブジェクトを作成するには、ネットワークの実際のサイト トポロジでサポートされていない AD ds レプリケーション トポロジに、正しく構成されていないトポロジを必要とするレプリケーションは失敗します。

## <a name="general-approach-to-fixing-problems"></a>問題を修正する一般的な方法

レプリケーションの問題を修正する次の一般的なアプローチを使用します。 

1. 毎日、レプリケーションの正常性を監視するか、Repadmin.exe を使用して、毎日のレプリケーションの状態を取得します。
2. イベント メッセージと、このガイドで説明されているメソッドを使用して適切なタイミングで報告されたエラーを解決しようとしてください。 ソフトウェアの問題の原因が場合、は、他のソリューションを続行する前に、ソフトウェアをアンインストールします。
3. 既知の方法でレプリケーションが失敗する原因となっている問題を解決できない場合、サーバーから AD DS を削除し、AD DS を再インストールします。 AD DS を再インストールの詳細については、次を参照してください。 [Decommissioning a Domain Controller](https://go.microsoft.com/fwlink/?LinkId=128290)します。
4. 場合は、サーバーがネットワークに接続されている AD DS を正常に削除できません、問題を解決するのには、次のメソッドのいずれかを使用します。

   - 強制的に AD DS の削除でディレクトリ サービス復元モード (DSRM)、サーバーのメタデータをクリーンアップして、AD DS を再インストールします。
   - オペレーティング システムを再インストールし、ドメイン コント ローラーを再構築します。

AD DS の削除を強制の詳細については、次を参照してください。[ドメイン コント ローラーの強制的な削除](https://go.microsoft.com/fwlink/?LinkId=128291)します。

## <a name="using-repadmin-to-retrieve-replication-statustitle"></a>Repadmin を使用して、レプリケーションの状態を取得するには</title>

レプリケーションの状態は、ディレクトリ サービスの状態を評価するための重要な方法です。 エラーのないレプリケーションが動作している場合は、オンラインになっているドメイン コント ローラーがわかります。 次のシステムとサービスが動作するもわかります。


- DNS インフラストラクチャ
- Kerberos 認証プロトコル
- Windows タイム サービス (W32time)
- リモート プロシージャ呼び出し (RPC)
- ネットワーク接続

Repadmin を使用すると、フォレスト内のすべてのドメイン コントローラのレプリケーションの状態を評価するコマンドを実行して毎日のレプリケーションの状態を監視できます。 プロシージャは、Microsoft Excel およびレプリケーションの失敗をフィルターで開くことができる .csv ファイルを生成します。

次の手順を使用するには、フォレスト内のすべてのドメイン コント ローラーのレプリケーション状態を取得します。 

必要条件

この手順を完了するには、少なくとも、**Enterprise Admins** グループ、またはそれと同等の権限を持つグループのメンバーである必要があります。 

ツール:

- Repadmin.exe
- Excel (Microsoft Office)

### <a name="to-generate-a-repadmin-showrepl-spreadsheet-for-domain-controllers"></a>ドメイン コント ローラーの repadmin/showrepl スプレッドシートを生成するには

1. 管理者としてコマンド プロンプトを開きます。スタート メニューで、コマンド プロンプトを右クリックし、管理者として実行 をクリックします。 [ユーザー アカウント制御] ダイアログ ボックスが表示されたら、いて、必要な場合は、Enterprise Admins の資格情報を提供し、[続行] をクリックします。
2. コマンド プロンプトで次のコマンドを入力し、ENTER キーを押します。 `repadmin /showrepl * /csv > showrepl.csv`
3. Excel を開きます。
4. Office ボタンをクリックして、開く をクリックして、showrepl.csv に移動しますおよび をクリックします。
5. 非表示にするか、列 A とトランスポートの種類の列を次のように削除します。
6. 非表示または削除する列を選択します。

   - 列を非表示に、列を右クリックし、非表示をクリックします。
   - 列を削除するには、選択した列を右クリックし、[削除] をクリックします。

7. 列見出しの下に 1 行を選択します。 [表示] タブ ウィンドウ枠の固定をクリックし、上部の固定の行をクリックします。
8. スプレッドシート全体を選択します。 [データ] タブには、フィルターをクリックします。
9. 前回成功した場合の列で下向きの矢印をクリックしておよび昇順で並べ替え をクリックします。
10. ソース DC の列で下向きの矢印フィルターをクリックして、テキスト フィルター をポイントして、カスタム フィルター をクリックします。
11. [オート フィルター オプション] ダイアログ ボックスで、クリックは含まない表示行の下。 隣接するテキスト ボックスに「 <userInput>del</userInput>の結果をビューから削除するドメイン コント ローラーを削除します。
12. 前回のエラー列が使用して、値が equal と、値 0 を入力していない手順 11 を繰り返します。
13. レプリケーション エラーを解決します。

フォレストのドメイン コント ローラーがすべて、スプレッドシートは、ソース レプリケーション パートナーを示しています時間、レプリケーションが最後に発生したと各名前付けコンテキスト (ディレクトリ パーティション) の最後のレプリケーション エラーが発生した時刻。 Excel のオート フィルターを使用すると、ドメイン コント ローラーにのみ、または現在の最低またはほとんど、あるドメイン コント ローラーが失敗しているドメイン コント ローラーのみを操作するためのレプリケーションの正常性を表示し、レプリケートされるレプリケーション パートナーを確認できます。正常にします。

## <a name="replication-problems-and-resolutions"></a>レプリケーションの問題と解決策

レプリケーションの問題は、イベント メッセージでは、アプリケーションまたはサービスが操作を試行するときに発生するさまざまなエラー メッセージで報告されます。 理想的には、これらのメッセージは、監視、アプリケーションで、またはレプリケーションの状態を取得するときに収集されます。

レプリケーションの問題のほとんどは、ディレクトリ サービス イベント ログにログに記録されるイベント メッセージで特定されます。 レプリケーションの問題の出力にエラー メッセージの形式でも識別できます、 <system>repadmin/showrepl</system>コマンド。

### <a name="repadmin-showrepl-error-messages-that-indicate-replication-problems"></a>レプリケーションの問題を示す repadmin/showrepl エラー メッセージ

Active Directory レプリケーションの問題を識別するために使用して、 <system>repadmin/showrepl</system>コマンドは、前のセクションで説明します。 次の表には、根本的原因のエラーとエラーのソリューションを提供するトピックへのリンクと共に、このコマンドを生成するエラー メッセージが表示されます。

|Repadmin エラー|根本原因|ソリューション|
| --- | --- | --- |
|この最後のレプリケーション以降にサーバーは、廃棄 (tombstone) の有効期間を超えました。|ドメイン コント ローラーには、レプリケート、およびガベージ コレクションの AD DS から削除されて、廃棄済みに十分な長さの名前付きのソース ドメイン コント ローラーの入力方向のレプリケーションに失敗しました。|イベント ID 2042:これが長時間経過しているこのマシンのレプリケート|
|受信の近隣ノードはありません。|Repadmin/showrepl によって生成される出力の「受信隣人」セクションでは項目が表示されない場合、ドメイン コント ローラーは別のドメイン コント ローラーでレプリケーション リンクを確立できませんでした。|レプリケーション接続の問題を解決する (イベント ID 1925)| 
|アクセスが拒否されました。|2 つのドメイン コント ローラー間でレプリケーション リンクが存在しますが、レプリケーションは、認証の失敗の結果として正しく実行できません。|レプリケーションのセキュリティの問題を解決する| 
|< 日付 - 時刻 > に前回の試行を「対象のアカウント名が正しくありません」で失敗しました|この問題は、接続、DNS、または認証の問題に関連することができます。 DNS エラーの場合は、ので、ローカル ドメイン コントローラがグローバル一意識別子 (GUID) で解決できませんでした-ベースのレプリケーション パートナーの DNS 名。|レプリケーション DNS 参照 (イベント Id 1925、2087、2088) の問題を修正レプリケーション セキュリティの問題の解決 (イベント ID 1925) レプリケーション接続の問題を修正| 
|LDAP エラー 49 です。|ドメイン コント ローラーのコンピューター アカウントいないキー配布センター (KDC) で同期する可能性があります。|レプリケーションのセキュリティの問題を解決する| 
|ローカル ホストへの LDAP 接続を開くことができません。|管理ツールは、AD DS に接続できませんでした。|レプリケーション DNS 参照の問題を解決する (イベント ID 1925、2087、2088)| 
|Active Directory のレプリケーションが割り込まれました。|入力方向のレプリケーションの進行状況は、repadmin/sync コマンドを使用して手動で生成された要求などのレプリケーションの優先順位の高い要求によって中断されました。|レプリケーションが完了するまで待ちます。 この情報メッセージでは、通常の操作を示します。| 
|レプリケーションが投稿された、待機しています。| ドメイン コント ローラーを使用して、レプリケーション要求を投稿は応答を待機しています。 レプリケーションは、このソースからの処理中です。|レプリケーションが完了するまで待ちます。 この情報メッセージでは、通常の操作を示します。| 

次の表には、Active Directory の問題と問題のソリューションを提供するトピックへのリンクのルートとのレプリケーションが原因で問題を示す可能性がある一般的なイベントが一覧表示します。 

|イベント ID とソース|根本原因|ソリューション|
| --- | --- | --- | 
|1311 NTDS KCC|AD DS のレプリケーションの構成情報は、ネットワークの物理トポロジを正確に反映されません。|レプリケーション トポロジの問題を解決する (イベント ID 1311)| 
|1388 NTDS レプリケーション|レプリケーションの厳密な整合性が有効になって、残留オブジェクトがドメイン コント ローラーにレプリケートされる.|レプリケーション残留オブジェクトの問題を解決する (イベント ID 1388、1988、2042)|
|1925 NTDS KCC|書き込み可能なディレクトリ パーティションのレプリケーション リンクの確立に失敗しました。 このイベントは、エラーによって、さまざまな原因を持つことができます。| レプリケーション接続の問題 (イベント ID 1925) 修正レプリケーション DNS 参照の問題の解決 (イベント Id 1925、2087、2088)| 
|1988 NTDS レプリケーション|ローカル ドメイン コント ローラーは、ローカル ドメイン コント ローラー上に存在できないためは削除されているし、既にガベージ コレクト ソース ドメイン コント ローラーからオブジェクトをレプリケートしようとしています。 レプリケーションは、状況が解決されるまでこのパートナーの場合は、このディレクトリ パーティションは続行されません。|レプリケーション残留オブジェクトの問題を解決する (イベント ID 1388、1988、2042)|
|2042 NTDS レプリケーション|レプリケーションが発生していないパートナーと、廃棄 (tombstone) の有効期間と、レプリケーションを続行できません。|レプリケーション残留オブジェクトの問題を解決する (イベント ID 1388、1988、2042)| 
|2087 NTDS レプリケーション|AD DS に、IP アドレス、および失敗したレプリケーション ソース ドメイン コント ローラーの DNS ホスト名を解決できませんでした。|レプリケーション DNS 参照の問題を解決する (イベント ID 1925、2087、2088)| 
|2088 NTDS レプリケーション |AD DS は、IP アドレスが正常にレプリケートするソース ドメイン コント ローラーの DNS ホスト名を解決できませんでした。|レプリケーション DNS 参照の問題を解決する (イベント ID 1925、2087、2088)|
|Net Logon の 5805|コンピューター アカウントは、通常、同じコンピューター名のいずれかの複数のインスタンスまたはすべてのドメイン コント ローラーにレプリケートされていないコンピューター名によって発生する認証、できませんでした。|レプリケーションのセキュリティの問題を解決する| 

レプリケーションの概念の詳細については、次を参照してください。 [Active Directory のレプリケーション テクノロジ](https://go.microsoft.com/fwlink/?LinkId=41950)します。
  
## <a name="next-steps"></a>次のステップ

詳細については、サポートなどのエラー コードに固有の記事を参照してサポートの記事。[一般的な Active Directory レプリケーション エラーをトラブルシューティングする方法](https://support.microsoft.com/help/3108513)
