---
title: AD フォレストの回復 - フォレストを回復する方法を決定
description: ''
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.date: 08/09/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: 5a291f65-794e-4fc3-996e-094c5845a383
ms.technology: identity-adds
ms.openlocfilehash: 30d23d977b4d7cd320d78ff340120df7013dee4c
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59817733"
---
# <a name="determine-how-to-recover-the-forest"></a>フォレストを回復する方法を決定します。

>適用先:Windows Server 2016、Windows Server 2012 および 2012 R2、Windows Server 2008 および 2008 R2

Active Directory フォレスト全体を回復すると、フォレスト内のドメイン コント ローラー (DC) バックアップから復元するか、Active Directory Domain Services (AD DS) を再インストールする必要があります。 フォレストの回復時の信頼された最後のバックアップの状態に、フォレスト内の各ドメインを復元します。 そのため、復元操作になりますが失われる少なくとも次の Active Directory データ。

- 信頼された前回のバックアップ後に追加されたユーザーとコンピューター などのすべてのオブジェクト
- すべての更新プログラムに加えられた既存のオブジェクト、最後に信頼されているためバックアップ
- 信頼されている最後のバックアップ構成パーティションまたは (スキーマ変更) など、AD DS のスキーマ パーティションのいずれかに加えられたすべての変更

各ドメイン、フォレスト内では、ドメイン管理者アカウントのパスワードを知られないようにする必要があります。 可能であれば、これは、ビルトイン Administrator アカウントのパスワードです。 また、DC のシステム状態の復元を実行する、DSRM パスワードを理解する必要があります。 として、バックアップが有効では、廃棄済みオブジェクトの有効期間内で、または削除されたオブジェクトの有効期間内でアクティブな場合は、期間 Directory のごみの管理者アカウントと、安全な場所での DSRM パスワードの履歴をアーカイブすることをお勧めは一般に、箱が有効にします。 覚えやすいようにするためにドメイン ユーザー アカウントで、DSRM パスワードを同期することもできます。 詳細については、サポート技術情報の記事を参照してください[961320](https://support.microsoft.com/kb/961320)します。 DSRM アカウントの同期は、準備の一環として、フォレストの回復を行う前に行う必要があります。

> [!NOTE]
> 管理者アカウントは、Domain Admins と Enterprise Admins グループには、既定では、組み込みの Administrators グループのメンバーです。 このグループでは、ドメイン内のすべての Dc のフル コントロールには。

## <a name="determining-which-backups-to-use"></a>使用するバックアップを決定します。

ドメインごとに少なくとも 2 つの書き込み可能 Dc を定期的にバックアップから選択するいくつかのバックアップがあるようにします。 書き込み可能 DC を復元する、読み取り専用ドメイン コント ローラー (RODC) のバックアップを使用できないことに注意してください。 エラーの発生前に、いくつかの日に実行されたバックアップを使用して Dc を復元することをお勧めします。 一般に、新しと、復元されたデータの safeness のバランスを決定する必要があります。 最新のバックアップを回復、さらに便利なデータが復元されたフォレストに危険なデータを見直すのリスクが増加する可能性がありますを選択します。

システム状態バックアップの復元は、元のオペレーティング システムとサーバーのバックアップに依存します。 たとえば、別のサーバーにシステム状態のバックアップを復元する必要がありますされません。 ここでは、次の警告を表示することがあります。

"指定したバックアップでは、現在とは別のサーバーです。 別のサーバーへのバックアップでシステム状態の回復を実行するサーバーが使用できなくなる可能性がありますのでお勧めしません。 現在のサーバーを回復するため、このバックアップを使用することを確認しますか?"

Active Directory を別のハードウェアに復元する必要がある場合は、サーバーの完全バックアップとサーバーの完全回復を実行する計画を作成します。

> [!IMPORTANT]
> Windows Server 2008 以降、ことはできませんを新しいハードウェアまたは同じハードウェア上に Windows Server の新しいインストールにシステム状態のバックアップを復元します。 同じハードウェアで Windows Server が再インストールした後でこのガイドで推奨している場合は、この順序で、ドメイン コント ローラーを復元できます。
>
> 1. オペレーティング システムとすべてのファイルとアプリケーションを復元するには、完全なサーバーの復元を実行します。
> 2. Wbadmin.exe を使用して SYSVOL を authoritative とマークするためにシステム状態の復元を実行します。
>
> 詳細については、Microsoft サポート技術情報の参照資料[249694](https://support.microsoft.com/kb/249694)します。

エラーの発生時刻が既知でない場合は、フォレストの最後の安全な状態を保持するバックアップを識別するためにさらに詳しく調査します。 このアプローチは推奨されません。 そのため、フォレスト全体の障害がある場合、エラーのおおよその時間が識別できるように、1 日単位で AD DS の正常性状態に関する詳細なログを保持することを強くお勧めします。 高速回復を有効にするバックアップのローカル コピーをおく必要があります。

バックアップの有効期間と等しい場合は、Active Directory のごみ箱が有効になっている、 **deletedObjectLifetime**値または**tombstoneLifetime**値の小さい方です。 詳細については、次を参照してください。 [Active Directory のごみ箱ステップ バイ ステップ ガイド](https://go.microsoft.com/fwlink/?LinkId=178657)(https://go.microsoft.com/fwlink/?LinkId=178657)します。

別の方法として、Active Directory データベースのマウント ツール (Dsamain.exe) を使用することができますもとバックアップを識別するには、Ldp.exe または Active Directory ユーザーとコンピューターなどのライトウェイト ディレクトリ アクセス プロトコル (LDAP) ツールの最後の安全な状態が、フォレスト。 Windows Server 2008 および以降の Windows Server オペレーティング システムに含まれている、Active Directory データベース マウント ツールは、LDAP サーバーとして、バックアップまたはスナップショットに格納されている Active Directory データを公開します。 次に、データを参照するのに LDAP ツールを使用することができます。 このアプローチでは、いずれかの DC でディレクトリ サービス復元モード (DSRM) の AD DS のバックアップの内容を調べるを再起動する必要がないという利点があります。

詳細については、Active Directory データベースをマウントするツールを使用して、次を参照してください。、 [Active Directory データベースのマウント ツール ステップ バイ ステップ ガイド](https://technet.microsoft.com/library/cc753609\(WS.10\).aspx)します。

使用することも、 **ntdsutil スナップショット**Active Directory データベースのスナップショットを作成するコマンド。 定期的にスナップショットを作成するタスクをスケジュールすることによって、時間の経過と共に、Active Directory データベースの追加のコピーを取得できます。 これらのコピーを使用して、フォレスト全体の障害が発生したときを特定し、最適なバックアップを復元することができます。 スナップショットを作成するには、バージョンを使用して、 **ntdsutil** Windows Server 2008、または、リモート サーバー管理ツール (RSAT) Windows Vista またはそれ以降に付属します。 ターゲット DC では、任意のバージョンの Windows Server を実行できます。 使用しての詳細については、 **ntdsutil スナップショット**コマンドを参照してください[スナップショット](https://technet.microsoft.com/library/cc731620\(WS.10\).aspx)します。

## <a name="determining-which-domain-controllers-to-restore"></a>復元するドメイン コント ローラーを決定します。

復元プロセスの容易さは、復元するドメイン コント ローラーを決定する際に重要な要素です。 優先 DC の復元であるドメインごとに専用の DC にそれをお勧めします。 DC 簡単確実に計画および実行に使用されたソースの構成を使用するために、フォレストの回復を実行する専用の復元では、テストを復元します。 復旧のスクリプトを作成でき、かどうか、DC が含まれる操作マスターの役割か、またはが GC または DNS サーバーであるかどうか、さまざまな構成と競合しません。

> [!NOTE]
> 簡潔にする操作マスターの役割所有者を復元するには使用しないで、中に、その他の利点の 1 つを復元する一部の組織を引き起こすことができます。 たとえば、RID マスターの復元は、Rid を管理する、回復中に問題を防ぐために役立ちます。  

次の条件に最も適した DC を選択します。

- 書き込み可能な DC です。 これは必須です。

- 仮想マシンとして、Vm-generationid をサポートするハイパーバイザー上で Windows Server 2012 を実行している DC です。 この DC は、複製のソースとして使用できます。
- 物理的または仮想ネットワークにアクセス可能は、可能であれば、データ センターにある DC です。 これにより、簡単を分離できますが、ネットワークからフォレストの回復中に。
- 適切なサーバーの完全バックアップのある DC です。 適切なバックアップは、正常に復元できますが作成された、障害発生前に、数日、できるだけ多くの役立つデータとしてが含まれるバックアップです。
- 障害発生前に、ドメイン ネーム システム (DNS) サーバーだった DC です。 これは、DNS を再インストールに必要な時間を保存します。
- また、Windows 展開サービスを使用する場合は、BitLocker ネットワーク ロック解除を使用する構成されていない DC を選択します。 この場合は、フォレストの回復中に、バックアップから復元する最初の DC に使用する BitLocker ネットワーク ロック解除はサポートされません。

   BitLocker ネットワーク ロックを解除として、*のみ*キー保護機能*できません*で使用する Dc のシナリオが発生するために Windows 展開サービス (WDS) を展開が最初の DC が必要ですActive Directory と WDS のロックを解除するために動作しています。 最初の DC を復元する前に Active Directory はまだ使用できません、WDS のロックを解除できないようにします。

   BitLocker ネットワーク ロック解除を使用する DC が構成されているかどうかを判断するには、ネットワーク ロック解除証明書が次のレジストリ キーで認識されているを確認します。

   HKEY_LOCAL_MACHINESoftwarePoliciesMicrosoftSystemCertificatesFVE_NKP

セキュリティ手順の処理または Active Directory を含むバックアップ ファイルを復元するときに維持します。 フォレストの回復に付属している緊急度は意図せず、セキュリティのベスト プラクティスを見過ごしてにつながります。 詳細については、「を確立するドメイン コント ローラーのバックアップと復元のストラテジ」というセクションを参照してください。 [Active Directory のインストールをセキュリティで保護するおよび日常操作のためのベスト プラクティス ガイド。パート II](https://technet.microsoft.com/library/bb727066.aspx)します。

## <a name="identify-the-current-forest-structure-and-dc-functions"></a>現在のフォレストの構造と DC 関数を識別します。

フォレスト内のすべてのドメインを識別することによって、現在のフォレストの構造を決定します。 バックアップ、Dc と仮想化 Dc の複製のソースができます。 特に、各ドメインのすべての Dc の一覧を作成します。 最初にこのドメインは回復のために、フォレスト ルート ドメインの Dc の一覧は、最も重要なになります。 フォレスト ルート ドメインを復元した後は、Active Directory スナップインを使用して、他のドメイン、Dc、およびフォレスト内のサイトの一覧を取得できます。

次の例に示すように、ドメイン内の各ドメイン コント ローラーの機能を示すテーブルを準備します。 これは復旧後にフォレストの障害発生前の構成に戻すのに役立ちます。

|DC 名|オペレーティング システム|FSMO|GC (GC)|RODC|バックアップ|DNS|Server Core|VM|VM GenID|  
|-------------|----------------------|----------|--------|----------|------------|---------|-----------------|--------|---------------|  
|DC_1|Windows Server 2012|スキーマ マスター、ドメイン名前付けマスタ|〇|いいえ|〇|X|X|〇|〇|  
|DC_2|Windows Server 2012|なし|〇|いいえ|〇|〇|いいえ|〇|〇|  
|DC_3|Windows Server 2012|インフラストラクチャ マスタ|X|いいえ|X|〇|〇|〇|〇|  
|DC_4|Windows Server 2012|PDC エミュレーターでは、RID マスター|〇|X|いいえ|いいえ|X|〇|X|  
|DC_5|Windows Server 2012|なし|X|X|〇|〇|いいえ|〇|〇|  
|RODC_1|Windows Server 2008 R2|なし|〇|〇|〇|〇|〇|〇|いいえ|  
|RODC_2|Windows Server 2008|なし|〇|〇|いいえ|〇|〇|〇|いいえ|  

各ドメイン、フォレスト内では、そのドメインの Active Directory データベースの信頼できるバックアップが 1 つの書き込み可能 DC を特定します。 DC を復元するバックアップを選択すると、警告を使用します。 1 日と、エラーの原因がわかっている約、一般的な推奨事項は、数日前の日付に、が行われたバックアップを使用するは。
  
この例では、次の 4 つのバックアップの候補があります。DC_1、DC_2、DC_4、および DC_5 します。 これらのバックアップの候補の 1 つだけを復元します。 推奨される DC では、DC_5 は、次の理由です。  

- 仮想化 DC 複製のソースとして使用するための要件を満たす、Vm-generationid をサポートするハイパーバイザー上の仮想 DC を許可するソフトウェアを実行すると、Windows Server 2012 を実行、複製された (または複製することができない場合を削除することができますd)。 復元後、PDC エミュレーターの役割を強制するのに、ドメインのドメイン コント ローラーの複製可能なグループに追加できますサーバー。  
- Windows Server 2012 のフル インストールを実行します。 Server Core インストールを実行している DC は回復ターゲットとして簡単にできます。  
- DNS サーバーになります。 したがって、DNS は、再インストールする必要はありません。  

> [!NOTE]
> DC_5 がグローバル カタログ サーバーではないためにも利点がありますにする、グローバル カタログは、復元後に削除する必要はありません。 すべての Dc が既定では、および削除、復元は、フォレストの一部として推奨した後にグローバル カタログを追加して、グローバル カタログ サーバーには、DC が、グローバル カタログ サーバーが決定的な重要でないため、Windows Server 2012 以降でも、かどうかが、回復は、いずれの場合も処理します。  

## <a name="recover-the-forest-in-isolation"></a>分離フォレストを回復します。

推奨シナリオは、最初の DC を復元する前にすべての書き込み可能 Dc をシャット ダウンは再び運用環境にします。 これにより、危険なデータは、回復したフォレストにはレプリケートされません。 これは、方法は、すべての操作マスターの役割所有者をシャット ダウンは特に重要です。  

> [!NOTE]
> その他の Dc システムのダウンタイムを最小限に抑えるためにオンラインのままにしながら、分離されたネットワークには、各ドメインを回復する予定の最初の DC を移動する場合があります。 たとえば、障害が発生したスキーマのアップグレードから回復する場合は、単独で回復の手順を実行している間は、実稼働ネットワークで実行されているドメイン コント ローラーを保持する選択可能性があります。

仮想化 Dc を実行している場合に移動する運用ネットワークから分離された仮想ネットワークに回復を実行する場所。 別のネットワーク仮想化 Dc に移動すると、2 つの利点が提供されます。  

- 回復された Dc が分離されるため、フォレストの回復を原因となった問題の再発できなくなります。  
- 仮想化 DC の複製重要な数の Dc を実行できるように、別のネットワークで実行でき、運用ネットワークに戻されました前にテストします。

物理ハードウェアで Dc を実行している場合は、フォレスト ルート ドメインで復元する計画の最初の DC のネットワーク ケーブルを切断します。 可能であれば、その他のすべての Dc のネットワーク ケーブルも切断します。 フォレストの回復プロセス中に誤って起動された場合の Dc からレプリケート、できません。  

複数の場所に分散される大規模なフォレスト、すべての書き込み可能 Dc をシャット ダウンを保証するために困難ができます。 このため、回復手順: メタデータのクリーンアップをさらに、コンピューター アカウントと、krbtgt アカウントのリセットなど、目的は、危険な書き込み可能 Dc と復旧の書き込み可能 Dc をレプリケートしないことを確認 (場合に、いくつかのオンラインのまま、フォレスト)。  
  
ただし、書き込み可能 Dc をオフラインでのみを保証できるレプリケーションは発生しません。 そのため、可能であれば、シャット ダウンし、フォレストの回復中に、書き込み可能 Dc を物理的に分離することができますのリモート管理技術を展開する必要があります。  
  
Rodc は、書き込み可能 Dc をオフラインの動作を続行できます。 その他の DC が直接変更がレプリケートしない、RODC から: 特に、スキーマ、または構成コンテナー変更なし: ため、回復時に書き込み可能 Dc として同じリスクを引き起こすことはありません。 書き込み可能なすべての Dc が回復でオンラインで後、は、すべての Rodc を再構築する必要があります。  
  
Rodc は、回復操作が並列で起こって中に、それぞれのサイトでキャッシュされているローカル リソースへのアクセスを許可し続けます。 RODC にキャッシュされないローカル リソースには、書き込み可能 DC に転送される認証要求があります。 書き込み可能 Dc がオフラインになっているために、これらの要求は失敗します。 パスワードの変更などのいくつかの操作はありません、書き込み可能 Dc を回復するまでは機能も。  
  
ハブとスポークのネットワーク アーキテクチャを使用している場合は、まずハブ サイト内の書き込み可能 Dc を回復に集中できます。 後で、リモート サイトに Rodc を再構築することができます。  
  
## <a name="next-steps"></a>次の手順

- [AD フォレストの回復 - 前提条件](AD-Forest-Recovery-Prerequisties.md)  
- [AD フォレストの回復 - カスタム フォレスト回復の計画を立てる](AD-Forest-Recovery-Devising-a-Plan.md)  
- [AD フォレストの回復の問題の特定](AD-Forest-Recovery-Identify-the-Problem.md)
- [AD フォレストの回復に回復する方法を決定](AD-Forest-Recovery-Determine-how-to-Recover.md)
- [AD フォレストの回復 - 最初の回復を実行します。](AD-Forest-Recovery-Perform-initial-recovery.md)  
- [AD フォレストの回復の手順](AD-Forest-Recovery-Procedures.md)  
- [AD フォレストの回復 - よく寄せられる質問](AD-Forest-Recovery-FAQ.md)  
- [AD フォレストの回復 - Multidomain フォレスト内の 1 つのドメインを回復します。](AD-Forest-Recovery-Single-Domain-in-Multidomain-Recovery.md)  
- [AD フォレストの回復 - Windows Server 2003 ドメイン コント ローラーとフォレストの回復](AD-Forest-Recovery-Windows-Server-2003.md)  
