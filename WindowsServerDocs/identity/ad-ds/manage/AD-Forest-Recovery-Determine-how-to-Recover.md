---
title: "AD フォレストの回復 - フォレストを回復する方法を決定します。"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 07/07/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: 5a291f65-794e-4fc3-996e-094c5845a383
ms.technology: identity-adfs
ms.openlocfilehash: cc2525068225644b0964a2726bd9c0dcf2e0cba0
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
# <a name="determine-how-to-recover-the-forest"></a>フォレストを回復する方法を決定します。  

>Windows Server 2016、Windows Server 2012 および 2012 R2、Windows Server 2008 および 2008 の R2 を適用対象:

 Active Directory フォレスト全体を回復すると、フォレスト内のドメイン コントローラー (DC) バックアップから復元するか、Active Directory ドメイン サービス (AD DS) を再インストールが含まれます。 フォレストの回復時の信頼された最後のバックアップの状態に、フォレスト内の各ドメインを復元します。 そのため、復元操作になりますが失われるには、少なくとも次の Active Directory データ。  
  
-   信頼された最後のバックアップ後に追加された、(ユーザーとコンピューター] などのすべてのオブジェクト  
  
-   すべての更新プログラムに加えられた既存のオブジェクト、最後に信頼されているためバックアップ  
  
-   信頼された最後のバックアップ以降に、構成パーティションまたは (スキーマの変更) などの AD DS のスキーマ パーティションのいずれかに加えられたすべての変更  
  
 フォレスト内の各ドメインの Domain Admin アカウントのパスワードを既知する必要があります。 可能であれば、ない無効にする必要がありますが、ビルトイン Administrator アカウントのパスワードです。 また、DC のシステム状態の復元を実行する、DSRM パスワードを理解する必要があります。 一般は、バックアップが有効では、廃棄 (tombstone) の有効期間にわたって内、または削除されたオブジェクトの Active Directory のごみ箱が有効にした場合、有効期間内限り、Administrator アカウントおよびの安全な場所に DSRM パスワードの履歴をアーカイブすることをお勧めします。 覚えやすくためにドメイン ユーザー アカウントを使用して、DSRM パスワードを同期することもできます。 詳細については、「」を参照情報の記事[961320](https://support.microsoft.com/kb/961320)します。 DSRM アカウントの同期は、フォレスト回復の準備の一環として、前に実行する必要があります。  
  
> [!NOTE]
>  管理者アカウントは、Domain Admins と Enterprise Admins グループにも、既定では、組み込み Administrators グループのメンバーです。 このグループは、ドメイン内のすべての Dc のフル コントロールを持ちます。  
  
## <a name="determining-which-backups-to-use"></a>使用するには、どのバックアップを決定します。  
 ドメインごとに少なくとも 2 つの書き込み可能な Dc 定期的にバックアップから選択するいくつかのバックアップがあるためです。 書き込み可能な DC を復元する読み取り専用ドメイン コントローラー (RODC) のバックアップを使用することはできないことに注意してください。 Dc は、数日前以内に、エラーの発生するときに実行されたバックアップを使用して復元することをお勧めします。 一般に、新しと、復元されたデータの safeness のトレードオフを決定する必要があります。 最近のバックアップより有用なデータでの回復が、危険なデータを復元したフォレストに再挿入されるのリスクが増加する可能性がありますを選択します。  
  
 システム状態のバックアップを復元するは、元のオペレーティング システムとサーバーのバックアップに依存します。 たとえば、別のサーバーにシステム状態のバックアップを復元する必要がありますできません。 この場合は、次の警告が表示されます。  
  
 "指定したバックアップは現在とは別のサーバーです。 システムの状態、バックアップで、代替サーバーの回復を実行するため、サーバーが使用できなくなる可能性がありますお勧めしません。 よろしい、現在のサーバーを回復するため、このバックアップを使用する場合ですか?」  
  
 を別のハードウェアに Active Directory を復元する必要がある場合は、サーバーの完全バックアップおよびサーバーの完全回復を実行する計画を作成します。  
  
> [!IMPORTANT]
>  Windows Server 2008 以降では、ことはできませんを新しいハードウェアまたは同じハードウェア上の Windows Server の新しいインストールをシステム状態のバックアップを復元します。 Windows Server が再インストールされますが、同じハードウェア上このガイドの後半で推奨されている場合は、次の順序で、ドメイン コントローラーを復元できます。  
>   
>  1.  オペレーティング システムとすべてのファイルとアプリケーションを復元するために、サーバーの完全復元を実行します。  
> 2.  Wbadmin.exe を使用して SYSVOL を権限のあるとしてマークするために、システム状態の復元を実行します。  
>   
>  詳細については、「」を参照 Microsoft サポート技術情報の記事[249694](https://support.microsoft.com/kb/249694)します。  
  
 障害が発生した時間が不明な場合は、フォレストの最後の安全な状態を保持するバックアップを識別するさらに調査します。 このアプローチは、望ましいです。 そのため、フォレスト全体の障害がある場合、エラーのおおよその時間が識別できるように、日常的に、AD DS のヘルス状態に関する詳細なログを保持することを強くお勧めします。 高速な回復を有効にするバックアップのローカル コピーを維持することも必要があります。  
  
 Active Directory のごみ箱が有効になっている場合、バックアップの有効期間は、**deletedObjectLifetime**値または**tombstoneLifetime**値のどちらか短い方が小さい。 詳細については、次を参照してください。[Active Directory のごみ箱 Step-by-Step Guide](https://go.microsoft.com/fwlink/?LinkId=178657) (https://go.microsoft.com/fwlink/?LinkId=178657)。  
  
 代わりは、Active Directory データベースのマウント ツール (Dsamain.exe) と Ldp.exe または Active Directory ユーザーとコンピューターを識別するバックアップが、フォレストの最後の安全な状態などのライトウェイト ディレクトリ アクセス プロトコル (LDAP) ツールを使用することができます。 Windows Server 2008 および以降の Windows Server オペレーティング システムに含まれる、Active Directory データベース マウント ツールは、LDAP サーバーとしてバックアップまたはスナップショットに保存されている Active Directory データを公開します。 次に、データを参照するのに LDAP ツールを使用することができます。 このアプローチでは、すべての DC でディレクトリ サービス復元モード (DSRM) を調べるには AD DS のバックアップの内容を再起動する必要がないという利点があります。  
  
 詳細については、Active Directory データベースをマウントするツールを使用して、次を参照してください。、[Active Directory データベースのマウント ツール Step-by-Step Guide](https://technet.microsoft.com/library/cc753609\(WS.10\).aspx)します。  
  
 使用することも、**ntdsutil スナップショット**Active Directory データベースのスナップショットを作成するコマンドです。 定期的にスナップショットを作成するタスクをスケジュールするには、時間の経過と共に、Active Directory データベースの追加のコピーを取得できます。 これらのコピーを使用して、フォレスト全体の障害が発生したときの特定し、復元する最適なバックアップを選択することができます。 スナップショットを作成するのバージョンを使用して**ntdsutil** Windows Server 2008、または、リモート サーバー管理ツール (RSAT) Windows Vista またはそれ以降に同梱されています。 ターゲット DC では、任意のバージョンの Windows Server を実行できます。 使用しての詳細については、**ntdsutil スナップショット**コマンドは、「[スナップショット](https://technet.microsoft.com/library/cc731620\(WS.10\).aspx)します。  
  
  
## <a name="determining-which-domain-controllers-to-restore"></a>復元するドメイン コントローラーを決定します。  
 復元プロセスの簡単操作は、復元するドメイン コントローラーを決定する際に重要な要因です。 復元の優先 DC は、ドメインごとに専用 DC にそれをお勧めします。 DC やすくを確実に計画および実行するために使用された移行元の構成を使用するために、フォレストの回復を実行する専用の復元では、テストを復元します。 回復のスクリプトを作成し、GC または DNS サーバーであるかどうかどうか、DC が含まれる操作マスターの役割かなど、さまざまな構成と競合しませんできます。  
  
> [!NOTE]
>  簡潔にする操作マスターの役割所有者を復元することはお勧めしません、中に、一部の組織の他の利点の 1 つの復元ことができます。 たとえば、RID マスターの復元、Rid を管理する、回復中に問題を防ぐために役立つ場合があります。  
  
 次の条件に最も合致 DC を選択します。  
  
-   書き込み可能な DC します。 これは必須です。  
  
-   VM-GenerationID をサポートするハイパーバイザー上の仮想マシンとして Windows Server 2012 を実行している DC します。 この DC は、複製のソースとして使用できます。  
  
-   DC にアクセスできる、物理的または仮想ネットワーク、およびデータ センター内にある可能であればをします。 これにより、簡単に分離できますが、ネットワークからフォレストの回復時に。  
  
-   DC が良好なサーバーの完全バックアップをします。 正常なバックアップは、正常に復元することができます、数日前以内に、エラーの撮影し、できるだけ多くの役立つデータとしてを含むバックアップです。  
  
-   障害発生前に、のドメイン ネーム システム (DNS) サーバーだった DC します。 これは、DNS を再インストールに必要な時間を節約できます。  
  
-   また Windows 展開サービスを使用する場合は、BitLocker ネットワーク ロック解除を使用する構成されていない DC を選択します。 この場合は、フォレストの回復中に、バックアップから復元する最初の DC に使用する BitLocker ネットワーク ロック解除はサポートされません。  
  
     BitLocker ネットワーク ロックを解除として、*のみ*キー保護機能*できません*で使用できるドメイン コントローラー操作を行っては、生成されるシナリオのために Windows 展開サービス (WDS) を展開した Active Directory と WDS のロックを解除するために作業する最初の DC が必要です。 最初の DC を復元する前に Active Directory はまだ使用できません、WDS のロックを解除できないようにします。  
  
     調べるには BitLocker ネットワーク ロック解除を使用する DC が構成されているかどうか、ネットワーク ロック解除証明書が次のレジストリ キーで識別されることを確認します。  
  
     HKEY_LOCAL_MACHINESoftwarePoliciesMicrosoftSystemCertificatesFVE_NKP  
  
 処理または Active directory のバックアップ ファイルの復元時にセキュリティ手順を維持します。 フォレストの回復に付属している緊急セキュリティのベスト プラクティス都を見渡すにより、意図せずできます。 詳細についてを参照してください「を確立するドメイン コントローラーのバックアップと復元の戦略」で[セキュリティで保護する Active Directory のインストールおよび日常操作のためのベスト プラクティス ガイド: 第 2 部](https://technet.microsoft.com/library/bb727066.aspx)します。  
  
## <a name="identify-the-current-forest-structure-and-dc-functions"></a>現在のフォレストの構造と DC 関数を特定します。  
 フォレスト内のすべてのドメインを識別することによって、現在のフォレストの構造を決定します。 各ドメインで、バックアップの Dc と仮想化 Dc の複製のソースになる可能性が特にのすべての Dc の一覧を作成します。 最初にこのドメインは回復ために、フォレスト ルート ドメインの Dc の一覧は、最も重要になります。 フォレスト ルート ドメインを復元した後は、Active Directory スナップインを使用して、他のドメイン、Dc、およびフォレスト内のサイトの一覧を取得できます。  
  
 次の例のように、ドメイン内の各ドメイン コントローラーの機能を示す表を準備します。 これからは、回復後に、フォレストの障害発生前の構成に戻すできます。  
  
|DC 名|オペレーティング システム|FSMO|GC|RODC|バックアップ|DNS|Server Core|VM|VM-GenID|  
|-------------|----------------------|----------|--------|----------|------------|---------|-----------------|--------|---------------|  
|DC_1|Windows Server 2012|スキーマ マスタ ドメイン名前付けマスタ|うん|違います|うん|違います|違います|うん|うん|  
|DC_2|Windows Server 2012|[なし]|うん|違います|うん|うん|違います|うん|うん|  
|DC_3|Windows Server 2012|インフラストラクチャ マスタ|違います|違います|違います|うん|うん|うん|うん|  
|DC_4|Windows Server 2012|PDC エミュレーター、RID マスター|うん|違います|違います|違います|違います|うん|違います|  
|DC_5|Windows Server 2012|[なし]|違います|違います|うん|うん|違います|うん|うん|  
|RODC_1|Windows Server 2008 R2|[なし]|うん|うん|うん|うん|うん|うん|違います|  
|RODC_2|Windows Server 2008|[なし]|うん|うん|違います|うん|うん|うん|違います|  
  
 フォレスト内の各ドメインを信頼されたそのドメインの Active Directory データベースのバックアップを持つ単一の書き込み可能な DC を特定します。 DC を復元するバックアップを選択する場合は、注意を使用します。 1 日と失敗の原因は約わかっていますが、一般的な推奨事項が数日前以内にその日付が行われたバックアップを使用するには  
  
 この例では、次の 4 つのバックアップの候補となる: DC_1、DC_2、DC_4、および DC_5 します。 これらのバックアップの候補の 1 つだけを復元します。 推奨される DC では、次の理由で DC_5 を示します。  
  
-   仮想化 DC 複製のソースとして使用するための要件を満たす、VM-GenerationID をサポートしているを実行するソフトウェアをハイパーバイザーで仮想 DC の複製対象となるで許可されているように Windows Server 2012 を実行 (することができない場合を削除することができます、または複製された)。 復元後に、PDC エミュレーターの役割を強制移動するのに、ドメインのドメイン コントローラーの複製可能なグループに追加できますサーバーとします。  
  
-   Windows Server 2012 のフル インストールを実行します。 Server Core インストールを実行している DC が回復先として不便できます。  
  
-   これは、DNS サーバーです。 そのため、DNS は再インストールする必要はありません。  
  
> [!NOTE]
>  DC_5 がグローバル カタログ サーバーではないためにも利点ことで、グローバル カタログが、復元後に削除する必要はありません。 すべての Dc は既定とを削除して、復元をお勧めフォレスト回復プロセスの一環としていずれの場合で後に、グローバル カタログに追加してグローバル カタログ サーバーでこの DC は、グローバル カタログ サーバーが決定的な要因のため、Windows Server 2012 以降もは、かどうか。  
  
## <a name="recover-the-forest-in-isolation"></a>分離フォレストを回復します。  
 適切なシナリオは、復元された最初の DC の前にすべての書き込み可能な Dc をシャット ダウン、状態に戻りました運用です。 これにより、危険なデータは、回復したフォレストにはレプリケートされません。 それは、すべての操作マスターの役割所有者をシャット ダウンは特に重要です。  
  
> [!NOTE]
>  システムのダウンタイムを最小限に抑えるにはオンライン状態に維持するには、他の Dc を許可しながら、隔離されたネットワークをドメインごとに回復しようとして最初の DC を移動する場合がある可能性があります。 たとえば、障害が発生したスキーマ、アップグレードが回復している場合こともできますを単独で回復の手順を実行している間は、実稼働ネットワークで実行されているドメイン コントローラーを保持します。  
  
 仮想化 Dc を実行している場合ことができます移動するには、実稼働ネットワークから分離された仮想ネットワークに回復を実行する場所。 別のネットワーク仮想化 Dc に移動すると、次の 2 つの利点があります。  
  
-   回復された Dc があるため、独立したフォレスト回復の原因となった問題の再発できなくなります。  
  
-   仮想化 DC の複製する別のネットワーク上で実行されるので、重要な数の Dc が実行されていることができますでき、実稼働ネットワークに戻るに戻る前にテストできます。  
  
 物理ハードウェアでドメイン コント ローラーを実行している場合は、フォレスト ルート ドメインの復元を計画している最初の DC のネットワーク ケーブルを切断します。 可能であれば、ネットワーク ケーブルを他のすべての Dc の切断もできます。 これは、できなくなります Dc のレプリケーションでは、フォレストの回復プロセス中に誤って起動された場合。  
  
 大規模なフォレストにある複数の場所にわたって、すべての書き込み可能な Dc はシャット ダウンを保証するために困難とがあります。 このため、回復の手順-メタデータのクリーンアップをさらにコンピューター アカウントと、krbtgt アカウントのリセットなど — (一部オンライン フォレスト内にある) 場合、回復された書き込み可能なドメイン コント ローラーは危険な書き込み可能なドメイン コント ローラーにレプリケートしないことを確認するように設計されています。  
  
 ただし、書き込み可能なドメイン コント ローラーをオフラインでのみする保証できるレプリケーションは発生しません。 そのため、可能な限り、シャット ダウンし、フォレストの回復中に、書き込み可能な Dc を物理的に分離するのに役立ちますのリモート管理技術を展開する必要があります。  
  
 Rodc は、書き込み可能なドメイン コント ローラーがオフラインの操作を続行できます。 その他の DC 直接レプリケーションを実行しないすべての変更、RODC から — 特に、スキーマ、または構成コンテナ変更なし-ため、回復中に書き込み可能なドメイン コント ローラーとして同じリスクをなりませんしないでください。 書き込み可能なすべての Dc が回復したおよびオンラインしたら、すべての Rodc を再構築する必要があります。  
  
 Rodc は、回復操作が同時進行中に、それぞれのサイトにキャッシュされたローカル リソースへのアクセスを許可するように続行されます。 Rodc がキャッシュされていないローカル リソースには、書き込み可能な DC に転送される認証要求があります。 書き込み可能なドメイン コント ローラーでオフラインになっているために、これらの要求は失敗します。 パスワードの変更などのいくつかの操作も行われません書き込み可能な Dc を回復するまで。  
  
 ハブとスポークのネットワーク アーキテクチャを使用している場合は、まずハブ サイト内の書き込み可能な Dc の回復に集中できます。 後で、リモート サイトで Rodc を再構築することができます。  
  
## <a name="next-steps"></a>次の手順
-   [AD フォレストの回復の前提条件](AD-Forest-Recovery-Prerequisties.md)  
-   [AD フォレストの回復 - カスタム フォレスト回復計画を立てる](AD-Forest-Recovery-Devising-a-Plan.md)  
- [AD フォレストの回復 - 問題の特定](AD-Forest-Recovery-Identify-the-Problem.md)
-   [AD フォレストの回復 - を回復する方法を決定します。](AD-Forest-Recovery-Determine-how-to-Recover.md)
-   [AD フォレストの回復 - 最初の回復を実行](AD-Forest-Recovery-Perform-initial-recovery.md)  
-   [AD フォレストの回復の手順](AD-Forest-Recovery-Procedures.md)  
-   [AD フォレストの回復のよく寄せられる質問](AD-Forest-Recovery-FAQ.md)  
-   [AD フォレストの回復であれば、マルチ ドメイン フォレスト内で 1 つのドメインの回復](AD-Forest-Recovery-Single-Domain-in-Multidomain-Recovery.md)  
-   [AD フォレストの回復 - Windows Server 2003 ドメイン コントローラーとフォレストの回復](AD-Forest-Recovery-Windows-Server-2003.md)  
