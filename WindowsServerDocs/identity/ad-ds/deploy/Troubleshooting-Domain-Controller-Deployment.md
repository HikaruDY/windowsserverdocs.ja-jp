---
ms.assetid: 5ab76733-804d-4f30-bee6-cb672ad5075a
title: "ドメイン コント ローラーの展開のトラブルシューティング"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 254209b0da6a7bc0cd5f3880e14a7e5b16822cdd
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
# <a name="troubleshooting-domain-controller-deployment"></a>ドメイン コント ローラーの展開のトラブルシューティング

>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、ドメイン コントローラーの構成と展開のトラブルシューティングの詳しい方法について説明します。  
  
-   [トラブルシューティングの概要](../../ad-ds/deploy/Troubleshooting-Domain-Controller-Deployment.md#BKMK_Intro)  
  
-   [トラブルシューティングのオプション](../../ad-ds/deploy/Troubleshooting-Domain-Controller-Deployment.md#BKMK_Options)  
  
## <a name="BKMK_Intro"></a>トラブルシューティングの概要  
![トラブルシューティング](media/Troubleshooting-Domain-Controller-Deployment/adds_deploy_troubleshooting.png)  
  
## <a name="BKMK_Options"></a>トラブルシューティングのオプション  
  
### <a name="logging-options"></a>ログ オプション  
組み込みのログは、ドメイン コントローラーの昇格と降格に関する問題のトラブルシューティングの最も重要な情報源します。 これらのログのすべてを有効にし、既定で冗長性を最大用に構成します。  
  
|フェーズ|ログ|  
|---------|-------|  
|サーバー マネージャーまたは ADDSDeployment Windows PowerShell の操作|-%systemroot%\debug\dcpromoui.log<br /><br />-%systemroot%\debug\dcpromoui*.log|  
|ドメイン コントローラーのインストールと昇格|-%systemroot%\debug\dcpromo.log<br /><br />-%systemroot%\debug\dcpromo*.log<br /><br />イベント ビューアー \windows ログ \ \system<br /><br />イベント ビューアー \windows ログ \ ログ \ アプリケーション<br /><br />イベント ビューアー \ アプリケーションとサービス ログ \ ディレクトリ サービス<br /><br />イベント ビューアー \ アプリケーションとサービス ログ \ ファイル レプリケーション サービス<br /><br />イベント ビューアー \ アプリケーションとサービス ログ \dfs レプリケーション|  
|フォレストまたはドメインのアップグレード|-%systemroot%\debug\adprep\\<datetime>\adprep.log<br /><br />-%systemroot%\debug\adprep\\<datetime>\csv.log<br /><br />-%systemroot%\debug\adprep\\<datetime>\dspecup.log<br /><br />-%systemroot%\debug\adprep\\<datetime>\ldif.log*|  
|サーバー マネージャー ADDSDeployment Windows PowerShell 展開エンジン|イベント ビューアー \ アプリケーションとサービス ログ \microsoft\windows\directoryservices-deployment\operational|  
|Windows サービス|-%systemroot%\Logs\CBS\\*<br /><br />-%systemroot%\servicing\sessions\sessions.xml<br /><br />-%systemroot%\winsxs\poqexec.log<br /><br />-%systemroot%\winsxs\pending.xml|  
  
### <a name="tools-and-commands-for-troubleshooting-domain-controller-configuration"></a>ツールとコマンドのドメイン コント ローラー構成のトラブルシューティング  
ログで説明されていない問題をトラブルシューティングするには、開始点として、次のツールを使用します。  
  
-   Dcdiag.exe  
  
-   Repadmin.exe  
  
-   [AutoRuns.exe](https://technet.microsoft.com/sysinternals/bb963902.aspx)、タスク マネージャー、および MSInfo32.exe  
  
-   [Network Monitor 3.4](https://www.microsoft.com/download/en/details.aspx?displaylang=en&id=4865) (またはサード パーティ製のネットワーク キャプチャおよび分析ツール)  
  
### <a name="general-methodology-for-troubleshooting-domain-controller-configuration"></a>ドメイン コントローラー構成のトラブルシューティングの一般的な方法  
  
1.  構文の単純な問題によるエラーのでしたか。  
  
    1.  でしたを誤って入力または ADDSDeployment Windows PowerShell 引数に提供することを忘れないでですか。 たとえば、ADDSDeployment Windows PowerShell を使用して、でしたを忘れた場合、必要な引数を追加する**- domainname**して有効な名前ですか?  
  
    2.  慎重に正確に失敗した理由を指定したコマンド ラインの解析を参照してください。Windows PowerShell コンソール出力を確認します。  
  
2.  前提条件となるエラーのエラーですか。  
  
    1.  前提条件チェッカーで多数のエラーが致命的な昇格の結果として表示するために使用することはできませんようになりました。  
  
    2.  前提条件となるエラーのテキストを慎重に調べて管理されたシナリオではほとんどの問題を解決するために必要なガイダンスを提供します。  
  
3.  昇格し、そのために致命的なエラーですか。  
  
    1.  結果を慎重に確認します。多くのエラーがあるパスワードの誤り、ネットワークの名前解決、重要なオフラインのドメイン コントローラーなどの簡単な説明します。  
  
    2.  出力では、表示されたエラーし、そこからさかのぼってエラーが発生した理由の兆候を表示するには、Dcpromoui.log と dcpromo.log を調べます。  
  
        1.  常に作業サンプル ログと比較します。  
  
        2.  結果は、スキーマの拡張やフォレストまたはドメインを準備する問題を示している場合にのみ、ADPrep のログのエラーを調べます。  
  
        3.  Dcpromoui.log 詳細情報がないかが予期せず終了構成プロセスで処理不能な例外が原因場合にのみ、Directoryservices-deployment イベント ログでエラーを調べます。  
  
    3.  構成の問題の他のインジケータのディレクトリ サービス、システム、およびアプリケーション イベント ログを調べます。 多くの場合、ドメイン コントローラーの昇格は、その他のネットワーク構成が正しくない分散システム全体に影響を及ぼす生ずるです。  
  
    4.  フォレストの全体的なヘルスを検証し、さらにドメイン コントローラーの昇格を妨げる可能性のある微妙な構成の不備を示すために、dcdiag.exe と repadmin.exe を使用します。  
  
    5.  コンピューターを調べ、サード パーティのソフトウェアが干渉して AutoRuns.exe、タスク マネージャー、MSinfo32.exe を使用します。  
  
        1.  サード パーティ製ソフトウェアを削除する (単に無効にしない場合でも、ドライバーの読み込みをソフトウェア)。  
  
    6.  レプリケーション パートナー ドメイン コントローラーを昇格し、昇格プロセス両側のネットワーク キャプチャを分析することができないコンピューターに NetMon 3.4 をインストールします。  
  
        1.  作業ラボ環境を正常な昇格の形態し、が失敗しているを理解するには、これを比較します。  
  
        2.  この時点で、エラーが、フォレスト オブジェクト、既定ではないセキュリティ設定変更、またはネットワーク、考えられると、この新しいドメイン コントローラー、DNS、ファイアウォール、ホスト侵入保護ソフトウェア、またはその他の外部要因の構成の不備の被害します。  
  
### <a name="troubleshooting-specific-problems"></a>特定の問題のトラブルシューティング  
  
#### <a name="events-and-error-messages"></a>イベントとエラー メッセージ  
ドメイン コントローラーの昇格と降格を常に、最後の操作と、ほとんどのプログラムとは異なり成功の操作を実行しない戻り値の 0 にコードを返します。 ドメイン コントローラー構成の最後でコードを表示するには、いくつかのオプションがあります。  
  
1.  サーバー マネージャーを使用する場合は、自動的に再起動する前に、10 秒に昇格の結果を調べます。  
  
2.  ADDSDeployment Windows PowerShell を使用する場合は、自動的に再起動する前に、10 秒に昇格の結果を調べます。 また、完了時に自動的に再起動されないようにできます。 追加する必要があります、**Format-list**パイプラインの出力を読みやすくするためにします。 例えば：  
  
    ```  
    Install-addsdomaincontroller <options> -norebootoncompletion:$true | format-list  
  
    ```  
  
    前提条件の確認および検証エラー行われません再起動、すべてのケースで表示できるようにします。 例えば：  
  
  ![トラブルシューティング](media/Troubleshooting-Domain-Controller-Deployment/ADDS_PSPrereqError.png)  
  
3.  どのようなシナリオでは、dcpromo.log と dcpromoui.log を確認します。  
  
    > [!NOTE]  
    > 以下に示すエラーのいくつかは、オペレーティング システムとドメイン コントローラー構成の変更以降のオペレーティング システムが原因の可能性はありません。 新しい ADDSDeployment Windows PowerShell コードでは、特定のエラーもできなくなりますが、dcpromo.exe/unattend しません。これは、別の特別な理由で、現在の無人非推奨の DCPromo から ADDSDeployment Windows PowerShell のすべてを切り替えるです。  
  
昇格と降格は、次の成功メッセージ コードを返します。  
  
|エラー コード|説明|注:|  
|--------------|---------------|--------|  
|1|終了、成功|まだ再起動する必要があります、自動再起動フラグであるだけでこのノートが削除されました|  
|2|終了、成功すると、再起動が必要||  
|3|終了、成功、重大でないエラー|通常、DNS 委任の警告が返されたときに発生します。 DNS 委任を設定しない場合を使用します。<br /><br />-creatednsdelegation: $false|  
|4|終了、成功、重大でないエラーの場合は、再起動が必要|通常、DNS 委任の警告が返されたときに発生します。 DNS 委任を設定しない場合を使用します。<br /><br />-creatednsdelegation: $false|  
  
昇格と降格、以下のエラー メッセージ コードを返します。 拡張のエラー メッセージがある可能性があります。常にエラー全体をよく読み、番号の部分だけでなくします。  
  
|エラー コード|説明|推奨される解決策|  
|--------------|---------------|------------------------|  
|11|ドメイン コントローラーの昇格が既に実行中します。|複数、同時に同じターゲット コンピューターのドメイン コントローラーの昇格のインスタンスを実行していません。|  
|12|ユーザーは管理者である必要があります。|管理者がグループ化し、UAC で昇格するには、組み込みのメンバーとしてログオン|  
|13|証明機関がインストールされています。|証明機関ではまた、このドメイン コントローラーを降格することはできません。 証明書を発行している場合は、慎重にその使用状況 - をインベントリする前に、CA を削除、役割を削除すると、停止します。 Ca を実行するドメイン コントローラーではお勧めできません。|  
|14|セーフブート モードで実行されています。|サーバーを通常モードで起動します。|  
|15|ロールの変更が進行中または再起動する必要があります。|昇格の前に、(以前の構成の変更) のためのサーバーを再起動する必要があります。|  
|16|正しくないプラットフォームで実行されています。|*このエラーが発生しない可能性があります*|  
|17|NTFS 5 ドライブが存在しません|このエラーは Windows Server 2012 では、NTFS でフォーマットされている必要があります、少なくとも %systemdrive%|  
|18|Windir に十分な領域|%Systemdrive% ボリューム cleanmgr.exe を使用して領域を解放します|  
|19|名前変更が保留中再起動が必要です。|サーバーを再起動します。|  
|20|コンピューター名は、構文が無効です。|有効な名前のコンピューターを名前します。|  
|21|このドメイン コントローラーが FSMO の役割を保持し、gc でまたは DNS サーバーは、|追加**- demoteoperationmasterrole**を使用すると**- forceremoval**します。|  
|22|TCP/IP がインストールする必要がありますまたは機能していません|コンピューターに TCP/IP を構成するには、バインドされ、正しく動作を確認します。|  
|23|DNS クライアントが最初に構成する必要があります。|新しいドメイン コントローラーをドメインに追加するときに、プライマリ DNS サーバーを設定します。|  
|24|指定された資格情報が無効または見つからない必須の要素|ユーザー名とパスワードが正しいことを確認|  
|25|指定されたドメインのドメイン コントローラーが見つかりませんでした。|DNS クライアント設定、ファイアウォール規則を検証します。|  
|26|フォレストからドメインの一覧を読み取ることができませんでした。|DNS クライアント設定、LDAP 機能、ファイアウォール規則を検証します。|  
|27|ドメイン名がありません。|昇格または降格する際に、ドメインを指定します。|  
|28|不正なドメイン名|昇格すると、さまざまな、有効な DNS ドメイン名を選択します。|  
|29|親ドメインが存在しません|新しい子ドメインまたはツリー ドメインを作成するときに指定した親ドメインを確認します。|  
|30|フォレストではなくドメイン|ドメイン名を指定したことを確認します。|  
|31|子ドメインが既に存在します。|別のドメイン名を指定します。|  
|32|NetBIOS ドメイン名が正しくありません。|有効な NetBIOS ドメイン名を指定します。|  
|33|IFM ファイルへのパスが正しくありません。|メディアからインストール フォルダーに、パスを検証します。|  
|34|IFM データベースが正しくありません。|メディアを使用して、適切なインストールからこのオペレーティング システムと役割 (同じバージョンのオペレーティング システム、同じ種類のドメイン コントローラー、RODC 対 RWDC)|  
|35|SYSKEY がありません。|メディアからのインストールは暗号化され、それを使用する有効な SYSKEY を提供する必要があります。|  
|37|NTDS データベースまたはそのログへのパスが正しくありません。|データベースとログのパスを変更して、固定 NTFS ボリューム、しない、マップされたドライブや UNC パスを|  
|38|ボリュームには、NTDS データベースまたはログに十分な領域がありません。|Cleanmgr.exe を使用して領域を解放する、追加のディスク領域を追加、手動で不要なデータを別の場所に移動して領域をクリア|  
|39|SYSVOL へのパスが正しくありません。|SYSVOL フォルダーのパスを変更して、固定 NTFS ボリューム、しない、マップされたドライブや UNC パスを|  
|40|無効なサイト名|存在するサイト名を指定します。|  
|41|セーフ モードのパスワードを指定する必要があります。|DSRM アカウントのパスワードを指定、パスワード ポリシーを構成する方法に関係なく、空白にすることはできません。|  
|42|セーフモードのパスワードが (昇格のみ) の条件を満たしていません。|パスワード ポリシーの構成済みの規則を満たしている DSRM アカウントのパスワードを指定します。|  
|43|管理者パスワードが (降格のみ) の条件を満たしていません|パスワードのポリシーを満たしている、ローカル管理者アカウントのパスワードが構成されているルールを提供します。|  
|44|フォレストに指定した名前が正しくありません。|有効なフォレスト ルート DNS ドメイン名を指定します。|  
|45|指定した名前を持つフォレストが既に存在します。|別のフォレスト ルート DNS ドメイン名を選択します。|  
|46|ツリーに指定した名前が正しくありません。|有効なツリー DNS ドメイン名を指定します。|  
|47|指定された名前のツリーが既に存在します。|別のツリー DNS ドメイン名を選択します。|  
|48|ツリー名が、フォレストの構造に適合しません|別のツリー DNS ドメイン名を選択します。|  
|49|指定されたドメインが存在しません。|型指定されたドメイン名を確認します。|  
|50|降格中、最後のドメイン コントローラーが検出された場合でも、表示されていない、または最後のドメイン コントローラーが指定されましたはありません。|指定しない**ドメイン内の最後のドメイン コントローラー** (**- lastdomaincontrollerindomain**) は true。それがない限り、します。 使用**- ignorelastdcindomainmismatch**これは、最後のドメイン コントローラーで本当の意味とファントム ドメイン コントローラーのメタデータがある場合に上書きするには|  
|51|このドメイン コントローラーにアプリ パーティションが存在します。|指定**アプリケーション パーティションの削除**(**- removeapplicationpartitions**)|  
|52|必要なコマンド ライン引数が不足している (つまり、応答ファイルをコマンド ラインで指定する必要があります)|*Dcpromo/unattend、これは推奨されなくなりましたでのみ発生します。 以前のドキュメントを参照してください。*|  
|53|昇格または降格に失敗しました、マシンを再起動する必要がありますクリーンアップ|拡張エラーとログを調べます|  
|54|昇格または降格に失敗しました|拡張エラーとログを調べます|  
|55|昇格または降格がユーザーによってキャンセルされました|拡張エラーとログを調べます|  
|56|昇格または降格がユーザーによってキャンセルされましたをクリーンアップするコンピューターを再起動する必要があります。|拡張エラーとログを調べます|  
|58|RODC 昇格中にサイト名を指定する必要があります。|RODC のサイトを指定する必要があります、これは自動的に検出されない、RWDC と異なり、|  
|59|このドメイン コントローラーがそのゾーンのいずれかの最後の DNS サーバーを降格中、|これは指定、**ドメイン内の最後の DNS サーバー**使用または**- ignorelastdnsserverfordomain**|  
|60|Windows Server 2008 以降を実行しているドメイン コントローラーは RODC を昇格するために、ドメインに存在する必要があります。|少なくとも 1 つの Windows Server 2008 またはそれ以降のモデルの書き込み可能なドメイン コントローラーを昇格します。|  
|61|DNS をホストしていない既存のドメインに DNS と Active Directory ドメイン サービスをインストールすることはできません。|*このエラーが発生することはできません*|  
|62|応答ファイルには、[DCInstall] セクションではありません。|*Dcpromo/unattend、これは推奨されなくなりましたでのみ発生します。 以前のドキュメントを参照してください。*|  
|63|フォレストの機能レベルが Windows Server 2003 の下には|フォレストの機能レベルを上げるには、少なくとも Windows Server 2003 ネイティブします。 Windows 2000 および Windows NT 4.0 がサポートされるオペレーティング システムでは不要になった|  
|64|コンポーネントのバイナリの検出に失敗したため、昇格に失敗しました|AD DS の役割をインストールします。|  
|65|プロモーション用のコンポーネントのバイナリのインストールに失敗したために失敗しました|AD DS の役割をインストールします。|  
|66|オペレーティング システムの検出に失敗したため、昇格に失敗しました|拡張エラーとログを調べますサーバーは、オペレーティング システム バージョンを返す失敗しています。 コンピューターは、全体的な正常性が高い問題ありとして再インストールする必要が可能性があります。|  
|68|レプリケーション パートナーが無効|Repadmin.exe を使用して、または**取得-ADReplication\ ***パートナー ドメイン コントローラーの正常性を検証する Windows PowerShell|  
|69|必要なポートが既に別のアプリケーションによって使用されています。|使用**netstat.exe-anob**予約済みの AD DS ポートに誤って割り当てられているプロセスを検索するには|  
|70|フォレスト ルート ドメイン コントローラーは GC である必要があります。|*Dcpromo/unattend、これは推奨されなくなりましたでのみ発生します。 以前のドキュメントを参照してください。*|  
|71|DNS サーバーが既にインストールされています。|DNS をインストールするを指定しない (**- installDNS**)、DNS サービスが既にインストールされている場合|  
|72|コンピューターが非管理者モードでリモート デスクトップ サービスを実行しています。|2 つ以上の管理者のユーザー用に構成された RDS サーバーでも、このドメイン コントローラーを昇格することはできません。 RDS を慎重にその使用状況がアプリケーションまたはエンド ユーザー、削除によって使用されている場合は、前に停止すると、削除するには|  
|73|指定されたフォレストの機能レベルが正しくありません。|有効なフォレストの機能レベルを指定します。|  
|74|指定されたドメインの機能レベルが正しくありません。|有効なドメイン機能レベルを指定します。|  
|75|既定のパスワード レプリケーション ポリシーを確認することができません。|RODC のパスワード レプリケーション ポリシーが存在しにアクセスできることを検証します。|  
|76|指定したレプリケート/レプリケートされていないセキュリティ グループが無効|入力した有効なドメインとユーザー アカウントのパスワード レプリケーション ポリシーを指定する場合の検証します。|  
|77|指定された引数が無効|拡張エラーとログを調べます|  
|78|Active Directory フォレストの確認に失敗しました|拡張エラーとログを調べます|  
|79|Rodcprep が実行されていないために、RODC を昇格することはできません。|Windows Server 2012 を使用してフォレストを準備するかを使用して**adprep.exe/rodcprep**|  
|80|Domainprep が実行されていません|Windows Server 2012 を使用して、ドメインを準備するかを使用して**adprep.exe/domainprep**|  
|81|Forestprep が実行されていません|Windows Server 2012 を使用してフォレストを準備するかを使用して**adprep.exe/forestprep**|  
|82|フォレスト スキーマが一致しません。|Windows Server 2012 を使用してフォレストを準備するかを使用して**adprep.exe/forestprep**|  
|83|サポートされていない SKU|*このエラーが発生しない可能性があります*|  
|84|ドメイン コントローラー アカウントを検出できません。|既存のドメイン コントローラーに正しいユーザー アカウント コントロール属性セットがあることを検証します。|  
|85|第 2 段階のドメイン コントローラー アカウントを選択できません。|「既存のアカウントを使用する」が見つかったなしのいずれかのアカウントを指定するかどうか、またはアカウントの参照時にエラーが返されます。 正しい RODC 段階的アカウントを指定していることを確認します。|  
|86|第 2 段階の昇格を実行する必要があります。|返されるかどうか、追加のドメイン コントローラーを昇格するが、既存のアカウントが存在する、再インストールを許可"が指定されていません|  
|87|競合するタイプのドメイン コントローラー アカウントが存在します。|使用されていないドメイン コントローラーに接続しようとしていない場合、昇格する前に、コンピューターの名前を変更します。 使用されていないドメイン コントローラー アカウントを使用して、アタッチする必要があります**-useexistingaccount**、正しい読み取り専用または書き込み可能な引数は、アカウント タイプに応じて|  
|88|指定されたサーバー管理者が無効です。|RODC 管理者の委任の無効なアカウントを指定したとします。 指定されたアカウントが有効なユーザーまたはグループであることを確認します。|  
|89|指定されたドメインの RID マスターがオフラインです。|使用**netdom.exe クエリ fsmo** RID マスターを検出するためにします。 オンラインにして、昇格するドメイン コントローラーにアクセスできるように|  
|90|ドメイン名前付けマスターがオフラインです。|使用**netdom.exe クエリ fsmo**ドメイン名前付けマスターを検出するためにします。 オンラインにして、昇格するドメイン コントローラーにアクセスできるように|  
|91|プロセスが wow64 かどうかを検出するために失敗しました|*このエラーが発生することはできませんされなくなりますが、オペレーティング システムが 64 ビットです。*|  
|92|Wow64 はサポートされていません|*このエラーが発生することはできませんされなくなりますが、オペレーティング システムが 64 ビットです。*|  
|93|非強制降格のドメイン コントローラー サービスが実行されていません|AD DS サービスを開始します。|  
|94|ローカル管理者パスワードが要件を満たしていません空白または必須ではありません。|空白でないパスワードを指定し、ローカル パスワード ポリシーが、パスワードが必要であることを確認|  
|95|最後の Windows Server 2008 またはライブ Rodc が存在するドメイン内のそれ以降のドメイン コントローラーを降格できません。|すべての Windows Server 2008 またはそれ以降の書き込み可能なドメイン コントローラーを降格する前に、まずすべての Rodc を降格する必要があります。|  
|96|DS バイナリをアンインストールできません。|*Dcpromo/unattend、これは推奨されなくなりましたでのみ発生します。 以前のドキュメントを参照してください。*|  
|97|フォレスト機能レベルのバージョン、子ドメインのオペレーティング システムの場合よりも高い|同じまたはフォレストの機能レベルよりも高い子ドメインの機能を提供します。|  
|98|コンポーネント バイナリ インストールまたはアンインストールが進行中です。|*Dcpromo/unattend、これは推奨されなくなりましたでのみ発生します。 以前のドキュメントを参照してください。*|  
|99|フォレストの機能レベルが低すぎます (エラーは、Windows Server 2012 のみ)|フォレストの機能レベルを上げるには、少なくとも Windows Server 2003 ネイティブします。 Windows 2000 および Windows NT 4.0 がサポートされるオペレーティング システムでは不要になった|  
|100|ドメインの機能レベルが低すぎます (エラーは、Windows Server 2012 のみ)|ドメイン機能レベルを上げるには、少なくとも Windows Server 2003 ネイティブします。 Windows 2000 および Windows NT 4.0 がサポートされるオペレーティング システムでは不要になった|  
  
#### <a name="knownlikely-issues-and-support-scenarios"></a>正常および可能性の高い問題とサポートのシナリオ  
Windows Server 2012 開発プロセス中に発生する一般的な問題を次に示します。 これらの問題のすべて"設計上"で、有効な回避策または、最初の段階で回避するための適切な手段のいずれかです。 これらの多くは Windows Server 2008 R2 および古いオペレーティング システムでは、同じですが、AD DS の展開の書き換えは、問題への感度が高まりました。  
  
|問題|DNS がゾーンなしで実行しているドメイン コントローラーの降格が離れた|  
|---------|-----------------------------------------------------------------|  
|問題の症状|サーバーは、まだ DNS 要求に応答するが、ゾーン情報がありません。|  
|解決策と説明|AD DS 役割を削除するときにも、DNS サーバーの役割を削除または DNS サーバー サービスを無効に設定します。 DNS クライアントをそれ自体でなく別のサーバーをポイントしてください。 Windows PowerShell を使用している場合は、サーバーを降格した後に、次を実行します。<br /><br />コード - アンインストール windowsfeature dns<br /><br />または<br /><br />コード - セット サービス dns の開始の種類無効になっています<br />Dns のサービスの停止|  
  
|問題|Windows Server 2012 を既存の単一ラベル ドメインに昇格しても、updatetopleveldomain は構成されません = 1 or allowsinglelabeldnsdomain = 1|  
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------|  
|問題の症状|DNS レコードの動的登録が行われません|  
|解決策と説明|Netlogon と DNS グループ ポリシーを使用してこれらの値を設定します。 Microsoft は、Windows Server 2008; 単一ラベル ドメインの作成をブロックの開始ADMT またはドメイン リネーム ツールを使用して、承認済みの DNS ドメイン構造を変更することができます。|  
  
|問題|作成済みの使用されていない RODC アカウントがある場合、ドメイン内の最後のドメイン コントローラーの降格が失敗します。|  
|---------|------------------------------------------------------------------------------------------------------------|  
|問題の症状|メッセージの降格に失敗します。<br /><br />**Dcpromo.General.54**<br /><br />Active Directory ドメイン サービスを別の Active Directory ドメイン コントローラをディレクトリ パーティション CN の残りのデータを転送する見つかりませんでした = Schema, CN = Configuration, DC = corp, DC = contoso, DC = com します。<br /><br />「指定されたドメイン名の形式は無効です。」|  
|解決策と説明|残りの RODC アカウントを作成済みドメインを降格する前に削除するを使用して**Dsa.msc**または**Ntdsutil.exe メタデータのクリーンアップ**します。|  
  
|問題|自動フォレストおよびドメイン準備で GPPREP は実行されません。|  
|---------|---------------------------------------------------------------|  
|問題の症状|グループ ポリシー、結果の結果セット (RSOP) 計画モードでは、ドメイン間計画機能には、既存の GP の更新されたファイル システムと Active Directory アクセス許可が必要です。 Gpprep がない、使うことはできません RSOP 計画ドメイン間でします。|  
|解決策と説明|実行**adprep.exe/gpprep**に準備されていない Windows Server 2003、Windows Server 2008、または Windows Server 2008 R2 のすべてのドメインを手動でします。 管理者は、各アップグレードではなく、ドメインの履歴で GPPrep 1 回だけを実行する必要があります。 これはため、すべてのドメイン コントローラ上で再レプリケートするすべての SYSVOL の内容が原因となる適切なカスタム アクセス許可を既に設定した場合、自動 adprep によって実行されません。|  
  
|問題|メディアからインストールが失敗した場合、UNC パスをポイントしている時に確認するには|  
|---------|------------------------------------------------------------------|  
|問題の症状|エラーが返されます。<br /><br />コード - メディア パスを確認できませんでした。 例外「2」引数"GetDatabaseInfo"を呼び出すことです。 フォルダーが正しくありません。|  
|解決策と説明|リモート UNC パスではなく、ローカル ディスクに IFM ファイルを格納する必要があります。 この意図的なブロックでは、ネットワークの中断が原因の部分的なサーバーの昇格ができないようにします。|  
  
|問題|ドメイン コントローラーの昇格中に 2 回表示される DNS 委任の警告|  
|---------|-------------------------------------------------------------------------|  
|問題の症状|警告が返される*2 回*ADDSDeployment Windows PowerShell を使用して昇格すると。<br /><br />コード -"権限のある親ゾーンが見つからないか、または Windows DNS が実行されないために、この DNS サーバー用の委任を作成することはできませんサーバー。 既存の DNS インフラストラクチャと統合する場合は、ドメインの外部からの信頼性の高い名前解決を確認するは親ゾーンにこの DNS サーバーへの委任を手動で作成する必要があります。 それ以外の場合、操作は必要ありません。"|  
|解決策と説明|無視します。 ADDSDeployment Windows PowerShell は、ドメイン コントローラーの構成中にもう一度し、前提条件のチェック中に、最初の警告を示しています。 DNS 委任を構成しない場合は、引数を使用します。<br /><br />コード - - creatednsdelegation: $false<br /><br />*いない*このメッセージを抑制するために前提条件チェックのスキップ|  
  
|問題|構成中に UPN または非ドメイン資格情報を指定するには、誤解を招くエラーが返されます。|  
|---------|--------------------------------------------------------------------------------------------|  
|問題の症状|サーバー マネージャーでは、エラーが返されます。<br /><br />-「6」引数"DNSOption"の呼び出しで例外のコードします。<br /><br />ADDSDeployment Windows PowerShell では、エラーが返されます。<br /><br />コード - ユーザーのアクセス許可の検証に失敗しました。 このユーザー アカウントが属しているドメインの名前を指定する必要があります。|  
|解決策と説明|形式で有効なドメイン資格情報を提供することを確認**domain \user**します。|  
  
|問題|サーバーがブート不可能につながる Dism.exe を使用して Directoryservices-domaincontroller 役割を削除します。|  
|---------|---------------------------------------------------------------------------------------------------|  
|問題の症状|円滑にドメイン コントローラーを降格する前に、AD DS の役割を削除するのには、Dism.exe を使用して、不要になったサーバーは正常に起動し、エラーを示しています。<br /><br />コード - ステータス: 0x000000000<br />情報: 予期しないエラーが発生しました。|  
|解決策と説明|ディレクトリ サービス修復モードを使用してブート*Shift + F8*します。 AD DS の役割を元に戻すを追加し、ドメイン コントローラーを強制的に降格します。 また、バックアップからシステム状態を復元します。 Dism.exe を使用しないの AD DS 役割を削除します。ユーティリティは、ドメイン コントローラーの知識を持ちません。|  
  
|問題|フォレスト モードを Win2012 に設定するときに、新しいフォレストをインストールが失敗します。|  
|---------|--------------------------------------------------------------------|  
|問題の症状|ADDSDeployment Windows PowerShell を使用して昇格はエラーを返します。<br /><br />コード - Test.VerifyDcPromoCore.DCPromo.General.74<br /><br />ドメイン コントローラーの昇格の前提条件の検証に失敗しました。 指定されたドメインの機能レベルが正しくありません。|  
|解決策と説明|Win2012 のフォレスト機能モードを指定しない*も*Win2012 のドメイン機能モードを指定します。 エラーなしでは機能する例を次に示します。<br /><br />コード - - forestmode Win2012 - domainmode Win2012]|  
  
|||  
|-|-|  
|問題|メディア選択領域からのインストールの確認] をクリックすると、何もしないが表示されます。|  
|問題の症状|IFM フォルダーへのパスを指定する場合にクリックすると、**確認**ボタンは決してメッセージを返しますまたは何も表示されます。|  
|解決策と説明|**確認**ボタンは、問題がある場合のみエラーを返します。 それ以外の場合、これにより、**[次へ]**、IFM パスを入力した場合に選択可能なボタンをクリックします。 をクリックする必要があります**確認**IFM を選択した場合、続行します。|  
  
|||  
|-|-|  
|問題|サーバー マネージャーでの降格が完了するまでフィードバックは提供されません。|  
|問題の症状|サーバー マネージャーを使用して、AD DS の役割を削除して、ドメイン コントローラーを降格する、降格が完了または失敗するまで継続的なフィードバックはありません。|  
|解決策と説明|これは、サーバー マネージャーの制限です。 フィードバックには、ADDSDeployment Windows PowerShell コマンドレットを使用します。<br /><br />コード - Uninstall-addsdomaincontroller|  
  
|||  
|-|-|  
|問題|メディアの確認からのインストールでは、その RODC メディアが書き込み可能ドメイン コントローラー、またはその逆の提供は検出されません。|  
|問題の症状|新しいドメイン コントローラー IFM を使用して、- など、書き込み可能ドメイン コントローラーの RODC メディアや RODC の RWDC メディア - IFM の誤ったメディアを提供することを昇格すると、[検証] ボタンはエラーを返しません。 後で、昇格はエラーで失敗します。<br /><br />コード - ドメイン コントローラーとしてこのコンピューターを構成しているときにエラーが発生しました。 <br />昇格の Install-From-Media、Read-Only DC は、指定したソース データベースが許可されていないために開始できません。 RODC の IFM 昇格の他の Rodc のデータベースだけを使用できます。|  
|解決策と説明|確認のみ IFM の全体的な整合性を検証します。 サーバーに誤ったタイプの IFM を提供してください。 正しいメディアを使用してもう一度昇格を実行する前に、サーバーを再起動します。|  
  
|||  
|-|-|  
|問題|作成済みのコンピューター アカウントに RODC を昇格が失敗します。|  
|問題の症状|段階的なコンピューター アカウントを使用して新しい RODC を昇格する ADDSDeployment Windows PowerShell を使用して、エラーが表示されます。<br /><br />コード - パラメーター セットは、指定された名前付きパラメーターを使用して解決することはできません。    <br />無効な引数: ParameterBindingException<br />    + FullyQualifiedErrorId: AmbiguousParameterSet、Microsoft.DirectoryServices.Deployment.PowerShell.Commands.Install|  
|解決策と説明|既に作成済みの RODC アカウントで既に定義されているパラメーターは提供されません。 これらは次のとおりです。<br /><br />コード - - readonlyreplica<br />-installdns<br />-donotconfigureglobalcatalog<br />-サイト名<br />-installdns|  
  
|||  
|-|-|  
|問題|何も選択を解除する/を選択すると"各移行先サーバーに自動的に必要に応じて再起動"|  
|問題の症状|選択すると (またはを選択しない) 場合、Server Manager オプション**必要に応じて、各移行先サーバーを自動的に再起動**whendemoting 役割の削除によってドメイン コントローラー、サーバーが必ず再起動、選択肢にかかわらずします。|  
|解決策と説明|これは仕様です。 降格プロセスでは、この設定に関係なく、サーバーを再起動します。|  
  
|||  
|-|-|  
|問題|Dcpromo.log"[error] setting security on server files failed with 2"を示しています。|  
|問題の症状|ドメイン コントローラーの降格が問題なく完了するとが、dcpromo ログを調べるとエラーを示しています。<br /><br />コード - [error] サーバーのファイルのセキュリティの設定が 2 で失敗しました|  
|解決策と説明|無視してください。エラーは予期されると、表面的なします。|  
  
|||  
|-|-|  
|問題|前提条件 adprep チェックがエラー「交換スキーマ競合チェックを実行できません」で失敗します。|  
|問題の症状|Windows Server 2012 ドメイン コントローラーを既存の Windows Server 2003、Windows Server 2008、または Windows Server 2008 R2 フォレストに昇格しようとすると、前提条件の確認がエラーで失敗します。<br /><br />コード - AD 準備の前提条件の検証に失敗しました。 ドメインの交換スキーマ競合チェックを実行できません*<domain name>* (例外: RPC サーバーが利用できない)<br /><br />Adprep.log は、エラーを示しています。<br /><br />コード - サーバーから、Adprep はデータを取得できません。*<domain controller>*<br /><br />で Windows Management Instrumentation (WMI)。|  
|解決策と説明|新しいドメイン コントローラーは、既存のドメイン コントローラーに対する DCOM/RPC プロトコルを通じて WMI にアクセスできません。 までに、次の 3 つの原因がされました。<br /><br />に既存のドメイン コントローラーは、ファイアウォール規則のブロック アクセス<br /><br />-ネットワーク サービス アカウントがない"Logon as a service"(SeServiceLogonRight) 権限に既存のドメイン コントローラー<br /><br />-NTLM が無効、ドメイン コントローラー上で説明されているセキュリティ ポリシーを使用して[NTLM 認証の制限の概要](https://technet.microsoft.com/library/dd560653(WS.10).aspx)|  
  
|||  
|-|-|  
|問題|DNS の警告を表示する新しい AD DS フォレストを常に作成します。|  
|問題の症状|新しい AD DS フォレストを作成して、それ自身に対し、常に新しいドメイン コントローラー上の DNS ゾーンを作成するには、警告メッセージが表示されます。<br /><br />DNS の構成では、コード - エラーが検出されました。 <br />タイムアウト期間内にこのコンピューターで使用される DNS サーバーの応答します。<br />(エラー コード 0x000005B4"ERROR_TIMEOUT")|  
|解決策と説明|無視します。 この警告は、既存の DNS サーバーおよびゾーンにポイントしようとした場合に、新しいフォレストのルート ドメインの最初のドメイン コントローラーで意図的なものです。|  
  
|||  
|-|-|  
|問題|Windows PowerShell-whatif 引数が正しくない DNS サーバー情報を返します|  
|問題の症状|使用する場合、**-whatif**引数には、暗黙的または明示的なドメイン コントローラーを構成するときに**- installdns: $true**、出力します。<br /><br />コード -"DNS サーバー: なし"|  
|解決策と説明|無視します。 DNS がインストールされ正しく構成されています。|  
  
|||  
|-|-|  
|問題|昇格の後、ログオンは「のに十分な記憶域ではこのコマンドを処理する使用可能な」で失敗します。|  
|問題の症状|ログオフし、新しいドメイン コントローラーを昇格し、対話的にログオンしようとしています、エラーが表示されます。<br /><br />コード - のに十分な記憶域がこのコマンドを実行するには|  
|解決策と説明|ドメイン コントローラーを昇格の後、エラーのため、いずれかのリブートしなかったか、Windows PowerShell の ADDSDeployment 引数を指定したため**- norebootoncompletion**します。 ドメイン コントローラーを再起動します。|  
  
|||  
|-|-|  
|問題|[次へ] ボタンは [ドメイン コントローラー オプション] ページで利用できません。|  
|問題の症状|パスワードを設定する場合でも、**[次へ]**のボタンでは、**ドメイン コントローラー オプション**ページ サーバー マネージャーでは利用できません。 サイトに記載がない、**サイト名**メニュー。|  
|解決策と説明|複数の AD DS サイトがあり、少なくとも 1 つにサブネット; がありません。この未来のドメイン コントローラーは、それらのサブネットのいずれかに属しています。 サイト名] ドロップダウン メニューから手動でサブネットを選択する必要があります。 また DSSITE.MSC または使用して、次の Windows PowerShell コマンドをすべて検索するのには、不足しているサブネットをサイトします。<br /><br />コード - get adreplicationsite-フィルター *-プロパティ サブネット & #124;where-object {! $_.subnets-eq"\ *"} & #124 です。表の書式設定名|  
  
|||  
|-|-|  
|問題|昇格または降格が失敗した場合と、メッセージ「サービスを開始できません」|  
|問題の症状|昇格、降格、またはドメイン コントローラーの複製しようとすると、エラーが表示されます。<br /><br />コード - は、サービスを開始することはできません、いずれかになっているため無効になっているか、それを持たない有効なデバイスが関連付けられている"(0x80070422)<br /><br />エラーは、対話型可能性があります、イベント、または dcpromoui.log や dcpromo.log といったログに書き込まれました。|  
|解決策と説明|DS 役割サーバー サービス (DsRoleSvc) が無効です。 既定では、このサービスは AD DS の役割のインストール中にインストールされているし、手動で開始の種類に設定します。 このサービスを無効にしないでください。 これを手動に設定して、DS 役割の操作を開始およびオンデマンドで停止することを許可します。 この動作は仕様です。|  
  
|||  
|-|-|  
|問題|サーバー マネージャーが引き続き DC を降格する必要があることを警告します。|  
|問題の症状|非推奨の dcpromo.exe/unattend を使用してドメイン コントローラーを昇格するか、または場所に既存の Windows Server 2008 R2 ドメイン コントローラーを Windows Server 2012 にアップグレードする場合は、サーバー マネージャーであっても、展開後の構成タスク**このサーバーのドメイン コントローラーを昇格**します。|  
|解決策と説明|展開後の警告のリンクをクリックし、メッセージが消えます。 これは、表面的なと、予期されたものです。|  
  
|||  
|-|-|  
|問題|サーバー マネージャーの展開スクリプトの役割のインストールがありません。|  
|問題の症状|サーバー マネージャーを使用してドメイン コントローラーを昇格し、Windows PowerShell 展開スクリプトを保存するは含まれません役割インストールのコマンドレットと引数 (install-windowsfeature-ad ドメイン-サービス includemanagementtools の名前)。 役割がないと、DC を構成することはできません。|  
|解決策と説明|そのコマンドレットを手動で追加して、スクリプトの引数。 これは正常な動作、設計します。|  
  
|||  
|-|-|  
|問題|サーバー マネージャーの展開スクリプトが PS1 という名前のないです。|  
|問題の症状|サーバー マネージャーを使用してドメイン コントローラーを昇格し、Windows PowerShell 展開スクリプトを保存すると、ランダムな一時名とは、PS1 ファイルではなくファイルの名前はします。|  
|解決策と説明|手動でファイルの名前を変更します。 これは正常な動作、設計します。|  
  
|問題|Dcpromo/unattend ではサポートされない機能レベル|  
|-|-|  
|問題の症状|Dcpromo/unattend を使用して、次のサンプル応答ファイルを使用してドメイン コントローラーに昇格する: 場合<br /><br />コード-<br /><br />[DCInstall]<br />新しいフォレストを =<br /><br />ReplicaOrNewDomain = ドメイン<br /><br />NewDomainDNSName corp.contoso.com を =<br /><br />SafeModeAdminPassword =Safepassword@6<br /><br />DomainNetbiosName corp を =<br /><br />DNSOnNetwork = [はい]<br /><br />AutoConfigDNS = [はい]<br /><br />RebootOnSuccess NoAndNoPromptEither を =<br /><br />RebootOnCompletion = なし<br /><br />*DomainLevel = 0*<br /><br />*ForestLevel = 0*<br /><br />プロモーションは、dcpromoui.log に以下のエラーで失敗します。<br /><br />コード - dcpromoui EA4.5B8 0089 13:31:50.783 Enter CArgumentsSpec::ValidateArgument DomainLevel<br /><br />Dcpromoui EA4.5B8 008A 13:31:50.783 DomainLevel の値は 0 です。<br /><br />Dcpromoui EA4.5B8 008B 13:31:50.783 終了コードが 77<br /><br />Dcpromoui EA4.5B8 008 C 13:31:50.783 指定された引数が無効です。<br /><br />Dcpromoui EA4.5B8 008 D 13:31:50.783 終了ログ<br /><br />Dcpromoui EA4.5B8 0032 13:31:50.830 終了コードが 77<br /><br />レベル 0 は、Windows 2000 では、Windows Server 2012 でサポートされていません。|  
|解決策と説明|非推奨の dcpromo/unattend を使用して実行し、理解できることを無効な設定を指定するその後で失敗します。 これは正常な動作、設計します。|  

|問題|昇格がハングし"NTDS 設定オブジェクトを作成するのには完了しない.|  
|-|-|  
|問題の症状|レプリカの DC または RODC を昇格する場合、昇格が「NTDS 設定オブジェクトの作成」に達するとしませんやが完了するとします。 ログも更新を停止します。|  
|解決策と説明|これは、既知の問題が原因で、ビルトイン ドメイン管理者アカウントに対応するパスワードを使用してビルトイン ローカル Administrator アカウントの資格情報を提供することです。 これにより、障害ダウン中核となるセットアップ エンジンがエラーではなく、代わりに無期限に待機します (疑似ループ)。 これは -、- 望ましくありません動作します。<br /><br />サーバーを修正するには。<br /><br />1。再起動します。<br /><br />1. AD、でそのサーバーのメンバーのコンピューター アカウント (はまだできません DC アカウント) を削除します。<br /><br />1。そのサーバーに強制的に切り離し、ドメインから<br /><br />1。そのサーバーで、AD DS の役割を削除します。<br /><br />1。再起動<br /><br />1 再追加、AD DS の役割と再試行昇格を常に提供すること、***domain \admin***形式の資格情報を DC 昇格し、ビルトイン ローカル administrator アカウントだけでなく。|  
