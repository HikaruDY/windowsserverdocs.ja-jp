---
title: 証明書を AD FS のトラブルシューティング
description: このドキュメントでは、一般的な証明書の問題について説明します。
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 02/21/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 42fdce936bb4a6f25b456c4a96c7b99f650e6033
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59860583"
---
# <a name="ad-fs-troubleshooting---certificates"></a>証明書を AD FS のトラブルシューティング
AD FS では、正常に動作するために次の証明書が必要です。  設定されているまたは正しく構成されているこれらのいずれかがいない場合、問題が発生します。  

## <a name="required-certificates"></a>必要な証明書
AD FS では、次の証明書が必要です。



- **フェデレーションの信頼**– 相互に信頼されたインターネット ルート証明機関 (CA) にチェーンされている、いずれか証明書が、要求プロバイダーとフェデレーション サーバー、証明書利用者の信頼されたルート ストアに存在する必要があります、クロス証明のデザインは、それぞれの側が、パートナーとそのルート CA を交換したりする適切な場所にそれぞれの側でインポートされた証明書が自己署名に実装されています。
- **トークン署名**– フェデレーション サービスの各コンピューターには、トークン署名証明書が必要です。  証明書利用者のパーティのフェデレーション サーバーは、要求プロバイダーのトークン署名証明書を信頼する必要があります。 証明書利用者でのパーティのトークン署名証明書は、RP のフェデレーション サーバーからトークンを受信するすべてのアプリケーションによって信頼する必要があります。
- **Secure Sockets Layer (SSL)** – フェデレーション サービスの SSL 証明書は、フェデレーション サーバー プロキシ コンピューターの信頼されたストアに存在する必要があり、信頼された証明機関 (CA) ストアに有効なチェーンを持ちます。
- **証明書の失効リスト (CRL)** – 証明書が CRL を発行すると、CRL にアクセスできなければなりませんすべてのクライアントとサーバー証明書にアクセスする必要があります。

上記のいずれかが正しく構成されていないと AD FS は機能しません。

## <a name="common-things-to-check-with-certificates"></a>一般的な証明書チェック事項
次に発生し、証明書の問題を解決しようとするときに確認するかの機能の一覧を示します。

- 証明書が信頼されていることを確認します。
    - SSL 証明書は、クライアントによって信頼されている必要があります。
    - トークン署名証明書を証明書利用者の信頼されている必要があります。
- 信頼チェーンのチェーンを有効にするニーズを満たすすべての証明書を確認します。
- 証明書の有効期限を確認します。
- 証明書失効リスト (CRL) のアクセシビリティを確認します。
    - CDP フィールドが設定されているかどうかを確認します。
    - 手動で CDP 参照します。
- 証明書が失効していないことを確認します。

## <a name="common-certificate-errors"></a>証明書の一般的なエラー
次の表では、一般的なエラーと考えられる原因の一覧を示します。

|event|原因|解決方法
|-----|-----|-----|
|イベント - 249 証明書を見つかりませんでした、証明書ストア。 証明書のロール オーバー シナリオでこの遅れる可能性があります、障害がフェデレーション サービスの署名またはこの証明書を使用して復号化するときにします。|対象の証明書がローカル証明書ストアに存在しないか、サービス アカウントには、証明書の秘密キーへのアクセス許可はありません。|証明書がインストールされていることを確認します。 AD FS サーバーで localmachine \my ストア。 AD FS サービス アカウントに証明書の秘密キーへの読み取りアクセスしてください。|
|イベント 315 - 署名証明書の要求プロバイダー信頼の証明書チェーンの構築の試行中にエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書は、有効期限が切れてまたは有効になっていません。|証明書が有効で、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 316 - 署名証明書利用者の証明書チェーンの構築の試行中にエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書は、有効期限が切れてまたは有効になっていません。|証明書が有効で、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 317 - 証明書利用者のパーティの信頼の暗号化証明書の証明書チェーンの構築の試行中にエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書は、有効期限が切れてまたは有効になっていません。|証明書が有効で、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|クライアント証明書の証明書チェーンの構築中、イベント 319-エラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書は、有効期限が切れてまたは有効になっていません。|証明書が有効で、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 360 - 要求が、証明書のトランスポート エンドポイントが要求にクライアント証明書が含まれていません。|クライアント証明書を発行した CA のルートは、信頼されていません。</br></br>クライアント証明書の期限が切れています。</br></br>クライアント証明書が自己署名、信頼されていません。|クライアント証明書を発行した CA のルートが信頼されたルート ストアに存在することを確認します。</br></br>クライアント証明書の期限が切れていないことを確認します。</br></br>クライアント証明書が自己署名入りの場合、信頼された証明書の一覧に追加されたことを確認または自己署名証明書を信頼された証明書に置き換えます。|
|イベント 374 - 暗号化証明書を信頼を要求プロバイダーの証明書チェーンをビルド中にエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書は、有効期限が切れてまたは有効になっていません。|証明書が有効で、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント - 381 構成証明書の証明書チェーンの構築の試行中にエラーが発生しました。|AD FS サーバー用に構成された証明書のいずれかの有効期限が切れてか、失効しています。|構成されているすべての証明書が失効していないし、有効期限が切れていないことを確認してください。|
|イベント 385 - AD FS は、AD FS 構成データベース内の 1 つまたは複数の証明書を手動で更新する必要があることが検出されました。|有効期限が切れた証明書を AD FS サーバーで使用するための構成のいずれかまたはその有効期限が近づいています。|期限切れまたは間もなく-に-有効期限が切れる証明書の更新に置換します。 (自己署名証明書を使用している証明書の自動ロール オーバーが有効になっている場合は、このエラーが無視されます自己解決には。)|
|イベント 387 - AD FS では、1 つ以上のフェデレーション サービスで指定されている証明書に、AD FS Windows サービスで使用されるサービス アカウントにアクセスできたしない検出されました。|AD FS サービス アカウントには、1 つまたは複数構成されている証明書の秘密キーに読み取りアクセス許可がありません。|AD FS サービス アカウントが構成されているすべての証明書の秘密キーへのアクセス許可を読み取ることを確認します。|
|イベント 389 - AD FS では、1 つ以上の信頼関係がその証明書が期限切れまたは期限切れが迫っているため、手動で更新するを必要と検出されました。|構成されているパートナーの証明書のいずれかが期限切れまたは有効期限が近づいてします。 これは、要求プロバイダー信頼または証明書利用者信頼を適用できます。|この信頼を手動で作成した場合は、証明書の構成を手動で更新します。 フェデレーション メタデータを使用して信頼を作成した、パートナー、証明書を更新すると、すぐに、証明書に自動的に更新されます。|




## <a name="next-steps"></a>次の手順

- [AD FS のトラブルシューティング](ad-fs-tshoot-overview.md)
 