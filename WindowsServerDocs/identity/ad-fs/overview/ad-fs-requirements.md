---
ms.assetid: 28f4a518-1341-4a10-8a4e-5f84625b314b
title: "AD FS 2016 の要件"
description: "Active Directory フェデレーション サービスをインストールするための要件。"
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 03/06/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 81b51c751d5f54436b14450ef21bf49feb864290
ms.sourcegitcommit: 556361fe7c73c75d6cdc46a67dc88679fbe89c61
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/08/2018
---
# <a name="ad-fs-requirements"></a>AD FS の要件

>Windows Server 2016 の適用対象:

AD FS を展開するための要件を次に示します。  
  
-   [証明書の要件](ad-fs-requirements.md#BKMK_1)  
  
-   [ハードウェア要件](ad-fs-requirements.md#BKMK_2)  
  
-   [プロキシの要件](ad-fs-requirements.md#BKMK_3)  
  
-   [AD DS の要件](ad-fs-requirements.md#BKMK_4)  
  
-   [構成データベースの要件](ad-fs-requirements.md#BKMK_5)  
  
-   [ブラウザーの要件](ad-fs-requirements.md#BKMK_6)  

-   [ネットワークの要件](ad-fs-requirements.md#BKMK_7)  
  
-   [アクセス許可の要件](ad-fs-requirements.md#BKMK_13)  
  
## <a name="BKMK_1"></a>証明書の要件  
  
### <a name="ssl-certificates"></a>SSL 証明書

各 AD FS と Web アプリケーション プロキシ サーバーは、フェデレーション サービスに HTTPS 要求をサービスする SSL 証明書。  Web アプリケーション プロキシは、公開されたアプリケーションへのサービス要求に追加の SSL 証明書を持つことができます。

**推奨事項:**すべての AD FS フェデレーション サーバーと Web アプリケーション プロキシの同じ SSL 証明書を使用します。 

**要件:**

フェデレーション サーバーで SSL 証明書は、次の要件を満たす必要があります。
- 証明書が公開されている信頼して (実稼働展開の場合)
- 証明書には、サーバー認証拡張キー使用法 (EKU) の値が含まれています。
- 証明書には、フェデレーション サービス名サブジェクトまたはサブジェクトの別名 (SAN) で"fs.contoso.com"などにはが含まれています。
- 証明書にはポート 443 でユーザー証明書の認証には「certauth。\ < フェデレーション サービスの名前 \/>」、"certauth.fs.contoso.com"SAN のなどが含まれています
- デバイスの登録または前の Windows 10 クライアントを使用して内部設置型のリソースを最新の認証では、SAN は「enterpriseregistration。\ < upn suffix\ >」使用中の各 UPN サフィックスを組織内に含める必要があります。

Web アプリケーション プロキシで SSL 証明書は、次の要件を満たす必要があります。
- 統合 Windows 認証、プロキシの SSL 証明書を使用する AD FS プロキシ要求が (同じキーを使用) と同じフェデレーション サーバーの SSL 証明書をする必要があります、プロキシを使用する場合
- プロキシの SSL 証明書が (同じキーを使用) と同じフェデレーション サーバーの SSL 証明書をする必要があります"ExtendedProtectionTokenCheck"は、AD FS プロパティには、(既定の AD FS で設定) が有効な場合、
- それ以外の場合、プロキシの SSL 証明書の要件は、フェデレーション サーバーの SSL 証明書のものと同じです。

### <a name="service-communication-certificate"></a>サービス通信証明書
この証明書は不要なほとんどの AD FS シナリオなどの Azure AD および Office 365 します。 既定では、AD FS は、サービス通信証明書と初期構成時に提供された SSL 証明書を構成します。

**推奨事項:**
- SSL を使用するように、同じ証明書を使用します。  

### <a name="token-signing-certificate"></a>トークン署名証明書
この証明書は、証明書利用者のパーティ アプリケーションで証明書を認識する必要があり、それに関連する既知および信頼される側とキーの証明書利用者のパーティに発行される署名が使用されるトークンはします。 期限切れとするなど、トークンの署名証明書変更は、新しい証明書を構成するときにすべての証明書利用者のパーティを更新する必要があります。

**推奨事項:**、内部生成、AD FS の既定の自己署名トークン署名証明書を使用します。  

**要件:**
- 組織では、トークンの署名証明書をエンタープライズ PKI を使用することを必要とする場合は、これを行う SigningCertificateThumbprint Install-AdfsFarm コマンドレットのパラメーターを使用します。
- 既定で生成される内部で証明書を使用するか、またはしたトークン署名証明書が変更されたときに、証明書を外部で登録されているかどうかは必要があります証明書利用者のすべての当事者は、新しい証明書情報で更新を確認します。  それ以外の場合、更新されていない証明書利用者の関係者へのログオンは失敗します。

### <a name="token-encryptingdecrypting-certificate"></a>トークン暗号化/暗号化解除証明書
この証明書は、AD FS に発行されたトークンを暗号化している要求プロバイダーによって使用されます。

**推奨事項:**、内部生成、AD FS の既定の証明書の暗号化を解除する自己署名トークンを使用します。  

**要件:**
- 組織では、トークンの署名証明書をエンタープライズ PKI を使用することを必要とする場合は、これを行う DecryptingCertificateThumbprint Install-AdfsFarm コマンドレットのパラメーターを使用します。
- 既定で生成される内部で証明書を使用するか、またはする証明書の暗号化を解除トークンが変更されたときに、証明書を外部で登録されているかどうかは必要がありますすべての要求プロバイダーは、新しい証明書情報で更新を確認します。  それ以外の場合、ログオンは、要求プロバイダーが更新されていないのいずれかを使用しては失敗します。
  
> [!CAUTION]  
> Token\ 署名証明書と token\ decrypting\/暗号化に使用される証明書は、フェデレーション サービスの安定性にとって重要です。 これらの証明書がバックアップし、ご利用いただけません個別に回復イベント中に、ユーザー独自の token\ 署名 & token\ decrypting\/暗号化証明書を管理する必要がありますを確認します。  

### <a name="user-certificates"></a>ユーザー証明書
- ときに、x509 ユーザー証明書の認証 AD FS では、すべてのユーザー証明書を使用する必要がありますまでチェーンでつながって AD FS と Web アプリケーション プロキシ サーバーによって信頼されているルート証明機関を使用します。

## <a name="BKMK_2"></a>ハードウェア要件  
AD FS と Web アプリケーション プロキシのハードウェア要件 (物理または仮想) は、容量を処理するため、ファームのサイズを変更する必要がありますので、CPU のゲートはします。  
- 使用して、[AD FS 2016 キャパシティ プランニング スプレッドシート](http://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)に必要な AD FS と Web アプリケーション プロキシ サーバーの数を特定します。

AD FS のメモリとディスク要件は、非常に静的な次の表を参照してください。


|**ハードウェアの要件**|**最小要件**|**推奨要件**|
|----- | ----- |-----|
|RAM|2 GB|4 GB |
|ディスク領域|32 GB|100 GB |

**SQL Server のハードウェア要件**

AD FS 構成データベースを SQL Server を使用している場合、最も基本的な SQL Server の推奨事項に従って、SQL Server のサイズします。  AD FS データベースのサイズが非常に小さいと AD FS は、データベース インスタンスに大きな処理負荷を配置しません。  AD FS は、ただし、データベースに接続複数回、認証時にネットワーク接続は、堅牢なする必要がありますようにします。  残念ながら、AD FS 構成データベース用の SQL Azure はサポートされていません。
  
## <a name="BKMK_3"></a>プロキシの要件  
  
-   エクストラネット アクセスは、Web アプリケーション プロキシ役割サービスを展開する必要があります \ - リモート アクセス サーバーの役割の一部です。 

-   サード パーティ製プロキシをサポートする必要があります、[MS ADFSPIP プロトコル](https://msdn.microsoft.com/en-us/library/dn392811.aspx)に AD FS プロキシとしてサポートされます。  サード パーティの一覧のベンダーを参照してください、[よく寄せられる質問](AD-FS-FAQ.md#what-third-party-proxies-are-available-for-ad-fs-that-support-ms-adfspip)します。

-   AD FS 2016 では、Windows Server 2016 で Web アプリケーション プロキシ サーバーが必要です。  2016 ファーム動作レベルで実行されている AD FS 2016 ファームのダウンレベル プロキシを構成することはできません。
  
-   同じコンピューターに、フェデレーション サーバーと Web アプリケーション プロキシ役割サービスをインストールすることはできません。  
  
## <a name="BKMK_4"></a>AD DS の要件  
**ドメイン コントローラーの要件**  
  
- AD FS では、Windows Server 2008 以降を実行しているドメイン コントローラーが必要です。

- 少なくとも 1 つの Windows Server 2016 ドメイン コントローラーは、Microsoft Passport for Work の必要があります。
  
> [!NOTE]  
> Windows Server 2003 ドメイン コントローラを備えた環境のすべてのサポートが終了しました。 参照してください[このページ](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO)マイクロソフト サポート ライフ サイクルの詳細についてはします。  
  
**ドメイン functional\ レベルの要件**  
  
 - すべてのユーザー アカウントのドメインと AD FS サーバーが参加しているドメインは、Windows Server 2003 以上のドメイン機能レベルで動作する必要があります。  
  
 - Windows Server 2008 ドメインの機能レベル、またはそれ以上はクライアント証明書の認証に必要な AD DS で、ユーザーのアカウントに、証明書が明示的にマップされている場合です。  
  
**スキーマの要件**  
  
-   AD FS 2016 の新しいインストールでは、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。

-   2016 レベルに AD FS ファームの動作の (FBL) レベルを上げるには、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。  

  
**サービス アカウントに関する要件**  
  
-   任意の標準のドメイン アカウントは、AD FS 用のサービス アカウントとして使用できます。 グループの管理されたサービス アカウントもサポートされます。 実行時に必要なアクセス許可は、AD FS を構成するときに自動的に追加されます。

-   グループの管理されたサービス アカウントでは、少なくとも 1 つのドメイン コントローラーが Windows Server 2012 またはそれ以降を実行している必要があります。  GMSA は、既定の live をする必要があります"CN = 管理されたサービス アカウントのコンテナーです。  

-   Kerberos 認証のサービス プリンシパル名 '`HOST/<adfs\_service\_name>`' AD FS サービス アカウントを登録する必要があります。 既定では、AD FS は構成この新しい AD FS ファームを作成するときにします。  これが失敗した場合など、衝突や十分なアクセス許可がある場合、警告が表示されますおよび手動で追加する必要があります。  
   
**ドメインの要件**  
  
-   すべての AD FS サーバーは、AD DS ドメインに参加する必要があります。  
  
-   ファーム内のすべての AD FS サーバーは、同じドメインに展開する必要があります。  
   
**マルチ フォレストの要件**  
  
-   AD FS サーバーが参加しているドメインは、すべてのドメインまたは AD FS サービスへの認証のユーザーを含むフォレストを信頼しなければなりません。  

-   AD FS サービス アカウントは、のメンバーであると、フォレストでは、すべてのユーザー ログインのフォレストを信頼する必要があります。 
  
-   AD FS サービス アカウントを AD FS サービスへのユーザーの認証を含むすべてのドメインにユーザーの属性を読み取るアクセス許可が必要です。  
  
## <a name="BKMK_5"></a>構成データベースの要件  
このセクションでは、要件とそれぞれ、Windows Internal Database (WID) または SQL Server データベースとして使用する AD FS ファームの制限について説明します。  
  
**WID**  
  
-   WID ファームでは、SAML 2.0 のアーティファクト解決プロファイルがサポートされていません。    

-   トークン リプレイ検出では、WID ファームをサポートします。 (この機能は AD FS のフェデレーション プロバイダーとして機能して外部要求プロバイダーからのセキュリティ トークンを消費しているシナリオでのみのみ使用)。  
  
次の表は、AD FS サーバーの数はの概要を示します WID vs で SQL Server ファームはサポートされています。    
  
  
|| 1 ~ 100 (RP) 信頼の AD FS で構成されている証明書利用者 | 100 を超える RP 信頼関係が構成されています。  |
| --- |--- | --- |
|1-30 AD FS サーバー|WID のサポート|WID の必要な SQL Server を使用してサポートされていません |
|複数の 30 AD FS サーバー|WID の必要な SQL Server を使用してサポートされていません|WID の必要な SQL Server を使用してサポートされていません  
  
**SQL Server**  
  
- Windows Server 2016 での AD FS、SQL Server 2008 およびそれ以降のバージョンがサポートされています。

- SQL Server ファームでは、SAML アーティファクト解決およびトークン リプレイ検出の両方がサポートされます。  
  
## <a name="BKMK_6"></a>ブラウザーの要件  
ブラウザーまたはブラウザー コントロールを使用して AD FS の認証が実行されると、お使いのブラウザーは、次の要件に従う必要があります。  
  
-   JavaScript を有効にする必要があります。  
  
-   シングル サインオンの Cookie を許可するようにクライアントのブラウザーを構成する必要があります。  
  
-   Server Name Indication \(SNI\) がサポートされている必要があります。  
  
-   ユーザー証明書とデバイスの証明書認証のブラウザーが SSL クライアント証明書の認証をサポートする必要があります。  

-   Windows 統合認証を使用してサインオンのシームレスなローカル イントラネット ゾーンまたは信頼済みサイト ゾーンでフェデレーション サービス名 (https:\/\/fs.contoso.com) などを構成する必要があります。
## <a name="BKMK_7"></a>ネットワークの要件  
 
**ファイアウォールの要件**  
  
Web アプリケーション プロキシとフェデレーション サーバー ファーム間にあるファイアウォールと、クライアントと Web アプリケーション プロキシの間のファイアウォールの両方に TCP ポート 443 を有効になっている必要があります受信します。  
  
さらに、クライアント ユーザー証明書の認証場合 \ (X509 を使用して認証をし用 clientTLS ユーザー certificates\) が必要なポート 443 で certauth エンドポイントが有効になっていないとは、AD FS 2016 では、TCP ポート 49443 を有効にする必要があります、クライアントと Web アプリケーション プロキシの間のファイアウォールの受信します。 これは不要で Web アプリケーション プロキシと、フェデレーション \software\microsoft\sms\components\sms_site_component_manager\component servers \ 間のファイアウォール) です。 

ハイブリッド ポートに関する追加情報の要件を参照してください[ハイブリッドの ID のポートとプロトコル](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-ports)します。 

詳細についてを参照してください[Active Directory フェデレーション サービスのセキュリティ保護に関するベスト プラクティス。](..\deployment\Best-Practices-Securing-AD-FS.md)
  
**DNS の要件**  
  
-   イントラネット アクセスでは、すべてのクライアントが企業内部ネットワーク \(intranet\) 内での AD FS サービスへのアクセスできる必要がありますまたは AD FS サーバーの AD FS サーバーのロード バランサーに AD FS サービス名を解決するのには。  
  
-   エクストラネット アクセスは、すべてのクライアントが企業ネットワーク \(extranet\/internet\) の外部から AD FS サービスへのアクセスできる必要があります Web アプリケーション プロキシ サーバーまたは Web アプリケーション プロキシ サーバーをロード バランサーに AD FS サービス名を解決するのには。  
  
-   境界ネットワーク内の各 Web アプリケーション プロキシ サーバーは、AD FS サーバーまたは AD FS サーバーのロード バランサーに AD FS サービス名を解決できる必要があります。 これは、代替 DNS サーバーを使用して、境界ネットワークのネットワークまたは HOSTS ファイルを使用して、ローカル サーバーの解像度を変更することで実現できます。  
  
-   Windows 統合認証をフェデレーション サービス名の DNS A レコード \(not CNAME\) を使用する必要があります。  

-   ポート 443 でユーザー証明書認証をフェデレーション サーバーまたは Web アプリケーション プロキシを解決するのには DNS に「certauth。\ < フェデレーション サービスの名前 \/>」を構成する必要があります。

-   デバイスの登録または前の Windows 10 クライアントを使用して内部設置型のリソースを最新の認証では、フェデレーション サーバーまたは Web アプリケーション プロキシを解決するのには「enterpriseregistration。\ < upn suffix\ >」を組織内の使用中の各 UPN サフィックスを構成する必要があります。

**ロード バランサーの要件**
- ロード バランサーは SSL を終了します。 AD FS では、複数のユース ケースと SSL を終了するときに分割する証明書認証をサポートします。 任意のユース ケースのロード バランサーで SSL を終了することはできません。 
- SNI をサポートしているロード バランサーを使用することをお勧めします。 イベントそうでない 0.0.0.0 フォールバック バインドを使用して AD FS で]、[Web アプリケーション プロキシ サーバーは、回避策を提供する必要があります。
- HTTP (HTTPS ではない) の正常性プローブ エンドポイントを使用してトラフィックをルーティングのロード バランサーの正常性チェックを実行することをお勧めします。 これは、SNI に関連する問題を回避できます。 これらのプローブ エンドポイントへの応答は HTTP 200 OK、バックエンド サービス依存しない付きにローカルで配信されます。 ' Adfs/プローブ' パスを使用して HTTP 経由でアクセスできる、HTTP プローブ
    - http://&lt;Web アプリケーション プロキシの名前&gt;adfs/プローブ
    - http://&lt;ADFS サーバー名&gt;adfs/プローブ
    - http://&lt;Web アプリケーション プロキシの IP アドレス&gt;adfs/プローブ
    - http://&lt;ADFS の IP アドレス&gt;adfs/プローブ
- DNS を使用することは推奨されていない負荷を分散する方法としてラウンド ロビンします。 この種類の負荷分散を使用する場合は、自動化された正常性プローブを使用して、ロード バランサーからノードを削除する方法は提供されません。 
- またはを使用する IP ベースのセッションのアフィニティ付箋セッションへのロード バランサー内での AD FS の認証トラフィックは推奨されません。 Office 365 のメール サービス (Exchange Online) への接続にメール クライアントの以前の認証プロトコルを使用する場合は、特定のノードのオーバー ロードが発生することができます。 

## <a name="BKMK_13"></a>アクセス許可の要件  
インストールと AD FS の初期構成を実行する管理者は、AD FS サーバーのローカル管理者のアクセス許可が必要です。  ドメイン管理者まず必要がありますが、ローカルの管理者が Active Directory でオブジェクトを作成するアクセス許可を持たない場合、必要な AD オブジェクトを作成し、AdminConfiguration パラメーターを使用して AD FS ファームを構成します。  
  
  

