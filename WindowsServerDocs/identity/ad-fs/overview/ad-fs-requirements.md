---
ms.assetid: 28f4a518-1341-4a10-8a4e-5f84625b314b
title: AD FS 2016 の要件
description: Active Directory フェデレーション サービスをインストールするための要件。
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 03/06/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: e62032533b15ec3d93896d242273612faafdca58
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/31/2019
ms.locfileid: "66444101"
---
# <a name="ad-fs-requirements"></a>AD FS の要件



AD FS を展開するための要件を次に示します。  
  
-   5. コマンド プロンプトで、「[ipconfig /all](ad-fs-requirements.md#BKMK_1)」と入力して Enter キーを押します。  
  
-   [ハードウェア要件](ad-fs-requirements.md#BKMK_2)  
  
-   [プロキシの要件](ad-fs-requirements.md#BKMK_3)  
  
-   [AD DS の要件](ad-fs-requirements.md#BKMK_4)  
  
-   [構成データベースの要件](ad-fs-requirements.md#BKMK_5)  
  
-   [ブラウザーの要件](ad-fs-requirements.md#BKMK_6)  

-   [ネットワークの要件](ad-fs-requirements.md#BKMK_7)  
  
-   [アクセス許可の要件](ad-fs-requirements.md#BKMK_13)  
  
## <a name="BKMK_1"></a>証明書の要件  
  
### <a name="ssl-certificates"></a>SSL 証明書

各 AD FS および Web アプリケーション プロキシ サーバーが、フェデレーション サービスに HTTPS 要求をサービスする SSL 証明書。  Web アプリケーション プロキシは、公開されたアプリケーションへのサービス要求に追加の SSL 証明書を持つことができます。

**推奨事項:** すべての AD FS フェデレーション サーバーと Web アプリケーション プロキシを同じ SSL 証明書を使用します。 

**要件:**

フェデレーション サーバーで SSL 証明書は、次の要件を満たす必要があります。
- 証明書が公開されている、(運用環境のデプロイ) の信頼
- 証明書には、サーバーの認証拡張キー使用法 (EKU) の値が含まれています。
- 証明書にはサブジェクトまたはサブジェクト代替名 (SAN) には、"fs.contoso.com"などのフェデレーション サービス名が含まれています
- ポート 443 でユーザー証明書認証、証明書が含まれています"certauth します。\<フェデレーション サービス名\>"、"certauth.fs.contoso.com"で、SAN など
- デバイスの登録や windows 10 の以前のクライアントを使用してオンプレミスのリソースを最新の認証では、SAN が"enterpriseregistration を含める必要があります。\<upn サフィックス\>"の各 UPN サフィックスを組織で使用するには。

Web アプリケーション プロキシで SSL 証明書は、次の要件を満たす必要があります。
- プロキシを使用する場合、プロキシの SSL 証明書、Windows 統合認証を使用する AD FS プロキシ要求する必要がありますと同じである (同じキーを使用して) フェデレーション サーバーの SSL 証明書
- プロキシの SSL 証明書が (同じキーを使用) と同じフェデレーション サーバーの SSL 証明書をする必要があります (既定の AD FS で設定) が"ExtendedProtectionTokenCheck"は、AD FS プロパティに有効な場合
- それ以外の場合、プロキシの SSL 証明書の要件は、フェデレーション サーバーの SSL 証明書のものと同じ

### <a name="service-communication-certificate"></a>サービス通信証明書
この証明書が Azure AD を含むほとんどの AD FS のシナリオに必要な Office 365 とします。 既定では、AD FS は、サービス通信証明書として初期構成時に提供された SSL 証明書を構成します。

**推奨事項:**
- SSL を使用して、同じ証明書を使用します。  

### <a name="token-signing-certificate"></a>トークン署名証明書
この証明書は、証明書利用者のパーティに発行されたトークンに署名証明書利用者アプリケーションは、証明書を認識する必要があり、として既知または信頼されたキーが関連付けられているために使用されます。 期限切れにして、対応するなど、トークンの署名証明書変更が新しい証明書を構成する場合は、すべての証明書利用者のパーティを更新する必要があります。

**推奨事項:** AD FS の既定では、内部的に生成され、自己署名のトークン署名証明書を使用します。  

**要件:**
- 組織では、トークンの署名エンタープライズ PKI からの証明書を使用することが必要です場合、これを実行できるインストール AdfsFarm コマンドレットの SigningCertificateThumbprint パラメーターを使用します。
- 内部的に生成される既定の証明書を使用するか、外部をトークン署名証明書が変更されたときに、証明書を登録するかどうかは、すべて証明書利用者が新しい証明書情報で更新されたことを確認する必要があります。  それ以外の場合、更新されない証明書利用者の関係者へのログオンは失敗します。

### <a name="token-encryptingdecrypting-certificate"></a>トークン暗号化/復号化証明書
この証明書は、AD FS に対して発行されたトークンを暗号化する要求プロバイダーによって使用されます。

**推奨事項:** AD FS の既定では、内部的に生成され、自己署名のトークン暗号化解除証明書を使用します。  

**要件:**
- 組織では、トークンの署名エンタープライズ PKI からの証明書を使用することが必要です場合、これを実行できるインストール AdfsFarm コマンドレットの DecryptingCertificateThumbprint パラメーターを使用します。
- 内部的に生成される既定の証明書を使用するか、外部するトークンの証明書を暗号化解除が変更されたときに、証明書を登録するかどうかは、すべての要求プロバイダーが新しい証明書情報で更新されることを確認する必要があります。  それ以外の場合、ログオンは、要求プロバイダーが更新されないのいずれかを使用してが失敗します。
  
> [!CAUTION]  
> トークンに使用される証明書\-署名とトークン\-復号化\/暗号化は、フェデレーション サービスの安定性に重要です。 お客様は、独自のトークンを管理\-署名 & トークン\-復号化\/暗号化の証明書をこれらの証明書がバックアップと利用できない個別に復旧イベント中を確認してください。  

### <a name="user-certificates"></a>ユーザー証明書
- 使用する x509 ユーザー証明書の認証と AD FS では、すべてのユーザー証明書は、AD FS および Web アプリケーション プロキシ サーバーによって信頼されているルート証明機関にまでチェーンする必要がある場合。

## <a name="BKMK_2"></a>ハードウェア要件  
AD FS と Web アプリケーション プロキシのハードウェア要件 (物理または仮想) は、容量を処理するため、ファームのサイズを変更する必要がありますので、cpu、ゲートは。  
- 使用して、 [AD FS 2016 の容量計画スプレッドシート](http://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)必要な AD FS と Web アプリケーション プロキシ サーバーの数を決定します。

AD FS のメモリとディスク要件が非常に静的なは、次の表を参照してください。


|**ハードウェア要件**|**最小要件**|**推奨要件**|
|----- | ----- |-----|
|RAM|2 GB|4 GB |
|ディスク領域|32 GB|100 GB |

**SQL Server のハードウェア要件**

AD FS 構成データベースを SQL Server を使用している場合は、サイズの最も基本的な SQL Server の推奨事項に従って、SQL Server を実行します。  AD FS データベースのサイズが非常に小さいと、AD FS は、データベース インスタンスでの大きな処理負荷を配置しません。  AD FS は、ただし、データベースに複数回接続、認証時にため、ネットワーク接続を堅牢にする必要があります。  残念ながら、SQL Azure では、AD FS 構成データベースのサポートされていません。
  
## <a name="BKMK_3"></a>プロキシの要件  
  
-   エクストラネット アクセスの場合、Web アプリケーション プロキシ役割サービスをデプロイする必要があります\-リモート アクセス サーバーの役割の一部です。 

-   サード パーティ製のプロキシをサポートする必要があります、 [MS ADFSPIP プロトコル](https://msdn.microsoft.com/en-us/library/dn392811.aspx)AD FS プロキシとしてサポートされます。  サード パーティの一覧の仕入先を参照してください、 [FAQ](AD-FS-FAQ.md#what-third-party-proxies-are-available-for-ad-fs-that-support-ms-adfspip)します。

-   AD FS 2016 では、Windows Server 2016 での Web アプリケーション プロキシ サーバーが必要です。  ダウンレベルのプロキシは、2016年ファーム動作レベルで実行されている AD FS 2016 ファームを構成できません。
  
-   フェデレーション サーバーと Web アプリケーション プロキシ役割サービスは、同じコンピューターにインストールすることはできません。  
  
## <a name="BKMK_4"></a>AD DS の要件  
**ドメイン コント ローラーの要件**  
  
- AD FS では、Windows Server 2008 またはそれ以降を実行しているドメイン コント ローラーが必要です。

- 少なくとも 1 つの Windows Server 2016 ドメイン コント ローラーは、Microsoft Passport for Work に必要です。
  
> [!NOTE]  
> Windows Server 2003 ドメイン コント ローラーと環境のすべてのサポートが終了しました。 参照してください[このページ](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO)マイクロソフト サポート ライフ サイクルの詳細についてはします。  
  
**ドメインの機能\-レベルの要件**  
  
 - すべてのユーザー アカウントのドメインと AD FS サーバーが参加しているドメインは、Windows Server 2003 以降のドメイン機能レベルで動作する必要があります。  
  
 - Windows Server 2008 のドメイン機能レベルまたはそれ以降が必要ですクライアント証明書の認証に AD DS でユーザーのアカウントに証明書が明示的にマップされる場合。  
  
**スキーマの要件**  
  
-   AD FS 2016 の新規インストールでは、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。

-   AD FS ファーム動作レベル (FBL) を 2016年レベルに上げるには、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。  

  
**サービス アカウントの要件**  
  
-   任意の標準のドメイン アカウントは、AD FS のサービス アカウントとして使用できます。 グループ管理サービス アカウントもサポートされます。 実行時に必要なアクセス許可は、AD FS を構成するときに自動的に追加されます。

-   AD サービス アカウントに必要なユーザー権利の割り当ては、サービスとしてログオン'

-   'NT Service\adfssrv' と' NT Service\drs' に必要なユーザー権利の割り当ては、セキュリティ監査の生成 ' と 'サービスとしてログオン' です。

-   グループ管理されたサービス アカウントには、少なくとも 1 つのドメイン コント ローラーが Windows Server 2012 以降を実行している必要があります。  既定値に存在する必要があります、GMSA ' CN = 管理されたサービス アカウントのコンテナー。  

-   Kerberos 認証の場合、サービス プリンシパル名 '`HOST/<adfs\_service\_name>`'、AD FS サービス アカウントを登録する必要があります。 既定では、AD FS はこれを構成、新しい AD FS ファームを作成するときにします。  これに失敗した場合など、競合や十分なアクセス許可は、警告が表示され、手動で追加する必要があります。  
   
**ドメインの要件**  
  
-   すべての AD FS サーバーは、AD DS ドメインに参加する必要があります。  
  
-   すべての AD FS サーバー ファーム内では、同じドメインに展開する必要があります。  
   
**マルチ フォレストの要件**  
  
-   AD FS サーバーが参加しているドメインには、すべてのドメインまたは AD FS サービスを認証するユーザーを含むフォレストを信頼する必要があります。  

-   AD FS サービス アカウントのメンバーであると、フォレストには、すべてのユーザー ログイン フォレストを信頼する必要があります。 
  
-   AD FS サービス アカウントを AD FS サービスを認証するユーザーを含むすべてのドメインのユーザー属性を読み取るアクセス許可が必要です。  
  
## <a name="BKMK_5"></a>構成データベースの要件  
このセクションでは、要件と制限事項を使用して、それぞれ、Windows Internal Database (WID) または SQL Server データベースと AD FS ファームについて説明します。  
  
**WID**  
  
-   WID ファームでは、SAML 2.0 の成果物の解像度のプロファイルはサポートされていません。    

-   トークン再生検出では、WID ファームをサポートします。 (この機能は AD FS のフェデレーション プロバイダーとして機能する方法と外部の要求プロバイダーからセキュリティ トークンの使用場所のシナリオのみでのみ使用)。  
  
な AD FS サーバーの数の概要を次の表に、SQL Server ファーム WID vs でサポートされています。    
  
  
|| 1 ~ 100 (rp) 信頼が AD FS で構成されている証明書利用者 | 100 を超えるの RP 信頼構成  |
| --- |--- | --- |
|1-30 AD FS サーバー|WID のサポート|WID のために必要な SQL Server を使用してサポートされていません |
|複数の 30年の AD FS サーバー|WID のために必要な SQL Server を使用してサポートされていません|WID のために必要な SQL Server を使用してサポートされていません  
  
**SQL Server**  
  
- Windows Server 2016 で AD fs は、SQL Server 2008 および以降のバージョンはサポートされています。

- SAML アーティファクト解決およびトークン リプレイ検出の両方が、SQL Server ファームでサポートされます。  
  
## <a name="BKMK_6"></a>ブラウザーの要件  
ブラウザーまたはブラウザー コントロールを使用して AD FS の認証が実行されると、お使いのブラウザーは、次の要件に従う必要があります。  
  
- JavaScript を有効にする必要があります。  
  
- シングル サインオンは、cookie を許可するクライアントのブラウザーを構成する必要があります。  
  
- Server Name Indication \(SNI\)サポートする必要があります  
  
- ブラウザーは、ユーザー証明書とデバイス証明書の認証、SSL クライアント証明書認証をサポートする必要があります。  

- Windows 統合認証、フェデレーション サービス名を使用してシームレスなサインオン (https など:\/\/fs.contoso.com) ローカル イントラネット ゾーンまたは信頼済みサイト ゾーンで構成する必要があります。
  ## <a name="BKMK_7"></a>ネットワークの要件  
 
**ファイアウォールの要件**  
  
Web アプリケーション プロキシとフェデレーション サーバー ファームと、クライアントと Web アプリケーション プロキシの間のファイアウォール間にある、両方のファイアウォールで TCP ポート 443 を有効になっている必要があります受信します。  
  
さらに、クライアント ユーザー証明書認証で\(X509 を使用し、clientTLS 認証ユーザー証明書\)が必要なポート 443 で certauth エンドポイントが有効でないとは、AD FS 2016 では、TCP ポート 49443 を有効にする必要がありますクライアントと Web アプリケーション プロキシの間のファイアウォールで受信します。 これは、Web アプリケーション プロキシとフェデレーション サーバーの間のファイアウォールでは必要ありません\)します。 

ハイブリッド ポートに関する追加情報の要件を参照してください[Hybrid Identity ポートとプロトコル](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-ports)します。 

追加情報を参照してください[Active Directory フェデレーション サービスをセキュリティで保護するためのベスト プラクティス。](../deployment/Best-Practices-Securing-AD-FS.md)
  
**DNS の要件**  
  
-   AD FS にアクセスするすべてのクライアントが企業内部ネットワーク内でサービスをイントラネット アクセスで\(イントラネット\)AD FS サーバーまたは AD FS サーバーのロード バランサーに、AD FS サービス名を解決できる必要があります。  
  
-   エクストラネット アクセスは、AD FS にアクセスするすべてのクライアント サービスから企業ネットワークの外部\(エクストラネット\/インターネット\)Web アプリケーション プロキシ サーバーのロード バランサーに、AD FS サービス名を解決できる必要がありますかWeb アプリケーション プロキシ サーバー。  
  
-   境界ネットワーク内の各 Web アプリケーション プロキシ サーバーは、AD FS サーバーまたは AD FS サーバーのロード バランサーに AD FS サービス名を解決できる必要があります。 これは、DMZ ネットワークまたはホスト ファイルを使用してローカル サーバーの解像度を変更することで、代替の DNS サーバーを使用して実現できます。  
  
-   Windows 統合認証は、DNS A レコードを使用する必要があります\(CNAME ではない\)フェデレーション サービス名。  

-   "Certauth ポート 443 上のユーザー証明書認証。\<フェデレーション サービス名\>"フェデレーション サーバーまたは web アプリケーション プロキシを解決するのには DNS で構成する必要があります。

-   デバイスの登録または pre-Windows 10 クライアントでは、"enterpriseregistration を使用してオンプレミスのリソースを最新の認証。\<upn サフィックス\>"、フェデレーション サーバーまたは web アプリケーション プロキシを解決するのには、組織で使用されている場合は、各 UPN サフィックスを構成する必要があります。

**ロード バランサーの要件**
- ロード バランサー MUST NOT には、SSL が終了します。 AD FS では、複数のユース ケースと SSL の終了時に動作しなくなる証明書認証をサポートします。 ロード バランサーでの SSL の終了は、ユース ケースはサポートされていません。 
- SNI をサポートしているロード バランサーを使用することをお勧めします。 イベントのしないと、バインドの AD FS のフォールバック 0.0.0.0 を使用する]、[Web アプリケーション プロキシ サーバーは、回避策を提供する必要があります。
- HTTP (HTTPS ではなく) の正常性プローブのエンドポイントを使用して、トラフィックのルーティングのロード バランサーの正常性チェックを実行することをお勧めします。 SNI に関連する問題を回避できます。 これらのエンドポイントのプローブに応答が HTTP 200 OK は依存しないバックエンド サービスをローカルで提供されます。 パス ' プローブ/adfs/' を使用して HTTP 経由でアクセスできる HTTP プローブ
    - http://&lt;Web アプリケーション プロキシ名 &gt; /adfs/プローブ
    - http://&lt;ADFS サーバー名 &gt; /adfs/プローブ
    - http://&lt;Web アプリケーション プロキシの IP アドレス &gt; /adfs/プローブ
    - http://&lt;ADFS の IP アドレス &gt; /adfs/プローブ
- DNS の使用をお勧めいませんラウンド ロビンの負荷を分散する方法として。 この種類の負荷分散を使用して、ノードの正常性プローブを使用してロード バランサーから削除を自動化する機能は提供されません。 
- ロード バランサー内の AD FS への認証トラフィックの IP ベースのセッション アフィニティまたはスティッキー セッションを使用することは推奨されません。 メール クライアント用のレガシ認証プロトコルを使用して、Office 365 のメール サービス (Exchange Online) に接続すると、特定のノードのオーバー ロードが発生します。 

## <a name="BKMK_13"></a>アクセス許可の要件  
インストールと AD FS の初期構成を実行する管理者は、ローカル管理者のアクセス許可を AD FS サーバーが必要です。  ドメイン管理者最初にする必要がありますが、ローカルの管理者が Active Directory でオブジェクトを作成する権限を持っていない場合、必要な AD オブジェクトを作成し、AdminConfiguration パラメーターを使用して AD FS ファームを構成します。  
  
  

