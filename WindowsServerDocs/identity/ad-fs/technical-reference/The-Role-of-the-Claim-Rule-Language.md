---
title: "要求規則言語の役割"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 07/07/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: dda9d148-d72f-4bff-aa2a-f2249fa47e4c
ms.technology: identity-adfs
ms.openlocfilehash: 206da33d33cbded0450db29615dc74eb1161cbce
ms.sourcegitcommit: 84a2bdcb92ba6af45781fab9727617e50fa5e911
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/07/2017
---
>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

# <a name="the-role-of-the-claim-rule-language"></a>要求規則言語の役割
Active Directory フェデレーション サービス (AD FS) の要求規則言語は、要求エンジンは、カスタム規則を定義する要求規則言語のロジックの処理エンジンとして機能し、着信および発信のクレームの動作の管理の構成要素として機能します。 要求エンジンによってすべての規則の処理方法についてを参照してください[The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md)します。  
  
## <a name="creating-custom-claim-rules-using-the-claim-rule-language"></a>要求規則言語を使用してカスタム要求規則を作成します。  
AD FS では、要求規則言語の ID 要求の動作を決定する使用可能なカスタムの規則を定義するオプションを持つ管理者を提供します。 このトピックの「信頼性情報規則言語の構文例を使用すると、列挙、追加、削除、およびを組織のニーズを満たすために信頼性情報を変更するカスタム規則を作成します。 カスタム規則をビルドするには、要求規則言語構文でのように入力して、**カスタムの要求を使用して要求を送信する**規則テンプレート。  
  
ルールは、セミコロン (;) で互いから分離されます。  
  
詳細については、カスタム規則を使用する場合、次を参照してください。[をカスタム要求規則を使用するタイミング](When-to-Use-a-Custom-Claim-Rule.md)します。  
  
## <a name="using-claim-rule-templates-to-learn-about-the-claim-rule-language-syntax"></a>要求規則テンプレートを使用して要求規則言語構文について  
AD FS では、定義済みの要求の発行とクレームの一般的な実装に使用できるルール テンプレートを承認要求規則のセットも提供します。 **要求規則の編集**] ダイアログ ボックス、特定の信頼の定義済みの規則を作成することができます: し、その規則を構成する要求規則言語構文を表示-] をクリックして、**[規則言語の**その規則のタブ。 このセクションの情報を使用して、**[規則言語の**手法は、独自のカスタム規則を作成する方法を把握できます。  
  
詳細については、要求規則および要求規則テンプレートを参照してください。[、要求規則の役割](The-Role-of-Claim-Rules.md)します。  
  
## <a name="understanding-the-components-of-the-claim-rule-language"></a>要求規則言語のコンポーネントを理解します。  
要求規則言語で区切られた、次のコンポーネントから成る、"= >"演算子。  
  
-   条件  
  
-   発行ステートメント  
  
### <a name="conditions"></a>条件  
入力信頼性情報を確認し、規則の発行ステートメントを実行するかどうかを決定する規則の条件を使用できます。 条件を評価する必要がある論理式を表すを true に、規則の本文部分を実行します。 この部分は、不足している場合、論理 true が想定されます。つまり、規則の本文は常に実行します。 条件部分には、論理積演算子連結された条件の一覧が含まれています ("& &")。 一覧のすべての条件を評価する必要がありますの条件部分全体を評価するのには true を true に設定します。 条件には、要求選択演算子または集計関数呼び出しのいずれかを指定できます。 これら 2 つは相互に排他的要求セレクターと集約関数は、1 つの規則の条件部分に組み合わせることができません。  
  
条件は、規則では省略可能です。 たとえば、次の規則には、条件はありません。  
  
```  
=> issue(type = "http://test/role", value = "employee");  
```  
  
条件の次の 3 つの種類があります。  
  
-   単一の条件 — これは、条件の最も単純な形式です。 1 つだけ式のチェックが行われますたとえば、windows アカウント名のドメイン ユーザーを = します。  
  
-   複数の条件 — この条件には、規則の本文内の複数の式を処理するための追加チェックが必要ですたとえば、windows アカウント名ドメイン ユーザーとグループ = = contosopurchasers します。  
  
> [!NOTE]  
> もう 1 つの条件が存在するが、1 つの条件または複数の条件のいずれかのサブセットです。 これは、正規表現 (Regex) 条件と呼ばれます。 入力式を取得し、特定のパターンを持つ式に一致するために使用します。 ようにする方法の例を使用することができますを次に示します。  
  
次の例では、カスタム ルールを作成する使用することがいくつかの条件の種類に基づいて、構文構造を示しています。  
  
#### <a name="single--condition-examples"></a>1 つの条件の例  
1 つの式の条件は、次の表で説明されています。 単と指定された要求の種類、信頼性情報または指定された要求の種類で、信頼性情報を確認し、要求の値を構築します。  
  
|条件の説明|条件の構文例|  
|-------------------------|----------------------------|  
|このルールでは、入力要求が指定された要求の種類 ("http://test/name") でチェックする条件があります。 一致する要求が入力要求の場合は、ルールは、一致するクレームまたは出力要求セットに信頼性情報をコピーします。|``` c: [type == "http://test/name"] => issue(claim = c );```|  
|このルールでは、指定された要求の種類 ("http://test/name") を持つ入力要求を確認し、要求の値 ("Terry") する条件があります。 一致する要求が入力要求の場合は、ルールは、一致するクレームまたは出力要求セットに信頼性情報をコピーします。|``` c: [type == "http://test/name", value == "Terry"] => issue(claim = c);```|  
  
複数の複雑な条件は、複数信頼性情報、要求の発行者をチェックする条件および条件、正規表現パターンに一致する値をチェックする条件など、次のセクションに表示されます。  
  
#### <a name="multiple--condition-examples"></a>複数の条件の例  
次の表は、例を示します - 複数式条件のします。  
  
|条件の説明|条件の構文例|  
|-------------------------|----------------------------|  
|このルールでは、それぞれが、指定された要求の種類 ("http://test/name"と"http://test/email") を持つ 2 つの入力信頼性情報を確認する条件があります。 2 つの一致する要求が入力要求にある場合は、ルールは、出力要求セットに、その名前要求をコピーします。|``` c1: [type  == "http://test/name"] && c2: [type == "http://test/email"] => issue (claim  = c1 );```|  
  
#### <a name="regular--condition-examples"></a>正規の条件の例  
次の表は、正規表現の例を示します-ベースの条件。  
  
|条件の説明|条件の構文例|  
|-------------------------|----------------------------|  
|この規則条件を確認する e の正規表現を使用するには-メール要求で終わる"@fabrikam.com"です。 一致する要求が入力要求に見つかった場合、規則は、出力要求セットに一致するクレームをコピーします。|```c: [type  == "http://test/email", value  =~ "^. +@fabrikam.com$" ] => issue (claim  = c );```|  
  
### <a name="issuance-statements"></a>発行ステートメント  
カスタム規則は、発行ステートメントに基づいて処理されます (*問題*または*追加*)、要求規則にプログラミングしました。 目的の結果、issue ステートメントによってまたはステートメントは、入力要求セットを設定するルールに書き込まれることができます、または出力要求セットに追加します。 Add ステートメントを明示的に使用するカスタム ルールでは、問題ステートメントを使用するカスタム要求規則要求値に両方の入力要求セットと出力要求セットの設定中にクレーム セットの値の入力にのみ要求を作成します。 これは、要求規則のセットでの将来の規則でのみ使用されるものでは、要求の値と役立ちます。  
  
たとえば、次の図では、入力方向の要求は入力要求セット要求発行エンジンによってに追加されます。 最初のカスタム要求規則を実行し、ドメイン ユーザーの条件が満たされると、要求発行エンジン、add ステートメントとの値を使用して、規則のロジックを処理するときに**エディター**が入力要求セットに追加します。 エディターの値が入力要求セットに存在するため、規則 2 ことができますが正常に issue ステートメントは、そのロジックを処理しの新しい値を生成する**こんにちは**、要求セットと、によって入力要求セットの使用ルールでは、次の規則を設定するが、両方の出力に追加します。 すべての値は入力要求セットのロジックを処理するための入力としてに存在する規則 3 を使用できます。  
  
![AD FS の役割](media/adfs2_customrule.gif)  
  
#### <a name="claim-issuance-actions"></a>要求の発行操作  
規則の本文では、要求の発行操作を表します。 言語で認識される 2 つの要求の発行操作があります。  
  
-   **Issue ステートメント:** issue ステートメントは、要求のセットを入力と出力の両方に対する要求を作成します。 たとえば、次のステートメントは、入力要求セットに基づいて新しい要求を発行します。  
  
    ```c:[type == "Name"] => issue(type = "Greeting", value = "Hello " + c.value);```  
  
-   **Add ステートメント:** add ステートメントは、入力要求セットのコレクションにのみ追加される新しい要求を作成します。 たとえば、次のステートメントを入力要求セットに新しい要求を追加します。  
  
    ```c:[type == "Name", value == "domain user"] => add(type = "Role", value = "Editor");``` 
  
規則の発行ステートメントは信頼性情報がどのようになるかを定義、条件が満たされたときに、規則によって発行します。 引数とステートメントの動作に関する発行ステートメントの 2 つの形式があります。  
  
-   **標準**— 通常の発行ステートメントは、規則でリテラル値または条件に一致する要求からの値を使用して要求を発行することができます。 通常の発行ステートメントは、次の形式の一方または両方から構成されます。  
  
    -   *要求のコピー*: 要求のコピーが出力要求セット内の既存の要求のコピーを作成します。 この発行形式には、"issue"発行ステートメントと組み合わせた場合にのみ有効になります。 "Add"発行ステートメントと組み合わせると、すべての効果をありません。  
  
    -   *新しい要求*: この形式は、新しい信頼性情報、さまざまな要求プロパティの値を指定します。 Claim.Type を指定する必要があります。その他のすべての要求プロパティは省略できます。 この形式の引数の順序は無視されます。  
  
-   **属性ストア**— この形式は、属性ストアから取得される値を持つ信頼性情報を作成します。 これは、属性の取得中にネットワークまたはディスクの入出力 (I/O) 操作を行う属性ストアに重要な単一の発行ステートメントを使用して複数の要求の種類を作成すること勧めします。 そのため、ポリシー エンジンと属性ストアの間のラウンド トリップの数を制限することをお勧めします。 特定の要求の種類に対して複数の要求を作成する法的もできます。 属性ストアが戻ったとき、指定された要求の種類の複数の値、発行ステートメントは、各返された要求値の信頼性情報を自動的に作成します。 属性ストアの実装では、param 引数を使用して、param 引数に用意されている値を持つクエリ引数内のプレース ホルダーを置き換えてください。 プレース ホルダーは、.NET 渡さに関するページ () 関数 (たとえば、{1} {2} など) と同じ構文を使用します。 この発行形式の引数の順序が重要であり、次の文法に示されている順序をする必要があります。  
  
次の表では、両方の種類の要求規則の発行ステートメントのいくつかの一般的な構文構造について説明します。  
  
|発行ステートメントの種類|発行ステートメントの説明|発行ステートメントの構文例|  
|---------------------------|----------------------------------|-------------------------------------|  
|-標準|次の規則は、ユーザーが指定された要求の種類と値を所有するたびに常に同じ要求を発行します。|```c: [type  == "http://test/employee", value  == "true"] => issue (type = "http://test/role", value = "employee");```|  
|-標準|次の規則は、別に、1 つの要求の種類を変換します。 条件"c"に一致する要求の値は、発行ステートメントで使用されていることに注意してください。|```c: [type  == "http://test/group" ] => issue (type  = "http://test/role", value  = c.Value );```|  
|属性ストア|次の規則は、Active Directory 属性ストアに対するクエリの入力方向の要求の値を使用します。|```c: [Type  == "http://test/name" ] => issue (store  = "Enterprise AD Attribute Store", types  =  ("http://test/email" ), query  = ";mail;{0}", param  = c.Value )```|  
|属性ストア|次の規則は、以前に構成された Structured Query Language (SQL) 属性ストアに対するクエリの入力方向の要求の値を使用します。|```c: [type  == "http://test/name"] => issue (store  = "Custom SQL store", types  =  ("http://test/email","http://test/displayname" ), query  = "SELECT mail, displayname FROM users WHERE name ={0}", param  = c.value );```|  
  
#### <a name="expressions"></a>式  
式は、要求セレクター制約と発行ステートメント パラメーターの両方の右側にある使用されます。 この言語でサポートされる式のさまざまな種類があります。 すべての式言語では、文字列ベースのことが入力として受け取った文字列から文字列を生成します。 番号や式では、日付/時刻など、他のデータ型がサポートされていません。 この言語でサポートされる式の種類を次に示します。  
  
-   文字列リテラル: 文字列値、両側を引用符 (") で区切られました。  
  
-   式の文字列の連結: 結果は、左と右の値の連結によって生成される文字列。  
  
-   関数の呼び出し: 関数は、識別子によって識別およびカンマとして渡されるパラメーター-角かっこで囲まれた式の区切りの一覧 ("に関するページ ()")。  
  
-   変数名のドット プロパティ名の形式で要求のプロパティへのアクセス: 指定された変数の評価に対して識別された要求のプロパティの値の結果。 この方法で使用できるようにすること、変数を要求セレクターにバインド最初必要があります。 同じ要求セレクターの制約内の要求セレクターにバインドされている変数を使用することはできません。  
  
次の要求プロパティはアクセスできます。  
  
-   Claim.Type  
  
-   Claim.Value  
  
-   Claim.Issuer  
  
-   Claim.OriginalIssuer  
  
-   Claim.ValueType  
  
-   Claim.Properties\[property\_name\] (このプロパティは、プロパティ名要求のプロパティのコレクションに見つからない場合に、空の文字列を返します。 )  
  
RegexReplace 関数を使用して、式の内部を呼び出すことができます。 この関数は、入力式を受け取りし、指定されたパターンと一致します。 パターンが一致する場合、一致の出力が置換値に置き換えられます。  
  
#### <a name="exists-functions"></a>Exists 関数  
Exists 関数は、入力に存在する条件と一致するクレーム セットのことを要求するかどうかを評価する条件で使用できます。 任意の一致するクレームが存在する場合は、発行ステートメントは 1 回だけ呼び出されます。 次の例では、「原点」要求が 1 回だけ発行 — 数の信頼性情報に関係なく、発行者が"MSFT"に設定する入力要求セット コレクション内の少なくとも 1 つの要求がある場合、発行者が"MSFT"に設定します。 この関数を使用すると、重複する要求が発行されるができないようにします。  
  
```  
exists([issuer == "MSFT"])  
   => issue(type = "origin", value = "Microsoft");  
```  
  
## <a name="rule-body"></a>規則の本文  
規則の本文には、単一の発行ステートメントのみを含めることができます。 Exists 関数を使用せず条件を使用している場合、規則の本文は条件部分が一致すると時間ごとに 1 回実行されます。  
  
## <a name="additional-references"></a>その他の参照  
[カスタム規則を使用して要求を送信する規則を作成します。](https://technet.microsoft.com/library/dd807049.aspx)  
  

