---
ms.assetid: 606df285-259c-4c6b-8583-9aca1d614c43
title: "パススルーを使用する場合、or Filter Claim Rule"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: aa205c46bf67dc25a55232b799bdd39fee4ac3c6
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/03/2017
---
>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

# <a name="when-to-use-a-pass-through-or-filter-claim-rule"></a>パススルーを使用する場合、or Filter Claim Rule
このルールは、入力方向の要求の値に基づいて、特定の入力方向要求の種類を取得し、どのような出力が行う必要がありますを決定するアクションを適用する必要がある場合、\(AD FS\) Active の Directory フェデレーション サービスで使用できます。 この規則を使用する場合は、パススルーまたは、規則で構成するオプションのいずれかに基づいて、次の表に、規則のロジックに一致するすべての要求をフィルター処理します。  
  
|規則のオプション|規則のロジック|  
|---------------|--------------|  
|すべての要求の値をパススルーします。|入力方向の要求の種類と等しい場合*要求の種類を指定した*等しく、値*任意の値*、要求をパススルー|  
|特定の要求値のみをパススルーします。|入力方向の要求の種類と等しい場合*要求の種類を指定した*等しく、値*指定した要求値*、要求をパススルー|  
|特定の e\ メール サフィックスの値に一致する要求値のみをパススルーします。|入力方向の要求の種類と等しい場合*要求の種類を指定した*等しく、値*サフィックスの値が指定されている*、要求をパススルー|  
|特定の値で始まる要求値のみをパススルーします。|入力方向の要求の種類と等しい場合*要求の種類を指定した*値で始まると*指定した要求値*、要求をパススルー|  
  
次のセクションでは、要求規則およびをこの規則を使用するタイミングについて詳しく説明するための基本的な概要を提供します。  
  
## <a name="about-claim-rules"></a>要求規則について  
要求規則は、入力方向の要求を行う、条件を適用するビジネス ロジックのインスタンスを表します \ (し y\ x の場合)、条件のパラメーターに基づいて出力方向の要求を生成します。 輪郭について知っておくべきヒントの要求規則を読む前に重要な一覧を次にこのトピックの「します。  
  
-   AD FS の管理スナップインには、要求規則でのみ作成できます要求規則テンプレートを使用します。  
  
-   入力方向の要求規則プロセスを要求するか、要求プロバイダーから直接 \ (など、Active Directory または別のフェデレーション \) または受付の出力から、要求プロバイダー信頼規則を変換します。  
  
-   要求規則は、特定の規則セット内で時系列要求発行エンジンによって処理されます。 規則に対する優先順位を設定、さらに調整したり、特定の規則セット内の先行する規則で生成された要求をフィルター処理できます。  
  
-   要求規則テンプレートを使用して、入力方向の要求の種類を指定する必要が常にします。 ただし、1 つの規則を使用して要求の種類が同じで、複数の要求の値を処理することができます。  
  
詳細については、要求規則および要求規則セットを参照してください。[、要求規則の役割](The-Role-of-Claim-Rules.md)します。 規則が処理される方法の詳細については、次を参照してください。[The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md)します。 要求規則セットを処理する方法の詳細については、次を参照してください。[要求パイプラインの役割](The-Role-of-the-Claims-Pipeline.md)します。  
  
## <a name="pass-through-all-claim-values"></a>すべての要求の値をパススルーします。  
この操作を使用する場合、指定された要求の種類の入力方向の要求値をすべてが出力方向の要求としてを通じて渡されます。 たとえば、役割要求の種類として入力方向の要求の種類を指定すると、すべての入力方向の要求値にコピーされます個別に出力方向の要求の種類の役割の新しい出力方向の要求。  
  
## <a name="filtering-a-claim"></a>要求のフィルター処理  
AD FS、という用語で*要求のフィルタ リング*フィルター処理または受信を制限するための手段の要求値を特定の値のみがパススルーまたは出力方向の要求として送信できるようにします。 **パススルーまたはフィルター処理入力方向の要求**ルール テンプレートをこの関数が可能になります。 このルールのプロパティ内で指定した条件を満たす値のみが通過できるように、入力方向の値をフィルター処理する条件を設定できます。  
  
たとえば、のみをパススルー、入力方向の要求の役割の要求の種類は、ユーザー名に関する要求のみを発行することも型が一致するときに、購入者の要求の値に一致する要求がユーザーの社会保障番号が含まれている信頼性情報をこの規則を使用することができます。  
  
このルールでフィルター条件を使用すると、ルールによって設定条件に一致する要求を決定するすべての入力方向の要求が確認されます。 選択された要求種類に一致する指定した要求値のみを通過できるように、その他のすべての要求は無視されます。  
  
たとえば、次の図に示すように、規則を設定されている場合、条件を満たすを UPN にもキーが設定のみ入力方向の要求をフィルター処理する要求の種類もで終わります@fabrikam.com、この条件を満たしている場合を除き、その他のすべての入力方向の要求は無視されます。 これが含まれています E\ メール アドレスの要求の種類の入力方向の要求にはでその要求値が終わるにもかかわらず@fabrikam.comします。 この場合の値を含む要求のみNick@fabrikam.com証明書利用者に送信されます。  
  
![パスを使用するときに使用](media/adfs2_filter.gif)  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>要求プロバイダー信頼でこの規則の構成  
受信のみをパススルーするこのルールを構成することができます、要求プロバイダー信頼を使用して、特定の制約に一致する要求プロバイダーから要求します。 のみ、要求プロバイダーからの要求を e\ メールを受け入れる例。そのため、要求プロバイダーのドメイン ネーム システム \(DNS\) 名前で終わる e\ メール要求の種類を受け入れるように、この規則テンプレートを使用します。  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>証明書利用者信頼でこの規則の構成  
証明書利用者信頼を使用すると、このルールはパススルーまたは証明書利用者に送信される出力方向の要求をフィルター処理を構成できます。 によって証明書利用者可能性があります、要求の種類を理解していないか、特定の信頼性情報が特定証明書利用者に送信される必要がありますいない機密情報を含む可能性があります。 この規則テンプレートは、特定証明書利用者信頼について、これらのポリシーの実施に役立ちます。  
  
## <a name="how-to-create-this-rule"></a>このルールを作成する方法  
要求規則言語または Pass Through を使用して、いずれかを使用してこのルールを作成するか、または AD FS 管理スナップインで、入力方向の要求規則テンプレートをフィルター処理します。 この規則テンプレートは、次の構成オプションを提供します。  
  
-   要求規則名を指定します。  
  
-   入力方向の要求の種類を指定します。  
  
-   すべての要求の値をパススルーします。  
  
-   特定の要求値のみをパススルーします。  
  
-   特定の e\ メール サフィックスの値に一致する要求値のみをパススルーします。  
  
-   特定の値で始まる要求値のみをパススルーします。  
  
このテンプレートを作成する方法の詳細については、次を参照してください。[パススルーするルールを作成または入力方向の要求をフィルター処理](https://technet.microsoft.com/library/dd807060.aspx)AD FS 展開ガイドにします。  
  
## <a name="using-the-claim-rule-language"></a>要求規則言語を使用します。  
要求の値がカスタム パターンに一致する場合にのみ、要求を送信する必要があります、カスタム規則を使用する必要があります。 詳細については、カスタム規則を使用するときに参照してください。  
  
### <a name="examples-of-how-to-construct-a-pass-through-or-filter-rule-syntax"></a>規則の構文を構築パススルーまたはフィルター処理する方法の例  
単純なフィルタ リング規則は、上記で説明したプロパティのいずれかに基づいて要求を抽出します。 たとえば、次の規則は、すべての e\ メール要求がパススルーされます。  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”]  => issue(claim  = c);  
```  
  
フィルターは論理的に AND\ ed 共存します。 たとえば、次の規則が値を持つすべての e\ メールの要求を受け入れます johndoe@fabrikam.com:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value == “johndoe@fabrikam.com “]  => issue(claim  = c);  
```  
  
上記の例では、フィルターは常に等価演算子を使用します。 要求規則言語は、次の演算子をサポートしています。  
  
-   \ = \ = \-\(case\-sensitive\) に等しい  
  
-   \! \ = \-\(case\-sensitive\) を等しくないです。  
  
-   \ = 約 \-正規表現一致  
  
-   \! ~ \-正規表現以外に一致  
  
たとえば、次の規則は boeing.com のサフィックスが付いているローカルのフェデレーション サーバーによって発行されていないすべての e\ メール要求を受け入れます。  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value =~ “^.*@boeing\.com$” , issuer != “LOCAL AUTHORITY”]  => issue(claim  = c);  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>カスタム規則を作成するためのベスト プラクティス  
フィルターは、次の表で説明するように、各要求のプロパティの 1 つ以上に適用できます。  
  
|要求のプロパティ|説明|  
|------------------|---------------|  
|種類|要求の種類 \ (通常は、Uri\ として表されます)、要求で伝達が情報の種類に関するフェデレーション パートナー間の暗黙の同意が反映されます。 たとえば、種類 http:///\/schemas.xmlsoap.org\/ws\/2005\/05\/identity\/claims\/emailaddress の信頼性情報は、ユーザーの e\ メール アドレスが含まれます。|  
|値|要求の値。 たとえば、種類 http:///\/schemas.xmlsoap.org\/ws\/2005\/05\/identity\/claims\/emailaddress の要求がの値を持つ可能性があります。johndoe@fabrikam.com|  
|ValueType|ValueType は、要求の値に含まれる情報が解釈されるための方法を表します。 通常、ValueType は http:///\/www.w3.org\/2001\/XMLSchema\#string に設定されますが、要求の値は、Base64Binary でエンコードされたデータを含めることが \ (image\ など) または日付、ブール値、およびなどです。|  
|発行者|発行者は、前回ユーザーに関する要求を発行したパーティです。 場合は、信頼性情報が要求プロバイダーのフェデレーション サーバーのすべての要求の発行者が"LOCAL AUTHORITY"に設定することで取得されます。 フェデレーション プロバイダーのフェデレーション サーバーによって要求を受信した場合、要求の発行者が、トークンに署名した要求プロバイダーの要求プロバイダー識別子に設定しようとします。 したがって、要求プロバイダーから受信した要求の規則を処理するときにすべての要求の発行者が、同じ値に設定しようとします。 証明書利用者の規則を作成するときは、別の要求プロバイダーから送信された要求を区別する発行者プロパティを使用することができます。|  
|OriginalIssuer|この要求プロパティは、最初に発行した要求をフェデレーション サーバーを伝達します。 発行元は、信頼性情報が 1 つ以上のフェデレーション サーバーを通過するシナリオで役に要求の issuer プロパティが設定されるので、最後に、トークンに署名したフェデレーション サーバー、\ (たとえば、証明書利用者フェデレーション プロバイダーのフェデレーション サーバーからトークンを受信する可能性があります関心特定のどの要求プロバイダーのフェデレーション サーバーには、ユーザーが認証された)|  
|プロパティ|各要求は、上記で説明した 5 つのプロパティだけでなく、名前付きプロパティを格納できるプロパティ バッグもあります。 これらのプロパティはトークンでシリアル化されない、のみ 1 つのフェデレーション サーバーのスコープ内で要求発行パイプラインのコンポーネント間で情報を渡すことをお勧めします。 たとえば、規則を設定するプロパティ要求中にプロバイダーを処理し、[証明書利用者のパーティ ルール] で [参照すること。|  
  

