---
ms.assetid: 8b15d44e-e4e6-4510-aa91-cc7ec7161b0a
title: "要求エンジンの役割"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 930b6f8034f17d8902104419042f944b82e90b4f
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/03/2017
---
>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

# <a name="the-role-of-the-claims-engine"></a>要求エンジンの役割
最上位のレベルでは、Active Directory フェデレーション サービス \(AD FS\) で要求エンジンを提供していると、フェデレーション サービスの要求の要求の処理専用 rule\ ベースのエンジンです。 要求エンジンは、すべてのフェデレーションによる信頼関係が構成した各規則セットを実行していると経由で、要求パイプラインへの出力結果の処理を担当するフェデレーション サービス内で唯一エンティティです。  
  
要求パイプラインは、複数の論理概念の中に、エンド ツー エンド プロセス フローの要求は、要求規則は次の要求規則実行プロセス中に信頼性情報のフローをカスタマイズすることができますを使用する実際の管理用の要素。 パイプライン プロセスに関する詳細については、次を参照してください。[要求パイプラインの役割](The-Role-of-the-Claims-Pipeline.md)します。  
  
次の図では、入力方向の要求 \(acceptance rules\) を受け入れた act で示すように承認要求に要求者 \(authorization rules\) と要求エンジンによってすべて、組織内のフェデレーションによる信頼関係の要求規則を使用 \(issuance rules\) が実行される出力方向の要求を発行します。  
  
![AD FS の役割](media/adfs2_enginepipeline.gif)  
  
## <a name="claim-rules-execution-process"></a>要求規則実行プロセス  
構成するときに要求プロバイダー信頼または証明書利用者信頼の要求規則と、組織でその信頼 act の要求規則 set\(s\) 入力方向の要求のゲートキーパーとしておよび発行する要求のクレームを発行するかどうかを判断する要求規則で必要なロジックを適用して、要求エンジンを起動しています。  
  
次のセクションでは、各要求規則実行プロセスを通過する要求のフローの中に、エンジンによって発生する手順について説明します。 各ステップ以下に示すように発生各ステージでは、要求パイプライン プロセスで説明します。 次の手順は次のとおりです。  
  
-   ステップ 1-初期化  
  
-   ステップ 2-実行  
  
-   手順 3-実行結果  
  
パイプライン プロセスに関する詳細については、次を参照してください。[要求パイプラインの役割](The-Role-of-the-Claims-Pipeline.md)します。  
  
### <a name="step-1--initialization"></a>ステップ 1-初期化  
要求規則実行プロセスの最初の手順で要求エンジンが最初に追加することによって入力方向の要求を受け入れる、*入力要求セット*します。 入力要求セットは、一時的にいる限り、必要なプロセスを取得するために利用できるようにするには、そのデータを必要とデータを格納するために使用されるメモリ内のキャッシュに似ています。 入力要求セットが、規則の実行が完了したら、データは破棄されます。  
  
#### <a name="adding-a-claim-to-the-input-claim-set-for-a-rule-set"></a>入力要求規則セットのセットへの要求を追加します。  
要求規則セットに関連付けられたロジックを処理するときに、メモリに要求データを一時的に格納する必要がある場合、要求エンジンによって入力要求セットが作成されます。 要求エンジンは、すべての入力方向の要求規則セット内の最初のルールによって取得できます入力要求セットにコピーします。  
  
たとえば、次の図で、要求エンジンを読み取り要求 A および B、入力方向からの要求し、入力要求セットにコピーします。 入力要求セット内にある、した後、要求エンジンを取得し、要求規則セット内の最初の規則のロジックの入力として要求 A および B を処理します。  
  
![AD FS の役割](media/adfs2_context1.gif)  
  
要求規則セット内のすべての規則は、同じ入力要求セットを共有します。 セット内の各規則は、そのため、セット内のすべての後続の規則に影響する、共有の入力要求セットに追加できます。  
  
### <a name="step-2--execution"></a>ステップ 2-実行  
要求規則プロセスのこの手順で要求エンジン時系列に従って実行のすべてのいずれかの特定の規則セット内のルール、一度にときに、要求規則は処理されます。 規則セット内の各規則にのみ実行されが表示される上から下の AD FS 管理スナップインで要求規則の編集] ダイアログ ボックスに表示される順序で実行します。 ルールの上部に設定されている要求規則が最初に処理し、すべてのルールが実行されるまで、後続の規則が処理されます。  
  
要求規則言語で定義されて、要求規則で構成されます 2 つの部分が、条件と発行ステートメントです。 クレーム セットの条件部分入力にデータを使用して要求のセットをルール内で指定された条件入力に含まれる要求の true を保持するかどうかを確認要求エンジン最初プロセス \ (規則の条件に一致するクレームと呼びます一致する claims\)。 一致要求が見つかった場合、要求エンジンは、一致要求の各セットに対して規則の発行ステートメントを実行します。 規則の発行ステートメントは、一致するクレームを含む、次のタスクのいずれかを実行できます。  
  
1.  一致する要求を出力要求セットにコピーします。  
  
2.  要求の各フィールドを変換して、入力要求セットだけにいずれかで、新しい信頼性情報を作成または評価と出力要求セット。  
  
3.  一致する claim\(s\) をいずれかで、入力要求セットだけに新しい claim\(s\) が作成または入力と出力要求セットに属性ストアから詳細情報を検索をキーとして使用します。  
  
#### <a name="adding-a-claim-to-the-output-claim-set-for-a-rule-set"></a>出力要求規則セットのセットへの要求を追加します。  
*出力要求セット*が最初に空では、要求エンジンは出力要求セットの実行プロセスが完了した後に存在する要求だけを返すために重要なメモリ内の場所。 つまり、入力要求にのみ存在する任意の信頼性情報の設定し、出力要求セットにない場合は無視されます最終出力方向の要求のセットを計算する段階になります。  
  
#### <a name="adding-a-claim-to-both-claim-sets-for-a-rule-set"></a>規則セットの両方の要求セットへの要求を追加します。  
規則が処理されるときに、要求は要求セットの入力で追加するか、両方が入力要求セットと出力要求セットの規則の発行ステートメントで使用されているステートメントに基づいてはします。 要求規則言語をこれらのステートメントを指す*追加*または*問題*します。  
  
場合、*追加*ステートメントを使用すると、要求が入力要求セットだけに追加され、信頼性情報が実行のためにのみ存在して、実行が完了が存在しなくなります。 場合、*問題*ステートメントを使用すると、信頼性情報が入力要求セットと出力要求セットの両方に追加され、出力要求セットの実行が完了した後で、信頼性情報が返されます。 これらのステートメントの詳細については、次を参照してください。[要求規則言語の役割](The-Role-of-the-Claim-Rule-Language.md)します。  
  
規則セット内の規則の条件部分が入力要求セット内の任意のクレームを一致しない場合は、規則の発行ステートメント部分は無視され、したがって要求は追加されません出力要求セットまたは入力要求セット。 次の図と対応する手順は、要求エンジンが変換規則を実行するときの動作を示しています。  
  
![AD FS の役割](media/adfs2_context2.gif)  
  
1.  入力方向の要求は、設定、要求エンジンによって入力要求に追加されます。  
  
2.  最初の規則を実行するとき、要求 A および B、その時点で要求だけを入力要求セットは、表示され、規則 1 の規則ロジックの条件部分が処理されます。  
  
3.  True にするルールの条件が決定されます A の要求が入力要求セットに存在するので、\ (一致要求 A\) し、両方に、入力要求セットと出力要求セットに新しい C クレームを追加します。  
  
4.  ルール 2 は、A、B および C のクレームを使えるようになりました \ (すべての要求が入力要求になって) のロジックを処理するための入力として。  
  
要求変換の詳細については、次を参照してください。[When to Use a Transform Claim Rule](When-to-Use-a-Transform-Claim-Rule.md)します。  
  
### <a name="step-3--execution-result"></a>手順 3-実行結果  
要求規則セット実行の最終ステージは、特定の規則セット内のすべてのルールを実行するいるし、最終的な要求セットが出力要求セットに存在が開始されます。 この時点では、要求エンジンは、出力要求規則セット実行の出力としてセットのコンテキストを返します。 これ以降は、要求パイプライン占有し、そのプロセスでは、次のステージをこの最終的な出力を移動します。  
  
## <a name="sending-the-execution-output-to-the-claims-pipeline"></a>要求パイプラインへの実行の出力を送信します。  
要求エンジン プロセス時に、規則を設定した規則セットが、入力のメモリ内の独自の専用場所と出力要求セットのことです。 これは、入力と出力要求の 1 つの規則セットによって使用されるセットとは別個の入力と出力要求セットのもう 1 つの規則セットで使用されていることを意味します。  
  
規則セットのプロセス全体を実行した後 \ (ステップ 1、2、および 3 \)、新しく発行された出力方向の要求 \ (出力要求になってのコンテンツのモデレート) は、次の規則セットで、要求パイプラインへの入力として使用されます。 これにより、次の図に示すように、別の規則セットの入力に設定する 1 つの規則の出力からフローを要求できます。  
  
![AD FS の役割](media/adfs2_enginecontexts.gif)  
  
> [!NOTE]  
> 発行規則セットもパイプラインにおける重要なステージですが、上の図は表示されませんが、図を簡略化のためにのみ。 図解は、発行規則セットと要求パイプラインにどのように適合する場合は、次を参照してください。[要求パイプラインの役割](The-Role-of-the-Claims-Pipeline.md)します。  
  
ここでは、受け入れ規則の出力はパイプラインによって、最終的なセットの承認規則の処理には、パイプラインの第 2 ステージに受け入れ規則によって生成された要求のフローを使用します。 全体要求規則の実行プロセスの時点では、\ 承認規則のセットをもう一度実行 (手順 1、2、および 3 above\)。 このサイクルは発行規則が設定されるまで \ (、pipeline\ の最後のステージ) が完了します。  
  
完了した出力方向の要求発行規則セットのエンジンから返された、SAML トークンにパッケージ化され、フェデレーション サービスはトークンをクライアントに送信されます。  
  
## <a name="processing-authorization-rules"></a>承認規則の処理  
手順 2 の要求規則実行プロセス中に実行されている要求規則セットから成る承認規則かどうか \ (である別の入力と出力要求の受け入れや発行のいずれかの rules\ より)、し、それらの承認規則を実行、要求者のクレームに基づいて、指定された証明書利用者フェデレーション サービスからのセキュリティ トークンを取得するトークンの要求元が承認されているかどうかを決定します。  
  
承認規則の目的は、許可または拒否要求かどうかに基づいて、ユーザーかどうか、指定された証明書利用者のトークンを取得できるようにするにです。 発行規則セットを実行するかどうかどうかを決定する、承認実行の出力が、パイプラインで使用される次の図に示すように、— 許可 and\ の有無に基づいて/または拒否要求、承認実行の出力自体は、要求規則セットへの入力として使用されませんが、します。  
  
![AD FS の役割](media/adfs2_authorization.gif)  
  
要求承認の詳細については、次を参照してください。[When to Use an Authorization Claim Rule](When-to-Use-an-Authorization-Claim-Rule.md)します。  
  

