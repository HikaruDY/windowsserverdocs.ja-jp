---
ms.assetid: 77aa61bf-9c04-4889-a5d2-6f45bc1b8bd2
title: "変換要求規則を使用する場合"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: c7b7ea2c8d9a08a4cbf6c89c2de2482043efe25b
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

# <a name="when-to-use-a-transform-claim-rule"></a>変換要求規則を使用する場合
出力方向の要求の種類に入力方向の要求の種類をマップし、入力方向の要求から発信された値に基づいて発生させる出力を決定するアクションを適用する必要がある場合、Active Directory フェデレーション サービス \(AD FS\) でこの規則を使用することができます。 この規則を使用する場合は、パススルーまたは次の表で説明されているように、規則で構成するオプションのいずれかに基づき、次の規則ロジックと一致する要求を変換します。  
  
|規則のオプション|規則のロジック|  
|---------------|--------------|  
|すべての入力方向の要求をパススルーします。|入力方向の要求の種類と等しい場合*要求の種類を指定した*等しく、値*任意の値*、出力方向の要求の種類等しい] で、要求をパススルー*要求の種類を指定します。*|  
|入力方向の要求の値を異なる出力方向の要求の値に置き換えます|入力方向の要求の種類と等しい場合*要求の種類を指定*等しく、値*指定した要求値*、し、出力方向の要求の値を新しい要求を変換*指定した要求値*と出力方向の要求の種類と*要求の種類を指定*|  
|入力方向の e\ 電子メール サフィックス要求を新しい e\ メール サフィックスに置き換えます|入力方向の要求の種類と等しい場合*要求の種類を指定した*等しく、値*サフィックスの値をいずれか*、し、出力方向の要求の値を新しい要求を変換*サフィックスの値が指定されている*と出力方向の要求の種類と*要求の種類を指定*|  
  
次のセクションでは、要求規則およびをこの規則を使用するタイミングについて詳しく説明するための基本的な概要を提供します。  
  
## <a name="about-claim-rules"></a>要求規則について  
要求規則は、入力方向の要求を行う、条件を適用するビジネス ロジックのインスタンスを表します \ (し y\ x の場合)、条件のパラメーターに基づいて出力方向の要求を生成します。 輪郭について知っておくべきヒントの要求規則を読む前に重要な一覧を次にこのトピックの「します。  
  
-   AD FS の管理スナップインには、要求規則でのみ作成できます要求規則テンプレートを使用します。  
  
-   入力方向の要求規則プロセスを要求するか、要求プロバイダーから直接 \ (など、Active Directory または別のフェデレーション \) または受付の出力から、要求プロバイダー信頼規則を変換します。  
  
-   要求規則は、特定の規則セット内で時系列要求発行エンジンによって処理されます。 規則に対する優先順位を設定、さらに調整したり、特定の規則セット内の先行する規則で生成された要求をフィルター処理できます。  
  
-   要求規則テンプレートを使用して、入力方向の要求の種類を指定する必要が常にします。 ただし、1 つの規則を使用して要求の種類が同じで、複数の要求の値を処理することができます。  
  
詳細については、要求規則および要求規則セットを参照してください。[、要求規則の役割](The-Role-of-Claim-Rules.md)します。 規則が処理される方法の詳細については、次を参照してください。[The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md)します。 要求規則セットを処理する方法の詳細については、次を参照してください。[要求パイプラインの役割](The-Role-of-the-Claims-Pipeline.md)します。  
  
## <a name="pass-through-all-claim-values"></a>すべての要求の値をパススルーします。  
この操作を使用する場合、フェデレーション サービスによって署名されているトークンに出力方向の要求として送信される前に、適合する入力方向の要求の種類を指定した入力方向の要求値がすべてが、指定した出力方向の要求の種類にマップされます。  
  
たとえば、規則を設定されている場合に、**要求の値のすべてのパススルー**オプション ロジックと、入力方向の要求のグループの種類と役割の出力方向の要求の種類が指定されている場合、発行元からのフローを入力方向の要求値すべてが要求の種類の役割の新しい出力方向の要求に個別にコピーします。  
  
## <a name="transforming-a-claim"></a>要求の変換  
AD FS、という用語で*信頼性情報を変換*要求の出力方向の要求の値を異なる値を 1 つの着信を置換するための手段です。 この関数を可能にする入力方向の要求規則のトランス フォームすることをお勧めします。 このルールのプロパティ内で、指定した入力方向の要求の種類に基づいての異なる出力方向の要求値の入力方向の値を変換する条件を設定できます。  
  
たとえばに入力方向の値を異なる出力方向の要求の値に置き換えて、条件で規則が設定されている場合に、次の図に示すように、グループの入力方向要求の種類をすべては新しい出力方向の要求に種類 Role にマップされます。 ここでは、購入者の入力方向の要求の値は管理者の新しい出力方向の要求値に置き換えられます。  
  
![トランス フォームを使用する場合](media/adfs2_transform.gif)  
  
新しい値で指定された e\ メール サフィックスの値を持つすべての入力方向の要求を置き換える条件を適用するのにこの規則を使用することもできます。 たとえば、fabrikam.com に sales.corp.fabrikam.com のサフィックスを持つすべての要求の値を変更するには、この規則で条件を設定する可能性があります。  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>要求プロバイダー信頼でこの規則の構成  
要求プロバイダー信頼を使用する場合は、信頼できる同等のものに、要求プロバイダーからの入力方向の要求を変換するこの規則を構成できます。 要求の種類と要求の値により組織は、要求プロバイダー組織で意味が異なることができます。 このルールを使用して、要求の種類と、出力方向の要求対応は、証明書利用者が理解できるように、要求プロバイダーから入手した値を正規化することができます。  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>証明書利用者信頼でこの規則の構成  
証明書利用者信頼を使用する場合は、特定の利用者の要求を変換するこの規則を構成できます。 要求の種類と要求の値が特定の証明書利用者パーティーのさまざまな意味を持つ可能性があり、このルールにより、単一の証明書利用者のパーティ製の出力方向の要求の種類と値を変更します。  
  
## <a name="how-to-create-this-rule"></a>このルールを作成する方法  
要求規則言語を使用して、またはを使用して、この規則を作成する、**入力方向の要求を変換**規則テンプレートの AD FS 管理スナップインでします。 この規則テンプレートは、次の構成オプションを提供します。  
  
-   要求規則名を指定します。  
  
-   出力方向の要求の種類を指定する特定の入力方向要求種類を変換します。  
  
-   すべての要求の値をパススルーします。  
  
-   入力方向の要求の値を異なる出力方向の要求の値に置き換えます  
  
-   入力方向の e\ 電子メール サフィックス要求を新しい e\ メール サフィックスに置き換えます  
  
このテンプレートを作成する方法の詳細については、次を参照してください。[入力方向の要求を変換する規則を作成する](https://technet.microsoft.com/library/dd807068.aspx)AD FS 展開ガイドにします。  
  
## <a name="using-the-claim-rule-language"></a>要求規則言語を使用します。  
出力方向の要求は、1 つ以上の入力方向の要求のコンテンツから作成する必要がある場合、は、代わりにカスタム規則を使用する必要があります。 出力方向の要求の要求の値は、入力方向の要求の値に基づく必要がある場合: 他のコンテンツが、— そのコンテキストでカスタム規則を使用することも必要があります。 詳細については、次を参照してください。[When to Use a Custom Claim Rule](When-to-Use-a-Custom-Claim-Rule.md)します。  
  
### <a name="examples-of-how-to-construct-a-transform-rule-syntax"></a>変換規則の構文を作成する方法の例  
要求を変換する要求規則言語構文を使用する場合は、新しいリテラル値を変換された要求のプロパティを設定できます。 たとえば、次の規則役割要求の値から変更"Administrators"を"root"要求の種類が同じを維持しながらします。  
  
```  
c:[type == “https://schemas.microsoft.com/ws/2008/06/identity/claims/role”, value == “Administrators”]  => issue(type = c.type, value = “root”);  
```  
  
正規表現は、要求を変換も使用できます。 たとえば、次の規則はドメイン \\ ユーザー形式での windows ユーザー名要求を FABRIKAM にドメインを設定します。  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"] => issue(type = c.type, value = regexreplace(c.value, "(?<domain>[^\\]+)\\(?<user>.+)", "FABRIKAM\${user}"));  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>カスタム規則を作成するためのベスト プラクティス  
要求変換は、基本的なフィルタ リング機能を使用して、選択した要求を選択的に適用できます。 値は、以下のことに注意をフィルター処理するための要求プロパティの各割り当てることができます。  
  
|要求のプロパティ|説明|  
|------------------|---------------|  
|Type、Value、ValueType|これらのプロパティは、割り当ての最も頻繁に使用されます。 変換結果の要求のでは、少なくとも種類と値を指定する必要があります。|  
|発行者|要求規則言語は、要求の発行者を設定によって、通常、これはないことをお勧めします。 要求の発行者はトークンでシリアル化されません。 トークンを受信したすべての要求の Issuer プロパティは、トークンに署名したフェデレーション サーバーの識別子に設定されます。 したがって、規則で要求の発行者を設定しても、トークンの内容に影響はありません、要求がトークンにパッケージ化された後、設定は失われます。 位置センサーは、要求の発行者を設定するだけのシナリオは、」のこの特定の値を参照する規則セットが作成した証明書利用者のパーティ規則と要求プロバイダー規則のセットに特定の値に設定されているかどうかです。 Issuer プロパティが明示的に設定されていない場合、要求規則要求発行エンジンが"LOCAL AUTHORITY"に設定の値にします。|  
|OriginalIssuer|同様に、発行元を OriginalIssuer 一般に明示的に割り当てない値。 Issuer とは異なり、OriginalIssuer プロパティが、トークンでシリアル化ですが、トークンのコンシューマーを見込んでかどうか、設定を含めることが要求を最初に発行したフェデレーション サーバーの識別子。|  
|プロパティ|前のセクションで説明した、ように、信頼性情報のプロパティ バッグは保持されません。、トークンのため、プロパティへの割り当ては、以降のローカル ポリシーは、プロパティに格納されている情報を参照する場合にのみ行ってください。|  
  
要求規則言語を使用する方法の詳細については、次を参照してください。[要求規則言語の役割](The-Role-of-the-Claim-Rule-Language.md)します。  
  

