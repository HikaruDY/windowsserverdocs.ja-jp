---
ms.assetid: 5c8c6cc0-0d22-4f27-a111-0aa90db7d6c8
title: AD FS 展開トポロジの計画
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 00c43a56d9b57a2ae2c8b9aeca56807fe1d1841f
ms.sourcegitcommit: 0b5fd4dc4148b92480db04e4dc22e139dcff8582
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/24/2019
ms.locfileid: "66191178"
---
# <a name="plan-your-ad-fs-deployment-topology"></a>AD FS 展開トポロジの計画

Active Directory フェデレーション サービスの展開の計画の最初の手順\(AD FS\)は、組織のニーズに合わせて適切な展開トポロジを決定します。  
  
このトピックを読む前に、AD FS のデータが格納され、フェデレーション サーバー ファーム内の他のフェデレーション サーバーにレプリケートする方法を確認しの目的と AD FS に格納されている基になるデータを使用できるレプリケーション方法を理解しておいて con◆ データベースです。  
  
AD FS 構成データの格納に使用できる 2 つのデータベースの種類があります。Windows Internal Database \(WID\)と Microsoft SQL Server。 詳細については、次を参照してください。 [、AD FS 構成データベースの役割](../../ad-fs/technical-reference/The-Role-of-the-AD-FS-Configuration-Database.md)します。 さまざまな利点とさまざまなアプリケーション シナリオをサポートし、クリックすると、AD FS 構成データベースとして WID または SQL Server のいずれかを使用して関連付けられている制限事項を確認します。  
  
> [!IMPORTANT]  
> 基本的な冗長性、負荷分散、およびフェデレーション サービスをスケーリングするオプションを実装する\(必要な場合\)、すべての運用環境でのフェデレーション サーバー ファームごとに少なくとも 2 つのフェデレーション サーバーをデプロイすることをお勧めします。使用するデータベースの種類に関係なく。  
  
## <a name="determining-which-type-of-adfs-configuration-database-to-use"></a>どのタイプの AD FS 構成データベースを使用するかを決定する  
AD FS 構成を格納するデータベースを使用して、場合によっては — トランザクション データは、フェデレーション サービスに関連します。 AD FS ソフトウェアを使用するには、ビルドを選択する\-Windows Internal database \(WID\)または Microsoft SQL Server 2008 以降に、フェデレーション サービスにデータを格納します。  
  
ほとんどの場合は、この 2 つのデータベース タイプはほぼ等価です。 ただし、読み取りの詳細については、AD FS で使用できるさまざまな展開トポロジを開始する前に、注意するいくつかの違いがあります。 次の表は、WID データベースと SQL Server データベースでサポートされる機能の違いの説明をまとめたものです。  
  
||機能|WID でのサポート|SQL Server でのサポート
| --- | --- | --- |--- |
|AD FS の機能|フェデレーション サーバー ファーム展開|[はい]。 WID ファームでは、100 以下の証明書利用者のパーティ信頼がある場合、30 台のフェデレーション サーバーの制限があります。</br></br>WID ファームは、トークン再生検出または成果物の解決 (Security Assertion Markup Language (SAML) プロトコルの一部) をサポートしていません。 |[はい]。 1 つのファーム内に展開できるフェデレーション サーバーの数について制限はありません。  
|AD FS の機能|SAML アーティファクト解決 </br></br>**注:** この機能は、Microsoft Online Services、Microsoft Office 365、Microsoft Exchange、Microsoft Office SharePoint のシナリオには不要です。|X|〇  
|AD FS の機能|SAML\/WS\-フェデレーション トークン リプレイ検出|X|〇  
|データベースの機能|1 または読み取りをホストするサーバーをレプリケーションでは、基本的なデータベースの冗長性を使用してプル\-読み取りをホストしている移行元サーバーで行われた変更をデータベースで要求の唯一のコピー\/データベースのコピーを作成|〇|X 
|データベースの機能|高を使用してデータベースの冗長性\-フェールオーバー クラスタ リングやミラーリングなどの可用性ソリューション\(データベース層のみ\)**に注意してください。** すべての AD FS 展開トポロジは、AD FS サービス層でのクラスタ リングをサポートします。|X|〇  

  
## <a name="sql-server-considerations"></a>SQL Server に関する考慮事項  
SQL Server を AD FS 展開の構成データベースとして選ぶ場合は、次の事項を考慮してください。  
  
-   **SAML の機能と、その機能がデータベース サイズやデータ量増大に及ぼす影響**。 SAML アーティファクト解決や SAML トークン リプレイ検出の機能が有効化されているときは、発行された AD FS トークンそれぞれの情報が SQL Server 構成データベースに格納されます。 この結果として、SQL Server データベースのデータ量はそれほど増大しないと考えられていますが、増大する量はトークン リプレイ保持期間の設定によって異なります。 成果物の各レコードが、サイズが約 30 キロバイト\(KB\)します。  
  
-   **実際の展開に必要なサーバーの数**。 少なくとも 1 つの追加サーバーを追加する必要があります\(、AD FS インフラストラクチャをデプロイするために必要なサーバーの総数を\)は、SQL Server インスタンスの専用のホストとして機能します。 SQL Server 構成データベースに耐障害性と拡張性を持たせるためにフェールオーバー クラスタリングやミラーリングを使用する場合は、最低でも 2 つの SQL サーバーが必要です。  
  
## <a name="how-the-configuration-database-type-you-select-may-impact-hardware-resources"></a>選択した構成データベースのタイプがハードウェア リソースに及ぼす影響  
ファーム内に展開されるフェデレーション サーバーのハードウェア リソースに及ぶ影響は、WID を使用する場合でも SQL Server データベースを使用する場合でも、大きな違いはありません。 ただし、WID をファームに使用するときの重要な考慮事項が 1 つあります。それは、ファーム内の各フェデレーション サーバーが AD FS 構成データベースのローカル コピーを保持してレプリケーション変更の保存、管理、保守を行う必要があり、これと並行してフェデレーション サービスに必要な通常の動作も継続する必要があるということです。  
  
対照的に、フェデレーション サーバーが展開されているファームで SQL Server データベースを使用する場合は、AD FS 構成データベースのローカル インスタンスが各フェデレーション サーバーに存在していなくてもかまいません。 したがって、必要なハードウェア リソースの量はかなり少なくなる可能性があります。  
  
## <a name="BKMK_1"></a>フェデレーション サーバーを配置する場所  
セキュリティのベスト プラクティス、ファイアウォールの前に AD FS フェデレーション サーバーを配置およびをインターネットからのリスクを防ぐために、企業ネットワークに接続します。 これは、機能は、フェデレーション サーバーがある完全な権限をセキュリティ トークンを付与するため重要です。 そのため、ドメイン コント ローラーと同様に保護する必要があります。 フェデレーション サーバーが侵害された場合、悪意のあるユーザーは、すべての Web アプリケーションや AD FS によって保護されているフェデレーション サーバーに対するフル アクセス トークンを発行する機能を持ちます。  
  
> [!NOTE]  
> セキュリティ ベスト プラクティスとして、インターネットに直接アクセスできるように、フェデレーション サーバーを避けます。 または、組織が境界ネットワークを持っていない場合に、テスト ラボ環境を設定するときにのみ、フェデレーション サーバーにインターネットに直接アクセスを与えることを検討してください。  
  
一般的な企業ネットワークでは、イントラネット\-、企業ネットワークと、境界ネットワークとインターネットの間で確立するにはファイアウォールに接続する\-ファイアウォールに接続するが、境界ネットワークの間で確立されている多くの場合、インターネットです。 このような状況では、フェデレーション サーバーは、企業ネットワーク内に配置し、はインターネット クライアントで直接アクセスできません。  
  
> [!NOTE]  
> 企業ネットワークに接続されているクライアント コンピューターは、Windows 統合認証を使用してフェデレーション サーバーと直接通信できます。  
  
AD FS を使用するためのファイアウォール サーバーを構成する前に、フェデレーション サーバー プロキシを境界ネットワークに配置する必要があります。  
  
## <a name="supported-deployment-topologies"></a>サポートされる展開トポロジ  
次のトピックでは、AD FS で使用できるさまざまな展開トポロジについて説明します。 また、特定のビジネスのニーズに最適なトポロジを選択できるよう、各展開トポロジに関連する利点と制約事項についても説明します。  
  
-   [WID を使用するフェデレーション サーバー ファーム](Federation-Server-Farm-Using-WID.md)  
  
-   [WID とプロキシを使用するフェデレーション サーバー ファーム](Federation-Server-Farm-Using-WID-and-Proxies.md)  
  
-   [SQL Server を使用するフェデレーション サーバー ファーム](Federation-Server-Farm-Using-SQL-Server.md)  
  
## <a name="see-also"></a>関連項目  
[Windows Server 2012 R2 での AD FS 設計ガイド](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)  
  

