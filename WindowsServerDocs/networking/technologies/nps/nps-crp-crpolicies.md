---
title: 接続要求ポリシー
description: このトピックでは、Windows Server 2016 でネットワーク ポリシー サーバーの接続要求ポリシーの概要を示します。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 4ec45e0c-6b37-4dfb-8158-5f40677b0157
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 21330b3838064c7b31e78ef70bdc04f0db0f50db
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59872943"
---
# <a name="connection-request-policies"></a>接続要求ポリシー

>適用対象:Windows Server 2016 の Windows Server (半期チャネル)

このトピックを使用すると、NPS 接続要求ポリシーを使用して、NPS を RADIUS サーバー、RADIUS プロキシ、またはその両方として構成するのに方法について説明します。

>[!NOTE]
>このトピックに加え、次の接続要求ポリシー ドキュメントは使用できます。
> - [接続要求ポリシーを構成します。](nps-crp-configure.md)
> - [リモート RADIUS サーバー グループを構成します。](nps-crp-rrsg-configure.md)

接続要求ポリシーは条件のセットと、ネットワーク管理者がリモート認証ダイヤルイン ユーザー サービス (RADIUS) サーバーを指定する設定は、認証を実行し、接続の承認を要求する、ネットワーク ポリシー サーバー (NPS) を実行しているサーバーは、RADIUS クライアントから受信します。 RADIUS アカウンティングに使用される RADIUS サーバーを指定するのには、接続要求ポリシーを構成できます。

接続を作成できます要求ポリシーの RADIUS クライアントから送信された一部の RADIUS 要求メッセージがローカルで処理されるように (NPS を RADIUS サーバーとして使用されます) およびその他の種類のメッセージが別の RADIUS サーバー (NPS を RADIUS プロキシとして使用されます) に転送されます。

接続要求ポリシー、または RADIUS サーバーとして、次の要因に基づいて、RADIUS プロキシとして NPS を使用できます。 

- 時刻および曜日
- 接続要求で領域名
- 要求されている接続の種類
- RADIUS クライアントの IP アドレス

RADIUS アクセス要求メッセージが処理または、受信メッセージの設定は、NPS で構成されている接続要求ポリシーの少なくとも 1 つと一致する場合にのみ、NPS によって転送されます。 

ポリシー設定が一致して、ポリシーは、NPS がメッセージを処理することが必要な場合、NPS は、認証と接続要求の承認を RADIUS サーバーとして機能します。 ポリシー設定が一致し、ポリシーは、NPS は、メッセージを転送する必要があります場合、NPS は RADIUS プロキシとして機能し、処理用のリモート RADIUS サーバーに接続要求を転送します。

着信 RADIUS Access-request メッセージの設定では、少なくとも 1 つの接続要求ポリシーと一致しない場合、アクセス拒否メッセージが RADIUS クライアントに送信され、ユーザーまたはコンピューターがネットワークに接続しようとしています。 アクセスは拒否されます。

## <a name="configuration-examples"></a>構成の例

次の構成例では、接続要求ポリシーを使用する方法を示しています。

### <a name="nps-as-a-radius-server"></a>RADIUS サーバーとしての NPS

既定の接続要求ポリシーは、構成されている唯一のポリシーです。 この例では、NPS が RADIUS サーバーとして構成されているし、すべての接続要求がローカルの NPS によって処理されます。 NPS では、認証でき、アカウントが NPS のドメインのドメインおよび信頼されたドメインにあるユーザーを承認することができます。


### <a name="nps-as-a-radius-proxy"></a>RADIUS プロキシとしての NPS

既定の接続要求ポリシーを削除すると、され、2 つの異なるドメインに要求を転送する 2 つの新しい接続要求ポリシーが作成されます。 この例では、NPS が RADIUS プロキシとして構成されます。 NPS では、ローカル サーバー上で接続要求を処理しません。 代わりに、NPS またはリモート RADIUS サーバー グループのメンバーとして構成されている他の RADIUS サーバーに接続要求を転送します。


### <a name="nps-as-both-radius-server-and-radius-proxy"></a>RADIUS サーバーと RADIUS プロキシの両方として機能する NPS

既定の接続要求ポリシーだけでなく、NPS や信頼されていないドメイン内の他の RADIUS サーバーに接続要求を転送する新しい接続要求ポリシーが作成されます。 この例で、プロキシ ポリシーがポリシーの順序付きリストの先頭に表示されます。 接続要求がプロキシ ポリシーに一致する場合、接続要求は、リモート RADIUS サーバー グループ内の RADIUS サーバーに転送されます。 接続要求がプロキシ ポリシーと一致しませんが、既定の接続要求ポリシーと一致する場合は、NPS は、ローカル サーバーに接続要求を処理します。 接続要求がいずれかのポリシーが一致しない場合は破棄されます。

### <a name="nps-as-radius-server-with-remote-accounting-servers"></a>RADIUS サーバーとリモート アカウンティング サーバーとして機能する NPS

この例でアカウンティングを実行するローカルの NPS が構成されていないと既定の接続要求ポリシーが改訂され、RADIUS アカウンティング メッセージは、NPS またはリモート RADIUS サーバー グループ内の他の RADIUS サーバーに転送されるようにします。 アカウンティング メッセージを転送すると、認証と承認のメッセージが転送されていないと、ローカル ドメインのローカル NPS がこれらの関数を実行し、信頼できるすべてのドメイン。


### <a name="nps-with-remote-radius-to-windows-user-mapping"></a>Remote RADIUS to Windows ユーザーのマッピングと NPS

この例では、NPS は RADIUS サーバーとして、個々 の接続要求を RADIUS プロキシとしてを承認をローカル Windows ユーザー アカウントを使用しながら、リモート RADIUS サーバーに認証要求を転送することによって機能します。 この構成は、接続要求ポリシーの条件として [Remote RADIUS to Windows User Mapping] 属性を構成することによって実装されます。 (さらに、ユーザー アカウントをする必要がある作成ローカル、リモート RADIUS サーバーによって認証を行う対象となるリモート ユーザー アカウントと同じ名前を持つ)。

## <a name="connection-request-policy-conditions"></a>接続要求ポリシーの条件

接続要求ポリシーの条件は、着信 RADIUS Access-request メッセージの属性と比較される 1 つまたは複数の RADIUS 属性です。 複数の条件がある場合、接続の条件のすべての要求メッセージと、接続要求ポリシーが NPS によって適用されるポリシーの順序で一致する必要があります。


接続要求ポリシーで構成することができる条件属性を次に示します。

### <a name="connection-properties-attribute-group"></a>接続プロパティの属性グループ

接続のプロパティの属性グループには、次の属性が含まれています。

- **Framed-protocol**します。 着信パケットのフレーミングの種類を指定するために使用します。 例としては、Point-to-Point プロトコル (PPP)、シリアル回線インターネット プロトコル (SLIP)、フレーム リレー、X.25 です。
- **サービスの種類を**します。 要求されているサービスの種類を指定するために使用します。 例としては、構成されます (たとえば、PPP 接続など) とログイン (Telnet 接続など)。 RADIUS サービスの種類に関する詳細については、RFC 2865、「リモート認証ダイヤルイン ユーザー サービス (RADIUS)。」を参照してください。
- **トンネルの種類**します。 要求元のクライアントによって作成されるトンネルの種類を指定するために使用します。 トンネルの種類には、Point-to-Point トンネリング プロトコル (PPTP) およびレイヤー 2 トンネリング プロトコル (L2TP) が含まれます。

### <a name="day-and-time-restrictions-attribute-group"></a>属性グループの日付と時刻の制限 

日付と時刻の制限の属性グループには、日付と時刻の制限の属性が含まれています。 この属性では、週の曜日と、接続試行の 1 日の時刻を指定できます。 日付と時刻、NPS の日時に対する相対パスです。

### <a name="gateway-attribute-group"></a>Gateway 属性グループ

ゲートウェイの属性グループには、次の属性が含まれています。

- **被呼端末 ID と呼ばれる**します。 ネットワーク アクセス サーバーの電話番号を指定するために使用します。 この属性は、文字の文字列です。 パターン マッチング構文を使用すると、市外局番を指定します。
- **NAS Id**します。 ネットワーク アクセス サーバーの名前を指定するために使用します。 この属性は、文字の文字列です。 パターン マッチング構文を使用して、NAS の id を指定することができます。
- **NAS IPv4 アドレス**します。 インターネット プロトコル バージョン 4 (IPv4) を指定するために使用、ネットワーク アクセス サーバー (RADIUS クライアント) のアドレス。 この属性は、文字の文字列です。 パターン マッチング構文を使用して、IP ネットワークを指定することができます。
- **NAS IPv6 アドレス**します。 インターネット プロトコル バージョン 6 (IPv6) を指定するために使用、ネットワーク アクセス サーバー (RADIUS クライアント) のアドレス。 この属性は、文字の文字列です。 パターン マッチング構文を使用して、IP ネットワークを指定することができます。
- **NAS ポートの種類**します。 アクセス クライアントで使用するメディアの種類を指定するために使用します。 例としては、アナログ電話回線 (非同期と呼ばれます)、統合デジタル サービス通信網 (ISDN)、トンネルまたは仮想プライベート ネットワーク (Vpn)、IEEE 802.11 ワイヤレス、イーサネット スイッチ.

### <a name="machine-identity-attribute-group"></a>Machine Identity 属性グループ

[Machine Identity] 属性グループには、[Machine Identity] 属性が含まれています。 この属性を使用するには、ポリシーでクライアントを識別するメソッドを指定できます。

### <a name="radius-client-properties-attribute-group"></a>RADIUS クライアントのプロパティの属性グループ

RADIUS クライアントのプロパティの属性グループには、次の属性が含まれています。

- **Calling-station-id**します。 呼び出し元 (アクセス クライアント) で使用される電話番号を指定するために使用します。 この属性は、文字の文字列です。 パターン マッチング構文を使用すると、市外局番を指定します。  802.1 x 認証では、MAC アドレスは、通常設定され、クライアントから一致することができます。  このフィールドは '資格情報を検証し、Accept users' の接続要求ポリシーが構成されている場合に Mac アドレスのバイパスのシナリオで通常使用されます。  
- **クライアントのフレンドリ名**します。 認証を要求している RADIUS クライアント コンピューターの名前を指定するために使用します。 この属性は、文字の文字列です。 パターン マッチング構文を使用すると、クライアント名を指定します。
- **クライアントの IPv4 アドレス**します。 ネットワーク アクセス サーバー (RADIUS クライアント) の IPv4 アドレスを指定するために使用します。 この属性は、文字の文字列です。 パターン マッチング構文を使用して、IP ネットワークを指定することができます。
- **クライアントの IPv6 アドレス**します。 ネットワーク アクセス サーバー (RADIUS クライアント) の IPv6 アドレスを指定するために使用します。 この属性は、文字の文字列です。 パターン マッチング構文を使用して、IP ネットワークを指定することができます。
- **クライアント ベンダー**します。 認証を要求しているネットワーク アクセス サーバーのベンダーを指定するために使用します。 ルーティングとリモート アクセス サービスを実行しているコンピューターでは、Microsoft NAS の製造元です。 この属性を使用すると、NAS の製造元によってポリシーを構成します。 この属性は、文字の文字列です。 パターン マッチング構文を使用することができます。

### <a name="user-name-attribute-group"></a>ユーザー名の属性グループ

ユーザー名の属性グループには、ユーザー名属性が含まれています。 この属性を使用するには、ユーザー名、または、RADIUS メッセージでアクセス クライアントによって指定されたユーザー名に一致する必要がある、ユーザー名の一部を指定できます。 この属性は、通常、領域名とユーザー アカウント名を含む文字列です。 パターン マッチング構文を使用すると、ユーザー名を指定します。

## <a name="connection-request-policy-settings"></a>接続要求ポリシーの設定

接続要求ポリシー設定では、着信 RADIUS メッセージに適用されるプロパティのセットです。 次のプロパティのグループの設定で構成されます。

- 認証
- アカウンティング
- 属性の操作
- 要求を転送します。
- 詳細

次のセクションでは、これらの設定について詳しく説明します。

### <a name="authentication"></a>認証

この設定を使用すると、すべてのネットワーク ポリシーで構成されている認証の設定をオーバーライドして、認証方法と、ネットワークに接続するために必要な型を指定することができます。

>[!IMPORTANT]
>接続要求ポリシーは、ネットワーク ポリシーで構成する認証方法よりも安全性の低い認証方法を構成する場合は、ネットワーク ポリシーで構成するより安全な認証メソッドがオーバーライドされます。 たとえば、1 つのネットワーク ポリシーがある場合が必要に保護されている拡張認証プロトコル Microsoft チャレンジ ハンドシェイク認証プロトコル バージョン 2 の\(- PEAP-MS-CHAP v2\)、パスワード ベースであります。認証されていないアクセスを許可する接続要求ポリシー構成もセキュリティで保護されたワイヤレス、認証方法と、クライアントが PEAP MS-CHAP v2 を使用して認証するために必要ないことになります。 この例で、ネットワークに接続するすべてのクライアントに付与されて認証されていないアクセスします。

### <a name="accounting"></a>アカウンティング

この設定を使用すると、アカウンティング情報を NPS またはリモート RADIUS サーバー グループ内の他の RADIUS サーバーに転送して、リモート RADIUS サーバー グループでアカウンティングを実行するように、接続要求ポリシーを構成することができます。

>[!NOTE]
>複数の RADIUS サーバーがあり、1 つの中央の RADIUS アカウンティング データベースに格納されているすべてのサーバーのアカウンティング情報を表示する場合のポリシーでは、各 RADIUS サーバーの接続要求ポリシーのアカウンティング設定を使用からのアカウンティング データを転送するすべてのサーバーを 1 つの NPS またはアカウンティング サーバーとして指定されている他の RADIUS サーバー。

ポリシーのアカウンティング設定機能は、ローカルの NPS のアカウンティング構成の独立した接続要求。 つまり、ローカル ファイルまたは Microsoft SQL Server データベースに RADIUS アカウンティング情報をログ記録をローカルの NPS を構成する場合は、するようにリモートの RADIUS アカウンティング メッセージを転送する接続要求ポリシーを構成するかどうかに関係なくサーバーのグループです。

アカウンティング情報をローカルではなくリモートで記録する場合は、リモート RADIUS サーバー グループにアカウンティング データを転送する接続要求ポリシーのアカウンティングを構成するときに、アカウンティングを実行しないように、ローカルの NPS を構成する必要があります。

### <a name="attribute-manipulation"></a>属性の操作

一連の属性は、次のいずれかのテキスト文字列を操作する検索と置換ルールを構成することができます。

- [ユーザー名]
- コール先ステーション ID
- 呼び出し元の被呼端末 ID

前に、RADIUS メッセージが認証およびアカウンティングの設定に従いますが、上記の属性のいずれかの検索と置換ルールの処理が発生します。 属性の操作規則は、1 つの属性にのみ適用されます。 各属性の属性の操作規則を構成することはできません。 さらに、操作できる属性の一覧は、静的な一覧です。操作の使用可能な属性の一覧に追加することはできません。

>[!NOTE]
>MS-CHAP v2 認証プロトコルを使用している場合、RADIUS メッセージを転送するように、接続要求ポリシーを使用する場合、ユーザー名 属性を操作できません。 唯一の例外発生時に、円記号 (\)文字が使用され、操作の左側の情報にのみ影響します。 円記号は通常、ドメイン名 (円記号の左側の情報) と (円記号の右側に情報)、ドメイン内のユーザー アカウント名を示すために使用されます。 この場合、変更またはドメイン名を置き換える属性の操作規則のみが許可されています。

ユーザー名 属性で領域名を操作する方法の例」の「ユーザー名 属性で領域名を操作するための例」セクションを参照してください[NPS で正規表現を使用して](nps-crp-reg-expressions.md)います。

### <a name="forwarding-request"></a>要求を転送します。

次を設定する転送 RADIUS Access-request メッセージに使用される要求オプション。

- **このサーバーで要求を認証**します。 この設定を使用すると、NPS は接続要求の認証に Windows NT 4.0 ドメイン、Active Directory またはローカル セキュリティ アカウント マネージャー (SAM) のユーザー アカウント データベースを使用します。 この設定では、ユーザー アカウントのダイヤルイン プロパティと共に、NPS で構成されている一致するネットワーク ポリシーを使用 NPS が接続要求を承認することも指定します。 この場合、NPS は RADIUS サーバーとして実行する構成します。

- **次のリモート RADIUS サーバー グループに要求を転送**します。 この設定を使用すると、NPS は接続要求を指定したリモート RADIUS サーバー グループに転送します。 NPS では、アクセス要求メッセージに対応する有効な Access-accept メッセージを受信する場合、接続試行は、認証および承認されたと見なされます。 この場合、NPS は RADIUS プロキシとして機能します。

- **資格情報を検証することがなくユーザーを受け入れる**します。 この設定を使用すると、NPS がネットワークに接続しようとしています。 ユーザーの id を確認していないと、NPS は、ユーザーまたはコンピューター、ネットワークに接続する権限があることを確認しようとはしません。 NPS が認証されていないアクセスを許可するよう構成すると、接続要求を受信、NPS はネットワーク アクセスを許可しているクライアントと、ユーザーまたはコンピューターの radius Access-accept メッセージをすぐに送信します。 この設定は、アクセス クライアントがユーザーの資格情報が認証される前にトンネリングが強制トンネリングの種類によって使用されます。

>[!NOTE]
>アクセス クライアントの認証プロトコルが相互認証を提供する MS-CHAP v2 または拡張認証プロトコル-トランスポート層セキュリティ (EAP-TLS) の場合、この認証オプションを使用できません。 相互認証、アクセス クライアントに証明ことは、認証サーバー (NPS) を有効なアクセス クライアントと認証サーバーをアクセス クライアントに有効な認証サーバーであることを証明します。 この認証オプションを使用すると、Access-accept メッセージが返されます。 ただし、認証サーバーが、アクセス クライアントに検証を提供していないと、相互認証は失敗します。

正規表現を使用して、リモート RADIUS サーバー グループに指定された領域の名前を持つ RADIUS メッセージを転送するルーティング規則を作成する方法の例については、」の「プロキシ サーバーが RADIUS メッセージの転送の例」セクションを参照してください。[を使用して、NPS で正規表現](nps-crp-reg-expressions.md)します。

### <a name="advanced"></a>詳細

一連の RADIUS 属性を指定する高度なプロパティを設定できます。

- NPS は、RADIUS 認証またはアカウンティング サーバーとして使用されているときに、RADIUS 応答メッセージに追加します。 ネットワーク ポリシーと、接続要求ポリシーの両方で指定された属性が存在する場合、RADIUS 応答メッセージで送信される属性は、2 つの属性のセットの組み合わせです。
- NPS は、RADIUS 認証またはアカウンティング プロキシとして使用されているときに、RADIUS メッセージに追加します。 転送されるメッセージで、属性が既に存在する場合は、接続要求ポリシーで指定された属性の値に置き換えられます。 

さらに、ポリシーの要求で、接続の構成に使用できるいくつかの属性**設定** タブで、 **詳細設定**カテゴリは、特殊な機能を提供します。 たとえば、構成、 **Remote RADIUS to Windows ユーザー マッピング**認証を分割するし、アカウント データベースを 2 つのユーザーの間の接続要求の承認属性です。

**Remote RADIUS to Windows ユーザー マッピング**属性は、リモート RADIUS サーバーによって認証されたユーザーの Windows 認証が発生することを指定します。 つまり、リモート RADIUS サーバーがリモートのユーザー アカウント データベースでは、ユーザー アカウントに対して認証を実行しますが、ローカルの NPS は、ローカル ユーザー アカウント データベース内のユーザー アカウントに対して接続要求を承認します。 これは、訪問者のネットワークへのアクセスを許可する場合に便利です。

たとえば、パートナー組織の訪問者は、独自パートナー組織の RADIUS サーバーによって認証されることができ、組織、ネットワーク上のゲストのローカル エリア ネットワーク (LAN) にアクセスする Windows ユーザー アカウントを使用しています。

特殊な機能を提供するその他の属性は次のとおりです。

- **MS-検疫-IPFilter と MS 検疫のセッション タイムアウト**します。 これらの属性は、ルーティングとリモート アクセス VPN の展開でネットワーク アクセス検疫制御 (NAQC) を展開するときに使用されます。
- **Passport-ユーザーのマッピング-UPN のサフィックス**します。 この属性を使用すると、Windows Live™ ID ユーザー アカウントの資格情報で接続要求を認証できます。
- **トンネル タグ**します。 この属性を接続が割り当てられる NAS によって仮想ローカル エリア ネットワーク (Vlan) を展開するときに VLAN ID 番号を指定します。

## <a name="default-connection-request-policy"></a>既定の接続要求ポリシー

NPS をインストールするときに既定の接続要求ポリシーが作成されます。 このポリシーでは、次の構成にあります。

- 認証が構成されていません。
- 前方のアカウンティング情報をリモート RADIUS サーバー グループには、アカウンティングが構成されていません。
- 属性は属性の操作規則をリモート RADIUS サーバー グループの接続要求を転送することで構成されていません。
- 要求に転送すると、接続要求が認証され、ローカル NPS に承認されるように構成されます。
- 高度な属性が構成されていません。

既定の接続要求ポリシーでは、NPS を RADIUS サーバーとして使用します。 RADIUS プロキシとして機能する NPS を実行するサーバーを構成するには、リモート RADIUS サーバー グループを構成することも必要があります。 新しい接続要求ポリシー ウィザードを使用して新しい接続要求ポリシーの作成中には、新しいリモート RADIUS サーバー グループを作成することができます。 既定の接続要求ポリシーを削除するか、既定の接続要求ポリシーが NPS によってポリシーの順序付けされた一覧の最後に配置して処理される最後のポリシーであることを確認できます。

>[!NOTE]
>Windows 認証のため、同じコンピューターでリモート アクセス サービスが構成されているし、アカウンティング、なっても、リモート アクセスの認証およびアカウンティング要求を RADIUS サーバーに転送する NPS とリモート アクセス サービスがインストールされている場合. これは、リモート アクセスの認証およびアカウンティング要求にそれらをリモート RADIUS サーバー グループに転送するように構成する接続要求ポリシーが一致する場合に発生します。
