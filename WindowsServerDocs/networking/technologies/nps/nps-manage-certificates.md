---
title: NPS で使われる証明書を管理する
description: このトピックでは、Windows Server 2016 でネットワーク ポリシー サーバーでサーバー証明書の使用に関する情報を提供します。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 204a4ef4-9d78-4a62-9940-43cc0e1c39d0
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 73f3d6a1e9dc6ae1520b1d685b6b05b5f3aed601
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59864233"
---
# <a name="manage-certificates-used-with-nps"></a>NPS で使われる証明書を管理する

>適用対象:Windows Server 2016 の Windows Server (半期チャネル)

拡張認証プロトコルなどの証明書ベースの認証メソッドを展開する場合\-トランスポート層セキュリティ\(EAP\-TLS\)、Protected の Extensible Authentication Protocol\-トランスポート層セキュリティ\(PEAP\-TLS\)、および PEAP\-Microsoft チャレンジ ハンドシェイク認証プロトコル バージョン 2 \(MS\-CHAP v2\)、NPSs のすべてにサーバー証明書を登録する必要があります。 サーバー証明書が必要です。

- 」の説明に従って、証明書のサーバーの最小要件を満たす[PEAP および EAP の要件の証明書テンプレートの構成](nps-manage-cert-requirements.md)

- 証明機関によって発行される\(CA\)クライアント コンピューターによって信頼されています。 CA は、現在のユーザーとローカル コンピューターの信頼されたルート証明機関証明書ストアにその証明書が存在する場合、信頼されています。

次の手順は、信頼されたルート CA が、Verisign などのサード パーティの CA は、またはは、公開キー インフラストラクチャを展開している CA の展開で NPS 証明書の管理に役立つ\(PKI\)アクティブを使用して、Directory 証明書サービス\(AD CS\)します。

## <a name="change-the-cached-tls-handle-expiry"></a>キャッシュされた TLS ハンドルの有効期限を変更します。

EAP の初期認証プロセス中に\-TLS、PEAP\-TLS、および PEAP\-MS\-CHAP v2 を NPS が接続するクライアントの TLS 接続のプロパティの一部をキャッシュします。 クライアントは、NPS の TLS 接続のプロパティの一部もキャッシュします。

これらの TLS 接続プロパティの各コレクションに個別には、TLS ハンドルは呼び出されます。

クライアント コンピューターは、NPSs が多くのクライアント コンピューターの TLS ハンドルをキャッシュ中に、複数の認証子の TLS ハンドルをキャッシュできます。

クライアントとサーバーでキャッシュされた TLS ハンドルでは、再認証プロセスでより迅速に発生するできるようにします。 たとえば、ワイヤレス コンピューターは、NPS で reauthenticates、ときに、NPS は、ワイヤレス クライアントの TLS ハンドルを調べることができますおよびクライアント接続が再接続をすばやく判断できます。 NPS では、完全な認証を実行せず、接続を許可します。

同様に、クライアントは、NPS を TLS ハンドルを調べ、判断、再接続し、サーバー認証を実行する必要はありません。

Windows 10 および Windows Server 2016 を実行しているコンピューターでは、既定の TLS ハンドルの有効期限は 10 時間です。

状況によっては、TLS ハンドルの有効期限の時間を増減する可能性があります。

たとえば、管理者がユーザーの証明書が失効、証明書の有効期限が切れたの状況で TLS ハンドルの有効期限の時間を短縮します。 このシナリオでは、NPS に期限切れになっていないキャッシュされた TLS ハンドルがある場合、ユーザーをネットワークに接続できます。 失効した証明書では、このようなユーザーが再接続するを防ぐ、TLS を減らすハンドルの有効期限をヘルプ可能性があります。

>[!NOTE]
>このシナリオに最適なソリューションは、Active Directory でユーザー アカウントを無効にするか、ネットワーク ポリシーでネットワークに接続する権限が付与されている Active Directory グループからユーザー アカウントを削除するには。 すべてのドメイン コント ローラーにこれらの変更の反映遅れる可能性がありますも、ただし、レプリケーションの待機時間が原因です。 

## <a name="configure-the-tls-handle-expiry-time-on-client-computers"></a>クライアント コンピューターで TLS ハンドルの有効期限の時間を構成します。

この手順を使用すると、クライアント コンピューターが、NPS の TLS ハンドルをキャッシュする時間の量を変更します。 NPS を正常に認証後は、クライアント コンピューターは、TLS ハンドルとして、NPS の TLS 接続のプロパティをキャッシュします。 TLS ハンドルが 10 時間の既定の期間\(36,000,000 ミリ秒\)します。 大きくしたり、次の手順を使用して TLS ハンドルの有効期限の時間を短縮できます。

メンバーシップ **管理者**, 、または同等の権限は、この手順を実行するために必要な最小値。

>[!IMPORTANT]
>この手順は、クライアント コンピューターではなく、NPS を実行する必要があります。

### <a name="to-configure-the-tls-handle-expiry-time-on-client-computers"></a>TLS は、クライアント コンピューターの有効期限の処理を構成するには

1. 、NPS では、レジストリ エディターを開きます。

2. レジストリ キーを参照**HKEY\_ローカル\_MACHINE\System\CurrentControlSet\Control\SecurityProviders\SCHANNEL**

3. **編集** メニューのをクリックして**新規**、 をクリックし、**キー**します。

4. 型**ClientCacheTime**、し、ENTER キーを押します。

5. 右クリック**ClientCacheTime**、 をクリックして**新規**、 をクリックし、 **DWORD (32 ビット) 値**します。

6. クライアント コンピューターは、NPS が最初に成功した認証の試行後に、NPS の TLS ハンドルをキャッシュするミリ秒単位で入力します。

## <a name="configure-the-tls-handle-expiry-time-on-npss"></a>NPSs で TLS ハンドルの有効期限の時間を構成します。

NPSs がクライアント コンピューターの TLS ハンドルをキャッシュする時間の間隔を変更するのにには、この手順を使用します。 アクセス クライアントを正常に認証後は、NPSs は TLS ハンドルとしてクライアント コンピューターの TLS 接続のプロパティをキャッシュします。 TLS ハンドルが 10 時間の既定の期間\(36,000,000 ミリ秒\)します。 大きくしたり、次の手順を使用して TLS ハンドルの有効期限の時間を短縮できます。

メンバーシップ **管理者**, 、または同等の権限は、この手順を実行するために必要な最小値。

>[!IMPORTANT]
>この手順は、クライアント コンピューターではなく、NPS を実行する必要があります。

### <a name="to-configure-the-tls-handle-expiry-time-on-npss"></a>TLS は、NPSs の有効期限の処理を構成するには

1. 、NPS では、レジストリ エディターを開きます。

2. レジストリ キーを参照**HKEY\_ローカル\_MACHINE\System\CurrentControlSet\Control\SecurityProviders\SCHANNEL**

3. **編集** メニューのをクリックして**新規**、 をクリックし、**キー**します。

4. 型**ServerCacheTime**、し、ENTER キーを押します。

5. 右クリック**ServerCacheTime**、 をクリックして**新規**、 をクリックし、 **DWORD (32 ビット) 値**します。

6. クライアントによって最初に成功した認証の試行後に、クライアント コンピューターの TLS ハンドルをキャッシュする NPSs するミリ秒単位で入力します。

## <a name="obtain-the-sha-1-hash-of-a-trusted-root-ca-certificate"></a>信頼されたルート CA 証明書の sha-1 ハッシュを取得します。

この手順を使用すると、ローカル コンピューターにインストールされている証明書から Secure Hash Algorithm (sha-1) 信頼されたルート証明機関 (CA) のハッシュを取得できます。 状況によっては、証明書の sha-1 ハッシュを使用して、証明書を指定する必要はグループ ポリシーを展開する場合などです。

グループ ポリシーを使用する場合は、1 つまたは複数信頼されたルート CA 証明書クライアントが EAP または PEAP を使用した相互認証の処理中に、NPS を認証するために使用する必要がありますを指定できます。 クライアントがサーバー証明書の検証に使用する必要がある信頼されたルート CA 証明書を指定するには、証明書の sha-1 ハッシュを入力できます。

この手順では、証明書 Microsoft 管理コンソール (MMC) スナップインを使用して、sha-1 で信頼されたルート CA 証明書のハッシュを取得する方法を示します。 

この手順を完了するには、メンバーである、**ユーザー**ローカル コンピューターのグループ化します。

### <a name="to-obtain-the-sha-1-hash-of-a-trusted-root-ca-certificate"></a>Sha-1 の信頼されたルート CA 証明書のハッシュを取得するには

1. [実行] ダイアログ ボックスまたは Windows PowerShell では、入力**mmc**、し、ENTER キーを押します。 Microsoft 管理コンソール\(MMC\)が開きます。 MMC で、次のようにクリックします。**ファイル**、 をクリックし、**追加/削除 Snap\in**します。 **スナップインを追加または** ダイアログ ボックスが表示されます。

2. **スナップインを追加または**で、**利用できるスナップイン**、ダブルクリックして**証明書**します。 証明書スナップインでウィザードが開きます。 クリックして**コンピューター アカウント**、順にクリックします**次**します。

3. **コンピューターの選択**、いることを確認**ローカル コンピューター (このコンソールを実行して、コンピューター)** が選択されていること、**完了**、順にクリックします **[ok]**.

4. 左側のウィンドウでダブルクリック**証明書 (ローカル コンピューター)**、し、ダブルクリック、**信頼されたルート証明機関**フォルダー。

5. **証明書**フォルダーのサブフォルダーになって、**信頼されたルート証明機関**フォルダー。 をクリックして、**証明書**フォルダー。

6. 詳細ペインでは、信頼されたルート CA の証明書を参照します。 証明書をダブルクリックします。 **証明書** ダイアログ ボックスが表示されます。

7. **証明書**ダイアログ ボックスで、をクリックして、**詳細**タブ。

8. フィールドの一覧をスクロールして、選択**拇印**します。

9. 下のウィンドウで、証明書の sha-1 ハッシュである 16 進数の文字列が表示されます。 Sha-1 ハッシュを選択し、コピー コマンドの Windows のキーボード ショートカットを押して\(CTRL\+C\)ハッシュを Windows クリップボードにコピーします。

10. Sha-1 ハッシュを貼り付け、カーソルを正しく特定、および貼り付けコマンドを Windows のキーボード ショートカット キーを押す場所を開く\(CTRL\+V\)します。 

証明書と NPS の詳細については、次を参照してください。 [PEAP および EAP の要件の証明書テンプレートを構成する](nps-manage-cert-requirements.md)します。

NPS の詳細については、次を参照してください。[ネットワーク ポリシー サーバー (NPS)](nps-top.md)します。
