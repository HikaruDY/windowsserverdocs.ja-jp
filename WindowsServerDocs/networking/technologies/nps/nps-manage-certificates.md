---
title: NPS で使われる証明書を管理します。
description: このトピックでは、Windows Server 2016 でネットワーク ポリシー サーバーでサーバー証明書を使用してに関する情報を提供します。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 204a4ef4-9d78-4a62-9940-43cc0e1c39d0
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 2044cf30cc90c1673e05a1948ac9196d05940d1f
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="manage-certificates-used-with-nps"></a>NPS で使われる証明書を管理します。

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

拡張認証 Protocol\-トランスポート層セキュリティ \(EAP\-TLS\)、Extensible Authentication Protocol\-トランスポート層の保護されているセキュリティ \(PEAP\-TLS\)、PEAP\ Microsoft チャレンジ ハンドシェイク認証プロトコル バージョン 2 などの証明書ベースの認証方法を展開するかどうかは \ (MS\ CHAP v2\) すべての NPS サーバーにサーバー証明書を登録する必要があります。 サーバー証明書が必要があります。

- 最小サーバー証明書の要件を満たしている」の説明に従って[PEAP と EAP の要件の証明書テンプレートを構成します。](nps-manage-cert-requirements.md)

- 証明機関によって発行されるクライアント コンピューターによって信頼されている \(CA\) します。 CA は、その証明書は、現在のユーザーとローカル コンピューターの信頼されたルート証明機関証明書ストアに存在する場合、信頼されています。

次の手順は、信頼されたルート CA が、Verisign などのサード パーティの CA は、またはは、公開キー インフラストラクチャを展開している CA の展開では、NPS サーバーの証明書の管理に役立ちます \(PKI\) Active Directory Certificate Services \(AD CS\) を使用しています。

## <a name="change-the-cached-tls-handle-expiry"></a>TLS のキャッシュされたハンドルの有効期限を変更します。

EAP\ TLS、PEAP\ TLS、および PEAP\-MS\--ms-chap V 2 の初期認証プロセス中には、NPS サーバーは、接続するクライアントの TLS 接続のプロパティの一部をキャッシュします。 クライアントはまた、NPS サーバーの TLS 接続のプロパティの一部をキャッシュします。

これらの TLS 接続プロパティそれぞれ個別のコレクションには、TLS ハンドルが呼び出されます。

クライアント コンピューターは、NPS サーバーが多数のクライアント コンピューターの TLS のハンドルをキャッシュできるときに、複数の認証子の TLS ハンドルをキャッシュできます。

クライアントとサーバーでキャッシュされた TLS ハンドルより迅速に発生する、再認証プロセスができるようにします。 たとえば、ワイヤレス コンピューターは、NPS サーバーと reauthenticates、NPS サーバーはワイヤレス クライアントの TLS のハンドルを調べることができ、クライアント接続が再接続をすばやく確認できます。 NPS サーバーでは、完全な認証を実行しなくても、接続が認証されます。

それに対応して、クライアントは NPS サーバーの TLS のハンドルを調べ、判断を再接続し、サーバー認証を実行する必要はありません。

Windows 10 および Windows Server 2016 を実行しているコンピューターでは、既定の TLS のハンドルの有効期限は 10 時間です。

状況によっては、TLS ハンドルの有効期限の日時を増減する場合があります。

たとえば、ここで、管理者がユーザーの証明書が失効し、証明書の有効期限が切れてような状況で TLS ハンドルの有効期限の時間を短縮することができます。 このシナリオでは NPS サーバーに期限切れになっていないキャッシュされた TLS ハンドルがある場合、ユーザーをネットワークに接続できますもします。 失効した証明書を持つには、このようなユーザーが再接続するを防ぐ、TLS を減らすハンドルの有効期限を役立つ可能性があります。

>[!NOTE]
>このシナリオに最適なソリューションは、Active Directory でユーザー アカウントを無効にするかをネットワーク ポリシーでネットワークに接続するアクセス許可が付与されている Active Directory グループからユーザー アカウントを削除するのにです。 これらの変更をすべてのドメイン コントローラに伝達遅れる可能性がありますも、ただし、レプリケーションの潜在期間が原因です。 

## <a name="configure-the-tls-handle-expiry-time-on-client-computers"></a>クライアント コンピューターでの TLS ハンドルの有効期限の時刻を構成します。

この手順を使用すると、クライアント コンピューターが NPS サーバーの TLS のハンドルをキャッシュする時間の量を変更します。 NPS サーバーを正常に認証した後は、クライアント コンピューターは、TLS ハンドルと NPS サーバーの TLS 接続のプロパティをキャッシュします。 TLS ハンドルには、10 時間 \(36,000,000 milliseconds\) の既定の期間があります。 増加または、次の手順を使用して TLS ハンドルの有効期限の時間を短縮できます。

メンバーシップ**管理者**、相当するものでは、この手順を完了するために必要な最低限またはします。

>[!IMPORTANT]
>この手順は、クライアント コンピューターではなく、NPS サーバーで実行する必要があります。

### <a name="to-configure-the-tls-handle-expiry-time-on-client-computers"></a>TLS は、クライアント コンピューターで有効期限の日時の処理を構成するには

1. NPS サーバーでは、レジストリ エディターを開きます。

2. レジストリ キーに移動**HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\SecurityProviders\SCHANNEL**

3. **編集**] メニューのをクリックして**新規**、] をクリックし、**キー**します。

4. 種類**ClientCacheTime**、し、Enter キーを押します。

5. 右クリック**ClientCacheTime**、] をクリックして**新規**、] をクリックし、**DWORD (32 ビット) 値**します。

6. クライアント コンピューターは、NPS サーバーで最初の認証が成功した後に、NPS サーバーの TLS のハンドルをキャッシュすること、ミリ秒単位で入力します。

## <a name="configure-the-tls-handle-expiry-time-on-nps-servers"></a>NPS サーバーで TLS ハンドルの有効期限の日時を構成します。

NPS サーバーがクライアント コンピューターの TLS のハンドルをキャッシュする時間の長さを変更するには、この手順を使用します。 アクセス クライアントを正常に認証した後は、NPS サーバーは、TLS ハンドルと、クライアント コンピューターの TLS 接続のプロパティをキャッシュします。 TLS ハンドルには、10 時間 \(36,000,000 milliseconds\) の既定の期間があります。 増加または、次の手順を使用して TLS ハンドルの有効期限の時間を短縮できます。

メンバーシップ**管理者**、相当するものでは、この手順を完了するために必要な最低限またはします。

>[!IMPORTANT]
>この手順は、クライアント コンピューターではなく、NPS サーバーで実行する必要があります。

### <a name="to-configure-the-tls-handle-expiry-time-on-nps-servers"></a>TLS が NPS サーバーで有効期限の日時を処理を構成するには

1. NPS サーバーでは、レジストリ エディターを開きます。

2. レジストリ キーに移動**HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\SecurityProviders\SCHANNEL**

3. **編集**] メニューのをクリックして**新規**、] をクリックし、**キー**します。

4. 種類**ServerCacheTime**、し、Enter キーを押します。

5. 右クリック**ServerCacheTime**、] をクリックして**新規**、] をクリックし、**DWORD (32 ビット) 値**します。

6. NPS サーバーをクライアントによって最初の認証が成功した後、クライアント コンピューターの TLS ハンドルをキャッシュすること、ミリ秒単位で入力します。

## <a name="obtain-the-sha-1-hash-of-a-trusted-root-ca-certificate"></a>信頼されたルート CA 証明書のハッシュ、SHA-1 を取得します。

この手順を使用して、ローカル コンピューターにインストールされている証明書からセキュア ハッシュ アルゴリズム (SHA 1) 信頼されたルート証明機関 (CA) のハッシュを取得します。 状況によっては、証明書の SHA-1 ハッシュを使用して証明書を指定する必要はグループ ポリシーを展開する場合などです。

グループ ポリシーを使用する場合は、1 つまたは複数信頼されたルート CA 証明書をクライアントが EAP または PEAP と相互認証プロセス中に、NPS サーバーを認証するために使用する必要がありますを指定できます。 クライアントは、サーバー証明書の検証に使用する必要があります信頼されたルート CA 証明書を指定するには証明書の SHA-1 ハッシュを入力できます。

この手順では、証明書の Microsoft 管理コンソール (MMC) スナップインを使用して信頼されたルート CA 証明書の SHA-1 ハッシュを取得する方法を示します。 

この手順を完了するには、メンバーである、**ユーザー**、ローカル コンピューターでグループ化します。

### <a name="to-obtain-the-sha-1-hash-of-a-trusted-root-ca-certificate"></a>信頼されたルート CA 証明書のハッシュ、SHA-1 を取得するには

1. 実行] ダイアログ ボックスまたは Windows PowerShell で、次のように入力します。**mmc**、し、Enter キーを押します。 Microsoft 管理コンソール \(MMC\) を開きます。 MMC で、をクリックして**ファイル**、] をクリックし、**追加/削除 Snap\in**します。 **スナップインを追加または**] ダイアログ ボックスが開きます。

2. **スナップインを追加または**で、**利用できるスナップイン**、] をダブルクリック**証明書**します。 証明書スナップイン ウィザードが開きます。 をクリックして**コンピューター アカウント**、] をクリックし、**次**します。

3. **コンピューターの選択**、いることを確認**ローカル コンピューター (このコンソールがで実行されているコンピューター)**が選択すると、] をクリックして**完了**、] をクリックし、**[OK]**します。

4. 左側のウィンドウでダブルクリック**証明書 (ローカル コンピューター)**、] をダブルクリックし、**信頼されたルート証明機関**フォルダー。

5. **証明書**フォルダーのサブフォルダーになって、**信頼されたルート証明機関**フォルダー。 をクリックして、**証明書**フォルダー。

6. 詳細ウィンドウで、信頼されたルート CA の証明書を参照します。 証明書をダブルクリックします。 **証明書**] ダイアログ ボックスが開きます。

7. **証明書**ダイアログ ボックスで、をクリックして、**詳細**] タブ。

8. フィールドの一覧をスクロールして、選択**拇印**します。

9. 下のウィンドウで、証明書の SHA-1 ハッシュは、16 進数の文字列が表示されます。 選択、SHA-1 ハッシュ、およびコピーを押して Windows のキーボード ショートカットからコマンドを \(CTRL\+C\) ハッシュを Windows クリップボードにコピーします。

10. 場所を開く \(CTRL\+V\)] コマンドをする SHA-1 ハッシュを貼り付けますを正しくカーソルを見つけて、貼り付けの Windows のキーボード ショートカット キーを押します。 

証明書と NPS の詳細については、次を参照してください。[PEAP と EAP の要件の証明書テンプレートを構成する](nps-manage-cert-requirements.md)します。

NPS の詳細については、次を参照してください。[ネットワーク ポリシー サーバー (NPS)](nps-top.md)します。
