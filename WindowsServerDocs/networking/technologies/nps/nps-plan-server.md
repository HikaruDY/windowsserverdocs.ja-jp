---
title: NPS を RADIUS サーバーとして計画する
description: このトピックでは、ネットワーク ポリシー サーバーの RADIUS サーバーの展開が Windows Server 2016 での計画に関する情報を提供します。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 5fd89ef8d95735b8cbe1334ba51ed0059595dbc3
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839173"
---
# <a name="plan-nps-as-a-radius-server"></a>NPS を RADIUS サーバーとして計画する

>適用対象:Windows Server 2016 の Windows Server (半期チャネル)

ネットワーク ポリシー サーバーを展開すると\(NPS\)をリモート認証ダイヤルイン ユーザー サービス (RADIUS) サーバーとして NPS が実行認証、承認、およびアカウンティングのローカル ドメインとドメインの接続要求ローカル ドメインを信頼します。 これらの計画ガイドラインを使用するには、RADIUS デプロイを簡略化します。

これらの計画ガイドラインでは、NPS を RADIUS プロキシとして展開する状況は含まれません。 RADIUS プロキシとして機能する NPS を展開するときに、NPS は NPS または他の RADIUS サーバーをリモート ドメイン、信頼されていないドメイン、またはその両方で実行するサーバーに接続要求を転送します。 

NPS を RADIUS サーバーとして、ネットワーク上を展開する前に、展開を計画して、次のガイドラインを使用します。

- NPS 構成を計画します。

- RADIUS クライアントを計画します。

- 認証方法の使用を計画します。

- ネットワーク ポリシーを計画します。

- NPS のアカウンティングを計画します。

## <a name="plan-nps-configuration"></a>NPS 構成を計画します。

ドメイン メンバーである、NPS を決める必要があります。 複数ドメイン環境で、NPS は、資格情報と、NPS のローカル ドメインを信頼するすべてのドメインのメンバーは、ドメイン内のユーザー アカウントを認証できます。 承認プロセス中にユーザー アカウントのダイヤルイン プロパティを読み取る、NPS は、各ドメインの RAS および NPSs グループに、NPS のコンピューター アカウントを追加する必要があります。

NPS のドメイン メンバーシップを確認した後、サーバーは RADIUS クライアント、RADIUS プロトコルを使用して、ネットワーク アクセス サーバーとも呼ばれますと通信するように構成する必要があります。 さらに、構成できますイベントの種類を記録する NPS イベント ログは、サーバーの説明を入力できます。

### <a name="key-steps"></a>主要な手順

NPS 構成を計画する際に、次の手順を使用することができます。

- NPS を使用して RADIUS クライアントから RADIUS メッセージを受信する RADIUS ポートを決定します。 既定のポートとは、UDP ポートを 1812 および 1645 RADIUS 認証メッセージとポート 1813 および 1646 RADIUS アカウンティング メッセージ用です。

- 複数のネットワーク アダプター、NPS を構成する場合は、RADIUS トラフィックを許可するときに経由するアダプターを決定します。

- Nps イベント ログに記録するイベントの種類を決定します。 拒否された認証要求、認証が成功した要求、または両方の種類の要求を記録できます。

- 1 つ以上の NPS を展開するかどうかを決定します。 RADIUS ベースの認証およびアカウンティングのフォールト トレランスを提供するには、少なくとも 2 つの NPSs を使用します。 プライマリ RADIUS サーバーとして 1 つの NPS を使用し、もう一方はバックアップとして使用します。 各 RADIUS クライアントは、両方 NPSs にし、構成されます。 プライマリ NPS が使用できなくなった場合の RADIUS クライアントは別の NPS へアクセス要求メッセージを送信します。

- 管理オーバーヘッドを保存して、サーバーの不適切な構成を防ぐためには、その他の NPSs に 1 つの NPS 構成をコピーするためのスクリプトを計画します。 NPS は、別の NPS にインポート、NPS の構成の一部またはすべてをコピーするための Netsh コマンドを提供します。 コマンドは、Netsh プロンプトから手動で実行できます。 ただし、スクリプトとして、コマンドのシーケンスを保存する場合、サーバーの構成を変更する場合、後で、スクリプトを実行できます。

## <a name="plan-radius-clients"></a>RADIUS クライアントを計画します。

RADIUS クライアントは、ワイヤレス アクセス ポイントなどのネットワーク アクセス サーバー仮想プライベート ネットワーク (VPN) サーバー、802.1 X 対応スイッチ、およびダイアル アップ サーバー。 要求メッセージを RADIUS サーバー、接続を転送する RADIUS プロキシが RADIUS クライアントもあります。 NPS は、すべてのネットワーク アクセス サーバーをサポートしているし、RFC 2865 の「リモート認証ダイヤルイン ユーザー サービス (RADIUS)」」の説明に従って、RADIUS を遵守する RADIUS プロキシがプロトコルおよび RFC 2866 の「RADIUS Accounting。」

>[!IMPORTANT]
>クライアント コンピューターなど、アクセス クライアントは、RADIUS クライアントではありません。 ネットワーク アクセス サーバーおよび RADIUS プロトコルをサポートするプロキシ サーバーのみ RADIUS クライアントでは。

さらに、ワイヤレス アクセス ポイントとスイッチの両方は 802.1 X 認証に対応する必要があります。 拡張認証プロトコルをデプロイする場合\(EAP\)または Protected Extensible Authentication Protocol \(PEAP\)、アクセス ポイントとスイッチには、EAP の使用をサポートする必要があります。

ワイヤレス アクセス ポイントの PPP 接続用の基本的な相互運用性をテストするには、アクセス ポイントとパスワード認証プロトコル (PAP) を使用するアクセス クライアントを構成します。 ネットワーク アクセスに使用するものをテストするまでは、PEAP などの追加 (PPP) ベースの認証プロトコルを使用します。

### <a name="key-steps"></a>主要な手順

RADIUS クライアントを計画する際に、次の手順を使用することができます。

- ドキュメント、ベンダー固有属性 (Vsa) が NPS に構成する必要があります。 ネットワーク アクセス サーバーは、Vsa を必要とする場合は、NPS で、ネットワーク ポリシーを構成するときに後で使用 VSA 情報を記録します。 

- すべてのデバイスの構成を簡略化するには、RADIUS クライアントと、NPS の IP アドレスを文書化します。 RADIUS クライアントを展開するときに認証サーバーとして入力された NPS の IP アドレス、RADIUS プロトコルを使用するように構成する必要があります。 RADIUS クライアントと通信するように NPS を構成するときに、NPS スナップインに RADIUS クライアントの IP アドレスを入力する必要があります。

- RADIUS クライアントと NPS スナップインでは、構成の共有シークレットを作成します。 共有シークレット、または NPS の RADIUS クライアントを構成するときに、NPS スナップインにも入力するパスワードでは、RADIUS クライアントを構成する必要があります。

## <a name="plan-the-use-of-authentication-methods"></a>認証方法の使用を計画します。

NPS では、両方のパスワードに基づくし、証明書ベースの認証方法をサポートします。 ただし、すべてのネットワーク アクセス サーバーは、同じ認証方法をサポートします。 場合によっては、ネットワーク アクセスの種類に基づいてさまざまな認証方法を展開する場合があります。

たとえば、ワイヤレスおよびお客様の組織に対する VPN アクセスの両方のデプロイが、アクセスの種類ごとに別の認証方法を使用したい場合があります。トランスポート層セキュリティ (EAP-TLS) を使用する EAP が提供する強力なセキュリティのための VPN 接続および 802.1 X ワイヤレス接続用に PEAP-MS-CHAP v2 の EAP-TLS を使用します。

Microsoft チャレンジ ハンドシェイク認証プロトコル バージョン 2 (- PEAP-MS-CHAP v2) は、高速と呼ばれる機能を使用する PEAP では、ポータブル コンピューターやその他のワイヤレス デバイスで使用するために設計されている接続し直します。 新しいアクセス ポイントに関連付けられるたびを受けなくても同じネットワーク上のワイヤレス アクセス ポイント間を移動により、ワイヤレス クライアントが高速再接続します。 これにより、ワイヤレス ユーザーより優れたエクスペリエンスを提供し、自分の資格情報を再入力しなくてもアクセス ポイント間を移動することができます。
により高速再接続し、PEAP-MS-CHAP v2 を提供するセキュリティ - PEAP-MS-CHAP v2 ワイヤレス接続の認証方法としては論理的な選択は、します。

VPN 接続の場合は、EAP-TLS は、組織の VPN サーバーに自宅またはモバイル コンピューターからインターネット経由で送信されることも、ネットワーク トラフィックを保護する強力なセキュリティを提供する証明書ベースの認証方法です。

### <a name="certificate-based-authentication-methods"></a>証明書ベースの認証方法

証明書ベースの認証方法がある強力なセキュリティを提供することの利点困難にパスワード ベースの認証方法よりもデプロイされている場合の欠点があります。

PEAP-MS-CHAP v2 と EAP-TLS の両方が、証明書ベースの認証方法が、デプロイする方法には多くの違いがあります。

### <a name="eap-tls"></a>EAP-TLS

EAP-TLS は、クライアントとサーバーの両方の認証に証明書を使用して、組織の公開キー基盤 (PKI) を展開する必要があります。 PKI を展開する、複雑になる可能性し、計画の段階の NPS を RADIUS サーバーとして使用するための計画から独立している必要があります。

NPS は eap-tls、証明機関からのサーバー証明書を登録\(CA\)、証明書ストアにローカル コンピューターで、証明書が保存されます。 認証プロセス中に、サーバーの認証は、NPS は、アクセス クライアントの身元を証明するために、アクセス クライアントにそのサーバー証明書を送信するときに発生します。 アクセス クライアントは、証明書が有効でありサーバーの認証時に、使用に適しているかどうかを判断するさまざまな証明書のプロパティを調べます。 サーバー証明書は、最低限のサーバー証明書の要件を満たしているし、アクセス クライアントが信頼している CA によって発行された、NPS はクライアントによって正常に認証します。

同様に、クライアント認証は、クライアントがクライアント証明書を NPS に身元を証明するために、NPS に送信するとき、認証プロセス中に発生します。 NPS は、証明書を調べ、クライアント証明書は、最小限のクライアント証明書の要件を満たしているし、NPS が信頼している CA によって発行されたが、アクセス クライアントが NPS によって正常に認証します。

サーバー証明書を NPS の証明書ストアに保存することを必要に応じて、クライアントまたはユーザー証明書に格納できるクライアントまたはスマート カード、証明書ストア。

この認証プロセスを完了するは、必要なすべてのコンピューターにある、ローカル コンピューターと現在のユーザーの信頼されたルート証明機関の証明書ストアに、組織の CA 証明書。

### <a name="peap-ms-chap-v2"></a>PEAP-MS-CHAP v2

PEAP-MS-CHAP v2 では、サーバー認証とユーザー認証の資格情報のパスワードに基づく証明書を使用します。 証明書はサーバーの認証のみで使用されるため、PEAP-MS-CHAP v2 を使用するには、PKI を展開する必要はありません。 PEAP-MS-CHAP v2 を展開するときに、次の 2 つの方法のいずれかで、NPS のサーバー証明書を取得できます。

- NPSs に Active Directory 証明書サービス (AD CS) と、自動登録証明書をインストールすることができます。 このメソッドを使用する場合も、NPS に発行された証明書を信頼するように、ネットワークに接続するクライアント コンピューターに CA 証明書を登録する必要があります。

- サーバー証明書は、VeriSign などのパブリック CA から購入できます。 このメソッドを使用する場合は、クライアント コンピューターによって既に信頼されている CA を選択することを確認します。 クライアント コンピューターに CA を信頼し、クライアント コンピューターの証明書 Microsoft 管理コンソール (MMC) スナップインを開くし、現在のユーザーとローカル コンピューターの信頼されたルート証明機関ストアを表示するかどうかを確認します。 これらの証明書ストア内の CA から証明書がある場合、クライアント コンピューターが CA を信頼しはそのため、CA によって発行された任意の証明書を信頼します。

PEAP-MS-CHAP v2 認証プロセス中に、サーバーの認証は、NPS はクライアント コンピューターにそのサーバー証明書を送信するときに発生します。 アクセス クライアントは、証明書が有効でありサーバーの認証時に、使用に適しているかどうかを判断するさまざまな証明書のプロパティを調べます。 サーバー証明書は、最低限のサーバー証明書の要件を満たしているし、アクセス クライアントが信頼している CA によって発行された、NPS はクライアントによって正常に認証します。

ユーザー認証は、ユーザーがネットワークの種類のパスワードに基づく資格情報に接続するときに発生し、ログオンを試みます。 NPS では、資格情報を受信し、認証と承認を実行します。 ユーザーが認証され、正常に承認し、クライアント コンピューターは、NPS を正常に認証された場合は、接続要求が付与されます。

### <a name="key-steps"></a>主要な手順

認証方法の使用を計画する際に、次の手順を使用することができます。

- ワイヤレス、VPN、802.1 X 対応スイッチを提供する予定のネットワーク アクセスおよびダイヤルアップ アクセスの種類を識別します。

- 認証方法またはアクセスの種類ごとに使用する方法を決定します。 強力なセキュリティを提供する証明書ベースの認証メソッドを使用することをお勧めただし、その現実的ではありません他の認証方法には、ネットワークで必要なもののより良いバランスが提供するために、PKI を展開することです。

- EAP-TLS を展開する場合は、PKI の展開を計画します。 これは、サーバー証明書とクライアント コンピューターの証明書を使用する証明書テンプレートの計画が含まれます。 ドメインのメンバーと非ドメイン メンバー コンピューター、およびスマート カードを使用するかどうかを決定する証明書を登録する方法を決定するも含まれています。

- PEAP-MS-CHAP v2 を展開する場合は、VeriSign などの公共の CA からサーバー証明書を購入するか、または、NPSs にサーバー証明書を発行する AD CS をインストールするかどうかを決定します。

### <a name="plan-network-policies"></a>ネットワーク ポリシーを計画します。

ネットワーク ポリシーは、RADIUS クライアントから受信した接続要求を承認するかどうかを判断する NPS が使用されます。 NPS では、承認を確認するのにユーザー アカウントのダイヤルイン プロパティも使用します。

ネットワーク ポリシーは、NPS スナップインで表示される順序で処理されるためには、ポリシーの一覧で、最も制限の厳しいポリシーを最初に配置する予定です。 各接続要求は、NPS は接続要求のプロパティを持つポリシーの条件に一致を試みます。 NPS は、一致が見つかるまで順番には、各ネットワーク ポリシーを調べます。 一致が見つからない場合は、接続要求は拒否されます。

### <a name="key-steps"></a>主要な手順

ネットワーク ポリシーの計画時に、次の手順を使用することができます。

- 最も制限の緩いに最も制限の厳しいからのネットワーク ポリシーの推奨される NPS の処理順序を決定します。

- ポリシーの状態を決定します。 ポリシーの状態は、有効または無効の値を持つことができます。 ポリシーが有効になっている場合、NPS は承認の実行中に、ポリシーを評価します。 ポリシーが有効でない場合は評価されません。

- ポリシーの種類を決定します。 ポリシーが接続要求ポリシーが接続要求ポリシーの条件が一致すると、アクセスを拒否するように設計するかどうかによって、ポリシーの条件が一致すると、アクセスを許可するように設計するかどうかを判断する必要があります。 たとえば、Windows グループのメンバーにワイヤレス アクセスを明示的に拒否する場合は、グループには、ワイヤレス接続のメソッドが含まれている種類のアクセスを拒否の設定ポリシーには指定するネットワーク ポリシーを作成できます。

- NPS は、ポリシーの基になるグループのメンバーであるユーザー アカウントのダイヤルイン プロパティを無視するかどうかを決定します。 この設定が有効でない場合、ユーザー アカウントのダイヤルイン プロパティは、ネットワーク ポリシーで構成されている設定をオーバーライドします。 たとえば、ユーザー アクセスを許可するネットワーク ポリシーが構成されている、アクセスを拒否するユーザーのユーザー アカウントのダイヤルイン プロパティを設定する場合は、ユーザーはアクセスが拒否されます。 同じユーザーがネットワークへのアクセスを付与してポリシーの種類の設定を無視するユーザー アカウント ダイヤルイン プロパティを有効にした場合。

- このポリシーがポリシー ソースの設定を使用するかどうかを決定します。 この設定では、すべてのアクセス要求のソースを簡単に指定できます。 使用可能なソースは、ターミナル サービス ゲートウェイ (TS ゲートウェイ)、リモート アクセス サーバー (VPN またはダイアル アップ)、DHCP サーバー、ワイヤレス アクセス ポイント、および正常性登録機関のサーバーです。 または、ベンダー固有のソースを指定できます。

- ネットワーク ポリシーを適用するために従う必要がある条件を決定します。

- 接続要求によって、ネットワーク ポリシーの条件が一致する場合に適用される設定を決定します。

- 使用して、変更、または既定のネットワーク ポリシーを削除するかどうかを決定します。

## <a name="plan-nps-accounting"></a>NPS のアカウンティングを計画します。

NPS には、ユーザー認証およびアカウンティングの要求などの RADIUS アカウンティング データを 3 つの形式でログオンする機能が用意されています。IAS 形式、データベース互換形式、および Microsoft SQL Server のログ記録します。 

IAS 形式とデータベースと互換性のある形式は、テキスト ファイル形式でローカルの NPS のログ ファイルを作成します。 

SQL Server のログ記録は、SQL Server 2000 またはリレーショナル データベースへのログ記録の利点を活用する RADIUS アカウンティングの拡張、SQL Server 2005 の XML 準拠のデータベースにログオンする機能を提供します。

### <a name="key-steps"></a>主要な手順

NPS のアカウンティングを計画する際に、次の手順を使用することができます。

- ログ ファイルまたは SQL Server データベースでは、NPS のアカウンティング データを格納するかどうかを決定します。

### <a name="nps-accounting-using-local-log-files"></a>ローカル ログ ファイルを使用して NPS のアカウンティング

ユーザー認証の記録しアカウンティング要求のログ ファイルでは接続分析および課金の目的で主に使用および後に悪意のあるユーザーのアクティビティを追跡するためのメソッドを使用することにより、セキュリティの調査ツールとしても有用です、攻撃です。

### <a name="key-steps"></a>主要な手順

ローカル ログ ファイルを使用して NPS のアカウンティングを計画する際に、次の手順を使用することができます。

- NPS ログ ファイルを使用するテキスト ファイル形式を決定します。

- ログに記録情報の種類を選択します。 アカウンティング要求、認証要求、および定期的なステータスを記録できます。

- ログ ファイルを保存するハード_ディスクの場所を決定します。

- ログ ファイルのバックアップ ソリューションを設計します。 ログ ファイルを保存するハード_ディスクの場所を使用すると、データを簡単にバックアップする場所があります。 さらに、ハード_ディスクの場所の場合は、ログ ファイルが格納されるフォルダーのアクセス制御リスト (ACL) を構成することによって保護されている必要があります。

- 新しいログ ファイルを作成する頻度を決定します。 ログ ファイルをファイルのサイズに基づいて作成する場合は、NPS で、新しいログ ファイルが作成される前に許可されている最大ファイル サイズを決定します。

- NPS をハード ディスク記憶域スペースが不足した場合は、古いログ ファイルを削除するかどうかを決定します。

- アプリケーションまたはアカウンティング データを表示して、レポートの生成に使用するアプリケーションを決定します。

### <a name="nps-sql-server-logging"></a>SQL サーバーの NPS のログ記録

SQL サーバーの NPS のログ記録は、レポートの作成とデータ分析の目的とを一元化し、アカウンティング データの管理を簡略化、セッション状態情報を必要なときに使用されます。

NPS は、SQL Server および Microsoft SQL Server Desktop Engine を実行しているコンピューター上のデータ ソースに 1 つまたは複数のネットワーク アクセス サーバーから受信した要求をアカウンティングのログ レコードのユーザーの認証に使用する機能を提供します\(MSDE 2000。\)、または SQL Server SQL Server 2000 以降の任意のバージョン。

両方の構造化照会言語をサポートしているデータベース内のストアド プロシージャに XML 形式で、アカウンティング データが NPS から渡される\(SQL\)および XML \(SQLXML\)します。 ユーザー認証の記録とアカウンティング要求は、XML 対応の SQL Server データベースでは、1 つのデータ ソースとする複数の NPSs を使用できます。

### <a name="key-steps"></a>主要な手順

計画時に、NPS のアカウンティングの SQL サーバーの NPS のログ記録を使用して、次の手順を使用できます。

- か、組織の他のメンバーが SQL Server 2000 または SQL Server 2005 のリレーショナル データベース開発環境し、これらの製品を使用して、作成、変更、管理、および SQL Server データベースを管理する方法を理解するかどうかを決定します。

- NPS またはリモートのコンピューターに SQL Server がインストールされているかどうかを決定します。

- NPS アカウンティング データを含む XML ファイルの受信処理には、SQL Server データベースで使用するストアド プロシージャをデザインします。

- SQL Server データベース レプリケーションの構造とフローをデザインします。

- アプリケーションまたはアカウンティング データを表示して、レポートの生成に使用するアプリケーションを決定します。

- すべてのアカウンティング要求のクラス属性を送信するネットワーク アクセス サーバーを使用する予定です。 クラス属性は、Access-accept メッセージで、RADIUS クライアントに送信されはセッションの認証とアカウンティング要求メッセージを相関させるために便利です。 クラス属性をアカウンティング要求メッセージのネットワーク アクセス サーバーによって送信する場合は、アカウンティング、認証のレコードを一致するように使用できます。 一意のシリアル番号、サービスの起動時刻、およびサーバー アドレスの属性の組み合わせは、サーバーが受け取る認証ごとの一意の id である必要があります。

- 中間の計算をサポートするネットワーク アクセス サーバーを使用する予定です。

- アカウンティングのオンとオフは、アカウンティング メッセージを送信するネットワーク アクセス サーバーを使用する予定です。

- 保存をサポートするネットワーク アクセス サーバーとアカウンティング データの転送を使用する予定です。 ネットワーク アクセス サーバーは、NPS と通信できない場合、この機能をサポートするネットワーク アクセス サーバーはアカウンティング データを格納できます。 NPS が利用できる場合、ネットワーク アクセス サーバー、格納されているレコードに転送、NPS では、この機能を提供しないネットワーク アクセス サーバーに対する計算で信頼性の向上を実現すます。

- 常にネットワーク ポリシーで $acct-それまでの間の間隔 属性を構成する予定です。 $Acct-それまでの間の間隔 属性では、ネットワーク アクセス サーバーに送信する各暫定的な更新の間隔 (秒) を間隔を設定します。 RFC 2869、に従って $acct-それまでの間の間隔の属性の値は 60 秒または 1 分よりも小さいことができないする必要があり、600 秒または 10 分よりも大きくなければなりません。 詳細については、RFC 2869、「RADIUS 拡張機能」を参照してください。

- NPSs で定期的な状態のログ記録が有効になっていることを確認します。

