---
title: NPS を RADIUS サーバーとして計画します。
description: このトピックでは、ネットワーク ポリシー サーバーの RADIUS サーバー展開の Windows Server 2016 の計画に関する情報を提供します。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: pashort
author: shortpatti
ms.openlocfilehash: e9bb95428c17e5d7bde588693e84288ddfe64531
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="plan-nps-as-a-radius-server"></a>NPS を RADIUS サーバーとして計画します。

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

リモート認証ダイヤルイン ユーザー サービス (RADIUS) サーバーとしてネットワーク ポリシー サーバー \(NPS\) を展開するときに、NPS は、ローカル ドメインと、ローカル ドメインを信頼するドメインの場合、接続要求に対する認証、承認、およびアカウンティングを実行します。 これらの計画のガイドラインを使用すると、RADIUS 展開を簡略化します。

これらの計画のガイドラインでは、RADIUS プロキシとしての NPS を展開する場合は含まれません。 RADIUS プロキシとしての NPS を展開するときに、NPS は、リモート ドメイン、信頼されていないドメイン、またはその両方で、NPS または他の RADIUS サーバーを実行しているサーバーへの接続要求を転送します。 

NPS を RADIUS サーバーとして、ネットワーク上で展開する前に、展開を計画して、次のガイドラインを使用します。

- NPS サーバーの構成を計画します。

- RADIUS クライアントを計画します。

- 認証方法の使用を計画します。

- ネットワーク ポリシーを計画します。

- NPS アカウンティングを計画します。

## <a name="plan-nps-server-configuration"></a>NPS サーバーの構成を計画します。

どのドメインに NPS サーバーは、メンバーを決定する必要があります。 複数ドメイン環境では、NPS サーバーは、資格情報と NPS サーバーのローカル ドメインを信頼するすべてのドメインのメンバーは、ドメイン内のユーザー アカウントを認証できます。 NPS サーバーを承認プロセス中にユーザー アカウントのダイヤルイン プロパティの読み取りを許可するには、RAS および NPS サーバー グループにドメインごとに、NPS サーバーのコンピューター アカウントを追加する必要があります。

NPS サーバーのドメインのメンバーシップを確認した後は、RADIUS プロトコルを使用して、ネットワーク アクセス サーバーとも呼ばれます、RADIUS クライアントと通信するために、サーバーを構成する必要があります。 さらに、構成できますイベントの種類 NPS を記録するイベント ログとするサーバーの説明を入力できます。

### <a name="key-steps"></a>主要な手順

NPS サーバーの構成の計画時に、次の手順を使用することができます。

- NPS サーバーがメッセージを受信する RADIUS RADIUS クライアントから使用する RADIUS ポートを確認します。 既定のポートは、UDP ポート 1812、RADIUS 認証メッセージに対して 1645 1813 および 1646 RADIUS アカウンティング メッセージ用にポートです。

- NPS サーバーが複数のネットワーク アダプターで構成されている場合は、RADIUS トラフィックを許可するときに経由するアダプターを確認します。

- Nps でイベント ログに記録するイベントの種類を決定します。 拒否された認証要求、成功した認証要求、または両方の種類の要求をログインすることができます。

- 1 つ以上の NPS サーバーを展開しているかどうかを決定します。 RADIUS ベースの認証とアカウンティングのフォールト トレランスを提供するには、少なくとも 2 つの NPS サーバーを使用します。 別の NPS サーバーはプライマリ RADIUS サーバーとして使用し、他は、バックアップとして使用します。 各 RADIUS クライアントは、両方の NPS サーバーで構成されます。 プライマリの NPS サーバーが使用できなくなった場合 RADIUS クライアントは別の NPS サーバーへのアクセス要求メッセージを送信します。

- 管理オーバーヘッドで保存し、サーバーの正しくない構成できないようにするのには、他の NPS サーバーに NPS サーバーの 1 つの構成をコピーするためのスクリプトを計画します。 NPS では、別の NPS サーバーにインポートする NPS サーバーの構成の一部または全部をコピーするための Netsh コマンドを提供します。 Netsh プロンプトでコマンドを手動で実行することができます。 ただし、スクリプトとして、コマンド シーケンスを保存する場合、サーバーの構成を変更する場合、後で、スクリプトを実行できます。

## <a name="plan-radius-clients"></a>RADIUS クライアントを計画します。

RADIUS クライアントと、ワイヤレス アクセス ポイントなどのネットワーク アクセス サーバーは仮想プライベート ネットワーク (VPN) サーバー、802.1 X 対応スイッチ、およびダイアル アップ サーバー。 RADIUS クライアントがも RADIUS プロキシは、接続要求メッセージを RADIUS サーバーに転送できます。 NPS は、すべてのネットワーク アクセス サーバーをサポートしているし、RFC 2865、「リモート認証ダイヤルイン ユーザー サービス (RADIUS)」の説明に従ってプロトコルの RADIUS プロキシ RADIUS に準拠していると、「RADIUS アカウンティング。」

>[!IMPORTANT]
>クライアント コンピュータなどのアクセス クライアントは、RADIUS クライアントではありません。 のみネットワーク アクセス サーバーとプロキシ サーバー、RADIUS プロトコルをサポートする RADIUS クライアントでは。

さらに、ワイヤレス アクセス ポイントとスイッチの両方できる必要があります 802.1 X 認証します。 Extensible Authentication Protocol \(EAP\) または Protected Extensible Authentication Protocol \(PEAP\) を展開する場合は、アクセス ポイントとスイッチは EAP の使用をサポートする必要があります。

ワイヤレス アクセス ポイントを PPP 接続用の基本的な相互運用性をテストするには、アクセス ポイントとパスワード認証プロトコル (PAP) を使用するアクセス クライアントを構成します。 ネットワーク アクセスに使用する予定のものをテストするまでは、PEAP などの追加 PPP ベースの認証プロトコルを使用します。

### <a name="key-steps"></a>主要な手順

RADIUS クライアントの計画時に、次の手順を使用することができます。

- NPS で構成する必要があります (Vsa) ベンダー固有属性を文書化します。 ネットワーク アクセス サーバーでは、Vsa 必要がある場合は、NPS で、ネットワーク ポリシーを構成するときに、後で使用できる VSA 情報を記録します。 

- すべてのデバイスの構成を簡略化するには、RADIUS クライアントと、NPS サーバーの IP アドレスを文書化します。 RADIUS クライアントを展開するときに、認証サーバーとして入力 NPS サーバーの IP アドレスを持つ、RADIUS プロトコルを使用するように構成する必要があります。 および RADIUS クライアントと通信するために NPS を構成するときに、NPS スナップインに RADIUS クライアントの IP アドレスを入力する必要があります。

- RADIUS クライアントと NPS の管理スナップインでは、共有シークレットの構成を作成します。 共有シークレット、または NPS の RADIUS クライアントを構成するときに、NPS スナップインにも入力するパスワードは、RADIUS クライアントを構成する必要があります。

## <a name="plan-the-use-of-authentication-methods"></a>認証方法の使用を計画します。

NPS では、両方のパスワード ベースし、証明書ベースの認証方法をサポートします。 ただし、すべてのネットワーク アクセス サーバーは、同じ認証方法をサポートします。 場合によっては、ネットワーク アクセスの種類に基づいて、さまざまな認証方法を展開する場合があります。

たとえば、ワイヤレスと、組織に対する VPN アクセスの両方を展開だけアクセスの種類ごとに別の認証方法を使用してする可能性があります: トランスポート層セキュリティ (EAP-TLS) の EAP を提供する強力なセキュリティのため、VPN 接続および 802.1 X ワイヤレス接続用の PEAP MS-CHAP v2 EAP-TLS を使用します。

PEAP と Microsoft チャレンジ ハンドシェイク認証プロトコル バージョン 2 (PEAP MS-CHAP v2) という名前の高速機能を提供するには、ポータブル コンピューターおよびその他のワイヤレス デバイスで使用するように設計された具体的には接続し直します。 新しいアクセス ポイントに関連付けられる毎回を受けなくても、同じネットワーク上のワイヤレス アクセス ポイント間を移動により、ワイヤレス クライアントが高速再接続します。 これは、ワイヤレス ユーザーより優れたエクスペリエンスを提供し、自分の資格情報を再入力することがなく、アクセス ポイントの間で移動することができます。
ため高速再接続し、PEAP MS-CHAP v2 が提供するセキュリティ、PEAP MS-CHAP v2 のワイヤレス接続の認証方法として論理選択肢は、します。

VPN 接続、EAP-TLS は、組織の VPN サーバーにホームまたはモバイル コンピューターからインターネット経由で転送しても、ネットワーク トラフィックを保護する強力なセキュリティを提供する証明書ベースの認証方法です。

### <a name="certificate-based-authentication-methods"></a>証明書ベースの認証方法

証明書ベースの認証方法が強力なセキュリティを提供することの利点があります。パスワード ベースの認証方法よりも展開するが難しい中の欠点は、必要であります。

PEAP MS-CHAP v2 と EAP-TLS の両方が、証明書ベースの認証方法が展開されている方法およびそれらの多くの違いがあります。

### <a name="eap-tls"></a>EAP-TLS

EAP-TLS は、クライアントとサーバーの両方の認証に証明書を使用し、組織では、公開キー基盤 (PKI) を展開することが必要です。 PKI を展開することが、複雑なでき、NPS を RADIUS サーバーとして使用するための計画とは独立計画フェーズが必要です。

NPS サーバーのサーバー証明書の登録、EAP-TLS で証明機関から \(CA\)、および証明書が、ローカル コンピューターの証明書ストアに保存されます。 認証プロセス中には、サーバー認証は、NPS サーバーがアクセス クライアント アクセス クライアントの身元を証明するためにそのサーバー証明書を送信するときに発生します。 アクセス クライアントでは、証明書が有効ではおよびサーバー認証時に使用する適切なかどうかを判断するさまざまな証明書のプロパティについて説明します。 サーバー証明書は、最小サーバー証明書の要件を満たしているし、アクセス クライアントが信頼している CA によって発行された、NPS サーバーがクライアントによって正常に認証します。

同様に、クライアントを NPS サーバーの身元を証明するために NPS サーバーにクライアント証明書を送信すると、クライアント認証は認証プロセス中に発生します。 NPS サーバーが、証明書を検証し、クライアント証明書は、最小限のクライアント証明書の要件を満たしているし、NPS サーバーが信頼している CA によって発行された、アクセス クライアントが NPS サーバーが正常に認証します。

サーバー証明書が NPS サーバーの証明書ストアに格納されること、必要なクライアントやユーザー証明書に格納できるクライアントまたはスマート カードのいずれか証明書ストアです。

この認証プロセスを完了するは、必要なすべてのコンピューターにある、ローカル コンピューターと、現在のユーザーの信頼されたルート証明機関の証明書ストアに、組織の CA 証明書。

### <a name="peap-ms-chap-v2"></a>PEAP MS-CHAP v2

PEAP MS-CHAP v2 は、サーバー認証とユーザー認証のための資格情報のパスワード ベースの証明書を使用します。 証明書はサーバーの認証のみで使用されるため、PEAP MS-CHAP v2 を使用するために、PKI を展開する必要はありません。 PEAP MS-CHAP v2 を展開するときに、次の 2 つの方法のいずれかで、NPS サーバーのサーバー証明書を取得できます。

- NPS サーバーを Active Directory 証明書サービス (AD CS) し、たとえば「自動登録証明書をインストールすることができます。 このメソッドを使用する場合も、NPS サーバーに発行された証明書を信頼するように、ネットワークに接続するクライアント コンピューターに CA 証明書を登録する必要があります。

- VeriSign などのパブリック CA からサーバー証明書を購入することができます。 このメソッドを使用する場合は、クライアント コンピューターによってまだ信頼されている CA を選択することを確認します。 クライアント コンピューターに CA を信頼し、クライアント コンピューターで証明書 Microsoft 管理コンソール (MMC) スナップインを開くし、現在のユーザーとローカル コンピューターの信頼されたルート証明機関ストアを表示するかどうかを確認します。 これらの証明書ストア内の CA から証明書がある場合、クライアント コンピューターは、CA を信頼しはそのため、CA によって発行された任意の証明書を信頼します。

PEAP MS-CHAP v2 認証プロセスでは、サーバー認証は、NPS サーバーでは、そのサーバー証明書をクライアント コンピューターに送信するときに発生します。 アクセス クライアントでは、証明書が有効ではおよびサーバー認証時に使用する適切なかどうかを判断するさまざまな証明書のプロパティについて説明します。 サーバー証明書は、最小サーバー証明書の要件を満たしているし、アクセス クライアントが信頼している CA によって発行された、NPS サーバーがクライアントによって正常に認証します。

ユーザーの認証は、ネットワークの種類のパスワード ベースの資格情報への接続にしようとすると、ユーザーの場合に発生およびログオンしようとしています。 NPS では、資格情報を受信し、認証と承認を実行します。 ユーザーが認証され、正常に、承認されている場合、クライアント コンピューターには、NPS サーバーが正常に認証されている場合、接続要求が付与されます。

### <a name="key-steps"></a>主要な手順

計画時に、認証方法を使用するためには、次の手順を使用できます。

- など、ワイヤレス、VPN、802.1 X 対応のスイッチを提供する予定のネットワーク アクセスおよびダイアル アップ アクセスの種類を識別します。

- 認証方法またはアクセスの種類ごとに使用する方法を決定します。 強力なセキュリティを提供する証明書ベースの認証方法を使用することをお勧めただし、そのできない場合がありますを他の認証方法は、ネットワークを使用する場合の向上のバランスを保つ可能性がありますので、PKI を展開します。

- EAP-TLS を展開する場合は、PKI の展開を計画します。 これは、サーバー証明書とクライアント コンピュータ証明書を使用しようとする証明書テンプレートの計画が含まれます。 ドメインのメンバーと非ドメイン メンバー コンピューター、およびスマート カードを使用するかどうかを決定する証明書を登録する方法を決定するも含まれています。

- PEAP MS-CHAP v2 を展開する場合は、VeriSign などのパブリック CA から証明書を購入するか、または、NPS サーバーにサーバー証明書を発行する AD CS をインストールするかどうかを決定します。

### <a name="plan-network-policies"></a>ネットワーク ポリシーを計画します。

RADIUS クライアントから受信した接続要求が承認されているかどうかを確認するには、NPS でネットワーク ポリシーを使用します。 NPS は、承認の判断を行うため、ユーザー アカウントのダイヤルイン プロパティも使用します。

NPS の管理スナップインで表示される順序では、ネットワーク ポリシーが処理される、ために、ポリシーの一覧の最初に、最も制限の厳しいポリシーを配置する計画します。 各接続要求のため、NPS は、接続要求のプロパティで、ポリシーの条件に一致しようとします。 NPS は、一致するものが見つかるまでの順序で各ネットワーク ポリシーを検証します。 一致するものが見つからない場合は、接続要求は拒否されます。

### <a name="key-steps"></a>主要な手順

ネットワーク ポリシーの計画時に、次の手順を使用できます。

- ネットワーク ポリシー、最も制限の緩いに最も厳しい制限からの優先 NPS 処理順序を決定します。

- ポリシーの状態を確認します。 有効または無効になっているポリシーの状態の値ことができます。 ポリシーが有効になっている場合、NPS は、承認の実行中にポリシーを評価します。 ポリシーが有効でない場合は評価されません。

- ポリシーの種類を決定します。 ポリシーは、ポリシーの条件が一致した場合、接続要求ポリシーが、接続要求ポリシーの条件が一致すると、アクセスを拒否するように設計されて かどうか、アクセスを許可するように設計されて かどうかを決定する必要があります。 たとえば、Windows グループのメンバにワイヤレス アクセスを明示的に拒否する場合は、ネットワーク ポリシーを指定する、グループ、ワイヤレス接続方法、およびする種類のアクセスを拒否の設定ポリシーを作成できます。

- NPS は、ポリシーの基になっているグループのメンバであるユーザー アカウントのダイヤルイン プロパティを無視するかどうかを決定します。 この設定を無効にすると、ユーザー アカウントのダイヤルイン プロパティは、ネットワーク ポリシーで構成されている設定をオーバーライドします。 たとえば、アクセスをユーザーに付与するネットワーク ポリシーが構成されている場合は、そのユーザーのユーザー アカウントのダイヤルイン プロパティがアクセスを拒否する設定は、ユーザーはアクセスが拒否されます。 同じユーザーがネットワークへのアクセスを付与して、ポリシーの種類の設定を無視するユーザー アカウントにダイヤルイン プロパティを有効にした場合。

- このポリシーがソースのポリシー設定を使用するかどうかを決定します。 この設定では、すべてのアクセス要求のソースを簡単に指定することができます。 可能性のあるソースは、ターミナル サービス ゲートウェイ (TS ゲートウェイ)、(VPN またはダイアル アップ) は、リモート アクセス サーバー、DHCP サーバー、ワイヤレス アクセス ポイント、および正常性登録機関サーバーです。 または、ベンダー固有のソースを指定できます。

- ネットワーク ポリシーを適用するために一致する必要がある条件を確認します。

- ネットワーク ポリシーの条件が満たされた接続要求した場合に適用される設定を確認します。

- 使用して、変更、または既定のネットワーク ポリシーを削除するかどうかを決定します。

## <a name="plan-nps-accounting"></a>NPS アカウンティングを計画します。

NPS は 3 つの形式でユーザー認証とアカウンティング要求などの RADIUS アカウンティング データを記録する機能を提供します。 IAS 形式、データベース互換形式、および Microsoft SQL Server のログ記録します。 

IAS とデータベースとの互換性の形式は、テキスト ファイル形式のローカルの NPS サーバー上のログ ファイルを作成します。 

SQL Server のログは、SQL Server 2000 または SQL Server 2005 の XML 対応データベース、リレーショナル データベースにログの利点を活用する RADIUS アカウンティングの拡張にログオンする機能を提供します。

### <a name="key-steps"></a>主要な手順

NPS アカウンティングの計画時に、次の手順を使用することができます。

- ログ ファイルまたは SQL Server データベースでは、NPS アカウンティング データを格納するかどうかを決定します。

### <a name="nps-accounting-using-local-log-files"></a>ローカル ログ ファイルを使用して NPS アカウンティング

ログ ファイルに記録ユーザー認証とアカウンティング要求は、接続の分析と課金のために主に使用されも攻撃を受けた後の悪意のあるユーザーのアクティビティを追跡するためのメソッドを提供する、セキュリティの調査ツールとして役立ちます。

### <a name="key-steps"></a>主要な手順

ローカル ログ ファイルを使用して NPS アカウンティングの計画時に、次の手順を使用することができます。

- NPS、ログ ファイルを使用するテキスト ファイル形式を決定します。

- ログを記録情報の種類を選択します。 アカウンティング要求、認証要求、および定期的なステータスをログインすることができます。

- ログ ファイルを保存するハード_ディスクの場所を決定します。

- ログ ファイルのバックアップ ソリューションを設計します。 ログ ファイルを格納するハード_ディスクの場所は、簡単にデータをバックアップすることができます、場所にする必要があります。 さらに、ハード_ディスクの場所の場合は、ログ ファイルが格納されているフォルダーのアクセス制御リスト (ACL) を構成することによって保護されている必要があります。

- 新しいログ ファイルを作成する頻度を決定します。 ログ ファイル、ファイルのサイズに基づいて作成する場合は、NPS で新しいログ ファイルが作成される前に許可されているファイルの最大サイズを決定します。

- NPS をハード ディスク記憶域領域が不足している場合、古いログ ファイルを削除するかどうかを決定します。

- アカウンティング データを表示およびレポートの作成に使用するアプリケーションを決定します。

### <a name="nps-sql-server-logging"></a>NPS の SQL Server のログ

NPS の SQL Server のログは、レポートの作成およびデータ分析の目的でとを集中化および、アカウンティング データの管理を簡略化するため、セッション状態の情報を必要なときに使用されます。

NPS では、SQL Server および SQL Server 2000 以降、Microsoft SQL Server デスクトップ エンジン \(MSDE 2000\) または任意のバージョンの SQL Server を実行しているコンピューター上のデータ ソースを 1 つまたは複数のネットワーク アクセス サーバーから受信した要求をアカウンティングの記録のユーザーの認証にログを使用する機能を提供します。

アカウンティング データに渡される NPS から XML 形式の両方の構造化照会言語をサポートするいると、データベースのストアド プロシージャ \(SQL\) および XML \(SQLXML\) します。 ユーザー認証の記録とアカウンティング XML 対応の SQL Server データベースの要求は、1 つのデータ ソースを持つ複数の NPS サーバーを使用できます。

### <a name="key-steps"></a>主要な手順

計画時に、NPS アカウンティングの NPS の SQL Server ログを使用して、次の手順を使用することができます。

- か、組織の他のメンバーが SQL Server 2000 または SQL Server 2005 リレーショナル データベースの開発が発生して、これらの製品を使用して、作成、変更、管理、および SQL Server データベースを管理する方法を理解するかどうかを決定します。

- NPS サーバーで、またはリモート コンピューターで SQL Server がインストールされているかどうかを決定します。

- NPS アカウンティング データを格納する入力方向の XML ファイルを処理する SQL Server データベースで使用するストアド プロシージャを設計します。

- SQL Server データベース レプリケーションの構造とフローを設計します。

- アカウンティング データを表示およびレポートの作成に使用するアプリケーションを決定します。

- すべてのアカウンティング要求にクラスの属性を送信するネットワーク アクセス サーバーを計画します。 クラス属性は、アクセス許可のメッセージで、RADIUS クライアントに送信され、認証のセッションでのアカウンティング要求メッセージを関連付けるために便利です。 アカウンティング要求メッセージのネットワーク アクセス サーバーによってクラスの属性を送信する場合は、アカウンティングおよび認証のレコードに一致するように使用できます。 一意のシリアル番号、サービスの起動時刻、およびサーバー アドレスの属性の組み合わせは、サーバーが受け付ける認証ごとの一意の id である必要があります。

- 中間アカウンティングをサポートするネットワーク アクセス サーバーを計画します。

- アカウンティングのオンとオフは、アカウンティングのメッセージを送信するネットワーク アクセス サーバーを計画します。

- 保存をサポートするネットワーク アクセス サーバーとアカウンティング データの転送を使用する予定です。 ネットワーク アクセス サーバーが NPS サーバーと通信できない場合、この機能をサポートするネットワーク アクセス サーバーでアカウンティング データを格納できます。 NPS サーバーが利用可能なネットワーク アクセス サーバーは、この機能を提供しないネットワーク アクセス サーバー経由でアカウンティングで信頼性の向上を提供する、NPS サーバーに格納されているレコードを転送します。

- 常にネットワーク ポリシーで $acct-中間の間隔] 属性を構成する予定です。 $Acct-中間の間隔] 属性は、ネットワーク アクセス サーバーに送信される各暫定的な更新プログラムとの間、(単位: 秒)、間隔を設定します。 RFC 2869、に従って $acct の間隔中間属性の値は 60 秒間、または 1 分より大きくなければなりません、600 秒、または 10 分よりも小さくすることはできません。 詳細については、RFC 2869、[RADIUS の拡張機能」を参照してください。

- NPS サーバーでの定期的な状態のログ記録が有効になっていることを確認します。

