---
title: QoS ポリシーのしくみ
description: このトピックでは、グループ ポリシーを使用して、特定のアプリケーションおよび Windows Server 2016 でのサービスのネットワーク トラフィックの帯域幅の優先順位を設定することができるサービスの品質 (QoS) ポリシーの概要を示します。
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 25097cb8-b9b1-41c9-b3c7-3610a032e0d8
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 272272c833bb38924f1daa5561037901f6ff4e25
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59864283"
---
# <a name="how-qos-policy-works"></a>QoS ポリシーのしくみ

>適用対象:Windows Server 2016 の Windows Server (半期チャネル)

起動または更新されたユーザーまたはコンピューターの構成グループ ポリシー設定の QoS に取得すると、次の処理が行われます。

1. グループ ポリシー エンジンは、Active Directory からユーザーまたはコンピューターの構成グループ ポリシー設定を取得します。

2. QoS ポリシーの変更があった QoS のクライアント側拡張のグループ ポリシー エンジンに通知します。

3. QoS のクライアント側拡張機能は、QoS の検査モジュールに QoS ポリシーのイベント通知を送信します。

4. QoS の検査モジュールは、ユーザーまたはコンピューターの QoS ポリシーを取得し、それらを格納します。

ときに新しいトランスポート層エンドポイント\(TCP 接続または UDP トラフィック\)作成されると、次の処理が行われます。

1. TCP/IP スタックのトランスポート層のコンポーネントには、QoS の検査モジュールが通知されます。

2. QoS の検査モジュールは、トランスポート層エンドポイントに格納される QoS ポリシーのパラメーターを比較します。

3. 一致が見つかった場合、QoS 検査モジュールは Pacer.sys フロー、DSCP 値と一致する QoS ポリシーの設定を調整するトラフィックを含むデータ構造を作成するを接続します。 トランスポート層のエンドポイントのパラメーターと一致する複数の QoS ポリシーがある場合は、最も固有な QoS ポリシーが使用されます。

4. Pacer.sys はフローを保存し、QoS の検査モジュールへのフローに対応するフローの数を返します。

5. QoS の検査モジュールでは、トランスポート層にフローの数を返します。

6. トランスポート層では、トランスポート層のエンドポイントとフローの数を格納します。

トランスポート層のエンドポイントに対応するパケットがフローの数とマークされている場合は、送信、次の処理が行われます。

1. トランスポート層は、内部的にフローの番号を持つパケットをマークします。

2. ネットワーク層では、パケットのフローの数に対応する DSCP 値に Pacer.sys を照会します。

3. Pacer.sys は、ネットワーク層に DSCP 値を返します。

4. ネットワーク層では、Pacer.sys によって指定された DSCP 値を IPv4 の TOS フィールドまたは IPv6 トラフィック クラス フィールドを変更して、IPv4 パケットの場合は、最終的な IPv4 ヘッダーのチェックサムを計算します。

5. ネットワーク層では、フレーミング層にパケットを渡します。

6. フレーミング層がパケットを NDIS を通じて Pacer.sys に渡し、パケットは、フローの数がマークされている、ため 6.x します。

7. Pacer.sys はパケットが抑制される必要がある場合と、その場合を判断するフローの数、パケットを使用して、パケットを送信するためのスケジュールします。

8. Pacer.sys パケットに渡し、か、すぐに\(トラフィックがない場合は、調整\)またはスケジュールどおりに\(トラフィックがある場合の調整\)NDIS に 6.x で適切なネットワーク アダプターの送信。

ポリシー ベースの QoS のこれらのプロセスでは、次の利点を提供します。

- パケット単位ではなく-トランスポート層のエンドポイントは、QoS ポリシーを適用するかどうかを決定するトラフィックの検査が行われます。

- QoS ポリシーに一致しないトラフィックのパフォーマンスに与える影響はありません。

- アプリケーションは、DSCP ベースの差別化されたサービスを利用したり、トラフィックを制限するように変更する必要はありません。

- QoS ポリシーは、IPsec で保護されたトラフィックに適用できます。

次のトピックでは、このガイドでは、次を参照してください。 [QoS ポリシーのアーキテクチャ](qos-policy-architecture.md)します。

このガイドの最初のトピックを参照してください。[サービスの品質 (QoS) ポリシー](qos-policy-top.md)します。
