---
title: パフォーマンス チューニングのネットワーク アダプター
description: このトピックは、Windows Server 2016 のネットワーク サブシステムのパフォーマンス チューニング ガイドの一部です。
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 0b9b0f80-415c-4f5e-8377-c09b51d9c5dd
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 1c6d36966ce6e2d407b6568e16946745256ee69b
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="performance-tuning-network-adapters"></a>パフォーマンス チューニングのネットワーク アダプター

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

このトピックの「Windows Server 2016 を実行しているコンピューターにインストールされているパフォーマンス チューニング ネットワーク アダプターを使用することができます。

次の変数に依存して、ネットワーク アダプターの正しい調整設定を決定します。

- ネットワーク アダプターとその機能セット  

- サーバーが実行するワークロードの種類  

- サーバーのハードウェアとソフトウェア リソース  

- サーバーのパフォーマンス目標  

ネットワーク アダプターは、調整オプションを提供する場合は、前述のパラメーターに基づいて最適なスループットを実現するために、ネットワーク スループットとリソース使用率を最適化できます。  

次のセクションでは、パフォーマンス チューニング オプションの一部について説明します。  

##  <a name="bkmk_offload"></a>オフロード機能を有効にします。

ネットワーク アダプターのオフロード機能をオンにすると、一般的にメリットです。 場合によっては、ただし、ネットワーク アダプターは高スループットでオフロード機能を処理するのに十分ではありません。

>[!IMPORTANT]
>オフロード機能を使用しない**IPsec Task Offload**または**TCP Chimney オフロード**します。 これらのテクノロジは、Windows Server 2016 では推奨されなくなりましたし、サーバーとネットワークのパフォーマンスに悪影響を及ぼす可能性があります。 さらに、これらのテクノロジ可能性がありますサポートされていない Microsoft によって将来。

たとえば、セグメンテーション オフロードを有効にすると限られたハードウェア リソースのため、一部のネットワーク アダプター上で最大持続的スループットを削減できます。 ただし、スループットの低下が制限と考えられない場合は、この種類のネットワーク アダプターであっても、オフロード機能を有効にする必要があります。

>[!NOTE]
> 一部のネットワーク アダプターでは、個別に有効にしない送信と受信パスにオフロード機能が必要です。

##  <a name="bkmk_rss_web"></a>Receive Side Scaling (RSS) を Web サーバーを有効にします。

RSS には、サーバー上の論理プロセッサよりも少ないネットワーク アダプターがある場合に Web のスケーラビリティとパフォーマンスを向上できます。 すべての Web トラフィックが RSS 対応ネットワーク アダプターを介して送信されているとき、複数の Cpu で異なる接続からの着信 Web 要求を同時に処理することができます。

RSS とハイパー テキスト転送のロジックによりことに注意することが重要プロトコルの負荷分散に関する \(HTTP\)、RSS 対応ネットワーク アダプターが RSS 対応ネットワーク アダプターが 1 つまたは複数のサーバー上の Web トラフィックを受け入れる場合、パフォーマンスが大幅に低下する可能性があります。 このような状況で RSS 対応ネットワーク アダプターを使用またはネットワーク アダプターのプロパティで RSS を無効にする必要があります**プロパティの高度な**] タブ。ネットワーク アダプターが RSS 対応かどうかを確認するのには、ネットワーク アダプターのプロパティの RSS 情報を表示できます**プロパティの高度な**] タブ。

### <a name="rss-profiles-and-rss-queues"></a>RSS プロファイルと RSS キュー

既定の定義済みの RSS プロファイルは、以前のバージョンのオペレーティング システムから、既定の動作を変更する NUMA Static、です。 RSS プロファイルを使ってみるが役に立つ場合と、ネットワーク環境とハードウェアに適用する方法を理解する使用可能なプロファイルを確認することができます。

たとえば、タスク マネージャーを開き、サーバーで、論理プロセッサを確認してしているような受信トラフィックの使用率の低いする場合、は、ネットワーク アダプターでサポートされている最大値を既定の 2 から RSS キュー数を増やすこと試行できます。 ネットワーク アダプター ドライバーの一部として RSS キュー数を変更するオプションがあります。

##  <a name="bkmk_resources"></a>ネットワーク アダプターのリソースを増やす

ネットワーク アダプター用をリソースの手動構成を許可するなど、受信バッファーや送信、割り当てられているリソースを増やす必要があります。 

一部のネットワーク アダプターの設定、受信バッファー低メモリの割り当てられた節約にホストから。 小さい値により破棄されたパケットとパフォーマンスが低下します。 そのため、受信量が多いシナリオについては、最大に受信バッファー値を増やすことを勧めします。

>[!NOTE]
>ネットワーク アダプターが手動リソース構成を公開しない場合か、動的に構成すると、リソース、またはリソースが変更できない固定値に設定します。

### <a name="enabling-interrupt-moderation"></a>割り込み節度を有効にします。

割り込み節度を制御するには、一部のネットワーク アダプター公開異なる割り込み節度レベル、バッファー結合パラメーター (場合がありますに個別に送信し、受信バッファー)、またはその両方です。

CPU にバインドされたワークロードの場合、割り込み節度を考慮し、ため割り込みの増加と短い待機ホスト CPU の節約量と待機時間が増加ホスト CPU の節約量との間でトレードオフを考慮してください。 ネットワーク アダプターが割り込み節度を実行しませんが、バッファー結合を増やすことを公開して結合されるバッファーの数により、送信ごとのバッファーの数が増えるかが表示される、パフォーマンスを改善します。

##  <a name="bkmk_low"></a>低待機時間パケット処理のパフォーマンス チューニング

多くのネットワーク アダプターは、オペレーティング システムが原因の待機時間を最適化するオプションを提供します。 待機時間は、入力方向のパケットを処理ネットワーク ドライバーと、ネットワーク ドライバーがパケットを返送を送信するまでの経過時間です。 通常、この時間はマイクロ秒単位で測定します。 比較、長距離間のパケット送信の送信時間は、通常の単位はミリ秒 \ (、桁 larger\)。 この調整は、パケットの送信にかかる時間は短縮されません。

一部のパフォーマンス チューニングのマイクロ秒-影響を受けやすいネットワークの推奨事項を次に示します。

- コンピューターの BIOS 設定**高パフォーマンス**、C 状態を無効になっています。 ただし、システムと BIOS によって変わる場合は、これは、一部のシステムはパフォーマンスが高くなる場合は、オペレーティング システム コントロールを電源管理に注意してください。 確認してから、電源管理設定を調整**設定**またはを使用して、**powercfg**コマンド。 詳細については、次を参照してください[Powercfg のコマンド ライン オプション。](https://technet.microsoft.com/library/cc748940.aspx)

- オペレーティング システムの電源管理プロファイルを設定**高パフォーマンス システム**します。 これはしない適切に動作するシステム BIOS が電源管理のオペレーティング システムの制御を無効に設定されている場合に注意してください。

- UDP チェックサム、TCP チェックサム、や送信 Large Offload (LSO) など、静的オフロードを有効にします。

- トラフィックがマルチ ストリームされる大量のマルチキャストの受信している場合は、RSS を有効にします。

-   無効にする、**割り込み節度**最短の可能な待機時間を必要とするネットワーク カード ドライバーを設定します。 ただし、これより多くの CPU 時間を使用することができます、トレードオフを表します。

- パケットを処理するプログラム (ユーザー スレッド) によって使用されているコアと CPU キャッシュを共有するコア プロセッサでは、ネットワーク アダプターの割り込みと Dpc を処理します。 このために、RSS の構成と組み合わせて特定の論理プロセッサにプロセスを指示する CPU アフィニティの調整を使用できます。 割り込み、DPC、およびユーザー モード スレッドに同じコアを使用してなって現れる点がパフォーマンスは低下負荷が増加するにつれて、コアの使用に関する ISR、DPC、およびスレッドが競合するためです。

##  <a name="bkmk_smi"></a>システム管理の割り込み

レガシ USB の互換性、ファン制御、および BIOS 制御の電源管理、多くのハードウェア システムは、さまざまなメンテナンス機能、エラー修正コード \(ECC\) メモリ エラーの報告などのシステム管理の割り込み \(SMI\) を使用します。 

SMI は、システムで最も高い優先順位割り込みし、通常は BIOS に含まれる割り込みサービス ルーチンの実行時に、その他のすべてのアクティビティのプリエンプションを行います管理モードで、CPU を配置します。

残念ながら、100 マイクロ秒の待機時間のスパイク以上このことがあります。 

を最短の待機時間を実現するために必要がある場合は、Smi を可能な最も低いレベルに削減するハードウェア プロバイダーから BIOS のバージョンを要求する必要があります。 これらは頻繁に呼ば"低待機時間 BIOS"や"SMI フリー BIOS" 場合によっては、ことはできません、ハードウェア プラットフォーム SMI アクティビティを完全に排除するので、重要な機能 (冷却ファンなど) を制御するために使用されます。

>[!NOTE]
>オペレーティング システムできます保てますで Smi を制御、論理プロセッサがオペレーティング システムが操作できないようにする特別なメンテナンス モードで実行されているためです。

##  <a name="bkmk_tcp"></a>TCP のパフォーマンス チューニング

 次の項目を使用して TCP のパフォーマンスを調整することができます。

###  <a name="bkmk_tcp_params"></a>TCP の受信ウィンドウの自動調整

ネットワーク スタックを Windows Server 2008 より前に、接続の全体的な潜在的なスループットを制限する固定サイズ受信側ウィンドウ (65,535 バイト) を使用します。 TCP スタックの最も大きな変更点の 1 つは、TCP 受信ウィンドウの自動調整します。 

TCP の受信ウィンドウとして固定サイズを使用する場合は、1 つの接続の合計スループットを計算できます。

**合計の達成可能なスループット (バイト単位) = TCP ウィンドウのサイズ (バイト単位) が表示される \ * (1/接続の待機時間を秒単位)**

たとえば、達成可能な合計スループットはのみ 51 Mbps 上 10 ミリ秒の待機時間との接続 \ (大企業のネットワーク infrastructure\ の妥当な値)。 

ただし、自動調整と受信側ウィンドウが調整可能になりも大きくなる、送信者のニーズを満たす場合。 1 Gbps 接続のフル回線速度を達成することができます。 ネットワークの使用シナリオの TCP 接続の達成可能な合計スループットによって、これまでに制限されていた可能性がありますは、ネットワークを完全に使用できるようになりましたことができます。

#### <a name="deprecated-tcp-parameters"></a>推奨されなくなった TCP パラメーター

Windows Server 2003 から、次のレジストリ設定では、サポートされなくされ、以降のバージョンで無視されます。

すべての設定には、次のレジストリ キーがありませんでした。

    ```  
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters  
    ```  

- TcpWindowSize

- NumTcbTablePartitions  

- MaxHashTableSize  



###  <a name="bkmk_wfp"></a>Windows フィルタ リング プラットフォーム

Windows フィルタ リング プラットフォーム (WFP) Windows Vista および Windows Server 2008 で導入されたパケット処理フィルターを作成する Microsoft 以外の独立系ソフトウェア ベンダー (Isv) API が用意されています。 例についてには、ファイアウォールとウイルス対策ソフトウェアが含まれます。

>[!NOTE]
>不適切に作成された WFP フィルターでは、サーバーのネットワーク パフォーマンスを大幅に削減できます。 詳細については、次を参照してください。[移植パケット処理ドライバーおよび WFP をアプリ](https://msdn.microsoft.com/windows/hardware/gg463267.aspx)Windows デベロッパー センターでします。


このガイドのすべてのトピックへのリンクを参照してください。[ネットワーク サブシステムのパフォーマンス チューニング](net-sub-performance-top.md)します。
