---
ms.assetid: 6086947f-f9ef-4e18-9f07-6c7c81d7002c
title: Windows タイム サービスのツールと設定
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 10/16/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 84d10c30d42e92d325475a1143c85acce7456a80
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71395676"
---
# <a name="windows-time-service-tools-and-settings"></a>Windows タイム サービスのツールと設定
>適用先:Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows 10 以降

このトピックでは、Windows タイム サービス (W32Time) のツールと設定について説明します。 

ドメインに参加しているクライアント コンピューターの時刻を同期することのみが必要な場合は、「[ドメイン時刻の自動同期のためにクライアント コンピューターを構成する](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/cc816884%28v%3dws.10%29)」を参照してください。 Windows タイム サービスを構成する方法に関するその他のトピックについては、[Windows タイム サービスの構成情報を見つける方法](https://docs.microsoft.com/windows-server/networking/windows-time-service/windows-time-service-top)に関する記事を参照してください。  

> [!CAUTION]  
> Windows タイム サービスが実行されている場合は、Net time コマンドを使用して時間を構成および設定しないでください。  
>
> また、Windows XP 以前を実行している古いコンピューターでは、コマンド Net time /querysntp は、コンピューターの同期のための構成に使用されているネットワーク タイム プロトコル (NTP) サーバーの名前を表示しますが、NTP サーバーは、コンピューターのタイム クライアントが NTP または AllSync として構成されている場合にのみ使用されます。 このコマンドはその後、非推奨となりました。  

ほとんどのドメイン メンバー コンピューターのタイム クライアントの種類は NT5DS です。これは、ドメイン階層から時刻が同期されることを意味します。 この唯一の例外としての典型例は、フォレスト ルート ドメインのプライマリ ドメイン コントローラ (PDC) エミュレータ操作マスタとして機能するドメイン コントローラーです。これは通常、外部のタイム ソースを使用して時間を同期するように構成されています。 コンピューターのタイム クライアント構成を表示するには、Windows Server 2008 および Windows Vista 以降の管理者特権でのコマンド プロンプトから W32tm /query /configuration コマンドを実行し、コマンドの出力の **Type** 行を参照します。 詳細については、「[Windows タイム サービスのしくみ](https://docs.microsoft.com/windows-server/networking/windows-time-service/How-the-Windows-Time-Service-Works)」を参照してください。 コマンド **reg query HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters** を実行し、コマンドの出力で **NtpServer** の値を参照できます。  

> [!IMPORTANT]  
> Windows Server 2016 より前では、W32Time サービスは、精密な時間管理を必要とするアプリケーションのニーズを満たすように設計されていませんでした。  しかし、Windows Server 2016 の更新プログラムにより、1 ミリ秒の精度を実現するソリューションをドメインに実装できるようになりました。  詳しくは、[Windows 2016 の正確な時刻](accurate-time.md)および[高精度の環境に向けた Windows タイム サービスの構成を目的とするサポート範囲](https://docs.microsoft.com/windows-server/networking/windows-time-service/support-boundary)に関する記事を参照してください。  

## <a name="windows-time-service-tools"></a>Windows タイム サービス ツール  
Windows タイム サービスには次のツールが関連付けられています。  

#### <a name="w32tmexe-windows-time"></a>W32tm.exe:Windows タイム  
**カテゴリ**  

このツールは、Windows XP、Windows Vista、Windows 7、Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 の既定のインストールの一部としてインストールされます。  

**バージョンの互換性**  

このツールは、Windows XP、Windows Vista、Windows 7、Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 の既定のインストールで機能します。  

W32tm.exe は、Windows タイム サービス設定を構成するために使用されます。 また、タイムサービスに関する問題を診断するために使用することもできます。 W32tm.exe は、Windows タイム サービスを構成、監視、またはトラブルシューティングするために推奨されるコマンド ライン ツールです。  

次の表では、W32tm.exe で使用されるパラメーターについて説明します。  

**W32tm.exe の主なパラメーター**  


|                                                                                                                                  パラメーター                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                                                                                                   W32tm /?                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      W32tm のコマンド ライン ヘルプ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                                               W32tm /register                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  タイム サービスをサービスとして実行するように登録し、レジストリに既定の構成を追加します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                                                                              W32tm /unregister                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     タイム サービスの登録を解除し、すべての構成情報をレジストリから削除します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                                 w32tm /monitor<br /><br />[/domain:<domain name>] [/computers:<name>[,<name>[,<name>...]]] [/threads:<num>]                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                 domain - 監視するドメインを指定します。 ドメイン名が指定されていない場合、または domain と computers のどちらのオプションも指定されていない場合は、既定のドメインが使用されます。 このオプションは複数回使用される場合があります。<br /><br />computers - 指定されたコンピューターの一覧を監視します。 コンピューター名はコンマで区切り、スペースは使用しません。 名前にプレフィックス '\*' が付いている場合は、PDC として扱われます。 このオプションは複数回使用される場合があります。<br /><br />threads - 同時に分析するコンピューターの数を指定します。 既定値は 3 です。 許容範囲は 1 から 50 です。                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                                                                         w32tm /ntte <NT time epoch>                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   NT システム時刻 (0h 1-Jan 1601 から (10^-7)s 間隔) を読み取り可能な形式に変換します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                                                                                                        w32tm /ntpte <NTP time epoch>                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      NTP 時刻 (0h 1-Jan 1900 から (2^-32)s 間隔) を読み取り可能な形式に変換します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                               w32tm /resync<br /><br />[/computer:<computer>]<br /><br />[/nowait]<br /><br />[/rediscover]<br /><br />[/soft]                                                                               |                                                                                                                                                                                                                                                                                                                                                                      蓄積したエラー統計をすべて削除して、直ちに時刻を再同期するようにコンピュータに指示します。<br /><br />computer:<computer> - 再同期する必要があるコンピューターを指定します。 指定しない場合、ローカル コンピューターが再同期されます。<br /><br />nowait - 同期の再実行を待たずにすぐに返します。 指定がない場合は、同期の再実行の完了を待ってから返します。<br /><br />rediscover - ネットワーク構成を再検出し、ネットワーク ソースを再検出してから、再同期します。<br /><br />soft - 既存のエラー統計を使って再同期します。 互換性のために用意されたもので、あまり有効ではありません。                                                                                                                                                                                                                                                                                                                                                                      |
|                                                          w32tm /stripchart<br /><br />/computer:<target><br /><br />[/period:<refresh>]<br /><br />[/dataonly]<br /><br />[/samples:<count>]<br/><br/>[/rdtsc]<br/>                                                          |                            このコンピュータと別のコンピュータ間のオフセットのストリップ チャートを表示します。<br /><br />computer:<target> - オフセットを計測するターゲット コンピュータです。<br /><br />period:<refresh> - サンプルを収集する秒単位の間隔です。 既定値は 2 秒です。<br /><br />dataonly - データのみを表示し、グラフィックは表示しません。<br /><br />samples:<count> - <count> 個のサンプルを収集して停止します。 指定しない場合、**Ctrl + C** が押されるまでサンプルが収集されます。<br/><br/>rdtsc: 各サンプルについて、このオプションはテキスト グラフィックではなく、RdtscStart、RdtscEnd、FileTime、RoundtripDelay、NtpOffset のヘッダーと共にコンマ区切り値を出力します。<br/><ul><li>[RdtscStart - NTP 要求が生成される直前に収集された RDTSC (読み取りタイムスタンプ カウンター)](https://en.wikipedia.org/wiki/Time_Stamp_Counter) 値。</li><li>RdtscEnd - NTP 応答の受信と処理の直後に収集された RDTSC (読み取りタイムスタンプ カウンター) 値。</li><li>FileTime - NTP 要求で使用されるローカル FILETIME 値。</li><li>RoundtripDelay - NTP ラウンドトリップ計算に従って計算された、NTP 要求の生成から受信された NTP 応答の処理までの経過時間 (秒単位)。</li><li>NTPOffset - NTP オフセット計算に従って計算された、ローカル コンピューターと NTP サーバーの間の時間オフセット (秒単位)。</li></ul>                             |
| w32tm /config<br /><br />[/computer:<target>]<br /><br />[/update]<br /><br />[/manualpeerlist:<peers>]<br /><br />[/syncfromflags:<source>]<br /><br />[/LocalClockDispersion:<seconds>]<br /><br />[/reliable:(YES&#124;NO)]<br /><br />[/largephaseoffset:<milliseconds>] | computer:<target> - <target> の構成を調整します。 指定しない場合、既定値はローカル コンピューターです。<br /><br />update - タイム サービスに構成が変更されたことを通知し、変更を有効にします。<br /><br />manualpeerlist:<peers> - 手動ピアの一覧を <peers> に設定します。これは DNS または IP アドレス、あるいはその両方をスペースで区切った一覧です。 複数のピアを指定する場合は、このオプションを引用符で囲む必要が あります。<br /><br />syncfromflags:<source> - NTP クライアントの同期先であるソースを指定します。 <source> は、次のキーワードのコンマ区切りリストである必要があります (大文字と小文字は区別されません)。<br /><br />MANUAL - 手動ピアの一覧からピアを追加します。<br /><br />DOMHIER - ドメイン階層内のドメイン コントローラー (DC) から同期を取ります。<br /><br />LocalClockDispersion:<seconds> - 構成されたソースから時間を取得できない場合に W32Time が想定する内部クロックの精度を構成します。<br /><br />reliable:(YES&#124;NO) - このコンピュータが信頼性の高いタイム ソースであるかどうかを設定します。<br /><br />この設定はドメイン コントローラーでのみ有効です。<br /><br />YES - このコンピュータは信頼性の高いタイム サービスです。<br /><br />NO - このコンピュータは信頼性の高いタイム サービスではありません。<br /><br />largephaseoffset:<milliseconds> - W32Time がスパイクと見なすローカル時刻と ネットワーク時刻の時間差を設定します。 |
|                                                                                                                                  w32tm /tz                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              現在のタイムゾーン設定を表示します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                                                  w32tm /dumpreg<br /><br />[/subkey:<key>]<br /><br />[/computer:<target>]                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                指定されたレジストリ キーと関連付けられた値を表示します。<br /><br />既定のキーは HKLM\System\CurrentControlSet\Services\W32Time<br /><br />(タイム サービスのルート キー) です。<br /><br />subkey:<key> - 既定のキーのサブキー <key> と関連付けられた値を表示します。<br /><br />computer:<target> - コンピューター <target> のレジストリ設定を照会します                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                  w32tm /query [/computer:<target>] {/source &#124; /configuration &#124; /peers &#124; /status} [/verbose]                                                                                   |                                                                                                                                                                                                                                                                                                                  このパラメーターは、Windows Vista および Windows Server 2008 の Windows タイム クライアント バージョンで最初に使用できるようになりました。<br /><br />コンピューターの Windows タイム サービス情報を表示します。<br /><br />**computer:<target>** - **<target>** の情報を照会します。 指定しない場合、既定値はローカル コンピューターです。<br /><br />**Source** - タイム ソースを表示します。<br /><br />**Configuration** - 実行時間の構成と、設定の取得元を表示します。 詳細モードでは、未定義または未使用の設定も表示します。<br /><br />**peers** - ピアとその状態の一覧を表示します。<br /><br />**status** - Windows タイム サービスの状態を表示します。<br /><br />**verbose** - 詳細モードを設定して詳細情報を表示します。                                                                                                                                                                                                                                                                                                                   |
|                                                                                       w32tm /debug {/disable &#124; {/enable /file:<name> /size:<bytes> /entries:<value> [/truncate]}}                                                                                       |                                                                                                                                                                                                                                                                         このパラメーターは、Windows Vista および Windows Server 2008 の Windows タイム クライアント バージョンで最初に使用できるようになりました。<br /><br />ローカル コンピューターの Windows タイム サービスのプライベート ログを有効または無効にします。<br /><br />**disable** - プライベート ログを無効にします。<br /><br />**enable** - プライベート ログを有効にします。<br /><br />-   **file:<name>** - 絶対ファイル名を指定します。<br />-   **size:<bytes>** - 循環ログの最大サイズを指定します。<br />-   **entries:<value>** - ログに記録する情報の種類を指定するフラグの一覧を数値で指定し、コンマで区切って指定します。 有効な数値は 0 から 300 です。 単一の数値に加えて、0-100,103,106 などの数値の範囲も有効です。 値を 0-300 に指定すると、すべての情報がログに記録されます。<br /><br />**truncate** - ファイルが存在する場合、ファイルを切り捨てます。                                                                                                                                                                                                                                                                          |

---  
**W32tm.exe** の詳細については、Windows XP、Windows Vista、Windows 7、Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 のヘルプとサポート センターを参照してください。  

## <a name="windows-time-service-registry-entries"></a>Windows タイム サービスのレジストリ エントリ
Windows タイム サービスには次のレジストリ エントリが関連付けられています。  

この情報は、トラブルシューティングを行うとき、または必要な設定が適用されていることを確認するときに使用するための参照用に提供されています。 他の手段がない限り、レジストリは直接編集しないことをお勧めします。 レジストリに対する変更は、レジストリ エディターまたは Windows による検証は行われずに適用されるため、間違った値が格納される可能性があります。 これにより、システムで回復不能なエラーが発生する可能性があります。  

可能な場合は、レジストリを直接編集するのではなく、グループ ポリシー、Microsoft 管理コンソール (MMC) などの Windows ツールを使用して作業を行います。 レジストリを編集する必要がある場合は、細心の注意が必要です。  

> [!WARNING]  
> グループ ポリシー オブジェクト (GPO) 設定のためのシステム管理用テンプレート ファイル (System.adm) で構成されている一部のプリセット値は、対応する既定のレジストリ エントリとは異なります。 GPO を使用して Windows タイム設定を構成する場合は、[Windows タイムサービスのグループ ポリシー設定のプリセット値が、Windows Server 2003 の対応する Windows タイム サービスのレジストリ エントリと異なること](https://go.microsoft.com/fwlink/?LinkId=186066)を確認してください。 この問題は、Windows Server 2008 R2、Windows Server 2008、Windows Server 2003 R2、および Windows Server 2003 に当てはまります。  

Windows タイム サービスの多くのレジストリ エントリは、同じ名前のグループ ポリシー設定と同じになっています。 グループ ポリシー設定は、次の場所にある同じ名前のレジストリ エントリに対応します。  

>**HKLM\SYSTEM\CurrentControlSet\Services\W32Time\\**


このレジストリの場所には、いくつかのレジストリ キーがあります。 Windows タイム設定は、次のすべてのキーの値に格納されます。

* [Parameters](#hklmsystemcurrentcontrolsetservicesw32timeparameters)
* [Config](#hklmsystemcurrentcontrolsetservicesw32timeconfig)
* [NtpClient](#hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpclient)
* [NtpServer](#hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpserver)

レジストリの W32Time セクションの値の多くは、情報を格納するために W32Time によって内部的に使用されます。 これらの値は、いかなる状況でも手動で変更しないでください。 設定に慣れており、新しい値が想定どおりに動作することが確実である場合を除き、このセクションの設定は変更しないでください。 これらのレジストリ エントリは次の場所にあります。

**HKLM\SYSTEM\CurrentControlSet\Services\W32Time**  

ポリシーを作成すると、設定は次の場所で構成されます。これはその次の場所よりも優先されません。

**HKLM\SOFTWARE\Policies\Microsoft\Windows\W32time**

W32time キーはポリシーを使用して作成されます。  ポリシーを削除すると、このキーも削除されます。

その他の既定の場所は次のとおりです。

**HKLM\SYSTEM\CurrentControlSet\Services\W32time**

一部のパラメーターはクロック ティック単位でレジストリに格納されますが、秒単位で格納されるものもあります。 時刻をクロック ティックから秒に変換するには、次のようにします。  

-   1 分 = 60 秒  

-   1 秒 = 1000 ミリ秒  

-   1 ミリ秒 = 10,000 クロック ティック (Windows システムの場合。「[DateTime.Ticks プロパティ](https://docs.microsoft.com/dotnet/api/system.datetime.ticks?redirectedfrom=MSDN&view=netframework-4.7.2#System_DateTime_Ticks)」を参照)。  

たとえば、5分は 5\*60\*1000\*10000 = 3000000000 クロック ティックになります。 

すべてのバージョンには、Windows 7、Windows 8、Windows 10、Windows Server 2008、Windows server 2008 R2、Windows Server 2012、Windows Server 2012R2、Windows Server 2016 が含まれます。  一部のエントリは、新しいバージョンの Windows でのみ使用できます。

#### <a name="hklmsystemcurrentcontrolsetservicesw32timeparameters"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters

|          レジストリ エントリ          | バージョン |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|----------------------------------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AllowNonstandardModeCombinations |   すべて   |                                                                                                                                                                                                                                                                                                                                                                                                              エントリは、ピア間の同期で非標準モードの組み合わせが許可されることを示します。 ドメイン メンバーに対する既定値は 1 です。 スタンドアロン クライアントとサーバーに対する既定値は 1 です。                                                                                                                                                                                                                                                                                                                                                                                                              |
|            NtpServer             |   すべて   | エントリは、コンピューターでのタイムスタンプの取得元になる、スペースで区切られたピアのリストを指定します。これは、1 行に 1 つ以上の DNS 名または IP アドレスで構成されます。 リストされる各 DNS 名または IP アドレスは一意である必要があります。 ドメインに接続されているコンピューターは、正式な米国の時刻など、より信頼性の高いタイム ソースと同期する必要があります。  <ul><li>0x01 SpecialInterval </li><li>0x02 UseAsFallbackOnly</li><li>0x04 SymmetricActive - このモードの詳細については、[「Windows タイム サーバー」の「3.3 動作モード」](https://go.microsoft.com/fwlink/?LinkId=208012)を参照してください。</li><li>0x08 Client</li></ul><br />ドメイン メンバーには、このレジストリ エントリの既定値はありません。 スタンドアロン クライアントとサーバーに対する既定値は time.windows.com,0x1 です。<br /><br />注: 使用できる NTP サーバーの詳細については、[Microsoft サポート技術情報の記事 262680「インターネット上で利用可能な簡易ネットワーク タイム プロトコル (SNTP) タイム サーバーの一覧」](https://support.microsoft.com/help/262680/a-list-of-the-simple-network-time-protocol-sntp-time-servers-that-are)を参照してください。 |
|            ServiceDll            |   すべて   |                                                                                                                                                                                                                                                                                                                                                              エントリは W32Time によって管理されます。 これには Windows オペレーティング システムで使用される予約済みのデータが含まれています。この設定を変更すると、予期しない結果が発生する可能性があります。 ドメイン メンバーとスタンドアロン クライアントおよびサーバーの両方において、この DLL の既定の場所は、%windir%\System32\W32Time.dll です。                                                                                                                                                                                                                                                                                                                                                               |
|           ServiceMain            |   すべて   |                                                                                                                                                                                                                                                                                                                                                       エントリは W32Time によって管理されます。 これには Windows オペレーティング システムで使用される予約済みのデータが含まれています。この設定を変更すると、予期しない結果が発生する可能性があります。 ドメイン メンバーに対する既定値は SvchostEntry_W32Time です。 スタンドアロン クライアントとサーバーに対する既定値は SvchostEntry_W32Time です。  "                                                                                                                                                                                                                                                                                                                                                       |
|               種類               |   すべて   |                                                                                                                                                                                                                                  エントリは、どのピアからの同期を受け入れるかを示します。  <ul><li>**NoSync**: タイム サービスは他のソースと同期しません。</li><li>**NTP**: タイム サービスは、**NtpServer** レジストリ エントリで指定されたサーバーと同期します。</li><li>**NT5DS**: タイム サービスはドメイン階層から同期します。  </li><li>**AllSync**: タイム サービスは、使用可能なすべての同期メカニズムを使用します。  </li></ul>ドメイン メンバーに対する既定値は **NT5DS** です。 スタンドアロン クライアントとサーバーに対する既定値は **NTP** です。                                                                                                                                                                                                                                   |

---
#### <a name="hklmsystemcurrentcontrolsetservicesw32timeconfig"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Config

|    レジストリ エントリ     |          バージョン           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     AnnounceFlags     |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              エントリは、このコンピューターが信頼性の高いタイム サーバーとしてマークされているかどうかを制御します。 コンピューターは、タイム サーバーとしてもマークされていない限り、信頼性の高いサーバーとしてマークされません。<br /> -   0x00 タイム サーバーではありません  <br /> - 0x01 常にタイム サーバーです  <br /> -   0x02 自動タイム サーバー  <br /> -   0x04 常に信頼できるタイム サーバーです  <br /> -   0x08 信頼できる自動タイム サーバーです  <br />ドメイン メンバーに対する既定値は 10 です。 スタンドアロン クライアントとサーバーに対する既定値は 10 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|     EventLogFlags     |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          エントリは、タイム サービスがログに記録するイベントを制御します。  <br />-   時刻のジャンプ:0x1  <br />-   ソース変更:0x2  <br />ドメイン メンバーに対する既定値は 2 です。 スタンドアロン クライアントとサーバーに対する既定値は 2 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| FrequencyCorrectRate  |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    エントリは、クロックを修正するレートを制御します。 この値が小さすぎる場合、クロックは安定せず過度に修正されます。 値が大きすぎる場合、クロックの同期に時間がかかります。 ドメイン メンバーに対する既定値は 4 です。 スタンドアロン クライアントとサーバーに対する既定値は 4 です。  <br /><br />FrequencyCorrectRate レジストリ エントリでは、0 は無効な値であることに注意してください。 Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 コンピューターでは、この値が 0 に設定されている場合、Windows タイム サービスによって自動的に 1 に変更されます。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|      HoldPeriod       |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   エントリは、ローカル クロックを迅速に同期するためにスパイク検出を無効にする期間を制御します。 スパイクとは、時刻が数秒ずれていることを示すタイム サンプルであり、通常は十分な数のタイム サンプルが一貫して返された後に受信されます。 ドメイン メンバーに対する既定値は 5 です。 スタンドアロン クライアントとサーバーに対する既定値は 5 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   LargePhaseOffset    |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        エントリは、時間オフセットがこの値 (10<sup>-7</sup> 秒単位) 以上である場合にスパイクとみなします。 大量のトラフィックなどのネットワークの中断によって、スパイクが発生することがあります。 スパイクは、長期間継続しない限り無視されます。 ドメイン メンバーに対する既定値は 50000000 です。 スタンドアロン クライアントとサーバーに対する既定値は 50000000 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     LastClockRate     |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           エントリは W32Time によって管理されます。 これには Windows オペレーティング システムで使用される予約済みのデータが含まれています。この設定を変更すると、予期しない結果が発生する可能性があります。 ドメイン メンバーに対する既定値は 156250 です。 スタンドアロン クライアントとサーバーに対する既定値は 156250 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| LocalClockDispersion  |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        エントリは、唯一のタイム ソースが組み込みの CMOS クロックである場合に想定する必要のある分散 (秒単位) を制御します。 ドメイン メンバーに対する既定値は 10 です。 スタンドアロン クライアントとサーバーに対する既定値は 10 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| MaxAllowedPhaseOffset |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        エントリは、W32Time がクロック レートを使用してコンピューターの時計を調整する場合の最大オフセット (秒単位) を指定します。 オフセットがこのレートを超えると、W32Time はコンピューターの時計を直接設定します。 ドメイン メンバーに対する既定値は 300 です。 スタンドアロン クライアントとサーバーに対する既定値は 1 です。  [詳細については、下記を参照してください](#maxallowedphaseoffset-information)。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     MaxClockRate      |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          エントリは W32Time によって管理されます。 これには Windows オペレーティング システムで使用される予約済みのデータが含まれています。この設定を変更すると、予期しない結果が発生する可能性があります。 ドメイン メンバーに対する既定値は 155860 です。 スタンドアロン クライアントとサーバーに対する既定値は 155860 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| MaxNegPhaseCorrection |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              エントリは、サービスが行う最大の負の時間修正を秒単位で指定します。 サービスでこの値より大きい変更が必要であると判断された場合は、代わりにイベントをログに記録します。 特殊なケース:0xFFFFFFFF は常に時間を修正することを意味します。 ドメイン メンバーに対する既定値は 0xFFFFFFFF です。 スタンドアロン クライアントとサーバーに対する既定値は 54,000 (15 時間) です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|    MaxPollInterval    |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     エントリは、システムのポーリング間隔として許容される最大間隔を log2 秒単位で指定します。 システムはスケジュールされた間隔に従ってポーリングを行う必要がありますが、プロバイダーはサンプルを生成するよう要求された場合、それを拒否できます。 ドメイン コントローラーに対する既定値は 10 です。 ドメイン メンバーに対する既定値は 15 です。 スタンドアロン クライアントとサーバーに対する既定値は 15 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| MaxPosPhaseCorrection |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              エントリは、サービスが行う最大の正の時間修正を秒単位で指定します。 サービスでこの値より大きい変更が必要であると判断された場合は、代わりにイベントをログに記録します。 特殊なケース:0xFFFFFFFF は常に時間を修正することを意味します。 ドメイン メンバーに対する既定値は 0xFFFFFFFF です。 スタンドアロン クライアントとサーバーに対する既定値は 54,000 (15 時間) です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|     MinClockRate      |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          エントリは W32Time によって管理されます。 これには Windows オペレーティング システムで使用される予約済みのデータが含まれています。この設定を変更すると、予期しない結果が発生する可能性があります。 ドメイン メンバーに対する既定値は 155860 です。 スタンドアロン クライアントとサーバーに対する既定値は 155860 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|    MinPollInterval    |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              エントリは、システムのポーリング間隔として許容される最小間隔を log2 秒単位で指定します。 システムによってこの間隔よりも頻繁にサンプルを要求されることはありませんが、プロバイダーはスケジュールされた間隔とは別のタイミングでサンプルを生成できることに注意してください。 ドメイン コントローラーに対する既定値は 6 です。 ドメイン メンバーに対する既定値は 10 です。 スタンドアロン クライアントとサーバーに対する既定値は 10 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   PhaseCorrectRate    |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           エントリは、フェーズ エラーを修正するレートを制御します。 小さい値を指定すると、フェーズ エラーが迅速に修正されますが、クロックが不安定になる可能性があります。 値が大きすぎる場合は、フェーズ エラーの修正に時間がかかります。 <br /><br />ドメイン メンバーに対する既定値は 1 です。 スタンドアロン クライアントとサーバーに対する既定値は 7 です。<br /><br />注: PhaseCorrectRate レジストリ エントリでは、0 は無効な値です。 Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 コンピューターでは、この値が 0 に設定されている場合、Windows タイム サービスによって自動的に 1 に変更されます。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|   PollAdjustFactor    |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       エントリは、システムのポーリング間隔を増減する決定を制御します。 値が大きいほど、ポーリング間隔が減少する原因となるエラーの量が少なくなります。 ドメイン メンバーに対する既定値は 5 です。 スタンドアロン クライアントとサーバーに対する既定値は 5 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|   SpikeWatchPeriod    |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    エントリは、疑わしいオフセットが正当として受け入れられるまでに保持される必要がある時間 (秒単位) を指定します。 ドメイン メンバーに対する既定値は 900 です。 スタンドアロン クライアントとワークステーションに対する既定値は 900 です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|  TimeJumpAuditOffset  |            すべて             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            時刻のジャンプの監査しきい値を秒単位で示す符号なし整数。 タイム サービスがクロックを直接設定してローカル クロックを調整したとき、時間修正がこの値よりも大きい場合、タイム サービスは監査イベントをログに記録します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|    UpdateInterval     |            すべて             | エントリは、フェーズ修正の調整間のクロック ティック数を指定します。 ドメイン コントローラーに対する既定値は 100 です。 ドメイン メンバーに対する既定値は 30,000 です。 スタンドアロン クライアントとサーバーに対する既定値は 360,000 です。  <br /><br />**注**:UpdateInterval レジストリ エントリでは、0 は無効な値です。 Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 を実行中のコンピューターでは、この値が 0 に設定されている場合、Windows タイム サービスによって自動的に 1 に変更されます。<br /><br />次の 3 つのレジストリ エントリは、W32Time の既定の構成の一部ではありませんが、高いログ記録機能を得るためにレジストリに追加できます。 システム イベント ログに記録された情報は、グループ ポリシー オブジェクト エディターの EventLogFlags 設定の値を変えることによって変更できます。 既定では、タイム サービスは、新しいタイム ソースに切り替えるたびにイベント ビューアーにログを作成します。<br /><br />**警告**:グループ ポリシー オブジェクト (GPO) 設定のためのシステム管理用テンプレート ファイル (System.adm) で構成されている一部のプリセット値は、対応する既定のレジストリ エントリとは異なります。 GPO を使用して Windows タイム設定を構成する場合は、[Windows タイムサービスのグループ ポリシー設定のプリセット値が、Windows Server 2003 の対応する Windows タイム サービスのレジストリ エントリと異なること](https://go.microsoft.com/fwlink/?LinkId=186066)を確認してください。 この問題は、Windows Server 2008 R2、Windows Server 2008、Windows Server 2003 R2、および Windows Server 2003 に当てはまります。 |
|  UtilizeSslTimeData   | Windows 10 ビルド 1511 以降 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             1 のエントリは、W32Time で複数の SSL タイムスタンプが使用され、極めて不正確なクロックがシードされることを示します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

---
W32Time ログを有効にするには、次のレジストリ エントリを追加する必要があります。  

|レジストリ エントリ|バージョン|説明|
|------------------------------------|---------------|----------------------------|
|FileLogEntries|すべて|エントリは、Windows タイム ログ ファイルで作成されるエントリの量を制御します。 既定値は none で、この場合は Windows タイム アクティビティがログに記録されません。 有効な値は 0 から 300 です。 この値は、Windows タイムによって通常作成されるイベント ログ エントリには影響しません|
|FileLogName|すべて|エントリは、Windows タイム ログの場所とファイル名を制御します。 既定値は空白です。これは、**FileLogEntries** が変更されない限り変更しないでください。 有効な値は、Windows タイムがログ ファイルの作成に使用する完全なパスとファイル名です。 この値は、Windows タイムによって通常作成されるイベント ログ エントリには影響しません。  |
|FileLogSize|すべて|エントリは、Windows タイム ログ ファイルの循環ログの動作を制御します。 **FileLogEntries** および **FileLogName** が定義されている場合、エントリは、最も古いログ エントリを新しいエントリで上書きするまでに、ログ ファイルが増大できるサイズをバイト単位で定義します。 この設定には、1000000 以上の値を使用してください。 この値は、Windows タイムによって通常作成されるイベント ログ エントリには影響しません。  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpclient"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient

|レジストリ エントリ|バージョン|説明|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|すべて|エントリは、ピア間の同期で非標準モードの組み合わせが許可されることを示します。 ドメイン メンバーに対する既定値は 1 です。 スタンドアロン クライアントとサーバーに対する既定値は 1 です。|
|CompatibilityFlags|すべて|エントリは、次の互換性フラグと値を指定します。 <br /><br />-   DispersionInvalid:0x00000001  <br />-   IgnoreFutureRefTimeStamp:0x00000002  <br /> -   AutodetectWin2K:0x80000000  <br />-   AutodetectWin2KStage2:0x40000000  <br /><br />ドメイン メンバーに対する既定値は 0x80000000 です。 スタンドアロン クライアントとサーバーに対する既定値は 0x80000000 です。  |
|CrossSiteSyncFlags|すべて|エントリは、サービスがコンピューターのドメイン外の同期パートナーを選択するかどうかを決定します。 オプションと値は次のとおりです。  <br /><br />-   None:0  <br />-   PdcOnly:1  <br />-   All:2  <br /><br />Type が NT5DS に設定されていない場合、この値は無視されます。 ドメイン メンバーに対する既定値は 2 です。 スタンドアロン クライアントとサーバーに対する既定値は 2 です。  |
|DllName|すべて|エントリは、タイム プロバイダーの DLL の場所を指定します。  <br /><br />ドメイン メンバーとスタンドアロン クライアントおよびサーバーの両方において、この DLL の既定の場所は、%windir%\System32\W32Time.dll です。|
|Enabled|すべて|エントリは、現在のタイム サービスで NtpClient プロバイダーが有効になっているかどうかを示します。  <br /><ul><li>はい 1</li><li>いいえ 0</li></ul>ドメイン メンバーに対する既定値は 1 です。 スタンドアロン クライアントとサーバーに対する既定値は 1 です。|
|EventLogFlags|すべて|エントリは、Windows タイム サービスによってログに記録されるイベントを指定します。<ul><li>0x1 到達可能性の変更</li><li>0x2 大きいサンプル スキュー (これは Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 のみに当てはまります)</li></ul>ドメイン メンバーに対する既定値は 0x1 です。 スタンドアロン クライアントとサーバーに対する既定値は 0x1 です。|
|InputProvider|すべて|エントリは、NtpServer から時刻情報を取得する InputProvider として NtpClient を有効にするかどうかを示します。 NtpServer は、ローカル クロックを同期するのに役立つタイム サンプルを返すことによって、ネットワーク上のクライアント時間要求に応答するタイム サーバーです。 <ul><li>はい = 1  </li><li>いいえ = 0 </li></ul><p>ドメイン メンバーとスタンドアロン クライアントの両方に対する既定値:1  |
|LargeSampleSkew|すべて|エントリは、ログ記録の大きいサンプル スキューを秒単位で指定します。 証券取引委員会 (SEC) の仕様に準拠するには、これは 3 秒に設定する必要があります。 この設定では、EventLogFlags が 0x2 の大きいサンプル スキューについて明示的に構成されている場合のみ、イベントがログに記録されます。 ドメイン メンバーに対する既定値は 3 です。 スタンドアロン クライアントとサーバーに対する既定値は 3 です。  |
|ResolvePeerBackOffMaxTimes|すべて|エントリは、同期するピアの検索に繰り返し失敗した場合に待機間隔を 2 倍にするための最大回数を指定します。 値が 0 の場合、待機間隔が常に最小値であることを意味します。 ドメイン メンバーに対する既定値は 7 です。 スタンドアロン クライアントとサーバーに対する既定値は 7 です。 |
|ResolvePeerBackoffMinutes|すべて|エントリは、同期するピアの検索を試行する前に待機する初期間隔を分単位で指定します。 ドメイン メンバーに対する既定値は 15 です。 スタンドアロン クライアントとサーバーに対する既定値は 15 です。  |
|SpecialPollInterval|すべて|エントリは、手動ピアのための特別なポーリング間隔を秒単位で指定します。 SpecialInterval 0x1 フラグが有効になっている場合、W32Time は、オペレーティング システムによって決定されるポーリング間隔ではなく、このポーリング間隔を使用します。 ドメイン メンバーに対する既定値は 3,600 です。 スタンドアロン クライアントとサーバーに対する既定値は 604,800 です。<br/><br/>ビルド 1702 からは、SpecialPollInterval は MinPollInterval および MaxPollInterval の構成レジストリ値に含まれています。|
|SpecialPollTimeRemaining|すべて|エントリは W32Time によって管理されます。 これには、Windows オペレーティング システムによって使用される予約されたデータが含まれています。 これはコンピューターが再起動した後に W32Time が再同期されるまでの時間を秒単位で指定します。 この設定を変更すると、予期しない結果が発生する可能性があります。 ドメイン メンバーとスタンドアロン クライアントおよびサーバーの両方の既定値は、空白のままになります。  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpserver"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpServer

|レジストリ エントリ|バージョン|説明|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|すべて|エントリは、クライアントとサーバーの間の同期で非標準モードの組み合わせが許可されることを示します。 ドメイン メンバーに対する既定値は 1 です。 スタンドアロン クライアントとサーバーに対する既定値は 1 です。|
|DllName|すべて|エントリは、タイム プロバイダーの DLL の場所を指定します。<br /><br />ドメイン メンバーとスタンドアロン クライアントおよびサーバーの両方において、この DLL の既定の場所は、%windir%\System32\W32Time.dll です。  |
|Enabled|すべて|エントリは、現在のタイム サービスで NtpServer プロバイダーが有効になっているかどうかを示します。 <ul><li>はい 1</li><li>いいえ 0</li></ul>ドメイン メンバーに対する既定値は 1 です。 スタンドアロン クライアントとサーバーに対する既定値は 1 です。  |
|InputProvider|すべて|エントリは、NtpServer から時刻情報を取得する InputProvider として NtpClient を有効にするかどうかを示します。 NtpServer は、ローカル クロックを同期するのに役立つタイム サンプルを返すことによって、ネットワーク上のクライアント時間要求に応答するタイム サーバーです。 <ul><li>はい = 1  </li><li>いいえ = 0 </li></ul><p>ドメイン メンバーとスタンドアロン クライアントの両方に対する既定値:1  |

---

#### <a name="maxallowedphaseoffset-information"></a>MaxAllowedPhaseOffset 情報
W32Time でコンピューターの時計を段階的に設定するには、オフセットが **MaxAllowedPhaseOffset** 値より小さく、次の式を同時に満たす必要があります。  

* Windows Server 2016 以降のバージョン:
   ```  
    |CurrentTimeOffset| / (16*PhaseCorrectRate*pollIntervalInSeconds) <= SystemClockRate / 2  
   ``` 
* Windows Server 2012 R2 以前のバージョン:
   ```  
   |CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2  
   ``` 
**CurrentTimeOffset** 値はクロック ティックで測定されます。ここで、Windows システムでは 1 ミリ秒 = 10,000 クロック ティックです。  

**SystemClockRate** および **PhaseCorrectRate** もクロック ティックで測定されます。 **SystemClockRate** の値を取得するには、次のコマンドを使用し、秒 * 1000 \* 10000 の式を使用して、秒からクロック ティックに変換します。  

```  
W32tm /query /status /verbose  
ClockRate: 0.0156000s  
```  

**SystemclockRate** は、システム上のクロック レートを示します。 例として 156000 秒を使用した場合、**SystemclockRate** 値は 0.0156000 \* 1000 \* 10000 = 156000 クロック ティックとなります。  

**MaxAllowedPhaseOffset** も秒単位です。 クロック ティックに変換するには、**MaxAllowedPhaseOffset**\*1000\*10000 のように乗算します。  

次の例は、Windows Server 2012 R2 またはそれ以前のバージョンを使用する場合に、これらの計算を適用する方法を示しています。

**例 1**:時間が 4 分ずれています (たとえば、表示されている時刻が 11:05 で、ピアから受け取った正しいと思われるタイム サンプルが 11:09 だとします)。
  
```
phasecorrectRate = 1  

UpdateInterval = 30000 (clock ticks)  

systemclockRate = 156000 (clock ticks)  

MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  

|currentTimeOffset| = 4mins = 4*60\*1000\*10000 = 2400000000 ticks  

Is CurrentTimeOffset <= MaxAllowedPhaseOffset?  

2400000000 <= 6000000000 = TRUE  
```

このとき、上記の式が満たされていますか? 

```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2)  

Is 2,400,000,000 / (30000*1) <= 156000/2  

Is 80,000 <= 78,000  

NO/FALSE  
```  

したがって、W32tm は直ちに時計の設定を戻します。  

> [!NOTE]  
> この場合、時計の設定をゆっくりと戻すには、レジストリの **PhaseCorrectRate** または **updateInterval** の値も調整して、式の結果が **TRUE** になるようにする必要があります。  

**例 2**:時間が 3 分ずれています。 
 
```  
phasecorrectRate = 1  

UpdateInterval = 30000 (clock ticks)  

systemclockRate = 156000 (clock ticks)  

MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  

currentTimeOffset = 3mins = 3*60\*1000\*10000 = 1800000000 clock ticks  

Is CurrentTimeOffset <= MaxAllowedPhaseOffset?  

1800000000 <= 6000000000 = TRUE  
```  

このとき、上記の式が満たされていますか?

```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) <= SystemClockRate / 2)  

Is 3 mins (1,800,000,000) / (30000*1) <= 156000/2  

Is 60,000 <= 78,000  

YES/TRUE  
```  

この場合、時計の設定はゆっくりと戻されます。  

## <a name="windows-time-service-group-policy-settings"></a>Windows タイム サービス グループ ポリシー設定  
グループ ポリシー オブジェクト エディターを使用すると、ほとんどの W32Time パラメーターを構成できます。 これには、コンピューターを NTPServer または NTPClient として構成すること、時刻の同期メカニズムを構成すること、およびコンピューターを信頼性の高いタイム ソースとして構成することが含まれます。  

> [!NOTE]  
> Windows タイム サービスのグループ ポリシー設定は、Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 のドメイン コントローラーで構成でき、Windows Server 2003、Windows Server 2003 R2、Windows Server 2008、および Windows Server 2008 R2 を実行しているコンピューターにのみ適用できます。  

W32Time の構成に使用されるグループ ポリシー設定は、次の場所にあるグループ ポリシー オブジェクト エディター スナップインで確認できます。  

-   コンピュータの構成\管理用テンプレート\システム\Windows タイム サービス  

    ここで**グローバル構成設定**を構成します。  

-   コンピュータの構成\管理用テンプレート\システム\Windows タイム サービス\タイム プロバイダー  

    ここで **Windows NTP クライアント**設定を構成します。  

    ここで **Windows NTP クライアント**を有効にします。  

    ここで **Windows NTP サーバー**を有効にします。  

> [!WARNING]  
> グループ ポリシー オブジェクト (GPO) 設定のためのシステム管理用テンプレート ファイル (System.adm) で構成されている一部のプリセット値は、対応する既定のレジストリ エントリとは異なります。 GPO を使用して Windows タイム設定を構成する場合は、[Windows タイムサービスのグループ ポリシー設定のプリセット値が、Windows Server 2003 の対応する Windows タイム サービスのレジストリ エントリと異なること](https://go.microsoft.com/fwlink/?LinkId=186066)を確認してください。 この問題は、Windows Server 2008 R2、Windows Server 2008、Windows Server 2003 R2、および Windows Server 2003 に当てはまります。  

次の表に、Windows タイム サービスに関連付けられているグローバル グループ ポリシー設定と、各設定に関連付けられたプリセット値の一覧を示します。 各設定の詳細については、このトピックの前の方にある「[Windows タイム サービスのレジストリ エントリ](#windows-time-service-registry-entries)」の対応するレジストリ エントリを参照してください。 次の設定は、**グローバル構成設定**と呼ばれる 1 つの GPO に含まれています。  

**Windows タイムに関連付けられているグローバル グループ ポリシー設定**  

|グループ ポリシー設定|プリセット値|  
|------------------------|------------------|  
|AnnounceFlags|10|  
|EventLogFlags|2|  
|FrequencyCorrectRate|4|  
|HoldPeriod|5|  
|LargePhaseOffset|1280000|  
|LocalClockDispersion|10|  
|MaxAllowedPhaseOffset|300|  
|MaxNegPhaseCorrection|54,000 (15 時間)|  
|MaxPollInterval|15|  
|MaxPosPhaseCorrection|54,000 (15 時間)|  
|MinPollInterval|10|  
|PhaseCorrectRate|7|  
|PollAdjustFactor|5|  
|SpikeWatchPeriod|90|  
|UpdateInterval|100|  

次の表に、**Windows NTP クライアントの構成** GPO についての選択可能な設定、および Windows タイム サービスに関連付けられているプリセット値の一覧を示します。 各設定の詳細については、このトピックの前の方にある「[Windows タイム サービスのレジストリ エントリ](#windows-time-service-registry-entries)」の対応するレジストリ エントリを参照してください。  

**Windows タイムに関連付けられている NTP クライアント グループ ポリシー設定**  

|グループ ポリシー設定|既定値|  
|------------------------|-----------------|  
|NtpServer|time.windows.com,0x1|  
|種類|既定のオプション:<br /><br />-   **NTP**。 ドメインに参加していないコンピューターで使用します。<br />-   **NT5DS**。 ドメインに参加しているコンピューターで使用します。|  
|CrossSiteSyncFlags|2|  
|ResolvePeerBackoffMinutes|15|  
|ResolvePeerBackoffMaxTimes|7|  
|SpecialPollInterval|3600|  
|EventLogFlags|0|  

## <a name="network-ports-used-by-the-windows-time-service"></a>Windows タイム サービスによって使用されるネットワーク ポート  
Windows タイムは、すべての時刻同期通信に UDP ポート 123 を使用する必要がある NTP 仕様に従います。 このポートは Windows タイムによって予約されており、常に予約されたままになっています。 コンピューターが時計を同期するか、別のコンピューターに時間を提供するときは常に、その通信は UDP ポート 123 で実行されます。  

> [!NOTE]  
> 複数のネットワーク アダプターを備えたコンピューター (マルチホーム コンピューターとも呼ばれます) がある場合は、ネットワーク アダプターに基づいて Windows タイム サービスを選択的に有効にすることはできません。  

## <a name="related-information"></a>関連情報  
次のリソースには、このセクションに関連する追加情報が含まれています。  

-   IETF RFC データベースの RFC *1305*  

