---
ms.assetid: d1953097-63ea-4a0e-b860-2f3b7c175c41
title: Windows タイム サービスのしくみ
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: c9ab52229c2a16d6ae6b0b2733c52e53a25cfa44
ms.sourcegitcommit: fb4e2ace2e0a29e0f6b028f1cb945cab6aa6ee2c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/05/2018
---
# <a name="how-the-windows-time-service-works"></a>Windows タイム サービスのしくみ

>適用対象: Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

**このセクションで**  
  
-   [Windows タイム サービスのアーキテクチャ](#w2k3tr_times_how_rrfo)  
  
-   [Windows タイム サービス時間プロトコル](#w2k3tr_times_how_ekoc)  
  
-   [Windows タイム サービスのプロセスとの対話](#w2k3tr_times_how_izcr)  
  
-   [Windows タイム サービスによって使用されるネットワーク ポート](#w2k3tr_times_how_ydum)  
  
> [!NOTE]  
> このトピックでは、Windows タイム サービス (W32Time) の動作方法のみについて説明します。 Windows タイム サービスを構成する方法については、セクションのトピックの一覧を参照してください。 [Windows タイム サービス構成の情報を検索する場所](https://technet.microsoft.com/library/cc773061.aspx)します。  
  
> [!NOTE]  
> Windows Server 2003 および Microsoft Windows 2000 Server で、ディレクトリ サービスは Active Directory ディレクトリ サービスを名前します。 およびでは Windows Server 2008 以降のバージョン、ディレクトリ サービスは、Active Directory ドメイン サービス (AD DS) の名前します。 このトピックの残りの部分は、AD DS を指しますが、情報も Active Directory に適用可能です。  
  
Windows タイム サービスは、ネットワーク タイム プロトコル (NTP) の正確な実装ではありませんが、ネットワーク全体のコンピューターのクロックが可能な限り正確であることを確認する NTP 仕様で定義されているアルゴリズムの複雑なスイートを使用します。 理想的には、AD DS ドメインのすべてのコンピューターのクロックは、権限のあるコンピューターの時間と同期されます。 多くの要因をネットワーク上で時刻の同期に影響を与えることができます。 多くの場合、次の要因は、AD DS の同期の精度に影響を与えます。  
  
-   ネットワークの状態  
  
-   コンピューターのハードウェア クロックの精度  
  
-   Windows タイム サービスを利用可能な CPU とネットワークのリソースの量  
  
> [!IMPORTANT]  
> Windows Server 2016 では、前に W32Time サービスしない時間の影響を受けやすいアプリケーションのニーズに合わせて設計されました。  ただし、Windows Server 2016 に更新できるようになりましたミリ秒のソリューションを実装する、ドメイン内の正確性。  See [Windows 2016 Accurate Time](accurate-time.md) and  [Support boundary to configure the Windows Time service for high-accuracy environments](https://go.microsoft.com/fwlink/?LinkID=179459) for more information.  
  
同期頻度が少ない、時間や、ドメインに参加していないコンピューターは、time.windows.com と同期する、既定で構成されます。そのため、断続的なコンピューターまたはネットワーク接続なしで時刻の精度を保証することはできません。  
  
AD DS フォレストでは、所定の時間同期階層を持ちます。 Windows タイム サービスは、上部にある最も正確な参照クロック、階層内のコンピューター間の時間を同期します。 1 つ以上のタイム ソースがコンピューターに構成されている場合、Windows タイムはそのタイム ソースと同期するコンピューターの機能に基づいて構成されたソースから最適なタイム ソースを選択する NTP アルゴリズムを使用します。 Windows タイム サービスは、ネットワークのブロードキャストまたはマルチキャストのピアからの同期をサポートしていません。 これらの NTP 機能に関する詳細については、IETF RFC データベースでの RFC 1305 を参照してください。  
  
Windows タイム サービスが実行されているすべてのコンピューターでは、最も正確な時間を維持するために、サービスを使用します。 既定では、ドメインのメンバーであるコンピューターがタイム クライアントとして動作、そのため、ほとんどの場合は、Windows タイム サービスを構成する必要です。 ただし、Windows タイム サービスは、指定された参照のタイム ソースから時間を要求するように構成して、クライアントに時間を提供することもします。
  
コンピューターの時刻が正確な程度は、階層と呼ばれます。 (ハードウェア クロック) などのネットワーク上で最も正確なタイム ソースは、下位の階層レベル、またはいずれかの階層を占有します。 この正しいタイム ソースは、参照クロックと呼ばれます。 参照クロックから直接、時間を取得する NTP サーバーは、参照クロックよりも上位レベルの 1 つである階層を占有します。 NTP サーバーからの時間を取得するリソースは参照クロックから 2 つの手順したがっては 2 つの階層を最も正確なタイム ソースよりも高い占有され具合です。 コンピューターの階層数としてが増えると、そのシステム クロックの時刻になります正確性が劣る。 したがって、すべてのコンピュータの階層レベルは、そのコンピューターが最も正確なタイム ソースと同期するどの程度近いかを示すインジケーターです。  
  
W32Time Manager タイム サンプルを受信すると、タイム サンプルの使用に最も適したは NTP で特殊なアルゴリズムを使っています。 タイム サービスは、構成された時間ソースは、最も正確なアルゴリズムの別のセットも使用します。 タイム サービスは、どのタイム サンプルが最適な決定が、上記の基準に基づいて調整がローカル クロック速度に正しい時刻にまとめることを許可するようにします。 ローカル クロックと選択した正確な時刻サンプル (別名時間ずれ) との時差がローカル クロック速度を調整して修正するには大きすぎる場合は、タイム サービスはローカル クロックを正しい時刻に設定します。 この調整のクロック周波数または直接クロック時間の変更は、クロック統制と呼ばれます。  
  
## <a name="w2k3tr_times_how_rrfo"></a>Windows タイム サービスのアーキテクチャ  
Windows タイム サービスは、次のコンポーネントで構成されます。  
  
-   サービス コントロール マネージャー  
  
-   Windows タイム サービス マネージャー  
  
-   クロック統制  
  
-   タイム プロバイダー  
  
次の図は、Windows タイム サービスのアーキテクチャを示します。  
  
**Windows タイム サービスのアーキテクチャ**  
  
![Windows タイム](media/How-the-Windows-Time-Service-Works/trnt_sec_arcc.gif)  
  
サービス コントロール マネージャーはの開始と、Windows タイム サービスを停止します。 Windows タイム サービス マネージャーは、オペレーティング システムに含まれている NTP タイム プロバイダの操作を開始します。 Windows タイム サービス マネージャーは、Windows タイム サービスのすべての機能とすべてのタイム サンプルの結合を制御します。 他に、現在のシステム状態に関する情報など、現在のタイム ソースまたは最後に、時間、システム クロックが更新されてを提供する Windows タイム サービス マネージャーも行いますイベント ログにイベントを作成するため。  
  
時刻の同期処理には、次の手順が含まれます。  
  
-   プロバイダーの要求を入力し、構成されている NTP タイム ソースからタイム サンプルを受信します。  
  
-   これらのタイム サンプルに、Windows タイム サービス マネージャー、すべてのサンプルを収集し、クロック統制サブコンポーネントに渡してが渡されます。  
  
-   クロック統制サブコンポーネントの情報には、その結果、最適なタイム サンプルの選択範囲の NTP アルゴリズムが適用されます。  
  
-   クロック統制サブコンポーネントの情報は、クロック速度を調整するか、時刻を直接変更する最も正確な時刻に、システム クロックの時間を調整します。  
  
場合は、コンピューターは、タイム サーバーとして指定されているが、このプロセスの任意の時点で時刻の同期を要求している任意のコンピューターにログオン時間を送信することができます。  
  
## <a name="w2k3tr_times_how_ekoc"></a>Windows タイム サービス時間プロトコル  

時間プロトコルがどの程度 2 台のコンピューターを決定の時計が同期されます。 タイム プロトコルは、最適な使用可能な時間情報の判断と、別のシステムで一貫性のある時間が維持されるようにするクロックの収束を担当します。  
  
Windows タイム サービスでは、ネットワーク タイム プロトコル (NTP) を使用して、ネットワーク経由で時間を同期します。 NTP は、時計を同期させるために必要な作業分野のアルゴリズムを含むインターネット時刻プロトコルです。 NTP がより正確なタイム プロトコルよりも、単純なネットワーク タイム プロトコル (SNTP) Windows; の一部のバージョンで使用されています。ただし W32Time は、Windows 2000 などの SNTP ベースのタイム サービスを実行しているコンピューターとの下位互換性を有効にする SNTP をサポートするためには続行されます。  
  
### <a name="network-time-protocol"></a>ネットワーク タイム プロトコル  
ネットワーク タイム プロトコル (NTP) は、既定のオペレーティング システムで Windows タイム サービスによって使用される同期プロトコルの時間します。 NTP はフォールト トレラントで拡張性の高いタイム プロトコルであり、プロトコルを指定した時刻の参照を使用してコンピューターの時計を同期する最も頻繁に使用します。  
  
NTP 時刻の同期は、時間の期間にわたっては行われ、ネットワーク経由で NTP パケットの転送にが含まれます。 NTP のパケットには、時刻の同期、クライアントと参加しているサーバーの両方からタイム サンプルが含まれるタイムスタンプが含まれています。  
  
NTP は、使用する最も正確な時間を定義する参照クロックに基づいてし、その参照の時計をネットワーク上のすべてのクロックを同期します。 NTP は、普遍的な基準として、現在の時間を世界協定時刻 (UTC) を使用します。 UTC はタイム ゾーンから独立しており、ntp タイム ゾーンの設定に関係なく、世界で任意の場所を使用します。  
  
#### <a name="ntp-algorithms"></a>NTP アルゴリズム  
NTP には、2 つのアルゴリズム、クロックのフィルタ リング アルゴリズム、最適なタイム サンプルを決定する際、Windows タイム サービスを支援する、クロック選択アルゴリズムが含まれています。 クロックのフィルタ リング アルゴリズムは、タイム サンプルが照会されたタイム ソースから受信し、各ソースから最適なタイム サンプルを決定を詳しく調べて設計されています。 クロック選択アルゴリズムは、ネットワーク上の正確なタイム サーバーを決定します。 この情報は、ネットワークの待機時間とコンピューター時計の不正確さによるエラーの補正中に、コンピューターのローカル クロックを修正する収集された情報を使用して、クロック統制アルゴリズムに渡されます。  
  
NTP アルゴリズムは、ライトから中レベルのネットワークおよびサーバーの負荷の条件下で最も正確なです。 ネットワーク転送時間を考慮した任意のアルゴリズムと NTP アルゴリズムは可能性があります極端なネットワークの混雑の条件下でが不十分な実行します。 NTP アルゴリズムの詳細については、IETF RFC データベースでの RFC 1305 を参照してください。  
  
#### <a name="ntp-time-provider"></a>NTP タイム プロバイダー  
Windows タイム サービスは、さまざまなハードウェア デバイスと時刻のプロトコルをサポートできる完全な時刻同期パッケージです。 このサポートを有効にするのには、サービスは、プラグ可能なタイム プロバイダーを使用します。 タイム プロバイダが (ネットワークまたはハードウェアを使用して)、取得するときの正確な時刻スタンプまたはネットワーク経由で他のコンピューターにそれらのタイムスタンプを提供する責任を負う。  
  
NTP プロバイダーは、オペレーティング システムに含まれている標準時のプロバイダーです。 NTP プロバイダーは、NTP クライアントとサーバーのバージョン 3 で指定された標準に依存して、SNTP クライアントおよび Windows 2000 およびその他の SNTP クライアントとの下位互換性のサーバーと対話することができます。 Windows タイム サービスの NTP プロバイダーは、次の 2 つの部分で構成されます。  
  
-   **クライアントは、プロバイダーを出力します。** これは、ネットワーク上のクライアントに要求に応答する時間サーバーです。  
  
-   **NtpClient 入力プロバイダーです。** これは、タイム クライアントは、ハードウェア デバイスまたは、NTP サーバーのいずれかの別のソースから時刻情報を取得し、ローカルの時計を同期するための便利なタイム サンプルを返すことができます。  
  
ただし、これら 2 つのプロバイダーの実際の処理は密接に関連すると、タイム サービスを独立した表示されます。 以降、Windows 2000 Server では Windows コンピュータがネットワークに接続されている場合、NTP クライアントとして構成されます。 また、Windows タイムを実行しているコンピューターはサービス既定でドメイン コント ローラーまたは手動で指定されたタイム ソースと時刻を同期する試みのみです。 これらは、時間のソースを自動的に利用可能なセキュリティで保護されるため、希望するタイム プロバイダーです。  
  
#### <a name="ntp-security"></a>NTP セキュリティ  

AD DS フォレスト内で Windows タイム サービスは、時間データの認証を強制する標準のドメインのセキュリティ機能に依存します。 ドメイン メンバー コンピューターと、タイム サーバーとして動作しているローカル ドメイン コントローラの間で送信される NTP パケットのセキュリティは、共有キー認証に基づいています。 Windows タイム サービスは、コンピューターの Kerberos セッション キーを使用して、ネットワーク経由で送信される NTP パケットの認証済みの署名を作成します。 Net Logon のセキュリティで保護されたチャネルの内部 NTP パケットは送信されません。 代わりに、要求すると、コンピューター、時間、ドメインの階層内のドメイン コント ローラーから、Windows タイム サービスが必要です、時間が認証すること。 次に、ドメイン コント ローラーは、Net Logon サービスからセッション キーを使用して認証されている 64 ビット値の形式で、必要な情報を返します。 返された NTP のパケットが、コンピューターのセッション キーで署名されていないか、または正しく署名されていない場合、時刻は拒否されます。 このようなすべての認証エラーは、イベント ログに記録されます。 この方法では、Windows タイム サービスは、AD DS フォレスト内の NTP データのセキュリティを提供します。  
  
一般に、Windows タイム クライアントは、同じドメイン内のドメイン コント ローラーから正確な時刻の同期を自動的に取得します。 フォレストでは、子ドメインのドメイン コント ローラーは、親ドメインのドメイン コント ローラーと時刻を同期します。 タイム サーバーが認証済みの NTP パケットを時間を要求するクライアントに戻ったとき、パケットは、ドメイン間の信頼アカウントによって定義されている Kerberos セッション キーによって署名されています。 新しい AD DS ドメイン、フォレストに参加し、Net Logon サービスは、セッション キーを管理、ドメイン間の信頼アカウントが作成されます。 これにより、フォレスト ルート ドメインで信頼性の高いとして構成されているドメイン コント ローラーのすべての親と子の両方のドメインのドメイン コント ローラーおよび間接的に、ドメイン ツリー内にあるすべてのコンピューターに対して認証されたタイム ソースになります。  
  
Windows タイム サービスは、のフォレスト間で動作するように構成できますにこの構成が安全ではないことに注意してください。 重要です。 たとえば、別のフォレストの NTP サーバーが利用可能なあります。 ただし、そのコンピューターが別のフォレストにあるため、サインインし、NTP パケットの認証に使用する Kerberos セッション キーはありません。 クライアントを別のフォレスト内のコンピューターから正確な時刻の同期を取得するにはそのコンピューターへのネットワーク アクセスが必要なし、タイム サービスは、その他のフォレストにある特定のタイム ソースを使用するように構成する必要があります。 クライアントは、自身のドメイン階層外部の NTP サーバーからアクセス時間を手動で構成する場合、クライアントと時間のサーバー間で送信される NTP パケットは認証されていないされ、そのため、セキュリティで保護されたはありません。 フォレストの信頼の実装である場合でも、Windows タイム サービスはセキュリティで保護されたフォレスト間で。 Net Logon のセキュリティで保護されたチャネルには、Windows タイム サービスの認証メカニズムが、フォレスト間の認証がサポートされていません。  
  
#### <a name="hardware-devices-that-are-supported-by-the-windows-time-service"></a>Windows タイム サービスによってサポートされているハードウェア デバイス  
GPS などのクロックのハードウェア ベースまたは電波時計は参照の正確なクロック デバイスとして使用されます。 既定では、Windows タイム サービスの NTP タイム プロバイダーでは、コンピューターにハードウェア デバイスの直接接続はサポートされていない、この種類の接続をサポートするソフトウェア ベースの独立したタイム プロバイダーを作成することは可能です。 この種類の Windows タイム サービスと組み合わせて、プロバイダーは、信頼性の高い、安定した時刻の参照を提供できます。  
  
Cesium クロックや、Global Positioning System (GPS) 受信機などのハードウェア デバイスでは、時間の正確な定義を取得する標準に従って、正確な現在の時刻を提供します。 Cesium クロックは非常に安定し、温度や圧力、湿度などの要因によって影響を受けませんも非常にコストが高い。 GPS 受信機動作する非常に安価でありも、正確な参照クロックします。 GPS 受信機は、cesium クロックから時刻を取得するサテライトから時刻を取得します。 独立したタイム プロバイダーを使用せず Windows サーバーの時間は、電話またはインターネットを使用して、ハードウェア デバイスに接続されている、外部の NTP サーバーに接続して、時間を取得することができます。 米国海軍天文台などの組織では、非常に信頼性の高い参照クロックに接続されている NTP サーバーを提供します。  
  
多くの GPS 受信機とその他の時間デバイスは、ネットワーク上の NTP サーバーとして機能できます。 ネットワーク上の NTP サーバーとしても機能している場合にのみ、これらの外部のハードウェア デバイスから時刻を同期する AD DS フォレストを構成することができます。 これを行うには、(PDC) エミュレーターの GPS 機器によって提供される NTP サーバーと同期するフォレスト ルート内のプライマリ ドメイン コント ローラーとして機能しているドメイン コント ローラーを構成します。 これを行うには、次を参照してください。[フォレスト ルート ドメインの PDC エミュレーターで Windows タイム サービスを構成する](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29)します。  
  
### <a name="simple-network-time-protocol"></a>簡易ネットワーク タイム プロトコル  
単純なネットワーク タイム プロトコル (SNTP) は、サーバーとクライアントの NTP を提供する精度を必要としないことを目的としてが簡略化された時間プロトコルです。 SNTP、NTP のより基本的なバージョンは、Windows 2000 で使用されているプライマリ時間プロトコルです。 SNTP と NTP のネットワーク パケットの形式は同じであるため、2 つのプロトコルは相互運用可能にします。 2 つの主な違いは、SNTP に、エラーの管理と NTP を提供する複雑なフィルター処理システムがないことです。 単純なネットワーク タイム プロトコルの詳細については、IETF RFC データベースでの RFC 1769 を参照してください。  
  
### <a name="time-protocol-interoperability"></a>時間プロトコルの相互運用性  
Windows タイム サービスは、Windows 2000 で使用される SNTP プロトコルが Windows XP および Windows Server 2003 で NTP プロトコルと相互運用可能であるために、Windows 2000、Windows XP、および Windows Server 2003 を実行しているコンピューターの混在環境で動作できます。  
  
TimeServ と呼ばれる、Windows NT Server 4.0 のタイム サービスは、Windows NT 4.0 ネットワーク経由で時間を同期します。 TimeServ として使用可能なアドオン機能は、の一部では、 *Microsoft Windows NT 4.0 リソース キット*は Windows Server 2003 で必要とされる時刻の同期の信頼性のレベルが提供されていません。  
  
Windows タイム サービスは、Windows 2000 または Windows Server 2003 を実行するコンピューターと時刻を同期するために、Windows NT 4.0 を実行しているコンピューターと相互運用できます。ただし、Windows 2000 または Windows Server 2003 を実行するコンピューターは Windows NT 4.0 のタイム サーバーを自動的に検出できません。 たとえば、階層に基づくドメインを使用して時刻を同期するドメインが構成されている場合の同期があり、メソッドが Windows NT 4.0 ドメイン コント ローラーと時刻を同期するドメインの階層内のコンピューターをする、Windows NT 4.0 ドメイン コント ローラーとの同期を手動でこれらのコンピューターを構成する必要があります。  
  
Windows NT 4.0 では、Windows タイム サービスは使用してより時刻の同期の単純なメカニズムを使用します。 そのため、ネットワーク内のすべての正確な時刻の同期を確実には、Windows 2000 または Windows Server 2003 に Windows NT 4.0 ドメイン コント ローラーをアップグレードすることをお勧めします。  
  
## <a name="w2k3tr_times_how_izcr"></a>Windows タイム サービスのプロセスとの対話  

Windows タイム サービスは、ネットワーク上のコンピューターの時計の同期に設計されています。 時間収束とも呼ばれます、ネットワークに同期プロセスより正確なタイム サーバーから各コンピューターへのアクセス時間として、ネットワーク全体で発生します。 時間の収束には、権限を持つサーバーが NTP パケットの形式でクライアント コンピューターに現在の時刻を提供するプロセスが含まれます。 パケット内で提供される情報より正確なサーバーと同期されているため、コンピューターの現在のクロック時間に行われる調整が必要かどうかを示します。  
  
時刻の収束プロセスの一環として、ドメインのメンバーは、同じドメイン内にある任意のドメイン コント ローラーと時刻を同期しようとします。 コンピューターがドメイン コント ローラーより権限のあるドメイン コント ローラーと同期しようとします。  
  
Windows XP Home Edition、またはドメインに参加していないコンピューターを実行しているコンピューターは、ドメインの階層と同期するしないでくださいが、既定では time.windows.com から時刻を取得するように構成します。  
  
権限を持つ Windows Server 2003 を実行するコンピューターを確立するには、信頼性の高いタイム ソースにするコンピューターを構成する必要があります。 既定では、Windows Server 2003 ドメインにインストールされている最初のドメイン コント ローラーは信頼性の高いタイム ソースを自動的に構成します。 ドメインの権限のあるコンピューターになっているために、ドメインの階層ではなく、外部のタイム ソースと同期する構成する必要があります。 既定では、他のすべての Windows Server 2003 ドメインのメンバーは、ドメインの階層との同期に構成されます。  
  
Windows Server 2003 ネットワークを確立した後、次のオプションのいずれかの同期に使用する Windows タイム サービスを構成できます。  
  
-   ドメインの階層に基づく同期  
  
-   手動で指定された同期ソース  
  
-   すべての利用可能な同期メカニズム  
  
-   同期されません。  
  
これらの同期型は、次のセクションで説明します。  
  
### <a name="domain-hierarchy-based-synchronization"></a>ドメインの階層に基づく同期  

ドメインの階層に基づく同期では、AD DS ドメインの階層を使用して、時刻同期に使用する信頼できるソースを見つけます。 ドメインの階層に基づき、Windows タイム サービスは、各タイム サーバーの正確性を決定します。 Windows Server 2003 フォレストでは、プライマリ ドメイン コント ローラー (PDC) エミュレーター操作マスターの役割をフォレスト ルート ドメイン内にあるを保持しているコンピューターは、別の信頼性の高いタイム ソースが構成されている場合を除きに最適なタイム ソースの位置を保持します。 次の図は、ドメイン階層内のコンピューター間で時刻の同期のパスを示します。  
  
**AD DS 階層内の時刻同期**  
  
![Windows タイム](media/How-the-Windows-Time-Service-Works/trnt_ntw_adhc.gif)  
  
#### <a name="reliable-time-source-configuration"></a>信頼性の高いタイム ソースの構成  
信頼性の高いタイム ソースとして構成されているコンピューターは、タイム サービスのルートとして識別されます。 タイム サービスのルート ドメインの権限のあるサーバーは、通常、外部の NTP サーバーまたはハードウェア デバイスから時刻を取得するように構成されます。 タイム サーバーは、ドメイン階層全体で時間を転送する方法を最適化するために、信頼性の高いタイム ソースとして構成できます。 場合は、ドメイン コント ローラーは信頼性の高いタイム ソースにするように構成、Net Logon サービスは、ネットワークにログオンすると、信頼性の高いタイム ソースとしてそのドメイン コント ローラーを発表します。 他のドメイン コント ローラーと同期するタイム ソースを検索するとき、信頼できるソースが利用可能な場合に、信頼性の高いソースをまずよう選択できます。  
  
#### <a name="time-source-selection"></a>タイム ソースの選択  
時間ソースの選択のプロセスは、ネットワーク上の 2 つの問題を作成できます。  
  
-   追加の同期を切り替えます。  
  
-   ネットワーク トラフィック量が増加します。  
  
同期ネットワーク内のサイクルは、時間がドメイン コント ローラーの間の一貫性が残ってし、別の信頼性の高いタイム ソースと再同期なく継続的にそれらの間で共有は、同時に発生します。 Windows タイム サービスの時間ソースの選択アルゴリズムはこれらの種類の問題を防ぐために設計されています。  
  
コンピューターでは、次の方法のいずれかを使用すると同期するタイム ソースを識別します。  
  
-   コンピューターがドメインのメンバーでない場合は、指定されたタイム ソースと同期を構成する必要があります。  
  
-   コンピューターがメンバー サーバーまたはワークステーション、既定では、ドメイン内である場合、AD DS の階層に依存してと、Windows タイム サービスを実行している現在のローカル ドメインのドメイン コント ローラーとその時間を同期します。  
  
コンピューターがドメイン コント ローラーの場合は、最大 6 個のクエリと同期する別のドメイン コントローラを見つけるなります。 各クエリがドメイン コント ローラー、特定の場所の種類など、特定の属性のタイム ソースを識別するように設計し、信頼性の高いタイム ソースであるかどうか。 タイム ソースは、次の制約にも従う必要があります。  
  
-   信頼性の高いタイム ソースは、親ドメインのドメイン コント ローラーとのみ同期できます。  
  
-   PDC エミュレーターは、独自のドメインで信頼性の高いタイム ソースまたは親ドメインのドメイン コント ローラーと同期できます。  
  
ドメイン コント ローラーがそれを照会しているドメイン コント ローラーの種類と同期することでない場合、クエリは作成されません。 ドメイン コント ローラーは、どの種類のコンピューターの時間からクエリを実行する前に入手できることを認識します。 たとえば、PDC エミュレーターでローカルしようとしませんクエリ数値の 3 または 6 つため、ドメイン コント ローラーがそれ自体と同期を試みません。  
  
次の表は、ドメイン コント ローラーがタイム ソースとする、クエリが行われた注文を見つけるには、クエリを示します。  
  
**ドメイン コント ローラーのタイム ソースのクエリ**  
  
|クエリの数|ドメイン コント ローラー|位置情報|タイム ソースの信頼性|  
|----------------|---------------------|------------|------------------------------|  
|1|親ドメイン コント ローラー|サイト内|信頼性を希望するが利用可能なすべての場合、非信頼できるタイム ソースと同期できるタイム ソースがします。|  
|2|ローカル ドメイン コント ローラー|サイト内|信頼性の高いタイム ソースとのみ同期します。|  
|3|ローカルの PDC エミュレーター|サイト内|適用されません。<br /><br />ドメイン コント ローラーは、それ自体と同期しません。|  
|4|親ドメイン コント ローラー|サイト外|信頼性を希望するが利用可能なすべての場合、非信頼できるタイム ソースと同期できるタイム ソースがします。|  
|5|ローカル ドメイン コント ローラー|サイト外|信頼性の高いタイム ソースとのみ同期します。|  
|6|ローカルの PDC エミュレーター|サイト外|適用されません。<br /><br />ドメイン コント ローラーは、それ自体と同期しません。|  
  
**注:**  
  
-   コンピューターは、決して自体と同期します。 同期を試行しているコンピューターがローカルの PDC エミュレーターの場合は再試行されませんクエリ 3 または 6 です。  
  
各クエリでは、タイム ソースとして使用できるドメイン コント ローラーの一覧を返します。 Windows タイムの割り当ては、各ドメイン コント ローラーでは、信頼性とドメイン コント ローラーの場所に基づいてスコアが照会されます。 次の表は、ドメイン コント ローラーの種類ごとに、Windows タイムで割り当てられているスコアを示します。  
  
**スコアの決定**  
  
|ドメイン コント ローラーの状態|スコア|  
|----------------------------|---------|  
|同じサイト内にあるドメイン コント ローラー|8|  
|信頼性の高いタイム ソースとしてマークされているドメイン コント ローラー|4|  
|親ドメイン内にあるドメイン コント ローラー|2|  
|PDC エミュレーターはドメイン コント ローラー|1|  
  
Windows タイム サービスは、それが可能なハイスコアでドメイン コント ローラーを識別が判断した場合は、複数のクエリではありませんが行われます。 タイム サービスによって割り当てられているスコアは累積的な同じサイト内にある PDC エミュレーターが 9 つのスコアを受け取ります。  
  
外部ソースと同期するタイム サービスのルートを構成しない場合、コンピューターの内部ハードウェア クロックは時間を制御します。  
  
### <a name="manually-specified-synchronization"></a>手動で指定の同期  
手動で指定された同期では、1 つのピアまたはコンピューターの時間の取得元となるピアのリストを指定することができます。 コンピューターがドメインのメンバーでない場合は、指定されたタイム ソースと同期を手動で構成する必要があります。 コンピューターがドメインのメンバーは、既定では、ドメインの階層から同期するように構成では、同期を手動で指定されたは、ドメインのフォレスト ルートまたはドメインに参加していないコンピューターに最も役立ちます。 信頼性の高いタイムを提供するドメインの権限のあるコンピューターと同期する外部の NTP サーバーを手動で指定します。 ただし、ハードウェア クロックと同期するドメインの権限のあるコンピューターの構成は、実際に最適なソリューションをドメインに最も正確なセキュリティで保護された時刻を提供することです。  
  
特定のタイム プロバイダが書き込まれ、攻撃者に対して脆弱であるためしない限り、手動で指定されたタイム ソースは認証されません。 また、コンピューターは、その認証のドメイン コント ローラーではなく、手動で指定されたソースと同期、2 台のコンピューターが同期されず、Kerberos 認証に失敗の原因できるがあります。 その他のアクションが失敗し、印刷やファイル共有などのネットワークの認証を必要とする可能性があります。 外部ソースと同期するフォレストのルートが構成されている、のみの場合、フォレスト内で他のすべてのコンピューター同期を保つ、相互にリプレイ攻撃が困難です。  
  
### <a name="all-available-synchronization-mechanisms"></a>すべての利用可能な同期メカニズム  

「すべての利用可能な同期メカニズム」オプションは、ネットワーク上のユーザーの最も重要な同期方法です。 このメソッドは、同期、ドメインの階層を使用し、可能性があります、代替も、時間ソースの場合は、ドメインの階層の構成によっては利用できなくなります。 クライアントが、ドメインの階層と時刻を同期できない場合は、タイム ソースに自動的にフォールバックで指定されたタイム ソース、 **NtpServer**設定します。 同期のこのメソッドは正確な時刻をクライアントに提供するほとんどの場合です。  

### <a name="stopping-time-synchronization"></a>停止時刻の同期  
その時刻の同期からコンピューターを停止する必要は特定の状況があります。 たとえば場合は、コンピューターがダイアル アップ接続を使用して、WAN 経由でインターネット上のタイム ソースとは別のサイトからを同期しようとするは、コストのかかる電話料金を請求、ことができます。 そのコンピューターでの同期を無効にするとダイアル アップ接続経由でタイム ソースにアクセスしようとしてからコンピューターを禁止します。  
  
イベント ログにエラーが生成されないようにする同期無効にすることもできます。 コンピューターがある、利用可能なタイム ソースと同期を試みるたびに、イベント ログにエラーが発生します。 タイム ソースは、スケジュールされたメンテナンスのため、ネットワークから切断されたが、クライアントを再構成して別のソースから同期しない場合は、同期を試行タイム サーバーが利用できないようにするクライアントでの同期を無効にすることができます。  
  
同期ネットワークのルートとして指定されているコンピューターでの同期を無効にすると便利です。 これは、ルートのコンピューターがローカル クロックを信頼することを示します。 同期の階層のルートに設定されていないかどうかは**NoSync**別のタイム ソースと同期できない場合は、クライアントを使用して、時間が信頼できないために、このコンピューターが送信されるパケット。  
  
のみが別のタイム ソースと同期していない場合でも、クライアントによって信頼されているサーバーがクライアントで信頼性の高いタイム サーバーとして指定されている挙げられます。  
  
### <a name="disabling-the-windows-time-service"></a>Windows タイム サービスを無効にします。  
Windows タイム サービス (W32Time) を完全に無効にすることができます。 NTP を使用しているサード パーティ製の時間同期製品を実装する場合は、Windows タイム サービスを無効にする必要があります。 これは、すべての NTP サーバーがユーザー データグラム プロトコル (UDP) ポート 123 へのアクセスを必要し、ポート 123 は Windows タイムで予約されている Windows タイム サービスは、Windows Server 2003 オペレーティング システムで実行されている限りためです。  
  
## <a name="w2k3tr_times_how_ydum"></a>Windows タイム サービスによって使用されるネットワーク ポート  
Windows タイム サービスは、信頼性の高いタイム ソースを特定、時刻情報を取得および他のコンピューターに時間の情報を提供するネットワークで通信します。 NTP と SNTP Rfc で定義されている、このような通信を実行します。  
  
**Windows タイム サービスのポートの割り当て**  
  
|サービス名|UDP|TCP|  
|----------------|-------|-------|  
|NTP|123|該当なし|  
|SNTP|123|該当なし|  
  
## <a name="see-also"></a>参照してください。  
[Windows タイム サービスのテクニカル リファレンス](https://technet.microsoft.com/library/cc773061.aspx)  
[Windows タイム サービスのツールと設定](Windows-Time-Service-Tools-and-Settings.md)  
[Microsoft サポート技術情報の記事 902229](https://go.microsoft.com/fwlink/?LinkId=186066)  
  


