---
title: BranchCache
description: このトピックでは、Windows Server 2016 での BranchCache の概要
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-bc
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: a4587cff-c086-49f1-a0bf-cd74b8a44440
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 5540d89827b80a21bf23f6a2aa8f54f09dfde67a
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="branchcache"></a>BranchCache

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、情報技術 (IT) プロフェッショナルを対象は、BranchCache モード、機能、機能、およびさまざまなオペレーティング システムで利用できる BranchCache 機能など、BranchCache の概要情報を提供します。

> [!NOTE]
> このトピックに加え、次の BranchCache 関連のドキュメントは使用できます。
> 
> - [BranchCache ネットワーク シェルと Windows PowerShell コマンド](../branchcache/BranchCache-Network-Shell-and-Windows-PowerShell-Commands.md)
> -   [BranchCache 展開ガイド](../branchcache/deploy/BranchCache-Deployment-Guide.md)

**BranchCache の対象するはだれですか。**

システム管理者、ネットワークまたはストレージ ソリューション アーキテクト、またはその他の IT プロフェッショナル場合は、BranchCache は有用する次の状況です。

- 設計またはをメイン オフィスに、ブランチ オフィスから 2 つまたは複数の物理的な場所と、ワイド エリア ネットワーク (WAN) 接続を持つ組織の IT インフラストラクチャをサポートする場合。

- 設計またはクラウド テクノロジが展開されている組織の IT インフラストラクチャをサポートする、WAN 接続は、データへのアクセスおよびリモートの場所にアプリケーションに作業者が使用されます。

- ブランチ オフィスとメイン オフィス間のネットワーク トラフィックの量を削減して WAN 帯域幅の使用を最適化するには。

- 展開するか、または、このトピックで説明されている構成に一致するをメイン オフィスのコンテンツ サーバーを展開することを計画します。

- ブランチ オフィス内のクライアント コンピューターは、Windows 10、Windows 8.1、Windows 8、または Windows 7 を実行しています。

このトピックには、次のセクションが含まれます。

-   [BranchCache とは何ですか。](#bkmk_what)

-   [BranchCache のモード](#BKMK_2)
  
-   [BranchCache が有効なコンテンツ サーバー](#BKMK_3)
  
-   [BranchCache とクラウド](#BKMK_3a)
  
-   [コンテンツ情報のバージョン](#bkmk_version)  
  
-   [BranchCache でファイルのコンテンツの更新の処理方法](#bkmk_handles)  
  
-   [BranchCache インストール ガイド](#BKMK_4)  
  
-   [BranchCache のバージョンのオペレーティング システム](#bkmk_os)  
  
-   [BranchCache のセキュリティ](#bkmk_security)  
  
-   [コンテンツ フローとプロセス](#bkmk_flow)  
  
-   [キャッシュのセキュリティ](#bkmk_cache)  
  
## <a name="bkmk_what"></a>BranchCache とは何ですか。

BranchCache は、一部のエディション、Windows Server 2016 および Windows 10 オペレーティング システム、および Windows Server 2012 R2、Windows 8.1、Windows Server 2012、Windows 8、Windows Server 2008 R2 および Windows 7 の一部のエディションに含まれているワイド エリア ネットワーク (WAN) 帯域幅最適化テクノロジです。 ユーザーがリモート サーバー上のコンテンツをアクセスするときは、WAN 帯域幅を最適化、BranchCache は、クラウドのコンテンツ サーバーをホスト型またはと、クライアント コンピューターは WAN を経由ではなくローカルでコンテンツにアクセスするブランチ オフィスを許可するブランチ オフィスの場所にコンテンツをキャッシュ メイン オフィスからコンテンツを取得します。
  
ブランチ オフィスで、キャッシュをホストする、またはサーバーを使用できない場合、Windows 10、Windows 8.1、Windows 8 または Windows 7 を実行しているクライアント コンピューターで、ブランチ オフィス内に構成されているサーバーにコンテンツが格納されています。 クライアント コンピューターを要求してメイン オフィスからコンテンツを受信すると、コンテンツがブランチ オフィスにキャッシュされ、同じブランチ オフィスにある他のコンピューターは WAN リンク経由でコンテンツ サーバーからコンテンツをダウンロードするのではなく、ローカルでコンテンツを取得できます。

クライアント コンピューターによっては、同じコンテンツを後続の要求が行われた、クライアントはダウンロード*コンテンツ情報*、実際のコンテンツではなく、サーバーからです。 コンテンツ情報は、元のコンテンツのチャンクを使用して計算およびが非常に小さく、元のデータの内容と比較されるハッシュで構成されます。 クライアント コンピューターから、コンテンツ情報を使用して、ブランチ オフィスにキャッシュからコンテンツを見つけます、キャッシュがクライアント コンピューターまたはサーバー上に存在するかどうか。 クライアント コンピューターとサーバーもコンテンツ情報を使用して、承認されていないユーザーがアクセスできないように、キャッシュされたコンテンツをセキュリティで保護します。

BranchCache は、ブランチ オフィス内のクライアントとサーバーのコンテンツのクエリ応答時間を向上させることによってエンド ユーザーの生産性の向上し、トラフィックが減少する WAN リンク経由でネットワーク パフォーマンスを向上させることができます。

## <a name="BKMK_2"></a>BranchCache のモード
BranchCache には操作の 2 つのモード: 分散キャッシュ モードとホスト型キャッシュ モード。

分散キャッシュ モードで BranchCache を展開するときに、ブランチ オフィスのコンテンツ キャッシュはクライアント コンピューター間で配布されます。

ホスト型キャッシュ モードで BranchCache を展開するときに、ブランチ オフィスのコンテンツ キャッシュがいずれかでホストされているかと呼ばれる、複数のサーバー コンピューターにホスト型キャッシュ サーバー。

> [!NOTE]
> ブランチ オフィスあたり 1 つのみのモードで使用できる両方のモードを使用して BranchCache を展開することができます。 たとえばがサポートしていない、1 つと、サーバーが 2 つのブランチ オフィスがある場合は、クライアント コンピューターのみを含む、オフィスで分散キャッシュ モードで BranchCache を展開するときに、サーバーが含まれる、オフィス内のホスト型キャッシュ モードで BranchCache を展開できます。

次の図では、BranchCache は、両方のモードで展開されています。  

![BranchCache のモード](../media/BranchCache/bc_modes.jpg)

分散キャッシュ モードは、ホスト型キャッシュ サーバーとして使用するためのローカル サーバーを持たない小規模のブランチ オフィスに最適です。 分散キャッシュ モードでは、ハードウェアの追加がブランチ オフィス内で BranchCache を展開することができます。

BranchCache を展開するブランチ オフィスの他のワークロードを実行している 1 つまたは複数のサーバーなど、追加のインフラストラクチャに含まれる場合ホスト型キャッシュ モードで BranchCache を展開する利点が次の理由であります。

### <a name="increased-cache-availability"></a>キャッシュの可用性

ホスト型キャッシュ モードは、最初に要求およびデータをキャッシュするクライアントがオフラインの場合でも、コンテンツが利用可能なために、キャッシュの効率を向上します。 ホスト型キャッシュ サーバーにため、常に利用可能なより多くのコンテンツがキャッシュされ、WAN 帯域幅を大幅に削減するには、提供して、BranchCache の効率が向上します。

### <a name="centralized-caching-for-multiple-subnet-branch-offices"></a>複数のサブネットのブランチ オフィスのキャッシュの一元化


分散キャッシュ モードは、単一のサブネットでは動作します。 分散キャッシュ モード用に構成されている複数のサブネットのブランチ オフィス、他のサブネット上のクライアント コンピューターと 1 つのサブネットにダウンロードされたファイルを共有できません。 

このためは、ファイルが既にダウンロードされているを検出できません、他のサブネット上のクライアントは、プロセスの WAN 帯域幅を使用してメイン オフィスのコンテンツ サーバーからファイルを取得します。

ただし、ホスト型キャッシュ モードを展開するときに、これは、ケースではありません - 複数サブネットがあるブランチ オフィス内のすべてのクライアントが、クライアントが異なるサブネット上にある場合でも、ホスト型キャッシュ サーバーに格納されている 1 つのキャッシュにアクセスできます。 さらに、Windows Server 2016、Windows Server 2012 R2、および Windows Server 2012 での BranchCache は、ブランチ オフィスごとに 1 つ以上のホスト型キャッシュ サーバーを展開する機能を提供します。

> [!CAUTION]
> ファイルとフォルダーの SMB キャッシュに BranchCache を使用する場合は、オフライン ファイルを無効にしないでください。 オフライン ファイルを無効にした場合、BranchCache の SMB キャッシュが正しく機能しません。

## <a name="BKMK_3"></a>BranchCache が有効なコンテンツ サーバー

BranchCache を展開するときに、ソース コンテンツは、BranchCache が有効なコンテンツ サーバーで、メイン オフィスまたはクラウド データ センター内に格納されます。 BranchCache では、次の種類のコンテンツ サーバーがサポートされています。

> [!NOTE]
> 唯一のソース コンテンツ - は、コンテンツ、BranchCache 対応のコンテンツ サーバーからのクライアント コンピューターが最初に取得するには、BranchCache によって高速化されます。 クライアント コンピューターがインターネットまたは Windows Update では、上の Web サーバーなど、他のソースから直接取得するコンテンツは、クライアント コンピューターではキャッシュされませんまたはキャッシュ サーバーがホストされているし、ブランチ オフィスの他のコンピューターで共有されます。 Windows Update のコンテンツを高速化する場合は、ただし、メイン オフィスまたはクラウド データ センターの Windows Server Update Services (WSUS) アプリケーション サーバーをインストールして、BranchCache コンテンツ サーバーとして構成します。

### <a name="web-servers"></a>Web サーバー

サポートされている Web サーバーには、インストールされている Web サーバー (IIS) サーバーの役割を持ち、ハイパー テキスト転送プロトコル (HTTP) または HTTP セキュア (HTTPS) を使用する Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、または Windows Server 2008 R2 を実行しているコンピューターが含まれます。

さらに、Web サーバーでは、BranchCache 機能がインストールされている場合があります。

### <a name="file-servers"></a>ファイル サーバー

サポートされているファイル サーバーには、ファイル サービス サーバーの役割とインストールされている役割サービスのネットワーク ファイル用 BranchCache を持つ Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、または Windows Server 2008 R2 を実行しているコンピューターが含まれます。 

これらのファイル サーバーでは、サーバー メッセージ ブロック (SMB) を使用して、コンピューター間で情報を交換します。 ファイル サーバーのインストールを完了するもフォルダーを共有し、BranchCache を有効にするグループ ポリシーまたはローカル コンピューター ポリシーを使用して共有フォルダーのハッシュ生成を有効にする必要があります。

### <a name="application-servers"></a>アプリケーション サーバー

サポートされているアプリケーション サーバーには、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012 を実行しているコンピューターが含まれます。 または、Windows Server 2008 R2 バック グラウンド インテリジェント転送サービス (BITS) をインストールし、有効にします。 

さらに、アプリケーション サーバーでは、BranchCache 機能がインストールされている場合があります。 アプリケーション サーバーの例については、として Microsoft Windows Server Update Services (WSUS) と Microsoft System Center Configuration Manager ブランチ配布ポイントのサーバーを BranchCache コンテンツ サーバーとして展開できます。

## <a name="BKMK_3a"></a>BranchCache とクラウド

クラウドには、運用経費を削減し、新しいレベルのスケールを実現する膨大な可能性があるが、ネットワー キング コストを増やすし、生産性が悪化それらに依存するユーザーからワークロードを移動することができます。 ユーザーは、高パフォーマンスの期待し、アプリケーションやデータがホストされている場所もかまわないです。 

BranchCache は、ネットワーク アプリケーションのパフォーマンスが向上し、データの共有キャッシュを使用して帯域幅の消費を削減できます。  ブランチ オフィスや本社、ワーカーを使用しているサーバーが展開されているクラウドの生産性が向上します。

BranchCache は、新しいハードウェアやネットワーク トポロジの変更は必要ありません、ために、オフィスの場所と両方パブリック クラウドとプライベート クラウドの間の通信を向上させる優れたソリューションです。

> [!NOTE]
> 一部の Web プロキシは、標準のコンテンツ エンコードのヘッダーを処理できません、ために、ハイパー テキスト転送プロトコル セキュア (HTTPS) および HTTP ではないと、BranchCache を使用することをお勧めします。
  
=== の Windows Server 2016 でのクラウド テクノロジの詳細については、次を参照してください。[ソフトウェア定義ネットワーク (&) #40 です。SDN & #41 です。](../sdn/Software-Defined-Networking--SDN-.md).
  
## <a name="bkmk_version"></a>コンテンツ情報のバージョン

これには 2 つのバージョンのコンテンツ情報があります。

- Windows Server 2008 R2 および Windows 7 を実行しているコンピューターと互換性があるコンテンツ情報は、version 1 または V1 と呼ばれます。 V1 の BranchCache ファイル セグメント化でファイル セグメント、V2 より大きく、固定サイズの。 容量固定の大きなセグメントのサイズのためユーザーがファイルの長さを変更する変更と、変更されたセグメントが無効化、だけでなくすべてのファイルの末尾にセグメントが無効になります。 [次へ] 呼び出し、ブランチ オフィス内の別のユーザーが変更されたファイルのための結果削減 WAN 帯域幅が節約内容が変更し、変更後のすべてのコンテンツが WAN リンク経由で送信されるためです。

- Windows Server 2016、Windows 10、Windows Server 2012 R2、Windows 8.1、Windows Server 2012、および Windows 8 を実行しているコンピューターと互換性があるコンテンツ情報は、version 2 または V2 と呼ばれます。 V2 コンテンツ情報は、ファイル内の変更をよりトレラントなより小さな可変サイズのセグメントを使用します。 この増加のコンテンツ サーバーから、ファイルの変更部分のみを取得してより少ない WAN の帯域幅を使用して、ユーザーが更新されたバージョンをアクセスするときは、ファイルの以前のバージョンからのセグメントの確率を再利用されることができます。

次の表は、コンテンツ サーバーは、クライアントによって使用されているバージョンのコンテンツ情報に関する情報を提供し、BranchCache の展開で使用しているキャッシュ サーバーのオペレーティング システムをホストします。

> [!NOTE]
> 次の表では、"OS"頭字語は、オペレーティング システムを意味します。

|クライアントの OS|コンテンツ サーバー OS|ホスト型キャッシュ サーバー OS|コンテンツ情報のバージョン|
|-------------|---------------------|--------------------------|-------------------------------|
|Windows Server 2008 R2 および Windows 7 |Windows Server 2012 以降|Windows Server 2012 以降です。分散キャッシュ モードで [なし]|V1|
|Windows Server 2012 以降です。Windows 8 以降|Windows Server 2008 R2 |Windows Server 2012 以降です。分散キャッシュ モードで [なし]|V1|
|Windows Server 2012 以降です。Windows 8 以降| Windows Server 2012 以降| Windows Server 2008 R2 |V1|
|Windows Server 2012 以降です。Windows 8 以降|Windows Server 2012 以降|Windows Server 2012 以降です。分散キャッシュ モードで [なし]|V2|

コンテンツ サーバーがある Windows Server 2016、Windows Server 2012 R2、および Windows Server 2012 を実行しているキャッシュ サーバーをホストすると、それらの情報を要求する BranchCache クライアントのオペレーティング システムに基づいて適切なバージョンのコンテンツ情報を使用します。 

コンテンツとホスト型キャッシュ サーバーが V2 のコンテンツ情報を使用してコンテンツを要求すると、Windows Server 2012 と Windows 8 またはそれ以降のオペレーティング システムを実行しているコンピューターWindows Server 2008 R2 および Windows 7 を実行しているコンピューターでは、コンテンツを要求、コンテンツおよびホスト型キャッシュ サーバーは、V1 のコンテンツ情報を使用します。

>[!IMPORTANT]
>分散キャッシュ モードで BranchCache を展開するときに、別のコンテンツ情報のバージョンを使用するクライアントは相互にコンテンツを共有しません。 たとえば、Windows 7 を実行しているクライアント コンピューターと、同じブランチ オフィスにインストールされている Windows 10 を実行しているクライアント コンピューター共有していないコンテンツ相互にします。
  
## <a name="bkmk_handles"></a>BranchCache でファイルのコンテンツの更新の処理方法

ブランチ オフィスのユーザーを変更またはドキュメントの内容を更新、それらの変更内容が BranchCache の関与なしメイン オフィスのコンテンツ サーバーに直接書き込まれます。 これは、ユーザーのコンテンツ サーバーからドキュメントをダウンロードするかどうかや、ブランチ オフィス内のホストまたは分散キャッシュから取得します。

ブランチ オフィス内の別のクライアントによって変更されたファイルが要求されると、ファイルの新しいセグメントがメイン オフィスのサーバーからダウンロードし、そのブランチの分散またはホスト型キャッシュに追加します。 このため、ブランチ オフィスのユーザーは、キャッシュされたコンテンツの最新バージョンを常に表示されます。

## <a name="BKMK_4"></a>BranchCache インストール ガイド

Windows Server 2016 でサーバー マネージャーを使用するには、BranchCache 機能またはファイル サービス サーバー役割の役割サービスのネットワーク ファイル用 BranchCache をインストールします。 次の表を使用すると、役割サービスまたは機能をインストールするのにかどうかを決定します。

|機能|コンピューターの場所|インストールする BranchCache 要素|
|-----------------|---------------------|------------------------------------|
|コンテンツ サーバー \ (BITS ベースのアプリケーション サーバー \)|メイン オフィスまたはクラウド データ センター|BranchCache 機能|
|コンテンツ サーバー \(Web server\)|メイン オフィスまたはクラウド データ センター|BranchCache 機能|
|コンテンツ サーバー \ (SMB protocol\ を使用してファイル サーバー)|メイン オフィスまたはクラウド データ センター|ファイル サービス サーバー役割の役割サービスのネットワーク ファイル用 BranchCache|
|ホスト型キャッシュ サーバー|ブランチ オフィス|有効になっているホスト型キャッシュ サーバー モードで BranchCache 機能|
|BranchCache が有効なクライアント コンピューター|ブランチ オフィス|インストール作業は不要です。BranchCache と BranchCache モードを有効にする \(distributed or hosted\) クライアントで|

役割サービスまたは機能のいずれかをインストールするには、サーバー マネージャーを開き BranchCache の機能を有効にコンピューターを選択します。 サーバー マネージャーで、クリックして**管理**、] をクリックし、**追加の役割と機能**します。 **追加の役割と機能**ウィザードが開きます。 ウィザードを実行すると、次を選択を行います。

- ウィザードのページで**[インストールの種類**[**役割ベースまたは機能ベースのインストール**します。

- ウィザードのページで**サーバーの役割の選択**、BranchCache 対応ファイル サーバーをインストールする場合は、展開**ファイル サービスおよび記憶域サービス**と**ファイル サービスおよび iSCSI サービス**、し、[**ネットワーク ファイル用 BranchCache**します。  ディスク領域を節約する選択することも、**データ重複除去**役割サービス、および、ウィザードのインストールと完了に進みます。 BranchCache 対応ファイル サーバーをインストールしない場合、役割サービスのネットワーク ファイル用 BranchCache でファイル サービスおよび記憶域サービスの役割はインストールされません。

- ウィザードのページで**機能の選択**ファイル サーバーではないコンテンツ サーバーをインストールするか、またはホスト型キャッシュ サーバーを選択をインストールする場合、 **BranchCache**、ウィザードのインストールと完了に進みます。 ファイル サーバーまたはホスト型キャッシュ サーバー以外のコンテンツ サーバーをインストールしたくない場合は、BranchCache 機能をインストールしません。
  
## <a name="bkmk_os"></a>BranchCache のバージョンのオペレーティング システム

異なる種類の BranchCache 機能をサポートするオペレーティング システムの一覧を次に示します。

### <a name="operating-systems-for-branchcache-client-computer-functionality"></a>BranchCache クライアント コンピューターが機能用のオペレーティング システム

次のオペレーティング システムは、BranchCache をバック グラウンド インテリジェント転送サービス (BITS)、ハイパー テキスト転送プロトコル (HTTP)、およびサーバー メッセージ ブロック (SMB) のサポートを提供します。

- Windows 10 Enterprise

- Windows 10 Education

- Windows 8.1 Enterprise

- Windows 8 Enterprise

- Windows 7 Enterprise

- Windows 7 Ultimate

次のオペレーティング システムでは、BranchCache は、HTTP および SMB の機能をサポートしていませんが、BITS の BranchCache 機能をサポートしています。

-   Windows 10 Pro ビットのみがサポートします。

-   Windows 8.1 Pro ビットのみがサポートします。

-   Windows 8 Pro ビットのみがサポートします。

-   Windows 7 Pro ビットのみがサポートします。

> [!NOTE]
> BranchCache では、既定では、Windows Server 2008 または Windows Vista オペレーティング システムで使用できません。 これらのオペレーティング システムでただし、ダウンロードして、Windows Management Framework の更新プログラムをインストールする場合は、BranchCache の機能はのみバック グラウンド インテリジェント転送サービス (BITS) プロトコルの使用可能なです。 詳細については、および Windows Management Framework をダウンロードするには、「[Windows Management Framework (Windows PowerShell 2.0、WinRM 2.0、および BITS 4.0)](https://go.microsoft.com/fwlink/?LinkId=188677)でhttps://go.microsoft.com/fwlink/?LinkId=188677します。
  
### <a name="operating-systems-for-branchcache-content-server-functionality"></a>オペレーティング システムを BranchCache コンテンツ サーバーの機能

Windows Server 2016、Windows Server 2012 R2、および Windows Server 2012 のファミリのオペレーティング システムは、BranchCache コンテンツ サーバーとして使用できます。

さらに、Windows Server 2008 R2 のファミリのオペレーティング システムは、次の例外を除き、BranchCache コンテンツ サーバーとして使用できます。

- BranchCache は、Hyper-V と Windows Server 2008 R2 Enterprise の Server Core インストールでサポートされていません。

- BranchCache は、Hyper-V と Windows Server 2008 R2 Datacenter の Server Core インストールでサポートされていません。

### <a name="operating-systems-for-branchcache-hosted-cache-server-functionality"></a>ホスト型キャッシュ サーバーの機能を BranchCache 用のオペレーティング システム

BranchCache ホスト型キャッシュ サーバーとして Windows Server 2016、Windows Server 2012 R2、および Windows Server 2012 のファミリのオペレーティング システムを使用することができます。

さらに、次の Windows Server 2008 R2 オペレーティング システムを BranchCache ホスト型キャッシュ サーバーとして使用できます。

- Windows Server 2008 R2 Enterprise

- Windows Server 2008 R2 Enterprise (Hyper-v)

- Windows Server 2008 R2 Enterprise の Server Core のインストール

- Windows Server 2008 R2 Enterprise Server Core インストール (Hyper-v)

- Itanium ベース システム用 Windows Server 2008 R2

- Windows Server 2008 R2 Datacenter

- Windows Server 2008 R2 Datacenter (Hyper-v)

- Windows Server 2008 R2 Datacenter Server Core インストール (Hyper-v)

## <a name="bkmk_security"></a>BranchCache のセキュリティ

BranchCache は、既存のネットワーク セキュリティ アーキテクチャ、追加の機器やその他の複雑なセキュリティの構成を必要としないとシームレスに連携する設計のセキュリティで保護されたアプローチを実装します。
  
BranchCache は非侵入型と、すべて Windows 認証と承認のプロセスは変更されません。 BranchCache を展開した後に認証には、ドメインの資格情報、およびアクセス制御リスト (Acl) による承認も機能が変更された方法を使用しては実行されます。 さらに、その他の構成は、BranchCache を展開する前と同じように機能し続けます。

BranchCache セキュリティ モデルは、一連のハッシュの形式でのメタデータの作成に基づいています。 これらのハッシュはコンテンツ情報とも呼ばれます。

コンテンツ情報が作成されたら、実際のデータではなく、BranchCache のメッセージ交換で使用されているがやり取りされますサポートされているプロトコル (HTTP、HTTPS、および SMB) を使用します。

キャッシュされたデータは暗号化された保持され、元のソースからコンテンツにアクセスするためのアクセス許可がないクライアントがアクセスすることはできません。  クライアントの認証し、コンテンツ メタデータを取得することができます、ローカル オフィスのキャッシュにアクセスするコンテンツのメタデータを持つ必要があります前に、元のコンテンツ ソースによって承認されている必要があります。

### <a name="how-branchcache-generates-content-information"></a>BranchCache はコンテンツ情報を生成する方法

コンテンツ情報が複数の要素から作成されるため、コンテンツ情報の値は常に一意です。 これらの要素は次のとおりです。

- 実際のコンテンツ (Web ページ、共有ファイルなど)、ハッシュが派生します。  

- ハッシュ アルゴリズム、ブロック サイズなどの構成パラメーター。 コンテンツ情報を生成するには、コンテンツ サーバーは、コンテンツをセグメントに分割し、そのセグメントをブロックし、細分化します。 BranchCache は、セキュリティで保護された暗号化ハッシュを使用して識別および、SHA256 ハッシュ アルゴリズムをサポートする各ブロックとセグメントを確認します。

- サーバー シークレット。 すべてのコンテンツ サーバーは、任意の長さのバイナリ値であるサーバー シークレットを使用して構成する必要があります。

> [!NOTE]
> サーバー シークレットの使用は、クライアント コンピューターが自体コンテンツ情報を生成することができないことを確認します。 これは悪意のあるユーザーが BranchCache が有効なクライアント コンピューターと、クライアントが以前のバージョンにアクセスできていたが現在のバージョンにアクセスできない場合にバージョン間でコンテンツのわずかな変更を推測するブルート フォース攻撃を使用することを防ぎます。

### <a name="content-information-details"></a>コンテンツ情報の詳細

BranchCache は、承認されたクライアントに送信されるコンテンツに固有のハッシュを派生するために、キーとして、サーバー シークレットを使用します。 結合サーバー シークレットとデータのハッシュにハッシュ アルゴリズムを適用するには、このハッシュが生成されます。

このハッシュは、セグメント シークレットと呼ばれます。 BranchCache はセグメント シークレットを使用して、通信をセキュリティで保護します。 加えて、BranchCache は、ハッシュされたデータ ブロックのリストである、ブロック ハッシュ リストと、データのハッシュ、ブロック ハッシュ リストをハッシュして生成されるを作成します。

コンテンツ情報を次に示します。

- ブロック ハッシュ リスト:

    `BlockHashi = Hash(dataBlocki)   1<=i<=n`

- (HoD) のデータのハッシュ:

    `HoD = Hash(BlockHashList)`

- セグメント シークレット (Kp):

    `Kp = HMAC(Ks, HoD)`

BranchCache では、Peer Content Caching プロトコルと Retrieval Framework プロトコルを使用して、キャッシングとコンテンツ キャッシュ間のデータの取得をセキュリティで保護されたことを確認する必要があるプロセスを実装します。

加えて、BranchCache コンテンツ情報を処理操作および自体実際のコンテンツの転送時に使用するセキュリティの同じレベルでします。

## <a name="bkmk_flow"></a>コンテンツ フローとプロセス

コンテンツ情報および実際のコンテンツのフローは次の 4 つのフェーズに分かれています。

1.  [BranchCache のプロセス: コンテンツの要求](#BKMK_8)

2.  [BranchCache のプロセス: コンテンツの検出](#BKMK_9)

3.  [BranchCache のプロセス: コンテンツを取得します。](#BKMK_10)

4.  [BranchCache のプロセス: コンテンツのキャッシュ](#BKMK_11)

次のセクションでは、これらの段階について説明します。

## <a name="BKMK_8"></a>BranchCache のプロセス: コンテンツの要求

最初のフェーズでは、ブランチ オフィス内のクライアント コンピューターは、メイン オフィスなどの遠隔地にあるコンテンツ サーバーからファイルや Web ページなどのコンテンツを要求します。 コンテンツ サーバーは、要求されたコンテンツを受け取るクライアント コンピューターが承認されていることを確認します。 クライアント コンピューターが承認されているコンテンツ サーバーとクライアントの両方が BranchCache\ 有効になっている場合は、コンテンツ サーバーは、コンテンツ情報を生成します。

コンテンツ サーバーは、実際のコンテンツを使用するように、同じプロトコルを使用してクライアント コンピューターをコンテンツ情報を送信します。 

たとえば、クライアント コンピューターは、HTTP 経由で Web ページを要求、コンテンツ サーバーは HTTP を使用して、コンテンツ情報を送信します。 このため、ネットワーク レベルのセキュリティは、コンテンツの保証し、コンテンツ情報は同じです。

コンテンツ情報 (データのハッシュ + セグメント シークレット) の最初の部分が受信した後、クライアント コンピューターは、次の操作を実行します。

- 暗号化キー (Ke) として、セグメント シークレット (Kp) を使用します。

- HoD および Kp からセグメント ID (HoHoDk) が生成されます。

    `HoHoDk = HMAC(Kp, HoD + C), where C is the ASCII string "MS_P2P_CACHING" with NUL terminator.`

ただし、BranchCache は、セグメント シークレットを保護するのにはコンテンツ データ ブロックを暗号化この層で重大な脅威はセグメント シークレット リスクしています。 BranchCache は、コンテンツ ブロックが配置されているコンテンツ セグメントのセグメント シークレットから派生した暗号化キーを使用します。

これにより、サーバー シークレットを所有していないエンティティが、データ ブロックの実際のコンテンツを検出できません。 セグメント シークレットとして扱われますセキュリティの同じレベルで、プレーン テキスト セグメントそのもの、特定のセグメントのセグメント シークレットに関する知識ことが可能にピアからセグメントを取得しの暗号化を解除するためです。 サーバー シークレットの知識は、特定のプレーン テキストをすぐに生成しませんが、暗号テキストからする可能性があります、ブルート フォース攻撃を既知の一部が部分的にデータを公開し、特定の種類のデータを派生させるために使用できます。 サーバー シークレット、そのため、おく必要がある機密情報。
  
## <a name="BKMK_9"></a>BranchCache のプロセス: コンテンツの検出

コンテンツ情報がクライアント コンピューターによって受信されると、クライアントはそのキャッシュがクライアント コンピューター間に分散またはホスト型キャッシュ サーバーに配置されているかどうか、ローカルのブランチ オフィスのキャッシュ内で要求されたコンテンツを検索するのにセグメント ID を使用します。

クライアント コンピューターがホスト型キャッシュ モードに構成されている場合は、ホスト型キャッシュ サーバーのコンピューター名で構成し、コンテンツを取得するには、そのサーバーに接続します。

クライアント コンピューターが分散キャッシュ モードに構成されている場合ただし、コンテンツがブランチ オフィス内の複数のコンピューターで複数のキャッシュ保存可能性があります。 クライアント コンピューターは、コンテンツがある場所、コンテンツを取得する前に検出する必要があります。

分散キャッシュ モードに構成されている場合、クライアント コンピューターは、Web Services Dynamic Discovery (Ws-discovery) プロトコルに基づく検出プロトコルを使用してコンテンツを見つけます。 クライアントが送信 Ws-discovery マルチキャストのプローブ メッセージをネットワーク経由でキャッシュされたコンテンツを検出します。 プローブ メッセージには、これにより、クライアントを要求されたコンテンツがキャッシュに格納されているコンテンツと一致するかどうかを確認するセグメント ID が含まれます。 セグメント ID がローカルにキャッシュされているコンテンツと一致する場合は、ユニキャスト Probe-match メッセージと共に照会元のクライアントに初期プローブ メッセージの返信を受信するクライアント。  

Ws-discovery プロセスが成功したが、探索を実行しているクライアントが正しいことを要求しているコンテンツをコンテンツ サーバーから提供されたコンテンツ情報であるという事実によって異なります。

要求のコンテンツ フェーズ中にデータに対する主な脅威は、情報の漏洩はコンテンツ情報にアクセスする権限のあるコンテンツへのアクセスを意味するためです。 このリスクを軽減するには、探索プロセスでは、コンテンツを含むプレーン テキスト セグメントについて何もは表示されませんが、セグメント ID 以外のコンテンツ情報は表示されません。

さらに、同じネットワーク サブネット上の悪意のあるユーザーで実行する別のクライアント コンピューターは、ルーターを通過する元のコンテンツ ソースに対する BranchCache 検出トラフィックを確認できます。

ブランチ オフィスで、要求されたコンテンツが見つからない場合、クライアントは、WAN リンクを介してコンテンツ サーバーから直接コンテンツを要求します。

コンテンツを受信した後、クライアント コンピューターまたはホスト型キャッシュ サーバーのいずれかのローカル キャッシュに追加されます。 この場合、コンテンツ情報はに基づいて、クライアントまたはハッシュと一致しないすべてのコンテンツをローカル キャッシュに追加できないキャッシュ サーバーをホストします。 ハッシュを照合してコンテンツを検証するプロセスは、有効なコンテンツのみが、キャッシュに追加し、ローカル キャッシュの整合性が保護されていることにより、します。

## <a name="BKMK_10"></a>BranchCache のプロセス: コンテンツを取得します。

クライアント コンピューターがコンテンツのホストでは、ホスト型キャッシュ サーバーまたは分散キャッシュ モードのクライアント コンピューターのいずれかが、目的のコンテンツを検索した後、クライアント コンピューターは、コンテンツの取得プロセスを開始します。

まず、クライアント コンピューターは、最初のブロックが、必要なコンテンツ ホストに、要求を送信します。 要求には、目的のコンテンツを識別するセグメント ID とブロック範囲が含まれています。 1 つだけのブロックが返されるため、ブロック範囲には、1 つのブロックのみが含まれています。 (複数のブロックの要求は現在サポートされていません。)クライアントは、ローカルの未処理の要求リストにも、要求を格納します。  

クライアントから有効な要求メッセージを受信時に、コンテンツ ホストは、要求で指定されたブロックがコンテンツ ホストのコンテンツ キャッシュに存在するかどうかを確認します。

コンテンツのホストが、コンテンツ ブロックを保有している場合は、コンテンツ ホストはセグメント ID、ブロック ID、暗号化されたデータ ブロックおよびブロックを暗号化するために使用される初期化ベクトルを含む応答を送信します。

コンテンツ ブロックを保有しているにコンテンツ ホストがない場合、コンテンツ ホストは空の応答メッセージを送信します。 要求されたブロックがコンテンツ ホストにないクライアント コンピューターに通知します。 空の応答メッセージには、セグメント ID とブロック ID のサイズが 0 のデータ ブロックと共に、要求されたブロックが含まれています。

クライアント コンピューターがコンテンツ ホストから応答を受け取ったときに、クライアントは、メッセージが未処理の要求リスト内の要求メッセージに対応しているを確認します。 (、セグメント ID とブロック インデックス必要がありますと一致する未処理の要求。)

この確認プロセスが成功し、クライアント コンピューターでは、未処理の要求リストには、対応する要求メッセージはありません、クライアント コンピューターは、メッセージを破棄します。

この確認プロセスが成功し、クライアント コンピューターの未処理の要求リストに対応する要求メッセージには、クライアント コンピューター、ブロックの暗号化を解除します。 クライアントは、クライアントが最初に元のコンテンツ サーバーから取得したコンテンツの情報を適切なブロック ハッシュに対して暗号化が解除されたブロックを検証します。

ブロックの検証が成功した場合、暗号化が解除されたブロックがキャッシュに格納します。

クライアントは、すべての必要なブロックされるまで、このプロセスが繰り返されます。

> [!NOTE]
> 1 台のコンピューター上のコンテンツの完全なセグメントがない場合、取得プロトコルを取得し、さまざまなソースからコンテンツをアセンブル: 一連の分散キャッシュ モードのクライアント コンピューターをホスト型キャッシュ サーバーと、ブランチ オフィスをキャッシュする場合も、完全なコンテンツはメイン オフィスの元のコンテンツ サーバーが含まれません。

BranchCache はコンテンツ情報またはコンテンツを送信する前に、データは暗号化されます。 BranchCache は、応答メッセージ内のブロックを暗号化します。 Windows 7、BranchCache を使用する既定の暗号化アルゴリズムは aes-128、暗号化キーは Ke、キーのサイズは 128 ビット暗号化アルゴリズムでいます。 

BranchCache は、暗号化アルゴリズムに適しており、ブロックを暗号化する暗号化キーを使用している初期化ベクトルを生成します。 BranchCache では、メッセージに、暗号化アルゴリズムと初期化ベクトルをし記録します。 

サーバーとクライアント決して交換、共有、または暗号化キーを互いに送信します。 クライアントは、ソース コンテンツをホストしているコンテンツ サーバーから暗号化キーを受け取ります。 次に、サーバーから受け取った暗号化アルゴリズムと初期化ベクトルを使用して、復号化、ブロックします。 その他の明示的な認証またはダウンロード プロトコルに組み込まれている承認はありません。

### <a name="security-threats"></a>セキュリティの脅威

この層で主要なセキュリティの脅威は、次のとおりです。

- データの改ざん。

  *データを要求元に提供しているクライアントが、データを改ざんする*します。 BranchCache セキュリティ モデルでは、ハッシュを使用して、クライアントも、サーバーがデータに改変することを確認します。  

- 情報の漏洩:  

    *BranchCache は暗号化されたコンテンツを適切なセグメント ID を指定するすべてのクライアントに送信*します。 セグメント ID は、任意のクライアントは、暗号化されたコンテンツを受信できるように、公開します。 ただし、悪意のあるユーザーは、暗号化されたコンテンツを取得した場合、コンテンツの暗号化解除に暗号化キーが認識する必要があります。 上層のプロトコルでは、認証を実行し、認証および承認されたクライアントにコンテンツの情報を提供します。 コンテンツ情報のセキュリティは、コンテンツ自体に提供されるセキュリティに相当して、BranchCache コンテンツ情報を公開しません。  

    *攻撃者は、コンテンツを取得するネットワークを傍受*します。  BranchCache は、秘密鍵が Ke、されている、ネットワーク上のデータが AES128 を使用してクライアント間のすべての転送を暗号化します。  コンテンツ サーバーからダウンロードされるコンテンツ情報はまったく同じ方法で保護されていると、データ自体がありましたがより場合は BranchCache が使用されていないすべての情報の漏洩から保護されていいえ増減ため。

-   サービス拒否:

    *データ要求によってクライアントに負荷がかかって*します。 BranchCache プロトコルは、キュー管理カウンターおよびタイマーをクライアントが過負荷の状態とされていることを防ぐために組み込まれています。

## <a name="BKMK_11"></a>BranchCache のプロセス: コンテンツのキャッシュ

分散キャッシュ モードのクライアント コンピューターおよびブランチ オフィスに配置されているホスト型キャッシュ サーバーでは、コンテンツ キャッシュが構築時間の経過と共にコンテンツが WAN リンク経由で取得されるようにします。

ホスト型キャッシュ モードでは、クライアント コンピューターが構成されている、それらが自分のローカル キャッシュにコンテンツを追加しも、ホスト型キャッシュ サーバーにデータを提供します。 ホスト型キャッシュ プロトコルは、クライアントがコンテンツとセグメントの可用性はホスト型キャッシュ サーバーに通知するためのメカニズムを提供します。

ホスト型キャッシュ サーバーにコンテンツをアップロードするには、クライアントは、サーバーに対し、提供されるセグメントがあることを通知します。 ホスト型キャッシュ サーバーは、すべての提供されるセグメントに関連付けられたして実際に必要なセグメント内のブロックをダウンロードするコンテンツ情報を取得します。 クライアントがあるない他のセグメントをホスト型キャッシュ サーバーを提供するまで、このプロセスが繰り返されます。

ホスト型キャッシュ プロトコルを使用して、ホスト型キャッシュ サーバーを更新するには、次の要件を満たす必要があります。

- クライアント コンピューターは、ホスト型キャッシュ サーバーに提供できるセグメント内にブロックのセットが必要です。 クライアントは、提供されるセグメント; ためのコンテンツ情報を提供する必要があります。これは、セグメント ID、セグメント データのハッシュ、セグメント シークレット、およびセグメントに含まれるすべてのブロック ハッシュのリストので構成されます。

- ホスト型キャッシュ サーバー証明書と関連する秘密キーに、Windows Server 2008 R2、ホスト型キャッシュ サーバーを実行しているが必要ですが、および証明書を発行した証明機関 (CA) は、ブランチ オフィス内のクライアント コンピューターから信頼されている必要があります。 これにより、クライアントとサーバーに HTTPS サーバー認証を正常に参加できます。

    > [!IMPORTANT]
    > Windows Server 2016、Windows Server 2012 R2、または Windows Server 2012 を実行しているホスト型キャッシュ サーバーは、ホスト型キャッシュ サーバーの証明書と関連する秘密キーは必要ありません。  

- クライアント コンピューターは、コンピューターの名前、ホスト型キャッシュ サーバーとなるホスト型キャッシュ サーバーがリッスンしている BranchCache トラフィックを伝送制御プロトコル (TCP) ポート番号で構成されます。 ホスト型キャッシュ サーバーの証明書は、このポートにバインドされます。 ホスト型キャッシュ サーバーのコンピューター名できます完全修飾ドメイン名 (FQDN)、ホスト型キャッシュ サーバーがドメイン メンバー コンピューターです。または、ホスト型キャッシュ サーバーがドメイン メンバーでない場合、コンピューターの NetBIOS 名であることができます。

- クライアント コンピューターは、着信ブロック要求をアクティブにリッスンします。 リッスンしているポートは、ホスト型キャッシュ サーバーにクライアントから提供メッセージの一部として渡されます。 これにより、ホスト型キャッシュ サーバーを BranchCache プロトコルを使用して、セグメント内のデータ ブロックを取得するクライアント コンピューターに接続できます。

- 初期化されたときに着信 HTTP 要求をリッスンするようにホスト型キャッシュ サーバーを起動します。

- ホスト型キャッシュ サーバーがクライアント コンピューターの認証を要求するように構成されている場合、クライアントとホスト型キャッシュ サーバーの両方は HTTPS 認証をサポートするために必要です。

### <a name="hosted-cache-mode-cache-population"></a>ホスト型キャッシュ モードのキャッシュ保護

クライアントがセグメント id。 を含む INITIAL_OFFER_MESSAGE を送信するときに、ブランチ オフィス内のホスト型キャッシュ サーバーのキャッシュにコンテンツを追加するプロセスが開始します。 INITIAL_OFFER_MESSAGE 要求にセグメント ID を使用して、ホスト型キャッシュ サーバーのブロック キャッシュから対応するセグメント データのハッシュ、ブロック ハッシュのリスト、およびセグメント シークレットを取得します。 ホスト型キャッシュ サーバーは、特定のセグメントのすべてのコンテンツ情報を既に持っている場合、INITIAL_OFFER_MESSAGE への応答は [OK] とブロックのダウンロード要求は行われません。

ホスト型キャッシュ サーバーがすべての提供されるデータ ブロック、ブロック ハッシュ、セグメントに関連付けられているにもない場合、INITIAL_OFFER_MESSAGE への応答が関心をお持ちです。 クライアントは、記述した SEGMENT_INFO_MESSAGE を提供されている単一のセグメントに送信します。 ホスト型キャッシュ サーバーが、OK メッセージで応答し、不足しているブロック、製品またはサービスからのダウンロードを開始クライアント コンピューター。

セグメント データのハッシュ、ブロック ハッシュのリスト、およびセグメント シークレットは、ダウンロードされているコンテンツがいないされて改ざんしたりできるように変更それ以外の場合に使用されます。 ダウンロードされたブロックは、ホスト型キャッシュ サーバーのブロック キャッシュに追加されます。

## <a name="bkmk_cache"></a>キャッシュのセキュリティ  
このセクションでは、BranchCache クライアント コンピューター上およびホスト型キャッシュ サーバーのキャッシュされたデータをセキュリティで保護する方法について説明します。

### <a name="client-computer-cache-security"></a>クライアント コンピューターのキャッシュのセキュリティ
BranchCache に格納されているデータの最大の脅威が改ざんされることです。 場合は、攻撃者は、キャッシュに格納されているコンテンツおよびコンテンツの情報を改ざんできます、しありますこれを利用して BranchCache を使用しているコンピューターに対する攻撃を起動してみてください。 攻撃者は、その他のデータの代わりに、悪意のあるソフトウェアを挿入することによって、攻撃を開始できます。 BranchCache は、コンテンツ情報に含まれるブロック ハッシュを使用してすべてのコンテンツを検証することによって、この脅威を軽減します。 攻撃者は、このデータの改ざんを試みたが破棄され、元のソースからの有効なデータに置き換えられます。

BranchCache に格納されたデータにセカンダリの脅威とは、情報の漏洩です。 分散キャッシュ モードで、client がキャッシュすることは自身で要求; コンテンツのみただし、そのデータはクリア テキストで格納され、危険にさらされる可能性があります。 BranchCache サービスのみをキャッシュへのアクセスを制限するために、ローカル キャッシュは ACL で指定されているファイル システム アクセス許可によって保護されます。 

ACL は承認されていないユーザーがキャッシュにアクセスすることを防ぐに効果的ですは、ACL で指定されているアクセス許可を手動で変更することで、キャッシュにアクセスするには、管理者特権を持つユーザー可能性があります。 BranchCache は、管理者アカウントの悪用に対する保護されません。

データの漏洩が懸念される場合、BitLocker や暗号化ファイル システム (EFS) などの暗号化テクノロジを使用できるように、コンテンツのキャッシュに格納されているデータは暗号化されません。 BranchCache によって使用されるローカル キャッシュには、ブランチ オフィス内のコンピューターにおける情報漏洩の脅威が増加せずキャッシュには、別の場所で暗号化されていないディスク上に存在するファイルのコピーだけが含まれています。 

ディスク全体を暗号化は、クライアントの物理的なセキュリティことを確認するが難しい環境で特に重要です。 たとえば、ディスク全体を暗号化では、ブランチ オフィス環境から削除される可能性がありますモバイル コンピューター上の機密データをセキュリティで保護に役立ちます。

### <a name="hosted-cache-server-cache-security"></a>ホスト型キャッシュ サーバーのキャッシュのセキュリティ

ホスト型キャッシュ モードでは、ホスト型キャッシュ サーバーのセキュリティに関する最大の脅威は、情報の漏洩です。 BranchCache ホスト型キャッシュ環境では、キャッシュされたデータを保護するファイル システムのアクセス許可を持つ分散キャッシュ モードと同様に動作します。 違いは、ホスト型キャッシュ サーバーが 1 台のクライアントを要求するデータのみではなく、ブランチ オフィス内の任意の BranchCache が有効なコンピューターが要求されるコンテンツのすべてを格納します。 このキャッシュへの不正侵入のような影響より多くのデータが危険にさらされているためより深刻な可能性があります。  
  
ホスト型キャッシュ サーバーが Windows Server 2008 R2 を実行して、ホスト型キャッシュ環境で BitLocker や EFS などの暗号化テクノロジの使用をお勧めが WAN リンクを介して機密性の高いデータにアクセスできる、ブランチ オフィス内のクライアントのいずれかの場合。 ディスクの暗号化動作のみときに、コンピューターが電源オフ時に、攻撃者が物理的にアクセスするためにも、ホスト型キャッシュを物理的にアクセスを防ぐために必要です。  オンになって、コンピューターや、スリープ モードの場合、ディスクの暗号化はほとんどの保護を提供します。

> [!NOTE]
> Windows Server 2016、Windows Server 2012 R2、または Windows Server 2012 を実行しているホスト型キャッシュ サーバーは、追加で暗号化テクノロジを使用するには必要ありませんので、既定では、キャッシュ内のすべてのデータを暗号化します。

場合でも、ホスト型キャッシュ モードでクライアントを構成すると、キャッシュ データをローカルではまだとホスト型キャッシュ サーバー上のキャッシュだけでなくローカル キャッシュを保護する手順を実行することもできます。
