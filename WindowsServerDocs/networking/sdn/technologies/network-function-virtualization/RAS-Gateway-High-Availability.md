---
title: RAS ゲートウェイの高可用性
description: このトピックを使用するのソフトウェア定義ネットワーク (SDN) Windows Server 2016 では、RAS マルチ テナント ゲートウェイの高可用性構成について説明します。
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 34d826c9-65bc-401f-889d-cf84e12f0144
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 8ce515ceeb7ab6989ef18055f312983a6518a1a1
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59847763"
---
# <a name="ras-gateway-high-availability"></a>RAS ゲートウェイの高可用性

>適用対象:Windows Server 2016 の Windows Server (半期チャネル)

このトピックを使用すると、ソフトウェア定義ネットワーク (SDN) の RAS マルチ テナント ゲートウェイの高可用性構成について説明します。  
  
このトピックは次のセクションで構成されます。  
  
-   [RAS ゲートウェイの概要](#bkmk_overview)  
  
-   [ゲートウェイ プールの概要](#bkmk_pools)  
  
-   [RAS ゲートウェイ展開の概要](#bkmk_deployment)  
  
-   [ネットワーク コント ローラーと RAS ゲートウェイの統合](#bkmk_integration)  
  
## <a name="bkmk_overview"></a>RAS ゲートウェイの概要  
組織がクラウド サービス プロバイダー (CSP) またはエンタープライズで複数のテナントの場合は、インターネットを含む、仮想および物理ネットワークとの間にネットワーク トラフィックのルーティングを提供するマルチ テナント モードで RAS ゲートウェイをデプロイできます。  
  
RAS ゲートウェイは、テナントの仮想ネットワークおよびリソースにテナントのカスタマー ネットワーク トラフィックをルーティングするエッジ ゲートウェイとしてマルチ テナント モードでデプロイできます。  
  
高可用性とフェールオーバーを提供する RAS ゲートウェイ Vm の複数のインスタンスを展開するときに、ゲートウェイ プールを展開します。 Windows Server 2012 R2 では、すべてのゲートウェイ Vm 形成ゲートウェイのデプロイの論理的な分離が少し難しいことが行われた、1 つのプール。  Windows Server 2012 R2 のゲートウェイには、ゲートウェイが VPN 接続サイト間 (S2S) の使用可能な容量の過小使用率で発生したため、Vm の 1 対 1 の冗長性の展開が提供されています。  
  
この問題は、論理的な分離のさまざまな種類の可能性がある - 複数のゲートウェイ プールを提供する Windows Server 2016 で解決されます。 M+N 冗長性の新しいモードより効率的なフェールオーバー構成ができます。  
  
RAS ゲートウェイについての詳細の概要については、次を参照してください。 [RAS ゲートウェイ](../../../../remote/remote-access/ras-gateway/RAS-Gateway.md)します。  
  
## <a name="bkmk_pools"></a>ゲートウェイ プールの概要  
Windows Server 2016 では、1 つまたは複数のプールでゲートウェイをデプロイすることができます。  
  
次の図は、さまざまな種類の仮想ネットワーク間のトラフィック ルーティングを提供するゲートウェイ プールを示します。  
  
![RAS ゲートウェイ プール](../../../media/RAS-Gateway-High-Availability/ras_pools.png)  
  
各プールでは、次のプロパティがあります。  
  
-   各プールでは、冗長化の M と N です。 つまり、います 'active ゲートウェイ Vm の数がスタンバイ ゲートウェイ Vm 数は' n ' でバックアップします。 N (スタンバイ ゲートウェイ) の値と M (アクティブなゲートウェイ) 以下では常にします。  
  
-   プールには、個々 のゲートウェイの機能を実行できる - インターネット キー交換バージョン 2 (IKEv2) S2S、レイヤー 3 (L3)、および Generic Routing Encapsulation (GRE) - または、プールは、これらの関数のすべてを実行できます。  
  
-   すべてプールに、またはプールのサブセットには、単一のパブリック IP アドレスを割り当てることができます。 実行を大幅にでは、すべてのテナントが単一の IP アドレスでクラウドに接続する可能性があるためを使用する必要がありますが、パブリック IP アドレスの数を減らします。 高可用性と負荷分散に関する以下のセクションでは、このしくみについて説明します。  
  
-   簡単にスケールできますゲートウェイ プール アップまたはスケール ダウンを追加または、プール内のゲートウェイ Vm の削除します。 ゲートウェイの追加や削除がプールによって提供されるサービスを妨害しません。 追加し、ゲートウェイの全体のプールを削除することができます。  
  
-   複数のプールおよびプール内の複数のゲートウェイの 1 つのテナントの接続を終了できます。 ただし、テナントで終了している接続がある場合、**すべて**入力ゲートウェイ プールでは、他にサブスクライブできません**すべて**型またはゲートウェイ プールの個々 の型。  
  
ゲートウェイ プールでは、その他のシナリオを有効にする柔軟性も提供します。  
  
-   シングル テナント プール - 1 つのテナントで使用するための 1 つのプールを作成することができます。  
  
-   パートナー (再販業者) チャネルを介してクラウド サービスを販売している場合は、すべての再販業者のプールの別のセットを作成できます。  
  
-   複数のプールには、さまざまな容量が、同じゲートウェイ機能を提供できます。 たとえば、高スループットと低スループット IKEv2 S2S 接続の両方をサポートするゲートウェイ プールを作成できます。  
  
## <a name="bkmk_deployment"></a>RAS ゲートウェイ展開の概要  
次の図は、RAS ゲートウェイの一般的なクラウド サービス プロバイダー (CSP) 配置を示しています。  
  
![RAS ゲートウェイ展開の概要](../../../media/RAS-Gateway-High-Availability/ras_csp_deploy.png)  
  
この種類の展開では、ゲートウェイ プールの背後にある、ソフトウェア ロード バランサー (SLB)、これにより、CSP を展開全体で単一のパブリック IP アドレスを割り当てるにはデプロイします。 -複数のゲートウェイ プールとプール内の複数のゲートウェイをテナントの複数のゲートウェイ接続を終了できます。 IKEv2 S2S 接続上の図で使用した説明については、これが同じ他のゲートウェイの機能に適用可能な L3 および GRE ゲートウェイなどです。  
  
図では、MT BGP デバイスは、RAS マルチ テナント ゲートウェイ BGP を使用します。 マルチ テナント BGP は、動的ルーティング用に使用されます。 テナントのルーティングは集中管理 - ルート reflector (RR) と呼ばれる 1 つのポイント、テナント サイトのすべての BGP ピアリングを処理します。 RR 自体は、プール内のすべてのゲートウェイに分散されます。 これは、結果、テナント (データ パス) の接続を複数のゲートウェイで終了しますが、テナント (BGP ピアリング ポイント - コントロール パス) の RR は、ゲートウェイの 1 つのみで構成されます。  
  
BGP ルーターは、この一元的なルーティングの概念を表す図で分離します。 ゲートウェイの BGP の実装も提供しますトランジット ルーティングを 2 つのテナント サイト間のルーティングのトランジット ポイントとして機能するクラウドをことができます。 これらの BGP の機能は、すべてのゲートウェイの機能に適用されます。  
  
## <a name="bkmk_integration"></a>ネットワーク コント ローラーと RAS ゲートウェイの統合  
RAS ゲートウェイは Windows Server 2016 でネットワーク コント ローラーに完全に統合します。 RAS ゲートウェイとネットワーク コント ローラーが展開されると、ネットワーク コント ローラーは、次の関数を実行します。  
  
-   ゲートウェイ プールのデプロイ  
  
-   各ゲートウェイでのテナント接続の構成  
  
-   ゲートウェイ エラーが発生した場合、スタンバイ ゲートウェイにフローのネットワーク トラフィックの切り替え  
  
次のセクションでは、RAS ゲートウェイとネットワーク コント ローラーに関する詳細情報を提供します。  
  
-   [プロビジョニングと (IKEv2、L3、および GRE) ゲートウェイ接続の負荷分散](#bkmk_provisioning)  
  
-   [IKEv2 S2S の高可用性](#bkmk_ike)  
  
-   [GRE の高可用性](#bkmk_gre)  
  
-   [転送ゲートウェイ L3 の高可用性](#bkmk_l3)  
  
### <a name="bkmk_provisioning"></a>プロビジョニングと (IKEv2、L3、および GRE) ゲートウェイ接続の負荷分散  
テナントは、ゲートウェイの接続を要求するときに、要求は、ネットワーク コント ローラーに送信されます。 ネットワーク コント ローラーには、すべてのプールで各プールし、すべてのゲートウェイの容量を含めて、ゲートウェイ プールのすべてに関する情報を構成します。 ネットワーク コント ローラーは、適切なプールとゲートウェイの接続を選択します。 この選択は、接続の帯域幅の要件に基づきます。 ネットワーク コント ローラーでは、"best fit"アルゴリズムを使用して、プール内の接続を効率的に選択します。 この時点では、接続の BGP ピアリング ポイントが、テナントの最初の接続の場合も指定されています。  
  
ネットワーク コント ローラーが接続に RAS ゲートウェイを選択した後、ネットワーク コント ローラーは、ゲートウェイの接続に必要な構成を準備します。 また、ネットワーク コント ローラーの SLB プール; 上のネットワーク アドレス変換 (NAT) 規則がプロビジョニング、IKEv2 S2S 接続の場合SLB のプールでは、この NAT 規則は、テナントから、指定したゲートウェイへの接続要求を指示します。 テナントは、一意であることが必要ですが、ソース IP によって区別されます。  
  
> [!NOTE]  
> L3 と GRE 接続では、SLB をバイパスし、指定した RAS ゲートウェイと直接接続します。  これらの接続では、リモート エンドポイントのルーター (またはその他のサード パーティ製のデバイス) する必要がありますが正しく構成されている、RAS ゲートウェイに接続する必要があります。  
  
場合、接続の BGP ルーティングが有効になっている、RAS ゲートウェイの BGP ピアリングが開始したされ、ルートが、オンプレミスとクラウド間で交換されるゲートウェイ。 BGP で学習する (または静的に構成されているルート、BGP を使用しない場合) のルートは、ネットワーク コント ローラーに送信されます。 ネットワーク コント ローラーには、対象のテナントの Vm がインストールされている HYPER-V ホストにルートし組み込まれます。 この時点では、適切なオンプレミス サイトにテナント トラフィックをルーティングできます。 ネットワーク コント ローラーもゲートウェイの場所を指定する、関連付けられている、HYPER-V ネットワーク仮想化ポリシーを作成し、それらを HYPER-V ホストに組み込まれます。  
  
### <a name="bkmk_ike"></a>IKEv2 S2S の高可用性  
RAS ゲートウェイ プールでは、接続とのさまざまなテナントの BGP ピアリングの両方で構成されます。 すべてプールには 'アクティブなゲートウェイと' n ' スタンバイ ゲートウェイ。  
  
ネットワーク コント ローラーは、次のようにゲートウェイのエラーを処理します。  
  
-   ネットワーク コント ローラーが常に ping ですべてのプールとは、ゲートウェイの検出が失敗したゲートウェイまたは障害が発生しました。 ネットワーク コント ローラーには、次の種類の RAS ゲートウェイの障害を検出できます。  
  
    -   RAS ゲートウェイ VM の障害  
  
    -   RAS ゲートウェイが実行されている HYPER-V ホストの障害  
  
    -   RAS ゲートウェイ サービス エラー  
  
    ネットワーク コント ローラーには、デプロイされているすべてのアクティブなゲートウェイの構成が格納されます。 構成は、接続の設定およびルーティング設定で構成されます。  
  
-   ゲートウェイが失敗した場合、その他のゲートウェイであるが、失敗したゲートウェイ上にある RR テナント接続と同様に、ゲートウェイ上のテナント接続に影響します。 後者の接続のダウン時間が、前者の未満です。 ネットワーク コント ローラーは、失敗したゲートウェイを検出すると、次のタスクを実行します。  
  
    -   コンピューティング ホストからの影響を受ける接続のルートを削除します。  
  
    -   これらのホスト、HYPER-V ネットワーク仮想化ポリシーを削除します。  
  
    -   スタンバイ ゲートウェイを選択、アクティブなゲートウェイに変換し、ゲートウェイを構成します。  
  
    -   新しいゲートウェイへの接続を指す SLB プール上で NAT マッピングを変更します。  
  
-   同時に、新しいアクティブなゲートウェイ上で起動すると、構成、IKEv2 S2S 接続と BGP ピアリングは再確立します。 クラウド ゲートウェイまたはオンプレミスのゲートウェイのいずれかによって、接続と BGP ピアリングを開始できます。 ゲートウェイは、それぞれのルートを更新し、ネットワーク コント ローラーに送ります。 ネットワーク コント ローラーは、ゲートウェイによって検出された新しいルートを学習し、ネットワーク コント ローラーは、ルートと関連付けられている、HYPER-V ネットワーク仮想化ポリシーを HYPER-V ホストの障害の影響を受けるテナントの Vm が存在します。 このネットワーク コント ローラーの動作が似ています。 新しい接続のセットアップのような状況にのみ発生規模が大きい。  
  
### <a name="bkmk_gre"></a>GRE の高可用性  
ネットワーク コント ローラー - 障害の検出を含む、接続のコピーおよびスタンバイ ゲートウェイに影響を受ける接続の BGP または静的のルーティングのフェールオーバーのルーティング構成が RAS ゲートウェイ フェールオーバー応答プロセス (、引き出しを含め、ルートの再プラミング コンピューティング ホストと再の BGP のピアリング)、コンピューティング ホスト - HYPER-V ネットワーク仮想化ポリシーの再構成は GRE ゲートウェイと接続の同じです。 GRE 接続の再確立の動作が異なる、ただし、および GRE の高可用性ソリューションがいくつか追加の要件。  
  
![GRE の高可用性](../../../media/RAS-Gateway-High-Availability/ras_ha.png)  
  
ゲートウェイのデプロイ時、RAS ゲートウェイのすべての VM には、動的 IP アドレス (DIP) が割り当てられます。 さらに、すべてのゲートウェイ VM は、GRE の高可用性の仮想 IP アドレス (VIP) も割り当てられます。 GRE 非プールではないおよび、GRE 接続を受け入れることができるプール内のゲートウェイにのみ、Vip が割り当てられます。 割り当てられた Vip は、さらに、Vip をクラウドの物理ネットワークにアドバタイズする BGP を使用してラック (TOR) スイッチの先頭にアドバタイズされます。 これにより、ゲートウェイは、到達可能なリモート ルーターまたはサード パーティ製のデバイスから GRE 接続の他方の end が存在する場所。 この BGP ピアリングすることは、テナント レベル用の BGP ピアリングのルートのテナントの exchange よりも異なります。  
  
GRE 接続のプロビジョニング時に、ネットワーク コント ローラーは、ゲートウェイを選択、GRE エンドポイントを選択したゲートウェイの構成し、割り当てられているゲートウェイの VIP アドレスを返します。 この VIP は、移行先リモート ルーターの GRE トンネル アドレスとして構成し、されます。  
  
ゲートウェイが失敗した場合、ネットワーク コント ローラーはスタンバイ ゲートウェイに失敗したゲートウェイとその他の構成データの VIP アドレスをコピーします。 スタンバイ ゲートウェイがアクティブになったときに、TOR スイッチに VIP をアドバタイズし、物理ネットワークをさらにします。 リモート ルーターが引き続き同じ VIP を GRE トンネルを接続して、ルーティング インフラストラクチャにより、パケットは、新しいアクティブなゲートウェイにルーティングされます。  
  
### <a name="bkmk_l3"></a>転送ゲートウェイ L3 の高可用性  
HYPER-V ネットワーク仮想化の L3 転送ゲートウェイは、データ センター内の物理インフラストラクチャと HYPER-V ネットワーク仮想化クラウドの仮想化インフラストラクチャ間のブリッジです。 マルチ テナントの L3 転送ゲートウェイの各テナントは、テナントの物理ネットワークとの接続を独自の VLAN タグ付けされた論理ネットワークを使用します。  
  
ネットワーク コント ローラーのゲートウェイ サービス マネージャーが使用可能なゲートウェイ VM を選択し、(テナントの VLAN のタグが付けられた論理ネットワークから可用性の高いカスタマー アドレス (CA) の領域の IP アドレスを持つテナントの新しいインターフェイスを構成します。 新しいテナントが新しい L3 ゲートウェイを作成する場合). IP アドレスは、リモート (物理ネットワーク) ゲートウェイにピアの IP アドレスとして使用されます、テナントの HYPER-V ネットワーク仮想化ネットワークに到達する次のホップです。  
  
IPsec または GRE のネットワーク接続とは異なり、TOR スイッチを理解、テナントの VLAN タグ付けされたネットワークに動的にします。 テナントの VLAN タグ付けされたネットワークのルーティングは、TOR スイッチすべて中間スイッチと物理インフラストラクチャとのエンド ツー エンド接続を確立するゲートウェイの間のルーターで構成する必要があります。  次は、次の図に示すように CSP の仮想ネットワーク構成の例を示します。  
  
|ネットワーク|［サブネット］|VLAN ID|既定のゲートウェイ|  
|-----------|----------|-----------|-------------------|  
|Contoso L3 論理ネットワーク|10.127.134.0/24|1001|10.127.134.1|  
|Woodgrove L3 論理ネットワーク|10.127.134.0/24|1002|10.127.134.1|  
  
次は、次の図に示すようにテナント ゲートウェイの構成の例を示します。  
  
|テナント名|L3 ゲートウェイの IP アドレス|VLAN ID|ピアの IP アドレス|  
|---------------|-------------------------|-----------|-------------------|  
|Contoso|10.127.134.50|1001|10.127.134.55|  
|Woodgrove|10.127.134.60|1002|10.127.134.65|  
  
CSP のデータ センターでこれらの構成の図を次に示します。  
  
![転送ゲートウェイ L3 の高可用性](../../../media/RAS-Gateway-High-Availability/ras_fwdgw.png)  
  
ゲートウェイの失敗、エラーの検出、および転送ゲートウェイ、L3 のコンテキストでゲートウェイ フェールオーバー プロセスは、IKEv2 および GRE RAS ゲートウェイのプロセスに似ています。 相違点は、外部の IP アドレスの処理方法。  
  
ゲートウェイ VM の状態が異常になったとき、ネットワーク コント ローラーはプールからスタンバイ ゲートウェイのいずれかを選択され、ネットワーク接続と、スタンバイ ゲートウェイにルーティングを再プロビジョニングされます。 接続を移動、L3 転送ゲートウェイの高 CA 領域の使用可能な IP アドレスは、テナントの CA 空間 BGP IP アドレスと共に、新しいゲートウェイ VM にも移動します。  
  
L3 ピアリングの IP アドレスをフェールオーバー中に、新しいゲートウェイ VM に移動すると、ために、リモートの物理インフラストラクチャはもう一度にこの IP アドレスに接続し、その後、HYPER-V ネットワーク仮想化ワークロードに到達できません。 BGP 動的ルーティング、BGP IP アドレスを新しいゲートウェイ、仮想マシンに移動する CA 空間としてのリモートの BGP ルーターは、ピアリングを再確立し、HYPER-V ネットワーク仮想化のすべてのルートをもう一度説明します。  
  
> [!NOTE]  
> テナントの通信に VLAN タグ付けされた論理ネットワークを使用するには、TOR スイッチとそのすべての中間ルーターを個別に構成する必要があります。 さらに、L3 のフェールオーバーは、この方法で構成されているラックのみに限定されます。 このため、L3 ゲートウェイ プールを慎重に構成する必要があり、手動で構成を別々 に実行する必要があります。  
  


