---
title: RAS ゲートウェイの高可用性
description: このトピックを使用するのソフトウェアによるネットワーク制御 (SDN) Windows Server 2016 では、RAS マルチテナント ゲートウェイの高可用性構成について説明します。
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 34d826c9-65bc-401f-889d-cf84e12f0144
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 48794ff8312ca00eda25f6d8bdca9929fc47084f
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="ras-gateway-high-availability"></a>RAS ゲートウェイの高可用性

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

このトピックを使用すると、ソフトウェアによるネットワーク制御 (SDN) の RAS マルチテナント ゲートウェイの高可用性構成について説明します。  
  
このトピックには、次のセクションが含まれています。  
  
-   [RAS ゲートウェイの概要](#bkmk_overview)  
  
-   [ゲートウェイ プールの概要](#bkmk_pools)  
  
-   [RAS ゲートウェイ展開の概要](#bkmk_deployment)  
  
-   [ネットワーク コントローラーとの RAS ゲートウェイの統合](#bkmk_integration)  
  
## <a name="bkmk_overview"></a>RAS ゲートウェイの概要  
組織がクラウド サービス プロバイダー (CSP) または複数のテナントを持つエンタープライズの場合は、インターネットを含む仮想および物理ネットワークとの間にネットワーク トラフィックのルーティングを提供するマルチテナント モードで RAS ゲートウェイを展開できます。  
  
テナントの仮想ネットワークとリソースをテナントのカスタマー ネットワーク トラフィックをルーティングするエッジ ゲートウェイとして、マルチテナント モードで RAS ゲートウェイを展開することができます。  
  
高可用性とフェールオーバーを提供する RAS ゲートウェイ Vm の複数のインスタンスを展開するときに、ゲートウェイ プールを展開します。 Windows Server 2012 R2 ですべてのゲートウェイ Vm の形式、ゲートウェイ展開の論理的な分離を少し困難に 1 つのプール。  Windows Server 2012 R2 のゲートウェイには、ゲートウェイ Vm の場合のサイト間 (S2S) の使用可能な容量が十分に活用により、VPN 接続の 1:1 の冗長性の展開が提供されています。  
  
-のさまざまな種類の分離を論理的になる可能性が複数のゲートウェイ プールを提供する Windows Server 2016 でこの問題は解決します。 M と N の冗長性の新しいモードより効率的なフェールオーバー構成できます。  
  
RAS ゲートウェイの詳細の概要については、次を参照してください。[RAS ゲートウェイ](../../../../remote/remote-access/ras-gateway/RAS-Gateway.md)します。  
  
## <a name="bkmk_pools"></a>ゲートウェイ プールの概要  
Windows Server 2016 では、プールの 1 つまたは複数のゲートウェイを展開できます。  
  
次の図は、さまざまな種類の仮想ネットワークの間でトラフィックをルーティングを提供するゲートウェイ プールを示します。  
  
![RAS ゲートウェイ プール](../../../media/RAS-Gateway-High-Availability/ras_pools.png)  
  
各プールでは、次のプロパティがあります。  
  
-   各プールは、M と N の冗長です。 つまり、[' active ゲートウェイ Vm の数がスタンバイのゲートウェイ Vm の数 n 個でバックアップします。 N (スタンバイ ゲートウェイ) の値より小さいか等しい m (アクティブなゲートウェイ) では常にです。  
  
-   プールは、個々 のゲートウェイの機能のいずれかを実行できる - インターネット キー交換バージョン 2 (IKEv2) S2S、レイヤー 3 (L3) と汎用ルーティング カプセル化 (GRE) - またはプールは、これらすべての関数を実行できます。  
  
-   すべてのプールまたはプールのサブセットに 1 つのパブリック IP アドレスを割り当てることができます。 すべてのテナントを単一の IP アドレスをクラウドに接続することが可能になっているためにを使用する必要がありますのパブリック IP アドレスの数を削減大幅を実行します。 高可用性と負荷分散の下のセクションでは、この動作方法について説明します。  
  
-   容易に拡張できるゲートウェイ プール上または下へを追加またはプール内のゲートウェイ Vm を削除します。 ゲートウェイの追加または取り外しにプールによって提供されるサービスが中断されません。 追加し、[ゲートウェイの全体のプールを削除することもできます。  
  
-   複数のプールと複数のゲートウェイ プール内に 1 つのテナントの接続を終了できます。 ただし、テナントがある接続で終了している場合、**すべて**ゲートウェイ プールのように入力への加入ことはできません、**すべて**タイプまたは特定の種類のゲートウェイ プールします。  
  
ゲートウェイ プールは、その他のシナリオを有効にする柔軟性も提供します。  
  
-   シングル テナント プール - 1 つのテナントで使用するための 1 つのプールを作成することができます。  
  
-   パートナー (リセラー) チャネルを通じて、クラウド サービスを販売している場合は、すべての販売店のプールの個別のセットを作成できます。  
  
-   複数のプール容量が異なるが、同じゲートウェイ機能を提供できます。 たとえば、高スループットと低スループット IKEv2 の S2S 接続の両方をサポートしているゲートウェイ プールを作成することができます。  
  
## <a name="bkmk_deployment"></a>RAS ゲートウェイ展開の概要  
次の図では、RAS ゲートウェイの一般的なクラウド サービス プロバイダー (CSP) 展開について説明します。  
  
![RAS ゲートウェイ展開の概要](../../../media/RAS-Gateway-High-Availability/ras_csp_deploy.png)  
  
この種類の展開では、ゲートウェイ プールはの内側に、ソフトウェア ロード バランサー (SLB)、これにより、展開全体で 1 つのパブリック IP アドレスを割り当てる CSP が配置されます。 テナントの複数のゲートウェイ接続には、複数のゲートウェイ プール - とプール内の複数のゲートウェイを終了できます。 上記の図では、IKEv2 の S2S 接続を介してこの方法を示しますが、同じは他のゲートウェイの機能に適用されるすぎる、L3 および GRE ゲートウェイなどです。  
  
図では、BGP が配置された RAS マルチテナント ゲートウェイは MT BGP デバイスです。 マルチテナントの BGP が動的ルーティングに使用されます。 テナントのルーティング、集中 - ルート reflector (RR) と呼ばれる、単一ポイント、テナントのすべてのサイトの BGP ピアリングを処理します。 RR 自体は、プール内のすべてのゲートウェイに分散されます。 これにより、複数のゲートウェイのテナント (データ パス) の接続を終了が RR テナント (BGP ピアリング ポイント - コントロール パス) をゲートウェイの 1 つだけで構成されます。  
  
BGP ルーターは、この一元的なルーティングの概念を描画するダイアグラムで区切られます。 ゲートウェイの BGP 実装も提供トランジット ルーティング、2 つのテナント サイト間のルーティングの転送中ポイントとして機能するクラウドを有効にします。 これらの BGP 機能は、すべてのゲートウェイ機能に適用されます。  
  
## <a name="bkmk_integration"></a>ネットワーク コントローラーとの RAS ゲートウェイの統合  
RAS ゲートウェイは、Windows Server 2016 でネットワーク コントローラーと完全に統合されています。 RAS ゲートウェイとネットワーク コントローラーが展開されると、ネットワーク コントローラーは、次の機能を実行します。  
  
-   ゲートウェイ プールの展開  
  
-   各ゲートウェイでテナント接続の構成  
  
-   ゲートウェイ障害が発生した場合、スタンバイ ゲートウェイにフロー ネットワーク トラフィックの切り替え  
  
次のセクションでは、RAS ゲートウェイとネットワーク コントローラーに関する詳細情報を提供します。  
  
-   [プロビジョニングおよびゲートウェイ接続 (IKEv2、L3、および GRE) の負荷分散](#bkmk_provisioning)  
  
-   [IKEv2 S2S の高可用性](#bkmk_ike)  
  
-   [GRE の高可用性](#bkmk_gre)  
  
-   [高可用性 L3 ゲートウェイの転送](#bkmk_l3)  
  
### <a name="bkmk_provisioning"></a>プロビジョニングおよびゲートウェイ接続 (IKEv2、L3、および GRE) の負荷分散  
テナントは、ゲートウェイの接続を要求するときに、ネットワーク コントローラーに要求が送信されます。 ネットワーク コントローラーは、すべてのプールごとに各プールとすべてのゲートウェイの容量を含めて、ゲートウェイ プールに関する情報で構成されます。 ネットワーク コントローラーは、適切なプールと接続のゲートウェイを選択します。 この選択は、接続の帯域幅要件に基づいています。 ネットワーク コントローラーでは、「最適」アルゴリズムを使用して、プール内の接続を効率的に選択します。 この時点では、接続の BGP ピアリング ポイントが、場合は、テナントの最初の接続も指定されています。  
  
ネットワーク コントローラーが接続の RAS ゲートウェイを選択した後、ネットワーク コントローラーは、ゲートウェイの接続に必要な構成を準備します。 ネットワーク コントローラーが SLB プール上でネットワーク アドレス変換 (NAT) ルールもプロビジョニング、IKEv2 の S2S 接続の場合この NAT 規則 SLB プールには、指定したゲートウェイをテナントからの接続要求を指示します。 発信元 IP、一意であると想定されるテナントが区別されます。  
  
> [!NOTE]  
> L3 および GRE 接続は、SLB をバイパスし、指定した RAS ゲートウェイと直接接続します。  これらの接続では、リモート エンドポイントのルーター (またはその他のサード パーティ製デバイス) する必要がある正しく構成されている、RAS ゲートウェイに接続する必要があります。  
  
RAS ゲートウェイの BGP ピアリングが開始したし、オンプレミスとクラウド間間で交換されるルートの接続、BGP のルーティングが有効になっている場合のゲートウェイです。 ルートを BGP で学習する (または、BGP を使用しない場合、静的に構成されているルート) は、ネットワーク コントローラーに送信されます。 ネットワーク コントローラーには、対象、テナントの Vm がインストールされている Hyper-V ホストにルートし、組み込まれます。 この時点では、社内で正しいサイトにテナント トラフィックをルーティングできます。 また、ネットワーク コントローラーはゲートウェイの場所を指定する Hyper-V ネットワーク仮想化ポリシーが関連付けられているが作成され、それらを Hyper-V ホストに組み込まれます。  
  
### <a name="bkmk_ike"></a>IKEv2 S2S の高可用性  
プール内の RAS ゲートウェイは、接続とさまざまなテナントの BGP のピアリングの両方で構成されます。 すべてのプールには、[' アクティブなゲートウェイと n 個のスタンバイ ゲートウェイです。  
  
ネットワーク コントローラーは、次のように、ゲートウェイのエラーを処理します。  
  
-   ネットワーク コントローラーが常にすべてのプールとは、ゲートウェイの ping が失敗したゲートウェイの検出または失敗します。 ネットワーク コントローラーは、次の種類の RAS ゲートウェイの失敗を検出できます。  
  
    -   RAS ゲートウェイ VM の失敗  
  
    -   RAS ゲートウェイが実行されている Hyper-V ホストの障害  
  
    -   RAS ゲートウェイ サービスの失敗  
  
    ネットワーク コントローラーは、展開されたすべてのアクティブなゲートウェイの構成を格納します。 構成は、接続の設定とルーティングの設定で構成されます。  
  
-   ゲートウェイが失敗したときにどう影響するテナント接続、ゲートウェイとその他のゲートウェイ上に配置されているが、障害が発生したゲートウェイ上の RR のテナント接続します。 後者の接続の停止時間が、前者の未満です。 ネットワーク コントローラーは、障害が発生したゲートウェイを検出すると、次のタスクを実行します。  
  
    -   コンピューティング ホストからの影響を受ける接続のルートを削除します。  
  
    -   これらのホスト上の Hyper-V ネットワーク仮想化ポリシーを削除します。  
  
    -   スタンバイのゲートウェイを選択し、[アクティブなゲートウェイに変換、ゲートウェイを構成します。  
  
    -   新しいゲートウェイへの接続を指す SLB プールに NAT マッピングを変更します。  
  
-   同時に、新しいアクティブなゲートウェイ上で起動すると、構成、IKEv2 の S2S 接続と BGP ピアリングは再確立します。 クラウド ゲートウェイまたはオンプレミス ゲートウェイのいずれかでは、接続および BGP ピアリングを開始できます。 ゲートウェイは、そのルートを更新し、ネットワーク コントローラーに送信します。 ネットワーク コントローラーは、ゲートウェイによって検出された新しいルートを学習、ネットワーク コントローラー送信ルートと、関連付けられている Hyper-V ネットワーク仮想化ポリシーを Hyper-V ホストに障害の影響を受けるテナントの Vm が存在するされます。 このネットワーク コントローラーのアクティビティのような新しい接続セットアップのような状況にのみに発生する大きな規模でします。  
  
### <a name="bkmk_gre"></a>GRE の高可用性  
ネットワーク コントローラーのなどの障害の検出、コピーの接続とスタンバイ ゲートウェイへのルーティングの構成、/スタティック BGP のルーティングの影響を受ける接続 (引き出しなどでをルートの再 plumb 計算ホストと BGP が再ピアリング)、およびコンピューティングのホスト上の Hyper-V ネットワーク仮想化ポリシーの再構成のフェールオーバーで RAS ゲートウェイ フェールオーバー応答のプロセスは、同じ GRE ゲートウェイおよび接続です。 GRE 接続の再確立の動作とは異なる方法、ただし、および GRE の高可用性ソリューションでいくつか追加要件があります。  
  
![GRE の高可用性](../../../media/RAS-Gateway-High-Availability/ras_ha.png)  
  
ゲートウェイの展開の時に、すべての RAS ゲートウェイ VM に動的 IP アドレス (DIP) が割り当てられます。 さらに、すべてのゲートウェイ VM は GRE 高可用性の仮想 IP アドレス (VIP) にも割り当てられます。 Vip は、ゲートウェイ、GRE の接続を受け入れることができるプール内にのみを除く、非 GRE プールに割り当てられます。 割り当てられている Vip は、Vip は、クラウドの物理ネットワークにさらにアドバタイズ、BGP を使用してラック (TOR) スイッチの先頭にアドバタイズします。 これにより、ゲートウェイ到達可能なリモート ルーターまたはサード パーティ製のデバイスから、もう一方の端の GRE 接続が存在します。 この BGP ピアリングとは異なりますテナント レベル BGP ピアリングをテナントのルートを交換します。  
  
GRE 接続のプロビジョニング時に、ネットワーク コントローラーは、ゲートウェイを選択、選択されているゲートウェイ上の GRE エンドポイントを構成し、割り当てられているゲートウェイの VIP アドレスを返します。 この VIP は、移行先リモート ルーターの GRE トンネル アドレスとして構成されます。  
  
ゲートウェイが失敗した場合、ネットワーク コントローラーは、スタンバイのゲートウェイに障害が発生したゲートウェイとその他の構成データの VIP アドレスをコピーします。 スタンバイのゲートウェイがアクティブになったとき、TOR スイッチに VIP をアドバタイズし、物理ネットワークにさらにします。 GRE トンネルを同じ VIP に接続するリモートのルーターが続行され、ルーティング インフラストラクチャにより、新しいアクティブなゲートウェイにパケットがルーティングされるようになります。  
  
### <a name="bkmk_l3"></a>高可用性 L3 ゲートウェイの転送  
Hyper-V ネットワーク仮想化 L3 転送ゲートウェイは、データ センター内の物理インフラストラクチャと Hyper-V ネットワーク仮想化のクラウドの仮想化インフラストラクチャの間のブリッジです。 マルチテナント L3 転送ゲートウェイでは、各テナント、テナントの物理ネットワークとの接続、独自の VLAN タグ付けされた論理ネットワークが使用されます。  
  
新しいテナントでは、新しい L3 ゲートウェイを作成するとき、ネットワーク コントローラー ゲートウェイ サービス マネージャーは使用可能なゲートウェイ VM を選択し、(テナントの VLAN タグ付けされた論理ネットワーク) から高可用性カスタマー アドレス (CA) 空間の IP アドレスを持つ新しいテナント インターフェイスを構成します。 IP アドレスは、リモート (物理ネットワーク) ゲートウェイ上のピアの IP アドレスとして使用される、テナントの Hyper-V ネットワーク仮想化ネットワークに到達する次のホップです。  
  
IPsec や GRE のネットワーク接続とは異なり、TOR スイッチはしない説明、テナントの VLAN タグ付けされたネットワークに動的にします。 テナントの VLAN タグ付けされたネットワークのルーティングは、TOR スイッチとすべての中間スイッチと物理インフラストラクチャとゲートウェイをエンド ツー エンド接続を確認する間にルーターを構成する必要があります。  次の図に示すように CSP の仮想ネットワーク構成の例を次に示します。  
  
|ネットワーク|サブネット|VLAN ID|既定のゲートウェイ|  
|-----------|----------|-----------|-------------------|  
|Contoso L3 論理ネットワーク|10.127.134.0/24|1001|10.127.134.1|  
|Woodgrove L3 論理ネットワーク|10.127.134.0/24|1002|10.127.134.1|  
  
次の図に示すようにテナント ゲートウェイの構成の例を次に示します。  
  
|テナント名|L3 ゲートウェイ IP アドレス|VLAN ID|ピアの IP アドレス|  
|---------------|-------------------------|-----------|-------------------|  
|Contoso|10.127.134.50|1001|10.127.134.55|  
|Woodgrove|10.127.134.60|1002|10.127.134.65|  
  
次は、CSP データ センター内のこれらの構成の図に示します。  
  
![高可用性 L3 ゲートウェイの転送](../../../media/RAS-Gateway-High-Availability/ras_fwdgw.png)  
  
ゲートウェイの失敗、エラーの検出、およびにおいて、L3 ゲートウェイの転送ゲートウェイのフェールオーバー プロセスは、IKEv2 および GRE RAS ゲートウェイのプロセスと似ています。 相違点は、外部の IP アドレスを処理する方法。  
  
ゲートウェイ VM の状態が異常な状態になると、ネットワーク コントローラーは、プールからスタンバイ ゲートウェイのいずれかを選択し、ネットワーク接続とスタンバイ ゲートウェイ上のルーティングを再プロビジョニングします。 接続を移動、L3 転送ゲートウェイの高 CA 領域の使用可能な IP アドレスは、テナントの CA 空間 BGP IP アドレスと共に新しいゲートウェイ VM にも移動します。  
  
L3 ピアリングの IP アドレスをフェールオーバー中に新しいゲートウェイ VM に移動すると、ため、リモートの物理インフラストラクチャがもう一度をこの IP アドレスに接続し、その後、Hyper-V ネットワーク仮想化ワークロードに到達できます。 BGP 動的ルーティング用、BGP IP アドレスを新しいゲートウェイ、仮想マシンに移動する CA 空間としては、リモートの BGP ルーターはピアリングを再確立し、もう一度すべての Hyper-V ネットワーク仮想化のルートを学習します。  
  
> [!NOTE]  
> テナントの通信に VLAN タグ付けされた論理ネットワークを使用するために、TOR スイッチとすべての中間ルーターを個別に構成する必要があります。 さらに、L3 フェールオーバーは、この方法で構成されているラックのみに制限されます。 このため、L3 ゲートウェイ プールを慎重に構成する必要がありますとは別に手動で構成を完了する必要があります。  
  


