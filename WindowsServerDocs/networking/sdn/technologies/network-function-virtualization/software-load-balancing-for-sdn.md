---
title: ソフトウェアの負荷分散 (SLB) SDN
description: このトピックを使用すると、Windows Server 2016 でネットワーク定義のソフトウェアのソフトウェアの負荷分散について説明します。
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 97abf182-4725-4026-801c-122db96964ed
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 5e08afddde9c7be8d955a0cfdaf44f0fc31b8155
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="software-load-balancing-slb-for-sdn"></a>ソフトウェアの負荷分散 \(SLB\) SDN

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

このトピックを使用すると、Windows Server 2016 でネットワーク定義のソフトウェアのソフトウェアの負荷分散について説明します。  

クラウド サービス プロバイダー (CSP) および展開する企業はソフトウェアによるネットワーク制御 (SDN) Windows Server 2016 では、テナントおよびテナント仮想ネットワークのリソース間でのカスタマー ネットワーク トラフィックを均等に分散するのにソフトウェア負荷分散 (SLB) を使用できます。 Windows Server SLB 有効、同じワークロードをホストする複数のサーバーに高可用性とスケーラビリティを提供します。
  
Windows Server SLB には、次の機能が含まれています。  
  
-   レイヤー 4 (L4) は、' 南北 'と' 東西 ' TCP または UDP トラフィックの分散サービスを読み込みます。  
  
-   パブリックおよび内部ネットワーク トラフィックの負荷を分散します。  
  
-   Hyper-V ネットワーク仮想化を使用して作成した仮想ネットワークと仮想ローカル エリア ネットワーク (Vlan) には、動的 IP アドレス (Dip) をサポートしています。  
  
-   正常性プローブのサポート。  
  
-   対応するスケール アウト機能を含むクラウド スケールの準備が完了し、multiplexers とホストのエージェントの機能を拡張します。  
  
詳細については、次を参照してください。[ソフトウェア負荷分散機能](#bkmk_features)このトピックの「します。  
  
> [!NOTE]  
> テナントの Vlan がネットワーク コントローラーでサポートされていないため、ただしすると併用できる Vlan SLB サービス プロバイダーのデータ センターのインフラストラクチャと高密度 Web サーバーなどのワークロードを管理します。  
  
Windows Server SLB を使用して、スケール アウトでき、負荷分散 SLB Vm を使用して、その他の VM のワークロードに使用する同じ Hyper-V コンピューティング サーバー上で機能します。 このため、SLB には、迅速な作成と負荷分散エンドポイント CSP 操作に必要なの削除がサポートしています。 さらに、Windows Server SLB はクラスターあたりギガバイト数十台をサポートしている、単純なのプロビジョニング モデルを提供しは、簡単にスケール アウトとチェックインします。  
  
**SLB のしくみ**  
  
SLB は、データ センター内のリソースのクラウド サービス セットの一部である動的 IP アドレス (Dip) への仮想 IP アドレス (Vip) のマッピングによって機能します。  
  
Vip は、分散された Vm の負荷のプールへのパブリック アクセスを提供する単一の IP アドレスです。 たとえば、Vip は、テナント、およびテナントのお客様は、クラウド データ センター内のテナント リソースに接続できるように、インターネット上で公開されている IP アドレスです。  
  
Dip は、メンバー、VIP の背後にある負荷分散プールの Vm の IP アドレスです。 テナント リソースへのクラウド インフラストラクチャ内では、Dip が割り当てられます。  
  
Vip はで、SLB マルチプレクサー (マルチプレクサー) にあります。  MUX は、1 つまたは複数の仮想マシン (Vm) で構成されます。  ネットワーク コントローラーは、各マルチプレクサー vip ごとに、および各マルチプレクサー順番に使用してボーダー ゲートウェイ プロトコル (BGP)、/32 として、物理ネットワーク上のルーターには、各 VIP をアドバタイズするルートです。  BGP を物理ネットワーク ルーターを使用できます。  
  
-   VIP は、MUXes がレイヤー 3 ネットワーク内の異なるサブネット上にある場合でも、各マルチプレクサーで利用できることについて説明します。  
  
-   等しいコスト マルチパス (ECMP) のルーティングを使用するすべての利用可能な MUXes VIP ごとの負荷を分散します。  
  
-   自動的に MUX 失敗、または削除を検出し、障害が発生した MUX へのトラフィックの送信を停止します。  
  
-   正常な muxes 障害が発生した、または取り外された MUX から負荷を分散します。  
  
インターネットからパブリック トラフィックが到着すると、SLB MUX は、トラフィックを送信先として VIP とマップを含み、トラフィックを書き換えるには、個々 の DIP に到着するようにします。 受信ネットワーク トラフィックでは、このトランザクションは MUX 仮想マシン (Vm) と移行先の DIP がある Hyper-V ホストに分割されている 2 段階のプロセスで実行されます。  
  
-   負荷分散 - MUX は、DIP を選択するために VIP は、パケットをカプセル化され、トラフィックを DIP が置かれている Hyper-V ホストに転送されます。  
  
-   ネットワーク アドレス変換 (NAT) - Hyper-V ホスト パケットからカプセル化を削除、DIP への VIP を変換、ポートを再マップおよび DIP VM にパケットを転送します。  
  
MUX は、負荷分散ネットワーク コントローラーを使用して定義するポリシーのための Vip を正しい Dip にマップする方法を認識します。 これらのルールには、プロトコル、フロント エンド ポート、バック エンド ポート、および分散アルゴリズム (5、3、または 2 つのタプル) が含まれます。  
  
テナントの Vm の応答および送信の送信ネットワーク トラフィックをインターネットまたはリモートのテナントの場所に、NAT が Hyper-V ホストのトラフィックによって実行されるため、マルチプレクサーをバイパスし、Hyper-V ホストから、エッジ ルーターに直接移動します。 この MUX バイパス プロセスは、Direct Server Return (DSR) と呼ばれます。  
  
着信ネットワーク トラフィックが SLB MUX を完全にバイパスする最初のネットワーク トラフィック フローが確立されると、します。  
  
次の図では、クライアント コンピューターは、会社 Sharepoint サイトの場合、Contoso という名前の架空の会社の IP アドレスの DNS クエリを実行します。 次の処理が発生します。  
  
-   DNS サーバーは、クライアントに VIP 107.105.47.60 を返します。  
  
-   クライアントは、VIP を HTTP 要求を送信します。  
  
-   物理ネットワークには、任意のマルチプレクサー上にある VIP に到達する利用可能な複数のパスがあります。  各ルーターの過程では、ECMP を使用して、MUX に要求が到着するまでのパスの次のセグメントを選択します。  
  
-   要求を受け取る MUX は、ポリシーを構成を確認し、2 つの Dip、10.10.10.5 と VIP 107.105.47.60 に要求を処理する仮想ネットワーク上の 10.10.20.5 があることを確認  
  
-   MUX は DIP 10.10.10.5 を選択し、VXLAN を送信できるように、ホストを使用する DIP を格納しているホストに物理ネットワーク アドレスを使用して、パケットをカプセル化します。  
  
-   ホストでは、カプセル化されたパケットを受信し、それを検査します。  カプセル化を削除し、パケットを書き換えるため、移行先、10.10.10.5 DIP、VIP の代わりには、今すぐ dip の仮想マシンにトラフィックを送信します。  
  
-   要求はサーバー ファーム 2 で Contoso の Sharepoint サイトに達してようになりました。 サーバーは応答を生成し、ソースとして独自の IP アドレスを使用して、クライアントに送信します。  
  
-   ホストでは、クライアント、ここで、移行先、VIP を元の要求を行ったを記憶する仮想スイッチでは送信パケットをインターセプトします。  ホストは、DIP アドレスをクライアントに認識しないため、VIP にパケットのソースをリライトします。  
  
-   ホストでは、最終的に応答を受信するクライアントにパケットを転送するように、標準のルーティング テーブルを使用する物理ネットワークのデフォルト ゲートウェイに直接パケットを転送します。  
  
![ソフトウェア負荷分散プロセス](../../../media/Software-Load-Balancing--SLB--for-SDN/slb_process.jpg)  
  
**負荷分散のデータ センターの内部トラフィック**  
  
テナントのリソースを異なるサーバー上で実行され、同じ仮想ネットワークのメンバーあるとの間、Vm が接続されている Hyper-V 仮想スイッチが NAT. を実行するなど、負荷、データ センターの内部ネットワーク トラフィックが分散  
  
最初の要求は内部トラフィックの負荷分散を使用に送信され、適切な DIP を選択し、DIP にトラフィックをルーティングする MUX によって処理されます。 した時点以降、確立されたトラフィック フローは、マルチプレクサーをバイパスし、VM から直接 VM に移動します。  
  
**正常性プローブ**  
  
SLB には、次を含む、ネットワーク インフラストラクチャの正常性を検証する正常性プローブが含まれています。  
  
-   ポートに TCP プローブ  
  
-   ポートと URL に HTTP プローブ  
  
従来のロード バランサー アプライアンスし、プローブがアプライアンス上で発生した、ネットワーク経由で DIP に出張することとは異なり、DIP があるし、さらに、ホストにわたる作業の分散、DIP に SLB ホスト エージェントから直接移動のホスト上で発生した SLB プローブします。  
  
## <a name="bkmk_infrastructure"></a>ソフトウェア負荷分散のインフラストラクチャ  
Windows Server SLB を展開するには、最初に Windows Server 2016 でネットワーク コントローラーと 1 つまたは複数の SLB MUX Vm を展開する必要があります。  
  
さらに、SDN 対応の Hyper-V 仮想スイッチを使用して Hyper-V ホストを構成し、SLB ホスト エージェントが実行されていることを確認する必要があります。  ホストを提供するルーターは、等しいコスト マルチパス (ECMP) のルーティングおよびボーダー ゲートウェイ プロトコル (BGP) をサポートする必要がありますや、SLB MUXes から BGP ピアリングの要求を受け入れるように構成する必要があります。  
  
SLB インフラストラクチャの概要を次に示します。  

![ソフトウェアの負荷分散のインフラストラクチャ](../../../media/Software-Load-Balancing--SLB--for-SDN/slb_overview1.png)  
  
次のセクションでは、詳細については、SLB インフラストラクチャのこれらの要素を提供します。  
  
### <a name="scvmm"></a>SCVMM  
System Center 2016 では、SLB マネージャーおよびヘルス モニターを含む、Windows Server 2016 でネットワーク コントローラーを構成できます。 SLB muxs を Windows Server 2016 と Hyper-V を実行しているコンピューターに SLB ホスト エージェントをインストールするには、また System Center を使用することができます。  
  
System Center 2016 の詳細については、次を参照してください。[System Center 2016](https://www.microsoft.com/en-us/server-cloud/products/system-center-2016/)します。  
  
> [!NOTE]  
> System Center 2016 を使用しない場合は、ネットワーク コントローラーとその他の SLB インフラストラクチャ インストールして構成する Windows PowerShell または別の管理アプリケーションを使用することができます。 詳細については、次を参照してください。[展開ネットワーク コントローラーが Windows PowerShell を使用して](../../../sdn/deploy/Deploy-Network-Controller-using-Windows-PowerShell.md)します。  
  
### <a name="network-controller"></a>ネットワーク コントローラー  
ネットワーク コントローラーは、SLB マネージャーをホストし、SLB に対して、次の操作を実行します。  
  
-   System Center、Windows PowerShell、または別のネットワーク管理アプリケーションから Northbound API を介して受け取る SLB コマンドを処理します。  
  
-   Hyper-V ホストと SLB MUXes に配布するためのポリシーを計算します。  
  
-   SLB インフラストラクチャの正常性状態を提供します。  
  
### <a name="slb-mux"></a>SLB MUX  
SLB MUX は受信ネットワーク トラフィックを処理する Dip、Vip をマップし、正しい DIP にトラフィックを転送します。 また、各マルチプレクサーは、エッジ ルーターに VIP ルートを公開するのに BGP を使用します。 BGP Keep Alive MUXes と通知、MUX が失敗した本質的には、ロード バランサーの負荷分散を提供する - MUX 障害の発生時の負荷を再配布するアクティブな muxes します。  
  
### <a name="hosts-that-are-running-hyper-v"></a>Hyper-V を実行しているホスト  
Windows Server 2016 と Hyper-V を実行しているコンピューターで SLB を使用することができます。 Hyper-V ホスト上のバーチャル マシンは、Hyper-V でサポートされているどのオペレーティング システムを実行できます。  
  
### <a name="slb-host-agent"></a>SLB ホスト エージェント  
SLB を展開するときに、すべての Hyper-V ホスト コンピューターに SLB ホスト エージェントを展開するのに System Center、Windows PowerShell、または別の管理アプリケーションを使用する必要があります。 すべてのバージョンの Windows Server 2016 Nano Server を含む、Hyper-V のサポートを提供する SLB ホスト エージェントをインストールすることができます。  
  
SLB ホスト エージェントは、ネットワーク コントローラーから SLB ポリシーの更新をリッスンします。 さらに、ホストのエージェント用プログラムの規則 SLB、SDN が有効な Hyper-V 仮想スイッチに、ローカル コンピューター上に構成されています。  
  
### <a name="sdn-enabled-hyper-v-virtual-switch"></a>SDN には、Hyper-V 仮想スイッチが有効になっています。  
SLB との互換性を仮想スイッチの Hyper-V 仮想スイッチ マネージャーまたは Windows PowerShell コマンドを使用して、スイッチを作成する必要があり、仮想スイッチの仮想フィルタ リング プラットフォーム (VFP) を有効にする必要があります。  
  
仮想スイッチの VFP を有効にする方法については、Windows PowerShell コマンドを参照してください。[Get-vmsystemswitchextension](https://technet.microsoft.com/en-us/library/hh848603.aspx)と[有効にする VMSwitchExtension](https://technet.microsoft.com/en-us/library/hh848541.aspx?f=255&MSPPError=-2147217396)します。  
  
SDN には、Hyper-V 仮想スイッチが有効になっている SLB に対して次の操作を実行します。  
  
-   SLB のデータ パスを処理します。  
  
-   MUX からの受信ネットワーク トラフィックを受信します。  
  
-   DSR を使用してルーターに送信する、送信ネットワーク トラフィックのマルチプレクサーをバイパスします。  
  
-   Hyper-V の Nano Server のインスタンスを実行します。  
  
### <a name="bgp-enabled-router"></a>BGP ルーターを有効になっています。  
BGP ルーターは、SLB に対して、次の操作を実行します。  
  
-   ルートは、ECMP を使用して MUX へのトラフィックを受信します。  
  
-   送信ネットワーク トラフィックでは、ホストによって提供されるルートを使用します。  
  
-   SLB MUX から Vip をルートの更新をリッスンします。  
  
-   Keep Alive が失敗した場合は、SLB MUXes SLB ローテーションからが削除します。  
  
## <a name="bkmk_features"></a>ソフトウェア負荷分散機能  
SLB の機能と機能の一部を次に示します。  
  
**コア機能**  
  
-   SLB は、レイヤー 4 の負荷分散 '南北' と '東西' TCP または UDP トラフィックに対してサービスを提供します。  
  
-   Hyper-V ネットワーク仮想化ベースのネットワークで SLB を使用することができます。  
  
-   SDN 有効になっている Hyper-V 仮想スイッチに接続されている vm の DIP VLAN ベースのネットワークで SLB を使用できます。  
  
-   SLB インスタンスを 1 つは、複数のテナントを処理できます。  
  
-   SLB と DIP で Direct Server Return (DSR) を実装し待機時間の短い、スケーラブルな戻り値のパスをサポートします。  
  
-   スイッチ埋め込みチーミング (SET) または単一ルート入出力仮想化 (SR-IOV) にも使用するときに、SLB 関数  
  
-   SLB には、インターネット プロトコル バージョン 4 (IPv4) が含まれていますサポート。  
  
-   サイト間ゲートウェイ シナリオでは、SLB を 1 つのパブリック IP を使用するすべてのサイト間接続を有効にする NAT 機能を提供します。  
  
-   SLB、全ホスト エージェントと、Windows Server 2016 では、上のマルチプレクサーを含む、コア、および Nano インストールをインストールすることができます。  
  
**スケールとパフォーマンス**  
  
-   対応するスケール アウト機能を含むクラウド スケールの準備が完了し、MUXes とホストのエージェントの機能を拡張します。  
  
-   1 つのアクティブな SLB Manager のネットワーク コントローラー モジュールが 8 のマルチプレクサー インスタンスをサポートします。  
  
**高可用性**  
  
-   SLB をアクティブ/アクティブ構成内の 2 つ以上のノードを展開することができます。  
  
-   MUXes を追加し、SLB サービスに影響を与えずに MUX プールから削除できます。 これにより、維持 SLB 可用性とき   
    個々 の MUXes が更新プログラムを適用します。  
  
-   個々 のマルチプレクサー インスタンス 99% の稼働時間があります。  
  
-   正常性の監視データはエンティティの管理に使用できます。  
  
**配置**  
  
-   展開および SCVMM と SLB を構成することができます。  
  
-   SLB は、RAS マルチテナント ゲートウェイ、データ センターのファイアウォール、およびルート Reflector などの Microsoft アプライアンスとシームレスに統合することにより、マルチテナントの統合されたエッジを提供します。  
  

