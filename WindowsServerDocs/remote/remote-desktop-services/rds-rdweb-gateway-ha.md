---
title: RD Web とゲートウェイ web 前に、高可用性を追加します。
description: RDS デプロイで、RD Web とゲートウェイ サーバーをインストールするための手順を説明します。
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: remote-desktop-services
ms.tgt_pltfrm: na
ms.topic: article
author: lizap
ms.author: elizapo
ms.date: 11/08/2016
manager: dongill
ms.openlocfilehash: fa09532e0b327b24ebb1c0e155c26c25d1043b63
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59854603"
---
# <a name="add-high-availability-to-the-rd-web-and-gateway-web-front"></a>RD Web とゲートウェイ web 前に、高可用性を追加します。

>適用先:Windows Server 2016 の Windows Server (半期チャネル)


Windows Server リモート デスクトップ サービス (RDS) 展開の規模と可用性を向上させるには、リモート デスクトップ Web アクセス (RD Web アクセス) とリモート デスクトップ ゲートウェイ (RD ゲートウェイ) ファームを展開します。 

次の手順を使用して、既存のリモート デスクトップ サービスの基本的な展開に RD Web とゲートウェイ サーバーを追加します。  

## <a name="pre-requisites"></a>前提条件

追加の RD Web と RD ゲートウェイ - として機能するサーバーをセットアップできます VM または物理サーバー。 これには、サーバーをドメインに参加させると、リモート管理を有効化が含まれます。

## <a name="step-1-configure-the-new-server-to-be-part-of-the-rds-environment"></a>手順 1:RDS の環境の一部として新しいサーバーを構成します。

1. リモート デスクトップ接続クライアントを使用して、Azure portal で、RDM サーバーに接続します。
2. サーバー マネージャーへの新しい RD Web とゲートウェイ サーバーを追加します。
    1. サーバー マネージャーを起動して、をクリックして**管理 > サーバーの追加**します。   
    2. サーバーの追加 ダイアログ ボックスで次のようにクリックします。**検索開始**します。   
    3. 新しく作成した RD Web とゲートウェイ サーバー (たとえば、Contoso-WebGw2) を選択し、クリックして**OK**します。
3. 展開に RD Web とゲートウェイ サーバーを追加します。  
    1. サーバー マネージャーを起動します。  
    2. クリックして**リモート デスクトップ サービス > 概要 > 展開サーバー > タスク > RD Web アクセス サーバーを追加**します。   
    3. (たとえば、Contoso-WebGw2)、新しく作成したサーバーを選択し、クリックして**次**します。  
    4. 確認 ページで、次のように選択します。**必要に応じて、リモート コンピューターを再起動**、 をクリックし、**追加**します。  
    5. RD ゲートウェイ サーバーを追加することも次の手順を繰り返して**RD ゲートウェイ サーバー**手順 b. でします。
4. RD ゲートウェイ サーバーの証明書を再インストールするには。
    1.  サーバー マネージャーで RDM サーバーで、 **Remote Desktop Services > 概要 > タスク > 展開のプロパティの編集**します。  
    2.  展開**証明書**します。  
    3.  テーブルまでスクロールします。 [RD] をクリックして**ゲートウェイのロール サービス > 既存の証明書を選択します。**  
    4.  クリックして**別の証明書を選択**し、証明書の場所を参照します。 たとえば、\Contoso-CB1\Certificates)。 前提条件 (例: ContosoRdGwCert) 中に作成された、RD Web とゲートウェイ サーバーの証明書ファイルを選択し、クリックして**オープン**します。  
    5.  証明書のパスワードを入力**対象のコンピューターの信頼されたルート証明機関の証明書ストアに追加する証明書を許可する**、順にクリックします**OK**します。  
    6.  **[適用]** をクリックします。
    > [!Note] 
    > サーバー マネージャーまたはタスク マネージャーを介して各 RD ゲートウェイ サーバーで実行されている TSGateway サービスを手動で再起動する必要があります。
    7.  RD Web アクセス役割サービスを手順 a ~ f を繰り返します。

## <a name="step-2-configure-rd-web-and-rd-gateway-properties-on-the-new-server"></a>手順 2:新しいサーバーに RD Web と RD ゲートウェイのプロパティを構成します。
1. RD ゲートウェイ ファームの一部であるサーバーを構成します。
    1.  サーバー マネージャーで RDM サーバーで、**すべてのサーバー**します。 RD ゲートウェイ サーバーの 1 つを右クリックし、をクリックし、**リモート デスクトップ接続**します。
    2.  ドメイン管理者アカウントを使用して、RD ゲートウェイ サーバーにサインインします。  
    3.  サーバー マネージャーで、RD ゲートウェイ サーバーで、**ツール > リモート デスクトップ サービス > RD ゲートウェイ マネージャー**します。  
    4.  ナビゲーション ウィンドウで、ローカル コンピューター (例: Contoso-WebGw1) をクリックします。  
    5.  クリックして**RD ゲートウェイ サーバー ファームの追加メンバー**します。  
    6.  **サーバー ファーム**タブで、各 RD ゲートウェイ サーバーの名前を入力してから、をクリックして**追加**と**適用**します。  
    7.  手順 a ~ f 各 RD ゲートウェイ サーバー ファーム内の RD ゲートウェイ サーバーと相互を認識するようします。 驚かないでください、警告がある場合、DNS 設定が反映されるまでの時間がかかる場合があります。
2. RD Web アクセスのファームの一部であるサーバーを構成します。 次の手順では、両方の RDWeb サイトで同じにするには、検証とマシン キーを復号化を構成します。
    1.  サーバー マネージャーで RDM サーバーで、**すべてのサーバー**します。 最初の RD Web アクセス サーバー (例: Contoso-WebGw1) を右クリックし、をクリックし、**リモート デスクトップ接続**します。  
    2.  ドメイン管理者アカウントを使用して、RD Web アクセス サーバーにサインインします。  
    3.  サーバー マネージャーで、RD Web アクセス サーバーで、**ツール > インターネット インフォメーション サービス (IIS) マネージャー**します。  
    4.  IIS マネージャーの左側のウィンドウで、展開、**サーバー (例: Contoso-WebGw1) > サイト > 既定の Web サイト**、 をクリックし、 **RDWeb**します。  
    5.  右クリック**マシン キー**、 をクリックし、**機能を開く**します。
    6.  コンピューター キー ページで、**アクション**ペインで、**キーの生成**、 をクリックし、**適用**します。
    7.  検証キーをコピー (キーを右クリックしてをクリックし、**コピー**)。
    8.  IIS マネージャーで、**既定の Web サイト**を選択します**フィード**、 **FeedLogon**と**ページ**順番です。
    9. 各。
        1.  右クリック**マシン キー**、 をクリックし、**機能を開く**します。
        2.  検証キー、クリア**実行時に自動的に生成**、し、g の手順でコピーしたキーを貼り付けます。
    10.  この RD Web サーバーに RD 接続ウィンドウを最小化します。  
    11.  機能の表示で終わる、2 つ目の RD Web アクセス サーバーについて、手順 b から e まで**マシン キー**します。
    12. 検証キー、クリア**実行時に自動的に生成**、し、g の手順でコピーしたキーを貼り付けます。
    13. **[適用]** をクリックします。
    14. このプロセスを完了、 **RDWeb**、**フィード**、 **FeedLogon**と**ページ**ページ。
    15. 2 つ目の RD Web アクセス サーバーに RD 接続ウィンドウを最小化し、最初の RD Web アクセス サーバーに RD 接続ウィンドウを最大化します。  
    16. 復号化キーをコピーする n から手順 g を繰り返します。
    17. 検証キーと復号化キーの同一の両方の RD Web アクセス サーバーで、 **RDWeb**、**フィード**、 **FeedLogon**と**ページ**ページ、すべての RD 接続 windows からサインアウトします。

## <a name="step-3-configure-load-balancing-for-the-rd-web-and-rd-gateway-servers"></a>手順 3:RD Web と RD ゲートウェイ サーバーの負荷分散を構成します。

Azure インフラストラクチャを使用している場合は、外部の Azure load balancer; を作成できます。それ以外の場合は、別のハードウェアまたはソフトウェア ロード バランサーを設定することができます。 トラフィックが均等に分散できるように、キーは、負荷分散をユーザーには、そのワークロードが実行するサーバーの RD ゲートウェイ経由でのリモート デスクトップ クライアントからの有効期間が長い接続を分散します。

> [!Note] 
> RD Web と RD ゲートウェイを実行する前のサーバーは、外部ロード バランサーの背後にある設定が既に場合は、スキップして、手順 4、既存のバックエンド プールを選択し、プールに新しいサーバーを追加します。

1.  Azure Load Balancer を作成します。  
    1.  Azure ポータルで**参照 > ロード バランサー > 追加**します。  
    2.  たとえば、名前を入力**WebGwLB**します。  
    3.  選択**パブリック**の**スキーム**、**パブリック IP アドレス**、および**パブリック IP アドレス**します。 既存のパブリック IP アドレスを選択したり新しいものを作成できます。 
    4.  適切な選択**サブスクリプション**、**リソース グループ**、および**場所**します。
    5.  **[作成]** をクリックします。  
2. 作成、[プローブ](https://azure.microsoft.com/documentation/articles/load-balancer-custom-probe-overview/)をどのサーバーが生きているモニター。  
    1.  Azure ポータルで**参照 > のロード バランサー**。、ロード バランサー、作成した WebGwLB、および設定例。  
    2.  クリックして**プローブ > 追加**します。  
    3.  たとえば、名前を入力**HTTPS**、プローブします。 選択**TCP**として、**プロトコル**、入力と**443**の**ポート**、 をクリックし、 **ok**。   
3.  HTTPS と UDP の負荷分散規則を作成します。  
    1.  **設定**、 をクリックして**負荷分散規則**します。  
    2.  選択**追加**の**HTTPS 規則**します。  
    3.  たとえば、HTTPS、規則の名前を入力し、選択**TCP**の**プロトコル**します。 入力**443**両方の**ポート**と**バックエンド ポート**、 をクリック**OK**します。  
    4.  **負荷分散規則**、 をクリックして**追加**の**UDP ルール**します。  
    5.  など、規則の名前を入力**UDP**、選び**UDP**の**プロトコル**します。 入力**3391**両方の**ポート**と**バックエンド ポート**、 をクリック**OK**します。  
4. RD Web と RD ゲートウェイ サーバーのバックエンド プールを作成します。
      1. **設定**、 をクリックして**バックエンド アドレス プール > 追加**します。   
      2. 名前を入力します (たとえば、 **WebGwBackendPool**)、順にクリックします**仮想マシンの追加**します。  
      3. 可用性セット (たとえば、WebGwAvSet) を選択し、クリックして**OK**します。   
      4. をクリックして**仮想マシンを選択**、各仮想マシンを選択し、クリックして**選択 > ok > ok**します。
