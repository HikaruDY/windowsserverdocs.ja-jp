---
title: リモート デスクトップ接続のトラブルシューティング
description: 並べ替え現象のトラブルシューティングの手順
ms.custom: na
ms.reviewer: rklemen;josh.bender
ms.suite: na
ms.tgt_pltfrm: na
ms.topic: troubleshooting
ms.assetid: ''
author: jobende
manager: ''
ms.author: v-tea;kaushika;rklemen;josh.bender
ms.date: 02/22/2019
ms.localizationpriority: medium
ms.openlocfilehash: 8965df09fd57decf7f4a1b6b89861e5a67034a0a
ms.sourcegitcommit: d3f73936160505a40633ad8dd5931ac5fe3eccdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/12/2019
ms.locfileid: "9297401"
---
# リモート デスクトップ接続のトラブルシューティング
リモート デスクトップ サービス (RDS)、最も一般的な問題のいくつかの簡単な説明については、[よく寄せられる質問リモート デスクトップ クライアントについて](https://review.docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/remote-desktop-client-faq)参照してください。 この記事では、接続の問題のトラブルシューティングにいくつかの高度なアプローチについて説明します。 これらの手順の多くは、別の物理コンピューターまたはより複雑な構成に接続する 1 つの物理コンピューターなど、シンプルな構成のトラブルシューティングを行うかどうかを適用します。 一部の手順より複雑なマルチ ユーザー シナリオでのみ発生する問題を解決します。 リモート デスクトップ コンポーネントとの連携について詳しくは、[リモート デスクトップ サービスのアーキテクチャ](https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/desktop-hosting-logical-architecture)を参照してください。

> [!NOTE]  
> この記事で説明する手順の多くは、複数のコンピューターにリモートでアクセスする必要がありますがの一部にアクセスすることが必要です。 リモート管理ツールとそれらを構成する方法について詳しくは、 [Windows オペレーティング システムのリモート サーバー管理ツール (RSAT)](https://support.microsoft.com/en-us/help/2693643/remote-server-administration-tools-rsat-for-windows-operating-systems)を参照してください。

次の一覧には、ユーザー (またはユーザー) が発生している現象の種類を識別します。

- [リモート デスクトップ クライアントは、リモート デスクトップに接続できませんが、特定の現象またはメッセージ (一般的なトラブルシューティング手順) はありません。](#no-specific-symptoms-or-messages-general-troubleshooting-steps)
- [リモート デスクトップ クライアントが、リモート デスクトップに接続できず、「クラスは登録されません」のメッセージを受け取る](#client-cannot-connect-class-not-registered)
- [リモート デスクトップ クライアントが、リモート デスクトップに接続できず、受信、「ライセンスなし利用可能な」または"セキュリティ エラー"メッセージ](#client-cannot-connect-no-licenses-available)
- [ユーザーが、「アクセス拒否」メッセージを受け取るか 2 回の資格情報を提供する必要があります。](#user-cannot-authenticate-or-must-authenticate-twice)
- [、接続したときに、「リモート デスクトップ サービスでは現在使用中」のメッセージを受け取る](#on-connecting-user-receives-remote-desktop-service-is-currently-busy-message)
- [リモート デスクトップ クライアントの切断し、同じセッションに再接続ことはできません。](#rd-client-disconnects-and-cannot-reconnect-to-the-same-session)
- [ユーザーがリモートのラップトップ、ワイヤレス ネットワークに接続しラップトップをネットワークから切断し、](#remote-laptop-disconnects-from-wireless-network)します。
- [ユーザー エクスペリエンスのパフォーマンスが低下またはリモートのアプリケーションの問題](#user-experiences-poor-performance-or-application-problems)

> [!NOTE]  
> RDP 切断コードの現在のリストには、 [ExtendedDisconnectReasonCode 列挙型](https://docs.microsoft.com/en-us/windows/desktop/TermServ/extendeddisconnectreasoncode)を参照してください。 

## 特定の現象とメッセージ (一般的なトラブルシューティング手順) はなし

次の手順を使用して、リモート デスクトップ クライアントは、リモート デスクトップに接続できませんが、メッセージやヘルプは他の問題が原因を特定するには提供されません。 この種類の問題の最も一般的な原因の多くを解決するには、以下のメソッドを使用します。

- [RDP プロトコルの状態を確認します。](#check-the-status-of-the-rdp-protocol)
- [RDP サービスの状態を確認します。](#check-the-status-of-the-rdp-services)
- [RDP リスナーが機能していることを確認します。](#check-that-the-rdp-listener-is-functioning)
- [RDP リスナー ポートを確認します。](#check-the-rdp-listener-port)

### RDP プロトコルの状態を確認します。

#### ローカル コンピューター上の RDP プロトコルの状態を確認します。

チェックし、ローカル コンピューター上の RDP プロトコルの状態を変更、[リモート デスクトップを有効にする方法](https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/remote-desktop-allow-access#how-to-enable-remote-desktop)を参照してください。

> [!NOTE]  
> リモート デスクトップのオプションが利用できない場合は、[グループ ポリシー オブジェクトが RDP をブロックするかどうかをチェック](#check-whether-a-group-policy-object-gpo-is-blocking-rdp-on-a-local-computer)を参照してください。

#### リモート コンピューター上の RDP プロトコルの状態を確認します。

> [!IMPORTANT]  
> このセクションの手順を慎重に従います。 誤ってレジストリを変更すると、重大な問題が発生する可能性があります。 前に変更する、[復元できるようにレジストリをバックアップして](https://support.microsoft.com/en-us/help/322756%22%20target=%22_self%22)問題が発生する場合。

チェックし、リモート コンピューター上の RDP プロトコルの状態を変更、レジストリのネットワーク接続を使用します。

1. **開始**] を選択**を実行**するには、選択、 **regedt32**を入力します。
2. レジストリ エディターでは、**ファイル**を選択し、し、**ネットワーク レジストリへの接続**を選択します。
3. **コンピューターの選択**] ダイアログ ボックスで、リモート コンピューターの名前を入力、**名前の確認**を選択し、 **[ok]** を選択します。
4. **HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal サーバー**に移動します。  
   ![レジストリ エディターを fDenyTSConnections エントリを示す](..\media\troubleshoot-remote-desktop-connections\RegEntry_fDenyTSConnections.png)
   - **FDenyTSConnections**キーの値が**0**の場合は、RDP は有効にします。
   - **FDenyTSConnections**キーの値が**1**の場合は、RDP が無効にします。
5. RDP を有効にするには、 **0**に**1**から**fDenyTSConnections**の値を変更します。

#### グループ ポリシー オブジェクト (GPO) が、ローカル コンピューター上 RDP をブロックしているかどうかを確認します。

RDP ユーザー インターフェイスを有効にすることはできません変更した後に、 **fDenyTSConnections**の値が**1**に戻る場合や、GPO がコンピューター レベル設定を上書きすることがあります。

ローカル コンピューターのグループ ポリシー設定を確認するに管理者としてコマンド プロンプト ウィンドウを開き、次のコマンドを入力します。
```
gpresult /H c:\gpresult.html
```
このコマンドが完了したら、gpresult.html を開きます。 **コンピューターの構成テンプレート Components\\Remote デスクトップ Services\\Remote デスクトップ セッション Host\\Connections**でポリシーについては、**ユーザーがリモート デスクトップ サービスを使用してリモートで接続できるようにします**。

- このポリシーの設定が**有効**である場合は、グループ ポリシーは、RDP 接続をブロックしません。
- このポリシーの設定を**無効になっている**場合は、**優先された GPO**を確認してください。 これは、RDP 接続をブロックしている GPO です。
![これで、gpresult.html の例セグメント ドメイン レベルの GPO * * ブロック RDP * * は、RDP 無効にします。](..\media\troubleshoot-remote-desktop-connections\GPResult_RDSH_Connections_GP.png)
   
  ![これで、gpresult.html の例セグメント * * ローカル グループ ポリシー] * * は、RDP 無効にします。](..\media\troubleshoot-remote-desktop-connections\GPResult_RDSH_Connections_LGP.png)

#### GPO がリモート コンピューターで RDP をブロックしているかどうかを確認します。

リモート コンピューターのグループ ポリシー設定を確認するには、コマンドは、ローカル コンピューターとほぼ同じです。
```
gpresult /S <computer name> /H c:\gpresult-<computer name>.html
```
このコマンドを生成するファイル (**gpresult-\<computer name\>.html**) ローカル コンピューターのバージョン (**gpresult.html**) を使用して、同じ情報の形式を使用します。

#### ブロックの GPO を変更します。

グループ ポリシー オブジェクト エディター (GPE) とグループ ポリシー管理コンソール (GPM) でこれらの設定を変更することができます。 グループ ポリシーを使用する方法について詳しくは、[高度なグループ ポリシー管理](https://docs.microsoft.com/en-us/microsoft-desktop-optimization-pack/agpm/)を参照してください。

ブロックのポリシーを変更するには、以下のメソッドのいずれかを使用します。

- GPE、GPO (ローカルまたはドメイン) などの適切なレベルのアクセスし、**コンピューターの構成テンプレート Components\\Remote デスクトップ Services\\Remote デスクトップ セッション Host\\Connections**に移動\\**許可します。リモート デスクトップ サービスを使用してリモートで接続するユーザー**します。  
   1. ポリシーの設定を**有効**または**未構成します**。
   2. に影響を受けたコンピューターで、管理者としてコマンド プロンプト ウィンドウを開き、**ファイル名**のコマンドを実行します。
- GPM では、ブロックのポリシーが、影響を受けるコンピューターに適用されて OU に移動し、OU からポリシーを削除します。

### RDP サービスの状態を確認します。

ローカル (クライアント) コンピューターとリモート (ターゲット) コンピューターの両方では、次のサービスが実行されている必要があります。

- リモート デスクトップ サービス (TermService)
- リモート デスクトップ サービスのユーザー モード ポート リダイレクター (UmRdpService)

ローカルまたはリモートでサービスを管理するのにサービス MMC スナップインを使用することができます。 ローカルまたはリモートで PowerShell を使用することも (かどうかは、リモート コンピューターが構成されているリモートの PowerShell コマンドを承認する)。

![サービス MMC スナップインでリモート デスクトップ サービスです。 サービスの既定の設定は変更しません。](..\media\troubleshoot-remote-desktop-connections\RDSServiceStatus.png)

どちらのコンピューターでは、一方または両方のサービスが実行されていない場合を起動します。

> [!NOTE]  
> リモート デスクトップ サービスのサービスを開始する場合は、**はい**リモート デスクトップ サービスのユーザー モード ポート リダイレクター サービスを自動的に再起動をクリックします。

### RDP リスナーが機能していることを確認します。

> [!IMPORTANT]  
> このセクションの手順を慎重に従います。 誤ってレジストリを変更すると、重大な問題が発生する可能性があります。 前に変更する、[復元できるようにレジストリをバックアップして](https://support.microsoft.com/en-us/help/322756%22%20target=%22_self%22)問題が発生する場合。

#### RDP リスナーの状態を確認します。

この手順では、管理者権限を持つ PowerShell のインスタンスを使用します。 ローカル コンピューターの場合、管理者権限を持つコマンド プロンプトを使用することもできます。 ただし、この手順は、同じコマンドの両方で動作ローカルとリモートのために PowerShell を使用します。

1. PowerShell ウィンドウを開きます。 リモート コンピューターに接続するには、 **Enter-pssession-ComputerName \<computer name\>** を入力します。
2. **Qwinsta**を入力します。 
    ![Qwinsta コマンドには、コンピューターのポートをリッスンしているプロセスが一覧表示します。](..\media\troubleshoot-remote-desktop-connections\WPS_qwinsta.png)
3. 一覧には、 **rdp tcp**状態の**リッスン**が含まれている場合、RDP リスナーは取り組んでいます。 [RDP リスナー ポートの確認](#check-the-rdp-listener-port)に進みます。 それ以外の場合、手順 4 で続行します。
4. 動作中のコンピューターから RDP リスナー構成をエクスポートします。
    1. 持つように影響を受けたコンピューター、同じバージョンのオペレーティング システムを持つコンピューターにサインインし、(たとえば、レジストリ エディターを使用して)、そのコンピューターのレジストリにアクセスします。
    2. 次のレジストリ エントリに移動します。  
        **HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP Tcp**
    3. エントリを .reg ファイルにエクスポートします。 たとえば、レジストリ エディターはエントリを右クリックし、**エクスポート**を選択し、エクスポートする設定にファイル名を入力します。
    4. エクスポートされた .reg ファイルを影響を受けたコンピューターにコピーします。
5. RDP リスナー構成をインポートするには、対象のコンピューターで管理者権限を持つ (または PowerShell ウィンドウを開き、影響を受けたコンピューターにリモート接続) を PowerShell ウィンドウを開きます。
   1. 既存のレジストリ エントリをバックアップするには、次のコマンドを入力します。  
   
      ```powershell  
      cmd /c 'reg export "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-tcp" C:\Rdp-tcp-backup.reg'   
      ```  
   

   2. 既存のレジストリ エントリを削除するには、次のコマンドを入力します。  
   
      ```powershell  
      Remove-Item -path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-tcp' -Recurse -Force  
      ```
   
   3. 新しいレジストリ エントリをインポートして、サービスを再起動して、次のコマンドを入力します。  
   
      ```powershell  
      cmd /c 'regedit /s c:\<filename>.reg'  
      Restart-Service TermService -Force  
      ```   
      \<filename\> は、エクスポートされた .reg ファイルの名前です。
6. リモート デスクトップ接続をもう一度しようとして構成をテストします。 まだ接続できない場合は、影響を受けたコンピューターを再起動します。
7. まだ存在する場合接続できない、 [RDP の自己署名証明書の状態を確認](#check-the-status-of-the-rdp-self-signed-certificate)します。

#### RDP の自己署名証明書の状態を確認します。

1. まだ接続できない場合は、証明書 MMC スナップインで開きます。 されたら、管理、**コンピューター アカウント**を選択し、影響を受けたコンピューターを選択する証明書ストアを選択します。
2. [**リモート デスクトップ**の [**証明書**] フォルダーで、RDP の自己署名証明書を削除します。 
    ![MMC 証明書スナップインでリモート デスクトップ証明書。](..\media\troubleshoot-remote-desktop-connections\MMCCert_Delete.png)
3. 対象のコンピューターで、リモート デスクトップ サービスのサービスを再起動します。
4. 証明書スナップインを更新します。
5. RDP の自己署名証明書が再作成されていない場合[、MachineKeys フォルダーのアクセス許可を確認](#check-the-permissions-of-the-machinekeys-folder)します。

#### MachineKeys フォルダーのアクセス許可を確認します。

1. 影響を受けたコンピューターで、エクスプ ローラーを開き**C:\\ProgramData\\Microsoft\\Crypto\\RSA\\**に移動します。
2. **MachineKeys**を右クリックし、**プロパティ**の選択、**セキュリティ**、選びを選んで**詳細設定**します。
3. 次のアクセス許可が構成されていることを確認します。
      - Builtin\\Administrators: フル コントロール
      - : Everyone に読み取り、書き込み

### RDP リスナー ポートを確認します。

(クライアント) をローカル コンピューターとリモート (ターゲット) コンピューターの両方で RDP リスナーはポート 3389 をリッスンする必要があります。 その他のアプリケーションする必要がありますないこのポートを使用します。

> [!IMPORTANT]  
> このセクションの手順を慎重に従います。 誤ってレジストリを変更すると、重大な問題が発生する可能性があります。 前に変更する、[復元できるようにレジストリをバックアップして](https://support.microsoft.com/en-us/help/322756%22%20target=%22_self%22)問題が発生する場合。

RDP ポートを変更、または確認するには、レジストリ エディターを使用します。

1. スタート画面を選択**を実行**するには、選択し、 **regedt32**を入力します。
      - リモート コンピューターに接続するには、**ファイル**を選択し、**ネットワーク レジストリへの接続**を選択します。
      - **コンピューターの選択**] ダイアログ ボックスで、リモート コンピューターの名前を入力、**名前の確認**を選択し、 **[ok]** を選択します。
2. レジストリを開き、 **HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\\<listener\>** に移動します。 
    ![RDP プロトコルのポート番号サブキーします。](..\media\troubleshoot-remote-desktop-connections\RegEntry_PortNumber.png)
3. **ポート番号**に**3389**以外の値がある場合は、 **3389**に変更します。 
   > [!IMPORTANT]  
    > 別のポートを使用してリモート デスクトップ サービスを操作することができます。 ただし、このようにすることはお勧めしません。 このような構成のトラブルシューティングとは、この記事の範囲を超えています。
4. ポート番号を変更した後、リモート デスクトップ サービスのサービスを再起動します。

#### 別のアプリケーションが同じポートを使用しようとしていないことを確認します。

この手順では、管理者権限を持つ PowerShell のインスタンスを使用します。 ローカル コンピューターの場合、管理者権限を持つコマンド プロンプトを使用することもできます。 ただし、この手順は、同じコマンド動作ローカルとリモートのために PowerShell を使用します。

1. PowerShell ウィンドウを開きます。 リモート コンピューターに接続するには、 **Enter-pssession-ComputerName \<computer name\>** を入力します。
2. 次のコマンドを入力します。  
   
     ```powershell  
    cmd /c 'netstat -ano | find "3389"'  
    ```
  
    ![Netstat コマンドには、ポート、およびそれらをリッスンしているサービスのリストが生成されます。](..\media\troubleshoot-remote-desktop-connections\WPS_netstat.png)
1. **聞き取り中**の状態では、TCP ポート 3389 のエントリ (または RDP ポートの割り当て) を探します。 
    > [!NOTE]  
   > PID 列の下のプロセスまたはポートを使用してサービス PID (プロセス Id) が表示されます。
1. アプリケーションはポート 3389 (または RDP ポートの割り当て) を使用してを確認するのには、次のコマンドを入力します。  
   
     ```powershell  
    cmd /c 'tasklist /svc | find "<pid listening on 3389>"'  
    ```  
  
    ![Tasklist コマンドは、特定のプロセスの詳細情報を報告します。](..\media\troubleshoot-remote-desktop-connections\WPS_tasklist.png)
1. ( **Netstat**出力) からポートに関連付けられている PID 番号のエントリを探します。 サービスまたはその PID に関連付けられているプロセスは、右側に表示されます。
1. アプリケーションまたはリモート デスクトップ サービス (TermServ.exe) 以外のサービスは、ポートを使用して場合、は、以下のメソッドのいずれかを使用して、競合を解決できます。
      - その他のアプリケーションまたはサービス (推奨)、別のポートを使用するを構成します。
      - その他のアプリケーションまたはサービスをアンインストールします。
      - 別のポートを使用する RDP を構成し、(非推奨) リモート デスクトップ サービスのサービスを再起動します。

#### ファイアウォールが RDP ポートをブロックするかどうかを確認します。

**Psping**ツールを使用して、ポート 3389 を使用して、影響を受けたコンピューターに到達することができるかどうかをテストします。

1. 影響を受けたコンピューターとは異なるコンピューターで、ダウンロードから**psping** <https://live.sysinternals.com/psping.exe>します。
2. 管理者としてコマンド プロンプト ウィンドウを開き、 **psping**がインストールされているディレクトリに移動および次のコマンドを入力します。  
   
   ```  
   psping -accepteula <computer IP>:3389  
   ```
   
3. 次のような結果の**psping**コマンドの出力を確認します。  
      - **\_LT_computer IP\> に接続する**: リモート コンピューターが到達します。
      - **(0% 損失)**: 接続しようとするたびに成功しました。
      - **リモート コンピューターのネットワーク接続を拒否する**: リモート コンピューターは到達できません。
      - **(100% の損失)**: すべての接続に失敗します。
1. 影響を受けたコンピューターに接続するには、その機能をテストする複数のコンピューターで**psping**を実行します。
1. 影響を受けたコンピューターが他のすべてのコンピューター、他のコンピューターやその他の 1 つだけのコンピューターからの接続をブロックするかどうかに注意してください。
1. 次の手順をお勧めします。
      - ネットワーク管理者が、ネットワークが影響を受けたコンピューターに RDP トラフィックを許可することを確認するに伝えます。
      - ファイアウォールが RDP ポートをブロックしているかどうかを判断するのには、ソース コンピューターと (対象のコンピューターで Windows ファイアウォールを含む)、影響を受けたコンピューター間のファイアウォールの構成を調査します。

## クライアントが接続できない、「クラスが登録されていない」

「クラス登録されていない (0x80040154)」のエラー コードが含まれている Windows 10 バージョン 1709 を実行しているクライアントを使用してリモート コンピューターに接続しようとすると、後で、クライアント接続できないリモート デスクトップ セッション ホスト サーバー メッセージを報告するときにします。

固定ユーザー プロファイルを接続しようとしたユーザーがある場合、この問題が発生します。 この問題を解決するには、インストール、 [2018 年 7 月 24日-KB4338817 (OS ビルド 16299.579)](https://support.microsoft.com/en-us/help/4338817/windows-10-update-kb4338817) Windows 10 更新プログラム。

## クライアントが接続できない、利用可能なライセンスがないです。

このような場合は、RDSH サーバーとリモート デスクトップのライセンス サーバーが含まれている展開に適用されます。

ユーザーが表示される動作の種類を識別します。

- 利用可能なライセンスがないか、ライセンス サーバーがないために、セッションが切断されました
- セキュリティ エラーがあるため、アクセスが拒否されました

RD セッション ホストに、ドメイン管理者としてサインインし、ライセンスの RD 診断機能を開きます。 次のメッセージは、次のようになります。

  - 猶予期間のリモート デスクトップ セッション ホスト サーバーの有効期限が切れてが RD セッション ホスト サーバーが、ライセンス サーバーで構成されていません。 RD セッション ホスト サーバーのライセンス サーバーが構成されている場合を除き、RD セッション ホスト サーバーへの接続が拒否されます。
  - ライセンス サーバー \<computer name\> は利用できません。 これは、ネットワーク接続の問題によって発生する可能性があります、ライセンス サーバーでリモート デスクトップのライセンス サービスの停止または RD ライセンスは、コンピューターにインストールされていません。

これらの問題は、次のユーザーのメッセージに関連する傾向があります。

  - このコンピューターのリモート デスクトップ クライアント アクセス ライセンスがないために、リモート セッションが切断されました。
  - リモート デスクトップ ライセンス サーバーのライセンスを提供できるがないために、リモート セッションが切断されました。

ここでは、 [RD ライセンス サービスを構成](#configure-the-rd-licensing-service)します。

RD ライセンス診断機能「RDP プロトコル コンポーネント X.224 プロトコル ストリームにエラーを検出し、クライアントが切断された」がある可能性がありますなど、他の問題が表示されている場合、ライセンスの証明書に影響する問題があります。 このような問題は、次のように、ユーザー メッセージに関連付けられる傾向があります。

セキュリティ エラーのため、クライアントはターミナル サーバーに接続できませんでした。 ネットワークにログオンしていることを確認したら、もう一度サーバーに接続してみてください。

この場合、[更新、X509 証明書のレジストリ キー](#refresh-the-x509-certificate-registry-keys)。

### RD ライセンス サービスを構成します。

次の手順では、サーバー マネージャーを使用して、構成の変更を加えます。 サーバー マネージャーの使用を構成する方法については、[サーバー マネージャー](https://docs.microsoft.com/en-us/windows-server/administration/server-manager/server-manager)を参照してください。

1. サーバー マネージャーを開き、**リモート デスクトップ サービス**に移動します。
2. **展開の概要**で**タスク**を選択し、**展開プロパティの編集**] を選択します。
3. **RD ライセンス**をを選択し、(**デバイスごと**または**ユーザーごと**)、展開の適切なライセンス モードを選択します。
4. RD ライセンス サーバーの完全修飾ドメイン名 (FQDN) を入力し、[**追加**] をクリックします。
5. 1 つ以上の RD ライセンス サーバーがある場合は、サーバーごとに手順 4 を繰り返します。 
    ![RD ライセンス サーバー構成オプションでサーバー マネージャーします。](..\media\troubleshoot-remote-desktop-connections\RDLicensing_Configure.png)

### 更新、X509 証明書のレジストリ キー

> [!IMPORTANT]  
> このセクションの手順を慎重に従います。 誤ってレジストリを変更すると、重大な問題が発生する可能性があります。 前に変更する、[復元できるようにレジストリをバックアップして](https://support.microsoft.com/en-us/help/322756%22%20target=%22_self%22)問題が発生する場合。

この問題を解決するには、バックアップし、削除、X509 証明書のレジストリ キーなどコンピューター、およびし、再アクティブ化 RD ライセンス サーバーを再起動します。 これを行うには、次の手順に従います。

> [!NOTE]  
> RDSH サーバーごとに、次の手順を実行します。

1. レジストリ エディターを開き、 **HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\RCM**に移動します。
2. [レジストリ] メニューには、**レジストリ ファイルのエクスポート**を選択します。
3. **ファイル名**] ボックスに**証明書がエクスポート**を入力し、**保存**します。
4. 次の値をそれぞれを右クリックし、**削除**、] を選択し、 **[はい]** を削除を確認します。  
      - **証明書**
      - **証明書の X509**
      - **X509 証明書の ID**
      - **X509 Certificate2**
5. レジストリ エディターを終了し、RDSH サーバーを再起動します。

## ユーザーが認証されない、または 2 回認証する必要があります。

ユーザーの認証に影響する問題を引き起こす可能性のあるいくつかの問題が発生します。 このセクションでは、次の場合。

  - [ユーザーには、「ログオンの種類を制限」のメッセージにアクセスが拒否されました](#access-denied-restricted-type-of-logon)
  - [ユーザーまたはアプリケーションがイベント 16965 にアクセス拒否された「SAM データベースへのリモート呼び出しが拒否されました」](#access-denied-a-remote-call-to-the-sam-database-has-been-denied)
  - [スマート カードを使用して、ユーザーがサインインできません。](#a-user-cannot-sign-in-by-using-a-smart-card)
  - [リモート PC がロックされている場合、ユーザーを 2 回、パスワードを入力する必要があります。](#if-the-remote-pc-is-locked-a-user-needs-to-enter-a-password-twice)
  - [ユーザーがサインインできないし、「認証エラー」と「CredSSP 暗号化 oracle 修復」のメッセージを受け取る](#user-cannot-sign-in-and-receives-authentication-error-and-credssp-encryption-oracle-remediation-messages)
  - [一部のユーザーが 2 回サインインする必要が、クライアント コンピューターを更新した後](#after-you-update-client-computers-some-users-need-to-sign-in-twice)です。
  - [ユーザーが複数の RD 接続ブローカーで RemoteGuard を使用する展開でのアクセスが拒否されます。](#users-are-denied-access-on-a-deployment-that-uses-remote-credential-guard-with-multiple-rd-connection-brokers)

### アクセスが拒否されたログオンの制限の種類

この場合、Windows 10 または Windows Server 2016 のコンピューターに接続しようとする Windows 10 ユーザーには、次のメッセージを使ってアクセスが拒否されます。

> リモート デスクトップ接続します。  
> システム管理者は、ログオンの種類を制限されています (ネットワークや対話型) を使うことがあります。 詳細については、システム管理者または技術サポートに問い合わせてください。

この問題は、ネットワーク レベル認証 (NLA) が、RDP 接続に必要なされ、ユーザーが**リモート デスクトップ ユーザー**グループのメンバーではないときに発生します。 また、**リモート デスクトップ ユーザー**グループが適切な**アクセス ネットワークからこのコンピューター**のユーザーに割り当てられていない場合にも発生することができます。

この問題を解決するには、次の手順のいずれかの手順に従います。

  - [ユーザーのグループ メンバーシップまたはユーザー権利の割り当てを変更](#modify-the-users-group-membership-or-user-rights-assignment)します。
  - (非推奨) NLA オフにします。
  - Windows 10 以外のリモート デスクトップ クライアントを使用します。 たとえば、Windows 7 クライアントには、この問題はありません。

#### ユーザーのグループ メンバーシップまたはユーザー権利の割り当てを変更します。

この問題は、1 人のユーザーに影響する場合、この問題を最も簡単なソリューションは、**リモート デスクトップ ユーザー**グループにユーザーを追加します。

ユーザーは、既にこのグループのメンバー (または複数のグループのメンバーに同じ問題があるかどうか) 場合、は、Windows 10 または Windows Server 2016 のリモート コンピューター上のユーザー権利の構成を確認します。

1. グループ ポリシー オブジェクト エディター (GPE) を開き、リモート コンピューターのローカル ポリシーに接続します。
2. **コンピューター構成 Settings\\Security Settings\\Local Policies\\User 権利の割り当て**に移動し、**ネットワークからこのコンピューターへのアクセス**を右クリックし、**プロパティ**] を選択します。
3. **リモート デスクトップ ユーザー** (または親グループ) のユーザーとグループの一覧を確認します。
4. **リモート デスクトップ ユーザー** (または親グループ、**すべてのユーザー**など) かどうか、一覧に含まれません、リストに追加する必要があります (よりも 1 つまたは 2 つのコンピューターで、展開がある場合は、グループ ポリシー オブジェクトを使用)。  
    たとえば、既定のメンバーシップ**ネットワークからこのコンピューターへのアクセス**にはには、**すべてのユーザー**が含まれています。 展開では、**すべてのユーザー**を削除するグループ ポリシー オブジェクトを使用している場合は、**リモート デスクトップのユーザー**を追加するグループ ポリシー オブジェクトを更新することによってアクセスを復元する必要があります。

### アクセス拒否、SAM データベースへのリモート呼び出しが拒否されました

この動作は、ドメイン コント ローラーが実行されている Windows Server 2016 以降、ユーザーが、カスタマイズされた接続アプリを使用して、接続しようとする場合に発生する可能性が最も高い。 具体的には、Active Directory のユーザーのプロファイル情報にアクセスするアプリケーションには、アクセスが拒否されます。

この動作は、Windows に変更を結果します。 Windows Server 2012 R2 であること、およびそれ以前バージョンでは、ユーザーがログオン リモート デスクトップ、リモート接続マネージャー (RCM) 連絡先にドメイン コント ローラーは、Active Directory ドメイン内のユーザー オブジェクトでリモート デスクトップに固有の構成のクエリを実行するには、(DC)サービス (AD DS)。 この情報は、Active Directory ユーザーとコンピューター MMC スナップインで、ユーザーのオブジェクトのプロパティのリモート デスクトップ サービスのプロファイル] タブに表示されます。

Windows Server 2016 以降は、RCM は不要になった、AD DS のユーザー オブジェクトを照会します。 リモート デスクトップ サービスの属性を使用しているために、AD DS を照会する RCM が必要な場合、以前の RCM 動作を手動で有効にする必要があります。

> [!IMPORTANT]  
> このセクションの手順を慎重に従います。 誤ってレジストリを変更すると、重大な問題が発生する可能性があります。 前に変更する、[復元できるようにレジストリをバックアップして](https://support.microsoft.com/en-us/help/322756%22%20target=%22_self%22)問題が発生する場合。

RD セッション ホスト サーバーでのレガシ RCM 動作を有効にするには、次のレジストリ エントリを構成し、**リモート デスクトップ**サービスを再起動します。  
  - **Hkey \_local\_machine\\software\\policies\\microsoft\\windows NT\\Terminal サービス**
  - **HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\\<Winstation name\>\\**  
      - [名前]: **fQueryUserConfigFromDC**
      - 種類: **reg \_dword**
      - 値: **1** (10 進数)

RD セッション ホスト サーバー以外のサーバーでのレガシ RCM 動作を有効にするには、これらのレジストリ エントリと次の追加のレジストリ エントリを構成する (およびサービスを再起動して)。
  - **HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal サーバー**

この動作について詳しくは、KB 3200967 [Windows Server のリモート接続マネージャーへの変更](https://support.microsoft.com/en-us/help/3200967/changes-to-remote-connection-manager-in-windows-server)を参照してください。

### スマート カードを使用して、ユーザーがサインインできません。

この記事では、次の 3 つの一般的な状況がユーザーにサインインできないリモート デスクトップ スマート カードを使用して、説明します。  
  - [ユーザーは、読み取り専用ドメイン コント ローラー (RODC) を使用するブランチ オフィスにサインインできません。](#cannot-sign-in-with-a-smart-card-in-a-branch-office-with-a-rodc)
  - [ユーザーが最近更新されている Windows Server 2008 SP2 コンピューターにサインインできません。](#cannot-sign-in-with-a-smart-card-to-a-windows-server-2008-sp2-computer)
  - [ユーザーが最近更新されて、Windows コンピューターにサインインした保持されることはできませんになり、リモート デスクトップ サービスのサービス応答停止 (ハング)](#cannot-stay-signed-in-with-a-smart-card-and-remote-desktop-services-service-hangs)

#### RODC とブランチ オフィスのスマート カードではサインインできません。

RODC を使用しているブランチ サイトで、RDSH サーバーが含まれている展開では、この問題が発生します。 ルート ドメインでは、RDSH サーバーをホストします。 ブランチ サイトでユーザーは、子ドメインに属しているし、認証にスマート カードを使用します。 RODC は ( **RODC パスワードの許可されているレプリケーション グループ**に属している RODC) ユーザーのパスワードをキャッシュするように構成します。 ユーザーは、RDSH サーバー上のセッションにサインインすると、それらメッセージが表示されるなど、"ログオンの試行が正しくありません。 これは、悪意のあるユーザー名または認証情報が原因です。"

これは、既知の問題の方法でするルート DC と RODC は、ユーザーの資格情報の暗号化を管理します。 ルート DC、資格情報の暗号化、暗号化キーを使用し、RODC がクライアントに暗号化解除キーを提供します。 ただし、2 つのキーが一致しません。

この問題を回避するには、RODC にパスワードのキャッシュをオフにするか、またはブランチ サイトへの書き込み可能な DC を展開することによって、DC トポロジを変更することを検討してください。 別の方法として、ユーザーと同じ子ドメインに RDSH サーバーを移動します。 別の方法としてスマート カードせずにサインインできるようにすることです。 これらのソリューションのいずれかには、パフォーマンスやセキュリティのレベルで妥協が必要です。

#### Windows Server 2008 SP2 コンピューターにスマート カードではサインインできません。

ユーザーが KB4093227 で更新されている Windows Server 2008 SP2 コンピューターにサインインするときにこの問題が発生します (2018.4B)。 ユーザーがスマート カードを使用してサインインしようとすると、"いない有効な証明書が見つかりましたなどのメッセージでアクセスが拒否されます。 確認する、カードが挿入される正しくと緊密にどのように適合。" 同時に、Windows Server のコンピューター、アプリケーションはイベントを記録"挿入されたスマート カードからのデジタル証明書の取得中にエラーが発生しました。 無効な署名します。"

この問題を解決するには、Windows Server のコンピューターを更新、2018.06Bre と-KB 4093227 のリリース[Windows リモート デスクトップ プロトコル (RDP) 拒否 Windows Server 2008 のサービスの脆弱性のセキュリティ更新プログラムの説明: 2018 年 4 月 10 日](https://support.microsoft.com/en-us/help/4093227/security-update-for-vulnerabilities-in-windows-server-2008)します。

#### スマート カードとリモート デスクトップ サービスのサービスがハングを使用して署名された保持されることはできません。

この問題は、ユーザーが KB 4056446 で更新されている Windows または Windows Server のコンピューターにサインインするときに発生します。 最初は、ユーザーは、スマート カードを使用して、システムにサインインできる場合がありますが、"SCARD\_E\_NO\_SERVICE"エラー メッセージを受信します。 リモート コンピューターは、応答しなくなる可能性があります。

この問題を回避するには、リモート コンピューターを再起動します。

この問題を解決するには、適切な修正プログラムと、リモート コンピューターを更新します。

  - Windows Server 2008 SP2: KB 4090928、 [Windows の漏洩 lsm.exe プロセスのハンドルとスマート カードのアプリケーションが"SCARD\_E\_NO\_SERVICE"エラーを表示](https://support.microsoft.com/en-us/help/4090928/scard-e-no-service-errors-when-windows-leaks-handles-in-the-lsm-exe)
  - Windows Server 2012 R2: KB 4103724、 [2018 年 5 月 17 日: KB4103724 (月次プログラムのロールアップのプレビュー)](https://support.microsoft.com/en-us/help/4103724/windows-81-update-kb4103724)
  - Windows Server 2016 および Windows 10 バージョン 1607: KB 4103720、 [2018 年 5 月 17 日: KB4103720 (OS ビルド 14393.2273)](https://support.microsoft.com/en-us/help/4103720/windows-10-update-kb4103720)

### リモート PC がロックされている場合、ユーザーを 2 回、パスワードを入力する必要があります。

この問題は、ユーザーが、RDP 接続は必要ありません NLA 展開では、Windows 10 バージョン 1709 を実行しているリモート デスクトップに接続しようとするときに発生する可能性があります。 これらの条件下でリモート デスクトップがロックされている場合でユーザーが接続するときに 2 回、自分の資格情報を入力します。

この問題を解決するには、KB 4343893 で Windows 10 バージョン 1709 のコンピューターを更新する[、2018 年 8 月 30日: KB4343893 (OS ビルド 16299.637)](https://support.microsoft.com/en-us/help/4343893/windows-10-update-kb4343893)します。

### ユーザーがサインインできないし、「認証エラー」と「CredSSP 暗号化 oracle 修復」のメッセージを受け取る

ユーザーは、Windows Vista SP2 とそれ以降のバージョンまたは Windows Server 2008 SP2 から Windows のすべてのバージョンとそれ以降のバージョンを使用してサインインするときに、アクセスが拒否され、次のようにメッセージが表示されます。

  - 認証エラーが発生しました。 要求された関数がサポートされていません。
  - CredSSP 暗号化 oracle 修復可能性があります。

「CredSSP 暗号化 oracle 修復」は、3 月、年 4 月、および 2018 年 5 月にリリースされたセキュリティ更新プログラムのセットを参照します。 Credssp では、その他のアプリケーションの認証要求を処理する認証プロバイダーです。 13 2018 年 3 月、"3 b"とそれ以降の更新では、攻撃者がターゲット システム上のコードを実行するユーザーの資格情報を中継でした悪用を説明します。

初期の更新プログラムには、新しいグループ ポリシー オブジェクト、**暗号化 Oracle 修復**、次の設定が可能なサポートが追加されました。

  - **脆弱性が存在**します。 CredSSP を使用するクライアント アプリケーションが安全でないバージョンにフォールバックにできますが、この動作は、攻撃に対してリモート デスクトップを公開します。 CredSSP を使用するサービスは、更新されていないクライアントを受け入れます。
  - **軽減**されます。 CredSSP を使用するクライアント アプリケーションが安全でないバージョンにフォールバックにことはできませんが、CredSSP を使用するサービスが更新されていないクライアントを受け入れます。
  - **フォース クライアントが更新**されます。 CredSSP を使用するクライアント アプリケーションが安全でないバージョンにフォールバックにことはできません、CredSSP を使用するサービスでは、修正クライアント受け入れません。 
    注: すべてのリモート ホストは、最新バージョンをサポートするまで、この設定は展開されませんする必要があります。

2018 年 5 月 8日更新プログラムには、**軽減**に**Vulnerable**から既定の**暗号化 Oracle 修復**設定が変更されました。 この変更のリモート デスクトップ クライアントの更新プログラムがあることはできませんサーバーに接続する必要はありません (または再起動されていないサーバーを更新)。 更新プログラムとブロックされている通信の種類の効果の詳細については、KB 4093492、 [CVE-2018-0886 CredSSP の更新プログラム](https://support.microsoft.com/en-us/help/4093492/credssp-updates-for-cve-2018-0886-march-13-2018)を参照してください。

この問題を解決するには、すべてのシステムが完全に更新し、再開ことを確認します。 更新プログラムと、脆弱性の詳細についての完全な一覧を参照してください[CVE-2018-0886 |Credssp でリモート脆弱性](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2018-0886)します。

更新が完了するまで、この問題を回避するには、許可されている種類の接続の KB 4093492 を確認します。 可能であればの代替手段がない場合、次のメソッドのいずれかを考慮する可能性があります。

  - 影響を受けるクライアント コンピューターでは、 **Vulnerable**に**暗号化 Oracle 修復**ポリシーを設定します。
  - **コンピューターの構成テンプレート Components\\Remote デスクトップ Services\\Remote デスクトップ セッション Host\\Security**グループ ポリシーのフォルダーで、次のポリシーに変更します。  
      - **特定のセキュリティ層 (RDP) のリモート接続用の使う必要があります**: **Enabled**に設定し、 **RDP**を選択します。
      - **ネットワーク レベル認証を使用してリモート接続用のユーザーの認証を要求**します。 設定を**無効に**します。
      > [!IMPORTANT]  
      > これらの変更、展開のセキュリティは低下します。 まったく使用する場合は、一時のみあります。

グループ ポリシーを使った操作について詳しくは、[ブロックの GPO の変更](#modifying-a-blocking-gpo)を参照してください。

### 一部のユーザーが 2 回サインインする必要がクライアント コンピューターを更新します。 ある

いくつか Windows 7 または Windows 10 バージョン 1709 上のユーザーは、リモート デスクトップ セッションにサインインし、2 つ目のサインイン画面をすぐに確認します。 この問題は、クライアント コンピューターは、次の更新プログラムを受信した場合に発生します。

  - Windows 7: KB 4103718、 [、2018 年 5 月 8日: KB4103718 (月次プログラムのロールアップ)](https://support.microsoft.com/en-us/help/4103718/windows-7-update-kb4103718)
  - Windows 10 1709: KB 4103727、 [、2018 年 5 月 8日: KB4103727 (OS ビルド 16299.431)](https://support.microsoft.com/en-us/help/4103727/windows-10-update-kb4103727)

この問題を解決するには、(および RDSH または RDVI サーバー) に接続するユーザーのコンピューターが、2018 年 3 月まで完全に更新することを確認します。 これには、次の更新プログラムが含まれます。

  - Windows Server 2016: KB 4284880、 [、2018 年 6 月 12日-KB4284880 (OS ビルド 14393.2312)](https://support.microsoft.com/en-us/help/4284880/windows-10-update-kb4284880)
  - Windows Server 2012 R2: KB 4284815、 [、2018 年 6 月 12日-KB4284815 (月次プログラムのロールアップ)](https://support.microsoft.com/en-us/help/4284815/windows-81-update-kb4284815)
  - Windows Server 2012 の場合: KB 4284855、 [、2018 年 6 月 12日-KB4284855 (月次プログラムのロールアップ)](https://support.microsoft.com/en-us/help/4284855/windows-server-2012-update-kb4284855)
  - Windows Server 2008 R2: KB 4284826、 [、2018 年 6 月 12日-KB4284826 (月次プログラムのロールアップ)](https://support.microsoft.com/en-us/help/4284826/windows-7-update-kb4284826)
  - Windows Server 2008 SP2: KB4056564、[で Windows Server 2008、Windows Embedded POSReady 2009、および Windows Embedded 標準 2009 credssp でリモート コードの実行の脆弱性のセキュリティ更新プログラムの説明: 2018 年 3 月 13日](https://support.microsoft.com/en-us/help/4056564/security-update-for-vulnerabilities-in-windows-server-2008)

### ユーザーが複数の RD 接続ブローカーで Remote Credential Guard を使用する展開でのアクセスが拒否されます。

Windows Defender Remote Credential Guard が使用されている場合、2 つ以上リモート デスクトップ接続ブローカーを使用して高可用性の展開ではこの問題が発生します。 ユーザーは、リモート デスクトップにサインインできません。

Remote Credential Guard は、認証に Kerberos を使用し、NTLM を制限するため、この問題が発生します。 ただし、負荷分散と高可用性構成では、RD 接続ブローカーが Kerberos 操作をサポートことはできません。

RD 接続ブローカーの負荷分散と高可用性の構成を使用する必要がある場合は、Remote Credential Guard を無効にすると、この問題を回避できます。 Windows Defender Remote Credential Guard を管理する方法について詳しくは、 [Windows Defender Remote Credential Guard によるリモート デスクトップを保護するための資格情報](https://docs.microsoft.com/en-us/windows/security/identity-protection/remote-credential-guard#enable-windows-defender-remote-credential-guard)を参照してください。

## 接続すると、ユーザーが「リモート デスクトップ サービスでは現在使用中」のメッセージを受信します。

この問題を適切な応答を確認するのには、次の手順を使用します。

1. リモート デスクトップ サービスのサービス応答しなくなります (たとえば、リモート デスクトップ クライアントに表示されて、ようこそ画面では、「ハング」)。  
      - サービスのように見える場合は、 [RDSH サーバー メモリの問題](#rdsh-server-memory-issue)を参照してください。
      - クライアントは、通常、サービスを操作する表示されている場合は、次の手順に進みます。
2. 1 つまたは複数のユーザーは、リモート デスクトップ セッションを切断する場合、ユーザー再び接続かどうか。  
   - ユーザーの数は、セッションを切断に関係なく接続を拒否するサービスが解決しない場合は、 [RD リスナーの問題](#rd-listener-issue)を参照してください。
   - サービスの受け入れを開始する場合ユーザー数後にもう一度接続が切断された、セッション、[接続の制限ポリシーを確認](#check-the-connection-limit-policy)します。

### RDSH サーバー メモリの問題

Windows Server 2012 R2 RDSH サーバーによってメモリ リークが検出されました。 時間の経過と共にこれらのサーバーは、リモート デスクトップ接続と、次のようにメッセージをローカルの本体サインインの両方を拒否するように開始します。

> リモート デスクトップ サービスは現在使用中であるために、実行しようとしているタスクを完了できません。 数分でもう一度やり直してください。 他のユーザーがサインインすることもあります。

接続しようとすると、リモート デスクトップ クライアントは、応答しなくなります。

この問題を回避するには、RDSH サーバーを再起動します。

この問題を解決するには、KB 4093114 を適用する [、2018 年 4 月 10 日: KB4093114 (月次プログラムのロールアップ)] (file:///C:\\Users\\v-jesits\\AppData\\Local\\Microsoft\\Windows\\INetCache\\Content.Outlook\\FUB8OO45\\April%2010,%202018—KB4093114%20\(Monthly%20Rollup\))、RDSH サーバーにします。

### RD リスナーの問題

Windows Server 2012 R2 への Windows Server 2008 R2 から直接アップグレードされた一部の RDSH サーバーまたは Windows Server 2016 での問題を報告されています。 リモート デスクトップ クライアントは、RDSH サーバーに接続するときに RDSH サーバーは、ユーザー セッションの RD リスナーを作成します。 影響を受けるサーバーは、ユーザーが接続するにつれて RD リスナーではなく、低下の数を記録します。

この問題を回避するには、以下のメソッドを使用できます。

  - RD リスナーのカウントをリセットする RDSH サーバーを再起動します。
  - 非常に大きな値に設定する、接続の制限ポリシーを変更します。 接続の制限ポリシーの管理について詳しくは、[接続の制限ポリシーを確認する](#check-the-connection-limit-policy)を参照してください。

この問題を解決するには、RDSH サーバーを次の更新プログラムが適用されます。

  - Windows Server 2012 R2: KB 4343891、 [、2018 年 8 月 30日: KB4343891 (月次プログラムのロールアップのプレビュー)](https://support.microsoft.com/en-us/help/4343891/windows-81-update-kb4343891)
  - Windows Server 2016: KB 4343884、 [、2018 年 8 月 30日: KB4343884 (OS ビルド 14393.2457)](https://support.microsoft.com/en-us/help/4343884/windows-10-update-kb4343884)

### 接続の制限ポリシーを確認します。

個々 のコンピューター レベルまたはグループ ポリシー オブジェクト (GPO) を構成することにより、同時にリモート デスクトップ接続の数に制限を設定できます。 既定では、制限が設定されていません。

現在の設定を確認し、RDSH サーバー上の既存の Gpo を識別する、管理者としてコマンド プロンプト ウィンドウを開き、次のコマンドを入力します。
  
```
gpresult /H c:\gpresult.html
```
   
このコマンドが完了したら、gpresult.html を開き、**コンピューターの構成テンプレート Components\\Remote デスクトップ Services\\Remote デスクトップ セッション Host\\Connections**で検索**接続の数を制限**ポリシー。

  - このポリシーの設定を**無効になっている**場合は、RDP 接続されていないグループ ポリシーに制限します。
  - このポリシーの設定が**有効**である場合は、**優先された GPO**を確認します。 削除または接続の制限を変更する必要がある場合は、この GPO を編集します。

ポリシーの変更を適用するには、対象のコンピューターでコマンド プロンプト ウィンドウを開き、次のコマンドを入力します。
  
```
gpupdate /force
```
  
## RD クライアントの切断し、同じセッションに再接続ことはできません。

リモート デスクトップ クライアントは、リモート デスクトップへの接続を失った後、クライアントがすぐに再接続することはできません。 次のようにエラー メッセージが表示されます。

  - セキュリティ エラーのため、クライアントはターミナル サーバーに接続できませんでした。 ネットワークにログオンしていることを確認したら、もう一度サーバーに接続してみてください。
  - リモート デスクトップの切断します。 セキュリティ エラーのため、クライアントは、リモート コンピューターに接続できませんでした。 ネットワークにログオンしているしてもう一度接続を試してみることを確認します。

後で、リモート デスクトップ クライアントは、リモート デスクトップに再接続します。 ただし、元のセッションにクライアントを接続ではなく、RDSH サーバー、クライアント接続新しいセッションにします。 RDSH サーバーをチェックすると、元のセッションを切断の状態が入力されていませんが、代わりに、アクティブなままが表示されます。

この問題を回避するにはコンピューターの構成テンプレート Components\\Remote デスクトップ Services\\Remote デスクトップ セッション Host\\Connections**の**構成、キープア接続間隔**のポリシーを有効にできます。** グループ ポリシーのフォルダーです。 このポリシーを有効にした場合は、キープア間隔を入力する必要があります。 キープア間隔を分単位でサーバーをチェックする頻度、セッションの状態を決定します。

この問題は、認証と構成の設定の構成の誤りによって発生することができます。 Gpo を使用して、サーバー レベルでは、これらの設定を構成できます。 グループ ポリシー設定は、**コンピューターの構成テンプレート Components\\Remote デスクトップ Services\\Remote デスクトップ セッション Host\\Security**グループ ポリシーのフォルダーで利用できます。

1. RD セッション ホスト サーバーでリモート デスクトップ セッション ホストの構成を開きます。
2. **接続**] の下、接続の名前を右クリックし、[**プロパティ**] をクリックします。
3. [**全般**] タブで、**セキュリティ**層] で、接続の**プロパティ**] ダイアログ ボックスで、セキュリティ方法を選択します。
4. **暗号化レベル**では、必要なレベルをクリックします。 **低**、**互換性のあるクライアント**、**高**、または**FIPS 準拠**を選択することができます。

> [!NOTE]  
>  - クライアントと RD セッション ホスト サーバー間の通信には、最高レベルの暗号化が必要がある場合は、FIPS 準拠の暗号化を使用します。
>  - グループ ポリシーで構成した暗号化レベルの設定は、リモート デスクトップ サービスの構成ツールを使用して設定した構成をオーバーライドします。 また、有効にした場合、[システム暗号化: 暗号化、ハッシュ、および署名のための FIPS 準拠アルゴリズム](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc780081\(v=ws.10\))ポリシーでは、この設定は、**クライアント接続の暗号化レベルを設定する**ポリシーを上書きします。 **コンピューターの構成 Settings\\Security Settings\\Local Policies\\Security オプション**フォルダーには、システムの暗号化ポリシーです。
>  - 暗号化レベルを変更すると、新しい暗号化レベルは、有効、次回ユーザーがログオンします。 複数のレベルの 1 台のサーバー上の暗号化を必要とする場合は、複数のネットワーク アダプターをインストールし、各アダプターを個別に構成します。
>  - その証明書は、リモート デスクトップ サービスの構成で、対応する秘密キーを持つことを確認するには、証明書を表示、**一般的な**選択、**編集**] を選択する証明書を選択する接続を右クリックします。を表示し、[**証明書の表示**します。 [**全般**] タブの下部には、このステートメントでは、「があるこの証明書に対応する秘密キー」が表示されます。 証明書スナップインを使用して、この情報を表示することもできます。
>  - FIPS に準拠した暗号化 (、**システム暗号化: 暗号化、ハッシュ、および署名のための FIPS 準拠アルゴリズム**ポリシーまたはリモート デスクトップのサーバーの構成で**FIPS 準拠**設定) から送信されるデータを暗号化および、クライアント サーバーをサーバーとの間で、クライアントに、連邦情報処理標準 (FIPS) 140-1 暗号化アルゴリズムでは、Microsoft 暗号化モジュールを使用します。 詳細については、 [FIPS 140 検証](https://docs.microsoft.com/en-us/windows/security/threat-protection/fips-140-validation)を参照してください。
>  - **高**設定では、128 ビットの強力な暗号化を使用して、およびクライアント サーバーからサーバーをクライアントに送信されるデータを暗号化します。
>  - **互換性のあるクライアント**の設定は、クライアントとサーバーにクライアントでサポートされる最大のキーの強度の間で送信されるデータを暗号化します。
>  - **[低**] 設定では、クライアントから 56 ビットの暗号化を使用してサーバーに送信されるデータを暗号化します。

## ワイヤレス ネットワークからタイトルを切断リモート ラップトップ

この問題は、802.1 x ワイヤレス ネットワークを使用して、リモート デスクトップ クライアントがラップトップ コンピューターに接続するときに発生する可能性があります。 断続的に、ラップトップはワイヤレス ネットワークから切断し、自動的に再接続はありません。

これは、ワイヤレス ネットワーク接続のネットワーク認証の設定は、**ユーザー認証**ときに発生する既知の問題です。

この問題を回避するには、**ユーザーまたはコンピューターの認証**または**コンピューターの認証**にネットワーク認証の設定を設定します。

 > [!NOTE]  
> 1 台のコンピューターのネットワーク認証の設定を変更するには、ネットワークと共有センター コントロール パネルを使用して新しい設定で新しいワイヤレス接続を作成する必要があります。

Gpo を使用してワイヤレス ネットワークの設定を構成する方法の詳細については、[ワイヤレス ネットワークの構成 (IEEE 802.11) ポリシー](https://docs.microsoft.com/en-us/windows-server/networking/core-network-guide/cncg/wireless/e-wireless-access-deployment#bkmk_policies)を参照してください。

## ユーザー エクスペリエンスのパフォーマンスが低下したり、アプリケーションの問題

このセクションでは、ユーザーがリモート デスクトップの機能を使用するときに発生可能性のあるいくつかの一般的な問題を解決します。

  - [Microsoft Azure 断続的に新しい仮想マシンに接続しているユーザーの問題が発生](#intermittent-problems-with-new-microsoft-azure-virtual-machines)します。
  - [Windows 10 バージョン 1709 のリモート デスクトップに接続しているユーザーは、ビデオの再生に問題を必要があります](#video-playback-issues-on-windows-10-version-1709)。
  - [Windows 10 のリモート デスクトップに接続する読み取り専用のユーザー プロファイルを持つユーザーは、デスクトップを共有できません。](#desktop-sharing-issues-on-windows-10)
  - [NLA を無効にした場合、Windows 10 の以前のバージョンで実行するクライアントを使用して Windows 10 のリモート デスクトップに接続するユーザーのエクスペリエンスをパフォーマンスが低下](#performance-issues-when-mixing-versions-of-windows-10-if-nla-is-disabled)
  - [ユーザーは、リモート デスクトップ セッションで複数のアプリケーションを実行し、切断し、頻繁に再接続、黒の画面に再接続と共に、発生した可能性があります。](#black-screen-issue)

### 新しい Microsoft Azure virtual machines と断続的な問題

この問題は、最近プロビジョニングされている仮想マシンに影響します。 リモート デスクトップ セッションでは、すべてのユーザーの設定は読み込まれないことがユーザーは、仮想マシンに接続した後正しくします。

この問題を回避するには、仮想マシンから切断、20 分以上まで待機して、もう一度接続します。

この問題を解決するには、必要に応じて、仮想マシンに次の更新プログラムが適用されます。

  - Windows 10 および Windows Server 2016: KB 4343884、 [、2018 年 8 月 30日: KB4343884 (OS ビルド 14393.2457)](https://support.microsoft.com/en-us/help/4343884/windows-10-update-kb4343884)
  - Windows Server 2012 R2: KB 4343891、 [、2018 年 8 月 30日: KB4343891 (月次プログラムのロールアップのプレビュー)](https://support.microsoft.com/en-us/help/4343891/windows-81-update-kb4343891)

### Windows 10 バージョン 1709 でのビデオの再生の問題

この問題は、ユーザーが Windows 10 バージョン 1709 を実行しているリモート コンピューターに接続したときに発生します。 これらのユーザーにビデオ、VMR9 を使用してプレイするとき (ビデオ MixingRenderer9) コーデックでは、プレイヤーが黒ウィンドウのみを示しています。

これは、Windows 10 バージョン 1709 の既知の問題です。 この問題は、Windows 10 バージョン 1703 では発生しません。

### デスクトップの Windows 10 上の問題の共有

ユーザーがある読み取り専用のユーザー プロファイル (および関連するレジストリ ハイブ) など、キオスク シナリオではこの問題が発生します。 このようなユーザーが Windows 10、バージョン 1803 を実行しているリモート コンピューターに接続するときは、自分のデスクトップを共有できません。

この問題を解決する、4340917、Windows 10 更新プログラムを適用する[2018 年 7 月 24日-KB4340917 (OS ビルド 17134.191)](https://support.microsoft.com/en-us/help/4340917/windows-10-update-kb4340917)します。

### NLA を無効にした場合のバージョンの Windows 10 が混在する場合、パフォーマンスの問題

この問題は、NLA が無効になっているし、Windows 10 を実行しているリモート デスクトップ クライアント コンピューターは、異なるバージョンの Windows 10 を実行しているリモート デスクトップに接続するときに発生します。 パフォーマンスが低下は、Windows 10 バージョン 1709 または以前のバージョンを実行しているコンピューターでリモート デスクトップ クライアントのユーザーが Windows 10 バージョン 1803 またはそれ以降のバージョンを実行しているリモート デスクトップに接続するときに発生します。

これは、ため、Windows 10、バージョン 1803 またはそれ以降のバージョンに接続するときに、古いクライアント コンピューターが低速なプロトコルを使用して NLA を無効にした場合に発生します。

この問題を解決するには、適用 KB 4340917、 [2018 年 7 月 24日-KB4340917 (OS ビルド 17134.191)](https://support.microsoft.com/en-us/help/4340917/windows-10-update-kb4340917)します。

### 黒の画面の問題

Windows 8.0、Windows 8.1、Windows 10 RTM、および Windows Server 2012 R2 でこの問題が発生します。 ユーザーは、リモート デスクトップの場合は、複数のアプリケーションを起動し、セッションから切断します。 定期的に、ユーザーは、アプリケーションを操作し、もう一度切断するには、リモート デスクトップに再接続します。 ある時点で、ユーザーが再接続するとき、リモート デスクトップ セッションだけを示しています黒い画面。 ユーザーは、リモート コンピューターのコンソール (または RDSH サーバー コンソール) からリモート デスクトップ セッションを終了する必要があります。 このアクションは、アプリケーションを停止します。

この問題を解決するには、必要に応じて次の更新プログラムが適用されます。

  - Windows 8 および Windows Server 2012: KB4103719、 [2018 年 5 月 17 日: KB4103719 (月次プログラムのロールアップのプレビュー)](https://support.microsoft.com/en-us/help/4103719/windows-server-2012-update-kb4103719)
  - Windows 8.1 および Windows Server 2012 R2: KB4103724、 [2018 年 5 月 17 日: KB4103724 (月次プログラムのロールアップのプレビュー)](https://support.microsoft.com/en-us/help/4103724/windows-81-update-kb4103724)と KB 4284863、 [、2018 年 6 月 21日-KB4284863 (月次プログラムのロールアップのプレビュー)](https://support.microsoft.com/en-us/help/4284863/windows-81-update-kb4284863)
  - Windows 10: 固定 KB4284860、 [、2018 年 6 月 12日-KB4284860 (OS ビルド 10240.17889)](https://support.microsoft.com/en-us/help/4284860/windows-10-update-kb4284860)
