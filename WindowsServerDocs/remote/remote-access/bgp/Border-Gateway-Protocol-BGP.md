---
title: 境界ゲートウェイ プロトコル (BGP)
description: ボーダー ゲートウェイ プロトコル (BGP) で BGP がサポートされている展開トポロジ、BGP の特徴および機能を含む、Windows Server 2016 を理解するため、このトピックを使用できます。
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 78cc2ce3-a48e-45db-b402-e480b493fab1
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 655a7b02468db4246b85b495289806a3f9735a95
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/20/2019
ms.locfileid: "67282003"
---
# <a name="border-gateway-protocol-bgp"></a>境界ゲートウェイ プロトコル (BGP)

>適用先:Windows Server 2016 の Windows Server (半期チャネル)

このトピックを使用すると、BGP でサポートされている展開トポロジ、BGP の特徴、機能など、境界ゲートウェイ プロトコル (BGP) について理解することができます。  
  
> [!NOTE]  
> このトピックに加え、次の BGP ドキュメントは使用できます。  
>   
> -   [BGP Windows PowerShell コマンド リファレンス](../../remote-access/bgp/BGP-Windows-PowerShell-Command-Reference.md)  
  
このトピックは次のセクションで構成されます。  
  
-   [BGP でサポートされる展開トポロジ](#bkmk_top)  
  
-   [BGP の特徴](#bkmk_features)  
  
Windows Server 2016 リモート アクセス サービスに構成されている場合\(RAS\)マルチ テナント モードでゲートウェイは、ボーダー ゲートウェイ プロトコル (BGP) を提供するテナントの VM ネットワーク間のネットワーク トラフィックのルーティングを管理することができますそのリモート サイトを選択します。 RAS ゲートウェイ展開の 1 つのテナントでは、およびローカル エリア ネットワークとリモート アクセスを展開するときに、BGP を使用することもできます\(LAN\)ルーター。  
  
BGP を使用するとルーター上で手動でルートを構成する必要性が減ります。それは、BGP が動的ルーティング プロトコルであり、サイト間 VPN 接続を使用して接続されているサイト間のルートが自動的に学習されるためです。  
  
BGP ルーティングを使用してインストールする必要があります、**リモート アクセス サービス\(RAS\)** と**ルーティング**コンピューターまたは仮想マシンにリモート アクセス サーバーの役割の役割サービス\(VM\) -を使用するシステムの種類は、マルチ テナント展開のいるかどうかによって異なります。  
  
-   マルチ テナント展開では、1 つまたは複数の Vm には、RAS ゲートウェイをインストールすることをお勧めします。 複数の Vm の使用は、高可用性を提供します。 RAS ゲートウェイは、複数のテナントから複数の接続を処理できるし、HYPER-V ホストと、ゲートウェイとして実際に構成されている VM で構成されます。 このゲートウェイは、サイト対サイト VPN 接続を持つ exchange テナントとクラウド サービス プロバイダーをマルチ テナントの BGP ルーターとして構成されます\(CSP\)サブネット ルートです。  
  
-   1 つのテナントのエッジ ゲートウェイの展開または LAN ルーターの展開では、物理コンピューターまたは VM のいずれかで、RAS ゲートウェイをインストールできます。  
  
> [!IMPORTANT]  
> RAS ゲートウェイをインストールする場合を使用して、テナントごとに、BGP が有効になっているかどうかを指定する必要があります、 **Enable-remoteaccessroutingdomain**での Windows PowerShell コマンド、**型**のパラメーター値**すべて**します。 マルチ テナント機能を使用しない LAN の BGP 対応ルーターとしてリモート アクセスをインストールするには、コマンドを使用することができます**Install-remoteaccess VpnType RoutingOnly**します。  
>   
> 次のコード例は、RAS を RAS のすべての機能を使用して、マルチ テナント モードでインストールする方法を示しています (ポイント対サイト VPN、サイト対サイト VPN、および BGP ルーティング)、Contoso と Fabrikam の 2 つのテナントに対して有効にします。  
  
```  
$Contoso_RoutingDomain = "ContosoTenant"  
$Fabrikam_RoutingDomain = "FabrikamTenant"  
  
Install-RemoteAccess -MultiTenancy  
  
Enable-RemoteAccessRoutingDomain -Name $Contoso_RoutingDomain -Type All -PassThru  
Enable-RemoteAccessRoutingDomain -Name $Fabrikam_RoutingDomain -Type All -PassThru  
```  
  
## <a name="bkmk_top"></a>BGP でサポートされる展開トポロジ  
ここでは、エンタープライズ サイトがクラウド サービス プロバイダー (CSP) のデータセンターに接続されている、サポートされている展開トポロジを示します。  
  
すべてのシナリオでは、CSP ゲートウェイは、エッジで Windows Server 2016 RAS ゲートウェイです。 RAS ゲートウェイで、複数のテナントから複数の接続を処理できるは、HYPER-V ホストと、ゲートウェイとして実際に構成されている VM で構成されます。 このエッジ ゲートウェイは、エンタープライズおよび CSP サブネット ルートを交換するためのマルチテナントの BGP ルーターとして、サイト間 VPN 接続で構成されます。  
  
テナントは、サイト間 (S2S) VPN 接続を使用して、CSP データセンターのリソースに接続します。 さらに、エンタープライズ ゲートウェイと CSP ゲートウェイの間の動的なルーティング情報の交換のために BGP ルーティング プロトコルが展開されます。  
  
次の展開トポロジがサポートされます。  
  
-   [エンタープライズ サイトのエッジに BGP が配置の RAS VPN サイト間ゲートウェイ](#bkmk_top1)  
  
-   [エンタープライズ サイトのエッジに BGP を使用してサード パーティ製 Gateway](#bkmk_top2)  
  
-   [サード パーティ製のゲートウェイを使用した複数のエンタープライズ サイト](#bkmk_top3)  
  
-   [BGP と VPN とで異なる終端点](#bkmk_top4)  
  
以降のセクションでは、サポートされているそれぞれの BGP トポロジに関する追加の情報を示します。  
  
### <a name="bkmk_top1"></a>エンタープライズ サイトのエッジに BGP が配置の RAS VPN サイト間ゲートウェイ  
このトポロジは、CSP に接続されているエンタープライズ サイトを表しています。 Windows Server 2016 の RAS ゲートウェイが CSP、およびエッジ ファイアウォール デバイスの VPN サイト対サイト接続用に構成された、エンタープライズのルーティング トポロジには、内部ルーターが含まれます。 RAS ゲートウェイは、S2S VPN 接続と BGP 接続を終了します。  
  
![サイト対サイトの RAS の VPN ゲートウェイ](../../media/Border-Gateway-Protocol-BGP/bgp_01.jpg)  
  
両方のサイトは、別個の自律システム (AS) の BGP 対応ルーター間で情報を転送できる外部境界ゲートウェイ プロトコル (eBGP) を使用して接続されています。 そのためには、BGP プロトコルに不可欠なパラメーターである識別可能な自律システム番号 (ASN) をエンタープライズと CSP の両方が持っている必要があります。  
  
このシナリオでは、BGP は次のように動作します。  
  
-   エンタープライズ サイトのエッジ デバイスは、BGP を使用してクラウドでホストされている仮想化されたサブネット ルート (10.2.1.0/24) を学習します。 このデバイスでは、CSP RAS マルチ テナント ゲートウェイに、オンプレミス サブネット ルート (10.1.1.0/24) もアドバタイズします。  
  
-   顧客のエッジ ルーターは、次のいずれかの方法で、内部設置型の内部ルートを学習します。  
  
    -   エッジ デバイスは、内部ルーターで BGP を実行して、内部ルートを学習します (この例では、10.1.1.0/24)。 その一方で、エッジ デバイスから外部ルート (10.2.1.0/24 など) を学習した内部ルーターは、Open Shortest Path First (OSPF)、ルーティング情報プロトコル (RIP) などの内部ゲートウェイ プロトコル (IGP) を使用して、他の内部設置型のルーターに対してこれらのルートを配布する必要があります。  
  
    -   エッジ デバイスでは、静的ルートまたはインターフェイスを構成して、BGP を使用してアドバタイズするルートを選択できます。 さらに、エッジ デバイスは、IGP を使用して外部ルートを他の内部設置型ルーターに配布します。  
  
### <a name="bkmk_top2"></a>エンタープライズ サイトのエッジに BGP を使用してサード パーティ製 Gateway  
このトポロジは、サード パーティ製のエッジ ルーターを使用して CSP に接続するエンタープライズ サイトを表しています。 エッジ ルーターは、サイト間 VPN ゲートウェイとしても機能します。  
  
![エンタープライズ サイトのエッジに BGP が配置されたサード パーティのゲートウェイ](../../media/Border-Gateway-Protocol-BGP/bgp_02.jpg)  
  
エッジ ルーターは、次のいずれかの方法で、内部設置型の内部ルートを学習します。  
  
-   エッジ デバイスは、内部ルーターで BGP を実行して、内部ルートを学習します (このケースでは、10.1.1.0/24)。  
  
-   エッジ デバイスは、内部ゲートウェイ プロトコル (IGP) を実装し、内部ルーティングに直接参加します。  
  
### <a name="bkmk_top3"></a>CSP に接続する複数のエンタープライズ サイトのクラウド データ センター  
このトポロジは、サード パーティ製のゲートウェイを使用して CSP に接続する複数のエンタープライズ サイトを表しています。 サード パーティ製のエッジ デバイスは、サイト間 VPN ゲートウェイと BGP ルーターとして機能します。  
  
![CSP に接続する複数のエンタープライズ サイトのクラウド データ センター](../../media/Border-Gateway-Protocol-BGP/bgp_03.jpg)  
  
顧客のエッジ ルーターは、次のいずれかの方法で、内部設置型の内部ルートを学習します。  
  
-   エッジ デバイスは、内部ルーターで BGP を実行して、内部ルートを学習します (このケースでは、10.1.1.0/24)。  
  
-   エッジ デバイスは、内部ゲートウェイ プロトコル (IGP) を実装し、内部ルーティングに直接参加します。  
  
それぞれのエンタープライズ サイトは、直接 eBGP 接続を介して他のサイトからルートを学習します。  
  
それぞれのエンタープライズ サイトは、ホストされているネットワーク ルートを直接的に学習すると共に他のエンタープライズ サイトを使用して学習したうえで、ルートのコストに基づいて最適なルートを選択します。  
  
エンタープライズ サイト 1 の BGP ルーターがエンタープライズ サイト 2 の BGP ルーターに接続できないのは、接続が失敗したため、サイト 1 の BGP ルーターは、CSP の BGP ルーターからサイト 2 のエンタープライズ ネットワークにルートを学習する動的に開始され、トラフィックがシームレスにはCSP での Windows サーバーの BGP ルーターを使用してサイト 2 に、サイト 1 からルーティングされます。  
  
### <a name="bkmk_top4"></a>BGP と VPN とで異なる終端点  
このトポロジは、2 つの異なるルーターを BGP のエンドポイントとサイト間 VPN のエンドポイントとして使用するエンタープライズを表しています。 内部ルーターで BGP が終了したときに、サイト対サイト VPN は Windows Server 2016 の RAS ゲートウェイで終了します。 接続の CSP 側では、CSP は、RAS ゲートウェイと VPN と BGP の両方の接続を終了します。 この構成では、内部のサード パーティ製のルーター ハードウェアは、IGP への BGP ルートの再配布だけでなく、BGP への IGP ルートの再配布をサポートする必要があります。  
  
![BGP と VPN とで異なる終端点](../../media/Border-Gateway-Protocol-BGP/bgp_04.jpg)  
  
内部のルーターは、次のいずれかの方法で、エンタープライズのルートを学習します。  
  
-   BGP  
  
-   OSPF、RIP などの内部ゲートウェイ プロトコル (IGP)  
  
-   静的なルート構成  
  
エンタープライズ サイトで IGP を使用する場合、内部ルーターは、CSP の仮想ネットワークとローカル エンタープライズ サブネットの間のサブネット接続を維持するために、BGP ルートを IGP ルートに再配布すると共に、IGP ルートを BGP に再配布する必要があります。  
  
この展開では、エンタープライズの RAS ゲートウェイが CSP ゲートウェイへのルートをエンタープライズの RAS ゲートウェイを提供する CSP の RAS ゲートウェイを使用してサイト対サイト VPN 接続。 エンタープライズの内部ルーターは、iBGP をエンタープライズの RAS ゲートウェイを使用して、CSP ゲートウェイへのこのルートを学習します。 このため、エンタープライズの内部ルーターは、CSP RAS ゲートウェイの BGP ルーターとピアリング セッションを確立することはします。  
  
これ以降は、エンタープライズの内部ルーターと CSP の RAS ゲートウェイは、ルーティング情報を交換します。 エンタープライズ RAS BGP ルーターは、CSP ルートとネットワーク間でパケットを物理的にルーティングするエンタープライズのルートを学習します。  
  
## <a name="bkmk_features"></a>BGP の特徴  
RAS ゲートウェイの BGP ルーターの機能を次に示します。  
  
**リモート アクセスの役割サービスとの BGP ルーティング**します。 今すぐインストールすることができます、**ルーティング**インストールしなくてもリモート アクセス サーバーの役割の役割サービス、**リモート アクセス サービス (RAS)** BGP LAN ルーターとしてリモート アクセスを使用するときに、役割サービスです。  これは、BGP ルーターのメモリ フット プリントを縮小し、のみ動的 BGP ルーティングに必要なコンポーネントをインストールします。 ルーティングの役割サービスはだけで BGP ルーターの VM が必要であり、DirectAccess または VPN の使用を必要としない場合に役立ちます。 さらに、BGP の使用の LAN ルーターとしてリモート アクセスを使用して提供するには、内部ネットワーク上の BGP の動的ルーティング利点。  
  
**BGP 統計情報 (メッセージ カウンター、ルート カウンター)** 。 BGP ルーターは、必要に応じて、 **Get-BgpStatistics** Windows PowerShell コマンドを使用したメッセージおよびルートの統計情報の表示をサポートします。  
  
**等コスト マルチ パス ルーティング (ECMP) のサポート**。 BGP ルーターは ECMP をサポートし、複数の等コスト ルートを BGP ルーティング テーブルおよびスタックに追加できます。 ECMP が有効な場合、BGP ルーターは、データ パケットを送信するためのルートをランダムに選択します。  
  
**HoldTime 構成**。 BGP ルーターは、ネットワーク要件に従った HoldTimer 値の構成をサポートします。 このタイマーは、サード パーティ製のデバイスとの相互運用性を実現するため、または BGP ピアリング セッション タイムアウトの特定の最大時間を保持するために、動的に変更できます。  
  
**内部 BGP と外部 BGP のサポート**。 BGP ルーターでは、iBGP ピアリングと eBGP ピアリングの両方がサポートされます。 これらのピアリングを構成するには、適切な ASN がローカルおよびリモートの BGP ルーターに割り当てられていることを確認する必要があります。 4 つの BGP 展開トポロジのすべてにおいて eBGP ピアリングが使用され、4 番目のトポロジでは iBGP ピアリングも使用されます。  
  
**サード パーティのソリューションとの相互運用**。 BGP ルーターは、最新の BGP バージョン 4 仕様に基づき、主要なサード パーティのほとんどの BGP ルーティング デバイスとの間の相互運用性がテストされています。 詳細については、Request for Comments (RFC) 4271 の [境界ゲートウェイ プロトコル 4 (BGP-4)](https://tools.ietf.org/html/rfc4271)に関するページを参照してください。  
  
**IPv4 と IPv6 のトランスポート ピアリングのサポート**。 BGP ルーターでは、IPv4 ピアリングと IPv6 ピアリングの両方がサポートされます。 ただし、BGP の識別子を BGP ルーターの IPv4 アドレスとして構成する必要があります。 すべての BGP ルーター展開トポロジにおいて、この 2 種類のピアリング (IPV4、IPv6) のどちらかを使用できます。  
  
**IPv4 と IPv6 のユニキャスト ルート学習およびアドバタイズ機能 (マルチプロトコル ネットワーク層到達可能性情報 [NLRI])** 。 セッションを確立するときに適切な機能が他の BGP ルーターにアナウンスされる場合、BGP ルーターは、どのトランスポートを使用するかに関係なく、IPv4 ルートと IPv6 ルートを交換できます。 IPv6 ルーティングを構成するには、IPv6Routing パラメーターを有効にしたうえで、ルーター レベルでローカルなグローバル IPv6 アドレスを構成する必要があります。  
  
**混合モードとパッシブ モードのピアリング**。 BGP ルーターはイニシエーターとレスポンダーの両方として機能しますここでは、混合モードまたはパッシブ モード、場所、BGP ルーター ピアリングを開始せずで BGP ピアリング セッションを構成できますが受信要求に応答します。 混合モードは既定の設定であり、BGP ピアリングに推奨されます。 これは、デバッグや診断の目的でパッシブ モードを使用する場合を除いて当てはまります。 すべての BGP ルーター展開トポロジにおいて、障害イベントが発生した場合に備えて自動再起動を有効にするために混合モード ピアリングが必要になります。  
  
**ルート属性の書き直し機能**。 Next-Hop、MED、Local-Pref、Community の各 BGP ルーティング ポリシーを使用して、BGP ルーターの受信および送信ルート アドバタイズの次の属性を追加、変更、または削除できます。  
  
**ルート フィルター**。 BGP ルーターは、Prefix、ASN-Range、Community、Next-Hop などの複数のルート属性に基づく受信または送信ルート アドバタイズのフィルター処理をサポートしています。  
  
**ルートリフレクター (RR) と RR クライアント**します。 BGP ルーターは、ルート Reflector および RR クライアントとして動作できます。 RR がネットワークを簡略化、RR クラスターを形成している複雑なトポロジに便利です。  
  
**Route-Refresh のサポート**。 BGP ルーターは、Route-Refresh をサポートし、ピアリング時に既定でこの機能をアドバタイズします。 ピアのルーティング ポリシーの変更などのイベントでは、そのルーティング テーブルを更新する Route-refresh を送信するだけでなく、ルートの更新 - route-refresh メッセージを介してピアから要求されたときの新しいセットを送信することはできます。 これにより、シナリオの変更や、ピアリングを再起動しなくても Windows Server 2016 での BGP ルーティング ポリシーを更新できます。  
  
**静的なルート構成のサポート**。 **Add-BgpCustomRoute** Windows PowerShell コマンドを使用して、BGP ルーター上で静的なルートまたはインターフェイスを構成できます。 構成する静的ルートにはプレフィックスまたはインターフェイスの名前を使用でき、ここからルートが選択されます。 ただし、解決可能な次ホップを持つルートのみが BGP ルーティング テーブルに追加され、ピアにアドバタイズされます。  
  
**トランジット ルーティングのサポート**。 BGP ルーターは、iBGP 接続へ、ibgp から eBGP へと eBGP へ eBGP トランジット ルーティングをサポートしています。  
  
**ルーティング Flap ダンプ**します。 Windows Server 2016 での BGP ルーティングするためにルート Flap ダンプは、ルート flap ダンプのサポートを提供します。 などとルートが常に提供されてし、取り下げられて、不安定な場合は、ルーティング テーブルを作成することができます、ダンペング重みをルートに割り当てとフラップ - を監視し、それに応じてを抑制する BGP ルーターまたは構成解除-必要に応じてこれを抑制します。 これにより、安定したルーティング テーブルの保守と BGP ルーターで処理できます。  
  
**集計ルート**します。 BGP ルーターにルートの集計には、集約ルートを構成しより詳細なルートのアドバタイズをピアに要約または集計のルートに置き換える機能を提供します。 これは、結果より少ないルート通知メッセージの数が、ネットワーク上に転送します。  
  
> [!NOTE]  
> System Center、RAS ゲートウェイは Windows Server ゲートウェイと呼ばれます。  
  

  

