---
title: Web アプリケーション プロキシのトラブルシューティング
description: ''
author: kgremban
manager: femila
ms.date: 07/13/2016
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: a2fef55d-747b-4e20-8f21-5f8807e7ef87
ms.technology: web-app-proxy
ms.openlocfilehash: c63dbc415765cbe60bfbde7bf180f3dd967d6ab8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59841583"
---
# <a name="troubleshooting-web-application-proxy"></a>Web アプリケーション プロキシのトラブルシューティング

>適用先:Windows Server 2016

**このコンテンツは、Web アプリケーション プロキシのオンプレミス バージョンに関連します。クラウドでオンプレミス アプリケーションに安全にアクセスを有効にするのを参照してください。、 [Azure AD アプリケーション プロキシのコンテンツ](https://azure.microsoft.com/documentation/articles/active-directory-application-proxy-get-started/)します。**  
  
ここでは、イベントの説明と解決策を含む Web アプリケーション プロキシのトラブルシューティングの手順を説明します。 3 つの場所のエラーが表示されます。  
  
-   Web アプリケーション プロキシの管理者コンソール  
  
    Windows イベント ビューアーと対応する説明で管理者コンソールに表示される各イベント ID を表示することや、ソリューションが以下が見つかりました。  
  
    イベント ビューアーを開き、Web アプリケーション プロキシに関連するイベントを探して**Applications and Services Logs** > **Microsoft** > **Windows**  >  **Web アプリケーション プロキシ** > **管理者**  
  
    ![](media/Troubleshooting-Web-Application-Proxy/WebApplicationProxyTroubleshooting.png)  
  
    必要に応じて、詳細なログを分析およびデバッグ ログを使用するし、Windows イベント ビューアーで見つかった、Web アプリケーション プロキシのセッション ログの有効化 \ Microsoft \ Windows \ Web アプリケーション プロキシ \ 管理者  
  
-   PowerShell のエラー  
  
    PowerShell では、構成中に発生する問題のイベントが表示されます。  
  
    標準の PowerShell エラー プロンプトを使用してユーザーを PowerShell には、すべてのエラーが表示されます。 すべての PowerShell コマンドは、イベントとして記録されます。 PowerShell で発生するすべてのイベントでは、12016、ID 番号を持つ Windows イベント ビューアーに表示されているされ、PowerShell に関するセクションの下に定義されます。  
  
-   で、ベスト プラクティス アナライザー  
  
    これらのイベントが記載されて、 [Web アプリケーション プロキシのベスト プラクティス アナライザー](assetId:///995f5cea-e334-4ce6-a14c-6a2d03c0c79a)  
  
## <a name="powershell-messages"></a>PowerShell のメッセージ  
  
|イベントまたは現象|考えられる原因|解決方法|  
|--------------------|------------------|--------------|  
|証明書を信頼 ("ADFS ProxyTrust - <WAP machine name>") が無効です|これは、次のうちのいずれかが原因と考えられます。<br /><br />アプリケーション プロキシ コンピューターを長時間停止していました。<br />-Web アプリケーション プロキシと AD FS の間の切断<br />証明書インフラストラクチャの問題<br />の 8 時間ごとに、計画どおりに、AD FS マシンまたは Web アプリケーション プロキシと AD FS の間の更新処理で変更は実行されませんでしたし、信頼を更新する必要があります。<br />-Web アプリケーション プロキシ コンピューターおよび AD FS の時計が同期されていません。|時計が同期を確認します。 Install-webapplicationproxy コマンドレットを実行します。|  
|AD fs 構成データが見つかりませんでした。|Web アプリケーション プロキシがまだまたは AD FS データベースまたはデータベースの破損での変更によって完全にインストールしない可能性があります。|Install-webapplicationproxy コマンドレットを実行します。|  
|Web アプリケーション プロキシ AD FS から構成を読み取るしようとしたときにエラーが発生しました。|AD FS にアクセスできないことか、AD FS では、AD FS データベースから構成を読み取ろうとして内部の問題が発生した可能性があります。|AD FS が動作し、到達可能なあることを確認します。|  
|AD FS に格納されている構成データが破損しているか、Web アプリケーション プロキシは、それを解析できませんでした。<br /><br />または<br /><br />Web アプリケーションの Proxywas AD FS から証明書利用者の一覧を取得できません。|これは、AD fs 構成データが変更された場合に発生します。|Web アプリケーションの Proxyservice を再起動します。 問題が解決しない場合は、Install-webapplicationproxy コマンドレットを実行します。|  
  
## <a name="administrator-console-events"></a>管理者コンソールのイベント  
管理者コンソールの次のイベントは、一般に、認証エラー、無効なユーザ用のトークンを示しています。 または cookie の有効期限が切れました。  
  
|イベントまたは現象|考えられる原因|解決方法|  
|--------------------|------------------|--------------|  
|11005<br /><br />Web アプリケーション プロキシは、構成からシークレットを使用してクッキーの暗号化キーを作成できませんでした。|グローバル構成"AccessCookiesEncryptionKey"パラメーターは、PowerShell コマンドで変更されました。Set-WebApplicationProxyConfiguration -RegenerateAccessCookiesEncryptionKey|アクションは必要ありません。 問題のある cookie は削除され、ユーザーが認証を STS にリダイレクトされました。|  
|12000<br /><br />少なくとも 60 分間、web アプリケーション プロキシは構成の変更を確認できませんでした。|Web アプリケーション プロキシは、コマンド Get-WebApplicationProxyConfiguration/アプリケーションを使用して Web アプリケーション プロキシの構成にアクセスできません。 これは通常、AD FS との接続の欠如または AD FS との信頼関係を更新する必要が発生します。|AD FS との接続を確認します。 AD FS と Web アプリケーション プロキシの間に確立された信頼があることを確認してリンク https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake を使用してこれが実行できます。 これらのソリューションが機能しない場合は、Install-webapplicationproxy コマンドレットを実行します。|  
|12003<br /><br />Web アプリケーション プロキシは、アクセスの cookie を解析できませんでした。|Web アプリケーション プロキシと AD FS が接続されていないこと、または同じの構成を受信しない可能性があります。|AD FS との接続を確認します。 AD FS と Web アプリケーション プロキシの間に確立された信頼があることを確認してリンク https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake を使用してこれが実行できます。 これらのソリューションが機能しない場合は、Install-webapplicationproxy コマンドレットを実行します。|  
|12004<br /><br />Web アプリケーション プロキシは、アクセスの無効な cookie で要求を受信しました。|このイベントは、Web アプリケーション プロキシと AD FS が接続されていないこと、または同じの構成を受信しない可能性があります。<br /><br />"AccessCookiesEncryptionKey"パラメーターを実行した場合は chaged Set-webapplicationproxyconfiguration-RegenerateAccessCookiesEncryptionKey の PowerShell コマンド、によってこのイベントは正常と解決手順は必要ありません。|AD FS との接続を確認します。 AD FS と Web アプリケーション プロキシの間に確立された信頼があることを確認してリンク https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake を使用してこれが実行できます。 これらのソリューションが機能しない場合は、Install-webapplicationproxy コマンドレットを実行します。|  
|12008<br /><br />Web アプリケーション プロキシでは、バックエンド サーバーに許可されている Kerberos 認証の試行の最大数を超えています。|このイベントは、Web アプリケーション プロキシとバックエンド アプリケーション サーバー、または両方のマシンでの日付と時刻の構成の問題の間の不適切な構成を示している可能性があります。|バックエンド サーバーは、Web アプリケーション プロキシによって作成された Kerberos チケットを拒否します。 Web アプリケーション プロキシとバックエンド アプリケーション サーバーの構成が正しく構成されていることを確認します。<br /><br />Web アプリケーション プロキシとバックエンド アプリケーション サーバーの日付と時刻の構成が同期されていることを確認します。|  
|12011<br /><br />Web アプリケーション プロキシは、有効でないアクセス cookie の署名要求を受信しました。|このイベントは、Web アプリケーション プロキシと AD FS が接続されていないこと、または同じの構成を受信しない可能性があります。 "AccessCookiesEncryptionKey"パラメーターを実行した場合は chaged Set-webapplicationproxyconfiguration-RegenerateAccessCookiesEncryptionKey の PowerShell コマンド、によってこのイベントは正常と解決手順は必要ありません。|AD FS との接続を確認します。 AD FS と Web アプリケーション プロキシの間に確立された信頼があることを確認してリンク https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake を使用してこれが実行できます。 これらのソリューションが機能しない場合は、Install-webapplicationproxy コマンドレットを実行します。|  
|12027<br /><br />プロキシでは、要求の処理中に予期しないエラーが発生しました。 指定された名前が正しい形式のアカウント名ではありません。|このイベントは、Web アプリケーション プロキシとドメイン コント ローラー サーバー、または両方のマシンでの日付と時刻の構成の問題の間の不適切な構成を示している可能性があります。|ドメイン コント ローラーは、Web アプリケーション プロキシによって作成された Kerberos チケットを拒否します。 Web アプリケーション プロキシとバックエンド アプリケーション サーバーの構成を特に SPN の構成が正しく構成されています。 Web アプリケーション プロキシがドメインに参加しているドメイン コント ローラーが確認して Web アプリケーション Proxy.Make と信頼関係を確立することを確認するドメイン コント ローラーと同じドメインを確認して、Web アプリケーション プロキシの日付と時刻の構成と、ドメイン コント ローラーが同期されます。|  
|13012<br /><br />Web アプリケーション プロキシが無効なエッジ トークンの署名を受信しました||Web アプリケーション プロキシを更新することを確認[KB 2955164](https://go.microsoft.com/fwlink/?LinkId=400701)します。|  
|13013<br /><br />Web アプリケーション プロキシは、有効期限が切れたエッジ トークンを含む要求を受信しました。|Web アプリケーション プロキシと AD FS は、クロックを同期させることはありません。|Web アプリケーション プロキシと AD FS の間のクロックを同期します。|  
|13014<br /><br />Web アプリケーション プロキシは、無効なエッジ トークンを使用して要求を受信しました。 解析されないために、トークンが無効です。|AD FS の構成に問題がある可能性があります。|AD FS の構成を確認し、必要に応じて、既定の構成を復元します。|  
|13015<br /><br />Web アプリケーション プロキシが有効期限が切れたアクセス cookie で要求を受信しました。|クロックが同期されていない可能性があります。|Web アプリケーション プロキシのマシンのクラスターを使用する場合は、コンピューターの日付と時刻が同期されていることを確認します。|  
|13016<br /><br />Web アプリケーション プロキシは、エッジ トークンまたはアクセス cookie、UPN がないため、ユーザーに代わって Kerberos チケットを取得できません。|STS 構成に問題があります。|STS の UPN 要求の構成を修正します。|  
|13019<br /><br />Web アプリケーション プロキシは、次の一般 API エラーのため、ユーザーに代わって Kerberos チケットを取得できません。|このイベントは、Web アプリケーション プロキシとドメイン コント ローラー サーバー、または両方のマシンでの日付と時刻の構成の問題の間の不適切な構成を示している可能性があります。|ドメイン コント ローラーは、Web アプリケーション プロキシによって作成された Kerberos チケットを拒否します。 Web アプリケーション プロキシとバックエンド アプリケーション サーバーの構成を特に SPN の構成が正しく構成されています。 Web アプリケーション プロキシがドメインに参加しているドメイン コント ローラーが確認して Web アプリケーション Proxy.Make と信頼関係を確立することを確認するドメイン コント ローラーと同じドメインを確認して、Web アプリケーション プロキシの日付と時刻の構成と、ドメイン コント ローラーが同期されます。|  
|13020<br /><br />Web アプリケーション プロキシは、バックエンド サーバー SPN が定義されていないため、ユーザーに代わって Kerberos チケットを取得できません。|このイベントは、Web アプリケーション プロキシとドメイン コント ローラー サーバー、または両方のマシンでの日付と時刻の構成の問題の間の不適切な構成を示している可能性があります。|ドメイン コント ローラーは、Web アプリケーション プロキシによって作成された Kerberos チケットを拒否します。 Web アプリケーション プロキシとバックエンド アプリケーション サーバーの構成を特に SPN の構成が正しく構成されています。 Web アプリケーション プロキシがドメインに参加しているドメイン コント ローラーが確認して Web アプリケーション Proxy.Make と信頼関係を確立することを確認するドメイン コント ローラーと同じドメインを確認して、Web アプリケーション プロキシの日付と時刻の構成と、ドメイン コント ローラーが同期されます。|  
|13022<br /><br />Web アプリケーション プロキシは、バックエンド サーバーが Kerberos 認証の試行、HTTP 401 エラーに応答するためにユーザーを認証できません。|このイベントは、Web アプリケーション プロキシとバックエンド アプリケーション サーバー、または両方のマシンでの日付と時刻の構成の問題の間の不適切な構成を示している可能性があります。|バックエンド サーバーは、Web アプリケーション プロキシによって作成された Kerberos チケットを拒否します。 Web アプリケーション プロキシとバックエンド アプリケーション サーバーの構成が正しく構成されていることを確認します。Web アプリケーション プロキシとバックエンド アプリケーション サーバーの日付と時刻の構成が同期されていることを確認します。|  
|13025<br /><br />クライアントで、Web アプリケーション プロキシを SSL 証明書がありませんでした。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。 Web アプリケーション プロキシ用に構成された拇印が正しいことを確認します。|  
|13026<br /><br />クライアント Web アプリケーション プロキシとの SSL 証明書の表示が、証明書が無効です。 証明書が拇印と一致しません。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。 Web アプリケーション プロキシ用に構成された拇印が正しいことを確認します。|  
|13028<br /><br />Web アプリケーション プロキシは、有効になっていませんが、エッジ トークンを含む要求を受信しました。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。|  
|13030<br /><br />クライアント Web アプリケーション プロキシとの SSL 証明書の表示が、信頼プロバイダーは、クライアント証明書を発行した証明機関を信頼しません。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。 Web アプリケーション プロキシ用に構成された拇印が正しいことを確認します。|  
|13031<br /><br />クライアント Web アプリケーション プロキシとの SSL 証明書の表示が、証明書チェーンは信頼プロバイダーから信頼されていないルート証明書で終了します。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。 Web アプリケーション プロキシ用に構成された拇印が正しいことを確認します。|  
|13032<br /><br />クライアントは、Web アプリケーション プロキシに SSL 証明書を提示しますが、証明書が要求の使用法に対して無効です。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。 Web アプリケーション プロキシ用に構成された拇印が正しいことを確認します。|  
|13033<br /><br />クライアント Web アプリケーション プロキシとの SSL 証明書の表示が、証明書がその有効期間内にありません、現在のシステム クロックまたは署名付きのファイルのタイムスタンプで確認するとします。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。 Web アプリケーション プロキシ用に構成された拇印が正しいことを確認します。|  
|13034<br /><br />クライアントは、Web アプリケーション プロキシに SSL 証明書を提示しますが、証明書が無効です。|このイベントは、日付と時刻の構成問題を示している可能性があります。|証明書インフラストラクチャが有効であると、Web アプリケーション プロキシと AD FS の日付と時刻が同期されていることを確認してください。 Web アプリケーション プロキシ用に構成された拇印が正しいことを確認します。|  
  
次の管理者コンソールのイベントは通常のプロビジョニング、要求が失敗することをバックエンド サーバーは到達できないなどの構成に関連する問題を示していますし、バッファー オーバーフローが発生します。  
  
|イベントまたは現象|考えられる原因|解決方法|  
|--------------------|------------------|--------------|  
|12019<br /><br />Web アプリケーション プロキシは、次の URL 用のリスナーを作成できませんでした。|イベントの考えられる原因は、同じ URL に別のサービスがリッスンしていることです。|管理者は、だれがリッスンまたは同じ Url にバインドすることを確認ください。 これを確認するには、コマンドを実行します。 netsh http show urlacl します。 この URL を Web アプリケーション プロキシ コンピューターで実行されている別のコンポーネントで使用する場合は、それを削除または別の URL を使用して Web アプリケーション プロキシ経由のアプリケーションを公開します。|  
|12020<br /><br />Web アプリケーション プロキシは、次の url 予約を作成できませんでした。|イベントの考えられる原因は、別のサービスにある同じ URL を予約します。|管理者は、同じ Url にバインドできないことを確認してください。 これを確認するには、コマンドを実行します。 netsh http show urlacl します。 この URL を Web アプリケーション プロキシ コンピューターで実行されている別のコンポーネントで使用する場合は、それを削除または別の URL を使用して Web アプリケーション プロキシ経由のアプリケーションを公開します。|  
|12021<br /><br />Web アプリケーション プロキシは、SSL サーバー証明書をバインドできませんでした。 その他のすべての構成設定が適用されました。|作成し、SSL 証明書のデータの構成レコードを設定できません。|Web アプリケーション Proxyapplications が構成されている証明書の拇印は、ローカル コンピュータ ストアに秘密キーを持つすべての Web アプリケーション プロキシ コンピューターにインストールされていることを確認します。|  
|13001<br /><br />Web アプリケーション プロキシをバックエンド サーバーによって提示される SSL サーバー証明書が無効です。証明書は信頼されていません。|サーバーによって送信された Secure Sockets Layer (SSL) 証明書では、1 つまたは複数のエラーが見つかりました。 バックエンド サーバーに無効な SSL が提供されること、または Web アプリケーション プロキシとバックエンド サーバー間の信頼がない可能性があります。|バックエンド サーバーの SSL 証明書を検証します。 適切なルート Ca をバックエンド サーバーの証明書を信頼すると、Web アプリケーション プロキシ コンピューターが構成されていることを確認します。|  
|13006|エラー コードは、0x80072ee7、ときに、failurrre バックエンド サーバーの URL を解決できない原因です。 その他のエラー コードが記載されています [https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85)](https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85))|バックエンド サーバーの URL が正しいことと、その名前が、その Web アプリケーション プロキシ コンピューターから正しく解決できることを確認します。|  
|13007<br /><br />予定期間内で、バックエンド サーバーからの HTTP 応答を受信しませんでした。|バック エンド サーバーの要求タイムアウトしたかが低速か応答しません。|バックエンド サーバーの構成を確認します。 非常に遅い場合は、バックエンド サーバーへの接続を確認し、InactiveTransactionsTimeoutSec の Web アプリケーション プロキシのグローバル構成パラメーター コマンドレットを変更しても検討します。|  
  
## <a name="see-also"></a>関連項目  
[新機能 Windows Server 2016 での Web アプリケーション プロキシの新機能](web-application-proxy-windows-server.md)  
[Web アプリケーション プロキシの操作](assetId:///b607b717-2172-4271-98d1-fa8162e0bb2e)  
  


