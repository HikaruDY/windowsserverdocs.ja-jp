---
title: 手順 2 APP1 を構成します。
description: このトピックでは、OTP 認証と Windows Server 2016 で RSA SecurID を使用した DirectAccess のデモンストレーションのテスト ラボ ガイドの一部
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology:
- networking-da
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 19a7a4a6-9a04-42ea-a5d0-ecb28a34dbaa
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 612d3f4e9be71f60811b4499d9bdb8ae3bd217e8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2019
ms.locfileid: "59847493"
---
# <a name="step-2-configure-app1"></a>手順 2 APP1 を構成します。

>適用先:Windows Server 2016 の Windows Server (半期チャネル)

OTP のサポートの APP1 を準備するのにには、次の手順を使用します。  
  
1. 作成し、OTP 証明書の要求の署名に使用される証明書テンプレートをデプロイします。 OTP 証明書の要求の署名に使用される証明書テンプレートを構成します。  
  
2. 作成し、社内の CA によって発行された OTP 証明書の証明書テンプレートをデプロイします。 OTP 証明書が社内の CA によって発行された証明書テンプレートを構成します。  
  
> [!WARNING]  
> このテスト ラボ ガイドの設計には、インフラストラクチャ サーバー、ドメイン コント ローラーと Windows Server 2012 R2 または Windows Server 2012 のいずれかを実行している証明機関 (CA) などが含まれています。 このテスト ラボ ガイドを使用して、他のオペレーティング システムを実行しているインフラストラクチャ サーバーを構成するがテストされていない、および他のオペレーティング システムを構成する手順については、このガイドには含まれません。  
  
## <a name="DAOTPRA"></a>作成して OTP 証明書の要求の署名に使用される証明書テンプレートをデプロイするには  
  
1.  実行**certtmpl.msc**、し、ENTER キーを押します。  
  
2.  証明書テンプレート コンソールの詳細ペインで右クリックし、**コンピューター**テンプレート、およびクリック**テンプレートの複製**します。  
  
3.  **新しいテンプレートのプロパティ** ダイアログ ボックスの 、**互換性** タブで、**証明機関**一覧で、オペレーティング システムを選択し、で**結果として得られる変更** ダイアログ ボックスをクリックして**OK**します。 **証明書の受信者**リストがオペレーティング システムを選択し、**結果的な変更** ダイアログ ボックスをクリックして**ok**します。  
  
4.  **新しいテンプレートのプロパティ**ダイアログ ボックスで、をクリックして、**全般**タブ。  
  
5.  **全般**] タブの [**テンプレート表示名**、型**DAOTPRA**します。 設定、**有効期間**を設定し、2 日間、**更新期間**1 日にします。 場合、**証明書テンプレート**警告が表示されたら、クリックして**OK**します。  
  
6.  **[セキュリティ]** タブをクリックし、**[追加]** をクリックします。  
  
7.  **ユーザー、コンピューター、サービス アカウント、またはグループ**ダイアログ ボックスで、をクリックして**オブジェクトの種類**します。 **オブジェクトの種類**ダイアログ ボックスで、**コンピューター**、順にクリックします**OK**します。 **選択するオブジェクト名を入力**ボックスに「 **EDGE1**、 をクリックして**ok**し、**許可**列で選択、**読み取り**、**登録**、および**自動登録**チェック ボックス。 をクリックして**Authenticated Users**を選択します、**読み取り**下のチェック ボックス、**許可**列、およびその他のすべてのチェック ボックスをオフにします。 クリックして**ドメイン コンピューター**、オフにします**登録**下、**許可**列。 クリックして**Domain Admins**と**Enterprise Admins**  をクリック**フル コントロール**下、**許可**両方の列。 **[適用]** をクリックします。  
  
8.  をクリックして、**サブジェクト名**タブをクリックし、をクリックし、 **Active Directory の情報から構築**します。 **サブジェクト名の形式:** 一覧表示して選択**DNS 名**、ことを確認します、 **DNS 名**ボックスがオンになってを**適用**します。  
  
9. をクリックして、**拡張**] タブで [**アプリケーション ポリシー**順にクリックします**編集**。 すべての既存のアプリケーション ポリシーを削除します。 をクリックして**追加**、し、**アプリケーション ポリシーの追加**ダイアログ ボックスで、をクリックして**新規**、入力**DA OTP RA**で、**名:** フィールドと**1.3.6.1.4.1.311.81.1.1**で、**オブジェクト識別子:** フィールドをクリックして**OK**します。 **アプリケーション ポリシーの追加**ダイアログ ボックスで、をクリックして**OK**。 **アプリケーション ポリシー拡張の編集**、 をクリックして**OK**します。 **新しいテンプレートのプロパティ**ダイアログ ボックスで、をクリックして**OK**。  
  
## <a name="DAOTPLogon"></a>作成して社内の CA によって発行された OTP 証明書の証明書テンプレートをデプロイするには  
  
1.  証明書テンプレート コンソールの詳細ペインで右クリックし、**スマート カード ログオン**テンプレート、およびクリック**テンプレートの複製**します。  
  
2.  **新しいテンプレートのプロパティ** ダイアログ ボックスの 、**互換性** タブで、**証明機関**一覧で、使用するオペレーティング システム をクリックし、**結果的な変更**ダイアログ ボックスで、をクリックして**OK**します。 **証明書の受信者**一覧は、使用するオペレーティング システムを選択し、**結果的な変更** ダイアログ ボックスをクリックして**ok**。  
  
3.  **新しいテンプレートのプロパティ**ダイアログ ボックスで、をクリックして、**全般**タブ。  
  
4.  **全般**] タブの [**テンプレート表示名**、型**DAOTPLogon**します。 **有効期間**、ボックスの一覧でクリックして**時間**の**証明書テンプレート**ダイアログ ボックスで、をクリックして **[ok]**、ことを確認します時間数が 1 に設定されます。 **更新期間**、型**0**します。  
  
    > [!IMPORTANT]  
    > **Windows Server 2003 CA**します。 場合、証明機関 (CA) は、Windows Server 2003 を実行しているコンピューターでは、別のコンピューターに証明書テンプレートを構成する必要があります。 これは、設定するために必要な**有効期間**時間では Windows Server 2008 および Windows Vista より前のバージョンの Windows を実行している場合。 テンプレートを構成するために使用するコンピューターでは、Active Directory Certificate Services サーバーの役割がインストールされていない場合、またはクライアント コンピューターである場合は、証明書テンプレート スナップインをインストールする必要があります。 詳細については、次を参照してください。[証明書テンプレート スナップインをインストール](https://technet.microsoft.com/library/cc732445.aspx)します。  
    >   
    > **Windows Server 2008 R2 CA**します。 Windows Server 2008 R2 を実行している証明機関 (CA) が既にある場合は、証明書テンプレートを構成する必要があります**更新期間**1 または 2 時間、および**有効期間**に以下でなければ、**更新期間**が 4 時間以内。 証明書テンプレートを構成する場合**有効期間**DirectAccess のインストール ウィザードを Windows Server 2008 R2 を実行している CA を 4 時間より長い、証明書テンプレート、および DirectAccess 検出できませんインストールは失敗します。  
  
5.  をクリックして、**セキュリティ**] タブで [ **Authenticated Users**の**許可**列、および選択、**読み取り**と**登録**チェック ボックス。 **[OK]** をクリックします。 クリックして**Domain Admins**と**Enterprise Admins**、 をクリック**フル コントロール**下、**許可**両方の列。 **[適用]** をクリックします。  
  
6.  をクリックして、**サブジェクト名**タブをクリックし、をクリックし、 **Active Directory の情報から構築**します。 **サブジェクト名の形式:** 一覧表示して選択**完全区分名**、ことを確認します、**ユーザー プリンシパル名 (UPN)** ボックスがオンになってし、**適用**.  
  
7.  をクリックして、 **Server** ] タブで、[、 **CA データベース内の証明書および要求を保存しない**、チェック ボックスをオフ、 **の発行された証明書の失効情報を含めないでください**チェック ボックスをオンし、**新しいテンプレートのプロパティ**ダイアログ ボックスで、をクリックして**適用**します。  
  
8.  をクリックして、**発行要件** タブで、、**この数の承認済み署名:**  チェック ボックスでは、その値を 1 に設定します。 **署名に必要なポリシーの種類:** 一覧表示して選択**アプリケーション ポリシー**、し、**アプリケーション ポリシー**一覧表示して選択**DA OTP RA**. **新しいテンプレートのプロパティ**ダイアログ ボックスで、をクリックして**OK**。  
  
9. をクリックして、**拡張機能** タブで、および**アプリケーション ポリシー**  をクリックして**編集**します。 削除**クライアント認証**、保持**SmartCardLogon**、 をクリック**OK** 2 回です。  
  
10. 証明書テンプレート コンソールを閉じます。  
  
11. **開始**画面で「**certsrv.msc**、し、ENTER キーを押します。  
  
12. 証明機関のコンソール ツリーで、展開**corp APP1 CA 1**、 をクリックして**証明書テンプレート**、右クリック**証明書テンプレート**、指す**新規**、 をクリック**発行する証明書テンプレート**します。  
  
13. 証明書テンプレートの一覧で、次のようにクリックします。 **DAOTPRA**と**DAOTPLogon**、 をクリック**OK**します。  
  
14. コンソールの詳細ウィンドウに表示されます、 **DAOTPRA**で証明書テンプレートを**使用目的に**の**DA OTP RA**と**DAOTPLogon**で証明書テンプレートを**目的**の**スマート カード ログオン**します。  
  
15. サービスを再起動します。  
  
16. 証明機関コンソールを閉じます。  
  
17. 管理者特権でのコマンド プロンプトを開きます。 型**CertUtil.exe-setreg DBFlags + DBFLAGS_ENABLEVOLATILEREQUESTS**、ENTER キーを押します。  
  
18. コマンド プロンプト ウィンドウを次の手順で開いたままにしておきます。  
  


